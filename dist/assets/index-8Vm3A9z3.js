(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))m(x);new MutationObserver(x=>{for(const S of x)if(S.type==="childList")for(const I of S.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&m(I)}).observe(document,{childList:!0,subtree:!0});function u(x){const S={};return x.integrity&&(S.integrity=x.integrity),x.referrerPolicy&&(S.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?S.credentials="include":x.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function m(x){if(x.ep)return;x.ep=!0;const S=u(x);fetch(x.href,S)}})();/**
* @vue/shared v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Zf(i,r){const u=new Set(i.split(","));return m=>u.has(m)}const Sn={},Nc=[],Yo=()=>{},$b=()=>!1,Ed=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),jf=i=>i.startsWith("onUpdate:"),Mr=Object.assign,Gf=(i,r)=>{const u=i.indexOf(r);u>-1&&i.splice(u,1)},Zb=Object.prototype.hasOwnProperty,Zi=(i,r)=>Zb.call(i,r),pi=Array.isArray,Uc=i=>Ld(i)==="[object Map]",uv=i=>Ld(i)==="[object Set]",Ii=i=>typeof i=="function",Kn=i=>typeof i=="string",wl=i=>typeof i=="symbol",Pn=i=>i!==null&&typeof i=="object",hv=i=>(Pn(i)||Ii(i))&&Ii(i.then)&&Ii(i.catch),dv=Object.prototype.toString,Ld=i=>dv.call(i),jb=i=>Ld(i).slice(8,-1),pv=i=>Ld(i)==="[object Object]",qf=i=>Kn(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Wu=Zf(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Md=i=>{const r=Object.create(null);return u=>r[u]||(r[u]=i(u))},Gb=/-(\w)/g,oc=Md(i=>i.replace(Gb,(r,u)=>u?u.toUpperCase():"")),qb=/\B([A-Z])/g,dc=Md(i=>i.replace(qb,"-$1").toLowerCase()),fv=Md(i=>i.charAt(0).toUpperCase()+i.slice(1)),Dp=Md(i=>i?`on${fv(i)}`:""),bl=(i,r)=>!Object.is(i,r),Bp=(i,...r)=>{for(let u=0;u<i.length;u++)i[u](...r)},mv=(i,r,u,m=!1)=>{Object.defineProperty(i,r,{configurable:!0,enumerable:!1,writable:m,value:u})},Hb=i=>{const r=parseFloat(i);return isNaN(r)?i:r};let sg;const _v=()=>sg||(sg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function eu(i){if(pi(i)){const r={};for(let u=0;u<i.length;u++){const m=i[u],x=Kn(m)?Yb(m):eu(m);if(x)for(const S in x)r[S]=x[S]}return r}else if(Kn(i)||Pn(i))return i}const Wb=/;(?![^(]*\))/g,Kb=/:([^]+)/,Xb=/\/\*[^]*?\*\//g;function Yb(i){const r={};return i.replace(Xb,"").split(Wb).forEach(u=>{if(u){const m=u.split(Kb);m.length>1&&(r[m[0].trim()]=m[1].trim())}}),r}function Po(i){let r="";if(Kn(i))r=i;else if(pi(i))for(let u=0;u<i.length;u++){const m=Po(i[u]);m&&(r+=m+" ")}else if(Pn(i))for(const u in i)i[u]&&(r+=u+" ");return r.trim()}const Jb="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Qb=Zf(Jb);function gv(i){return!!i||i===""}const yv=i=>!!(i&&i.__v_isRef===!0),Ra=i=>Kn(i)?i:i==null?"":pi(i)||Pn(i)&&(i.toString===dv||!Ii(i.toString))?yv(i)?Ra(i.value):JSON.stringify(i,vv,2):String(i),vv=(i,r)=>yv(r)?vv(i,r.value):Uc(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((u,[m,x],S)=>(u[Op(m,S)+" =>"]=x,u),{})}:uv(r)?{[`Set(${r.size})`]:[...r.values()].map(u=>Op(u))}:wl(r)?Op(r):Pn(r)&&!pi(r)&&!pv(r)?String(r):r,Op=(i,r="")=>{var u;return wl(i)?`Symbol(${(u=i.description)!=null?u:r})`:i};/**
* @vue/reactivity v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ws;class tw{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=ws,!r&&ws&&(this.index=(ws.scopes||(ws.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const u=ws;try{return ws=this,r()}finally{ws=u}}}on(){ws=this}off(){ws=this.parent}stop(r){if(this._active){let u,m;for(u=0,m=this.effects.length;u<m;u++)this.effects[u].stop();for(u=0,m=this.cleanups.length;u<m;u++)this.cleanups[u]();if(this.scopes)for(u=0,m=this.scopes.length;u<m;u++)this.scopes[u].stop(!0);if(!this.detached&&this.parent&&!r){const x=this.parent.scopes.pop();x&&x!==this&&(this.parent.scopes[this.index]=x,x.index=this.index)}this.parent=void 0,this._active=!1}}}function ew(i,r=ws){r&&r.active&&r.effects.push(i)}function iw(){return ws}let Jl;class Hf{constructor(r,u,m,x){this.fn=r,this.trigger=u,this.scheduler=m,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,ew(this,x)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Tl();for(let r=0;r<this._depsLength;r++){const u=this.deps[r];if(u.computed&&(nw(u.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Sl()}return this._dirtyLevel>=4}set dirty(r){this._dirtyLevel=r?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let r=vl,u=Jl;try{return vl=!0,Jl=this,this._runnings++,ag(this),this.fn()}finally{lg(this),this._runnings--,Jl=u,vl=r}}stop(){this.active&&(ag(this),lg(this),this.onStop&&this.onStop(),this.active=!1)}}function nw(i){return i.value}function ag(i){i._trackId++,i._depsLength=0}function lg(i){if(i.deps.length>i._depsLength){for(let r=i._depsLength;r<i.deps.length;r++)xv(i.deps[r],i);i.deps.length=i._depsLength}}function xv(i,r){const u=i.get(r);u!==void 0&&r._trackId!==u&&(i.delete(r),i.size===0&&i.cleanup())}let vl=!0,Qp=0;const bv=[];function Tl(){bv.push(vl),vl=!1}function Sl(){const i=bv.pop();vl=i===void 0?!0:i}function Wf(){Qp++}function Kf(){for(Qp--;!Qp&&tf.length;)tf.shift()()}function wv(i,r,u){if(r.get(i)!==i._trackId){r.set(i,i._trackId);const m=i.deps[i._depsLength];m!==r?(m&&xv(m,i),i.deps[i._depsLength++]=r):i._depsLength++}}const tf=[];function Tv(i,r,u){Wf();for(const m of i.keys()){let x;m._dirtyLevel<r&&(x??(x=i.get(m)===m._trackId))&&(m._shouldSchedule||(m._shouldSchedule=m._dirtyLevel===0),m._dirtyLevel=r),m._shouldSchedule&&(x??(x=i.get(m)===m._trackId))&&(m.trigger(),(!m._runnings||m.allowRecurse)&&m._dirtyLevel!==2&&(m._shouldSchedule=!1,m.scheduler&&tf.push(m.scheduler)))}Kf()}const Sv=(i,r)=>{const u=new Map;return u.cleanup=i,u.computed=r,u},ef=new WeakMap,Ql=Symbol(""),nf=Symbol("");function so(i,r,u){if(vl&&Jl){let m=ef.get(i);m||ef.set(i,m=new Map);let x=m.get(u);x||m.set(u,x=Sv(()=>m.delete(u))),wv(Jl,x)}}function Da(i,r,u,m,x,S){const I=ef.get(i);if(!I)return;let c=[];if(r==="clear")c=[...I.values()];else if(u==="length"&&pi(i)){const F=Number(m);I.forEach((D,q)=>{(q==="length"||!wl(q)&&q>=F)&&c.push(D)})}else switch(u!==void 0&&c.push(I.get(u)),r){case"add":pi(i)?qf(u)&&c.push(I.get("length")):(c.push(I.get(Ql)),Uc(i)&&c.push(I.get(nf)));break;case"delete":pi(i)||(c.push(I.get(Ql)),Uc(i)&&c.push(I.get(nf)));break;case"set":Uc(i)&&c.push(I.get(Ql));break}Wf();for(const F of c)F&&Tv(F,4);Kf()}const rw=Zf("__proto__,__v_isRef,__isVue"),Pv=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(wl)),cg=ow();function ow(){const i={};return["includes","indexOf","lastIndexOf"].forEach(r=>{i[r]=function(...u){const m=tn(this);for(let S=0,I=this.length;S<I;S++)so(m,"get",S+"");const x=m[r](...u);return x===-1||x===!1?m[r](...u.map(tn)):x}}),["push","pop","shift","unshift","splice"].forEach(r=>{i[r]=function(...u){Tl(),Wf();const m=tn(this)[r].apply(this,u);return Kf(),Sl(),m}}),i}function sw(i){wl(i)||(i=String(i));const r=tn(this);return so(r,"has",i),r.hasOwnProperty(i)}class Av{constructor(r=!1,u=!1){this._isReadonly=r,this._isShallow=u}get(r,u,m){const x=this._isReadonly,S=this._isShallow;if(u==="__v_isReactive")return!x;if(u==="__v_isReadonly")return x;if(u==="__v_isShallow")return S;if(u==="__v_raw")return m===(x?S?vw:Lv:S?Ev:Cv).get(r)||Object.getPrototypeOf(r)===Object.getPrototypeOf(m)?r:void 0;const I=pi(r);if(!x){if(I&&Zi(cg,u))return Reflect.get(cg,u,m);if(u==="hasOwnProperty")return sw}const c=Reflect.get(r,u,m);return(wl(u)?Pv.has(u):rw(u))||(x||so(r,"get",u),S)?c:ao(c)?I&&qf(u)?c:c.value:Pn(c)?x?Mv(c):Jf(c):c}}class Iv extends Av{constructor(r=!1){super(!1,r)}set(r,u,m,x){let S=r[u];if(!this._isShallow){const F=sc(S);if(!Wc(m)&&!sc(m)&&(S=tn(S),m=tn(m)),!pi(r)&&ao(S)&&!ao(m))return F?!1:(S.value=m,!0)}const I=pi(r)&&qf(u)?Number(u)<r.length:Zi(r,u),c=Reflect.set(r,u,m,x);return r===tn(x)&&(I?bl(m,S)&&Da(r,"set",u,m):Da(r,"add",u,m)),c}deleteProperty(r,u){const m=Zi(r,u);r[u];const x=Reflect.deleteProperty(r,u);return x&&m&&Da(r,"delete",u,void 0),x}has(r,u){const m=Reflect.has(r,u);return(!wl(u)||!Pv.has(u))&&so(r,"has",u),m}ownKeys(r){return so(r,"iterate",pi(r)?"length":Ql),Reflect.ownKeys(r)}}class aw extends Av{constructor(r=!1){super(!0,r)}set(r,u){return!0}deleteProperty(r,u){return!0}}const lw=new Iv,cw=new aw,uw=new Iv(!0);const Xf=i=>i,kd=i=>Reflect.getPrototypeOf(i);function Dh(i,r,u=!1,m=!1){i=i.__v_raw;const x=tn(i),S=tn(r);u||(bl(r,S)&&so(x,"get",r),so(x,"get",S));const{has:I}=kd(x),c=m?Xf:u?tm:Ju;if(I.call(x,r))return c(i.get(r));if(I.call(x,S))return c(i.get(S));i!==x&&i.get(r)}function Bh(i,r=!1){const u=this.__v_raw,m=tn(u),x=tn(i);return r||(bl(i,x)&&so(m,"has",i),so(m,"has",x)),i===x?u.has(i):u.has(i)||u.has(x)}function Oh(i,r=!1){return i=i.__v_raw,!r&&so(tn(i),"iterate",Ql),Reflect.get(i,"size",i)}function ug(i,r=!1){!r&&!Wc(i)&&!sc(i)&&(i=tn(i));const u=tn(this);return kd(u).has.call(u,i)||(u.add(i),Da(u,"add",i,i)),this}function hg(i,r,u=!1){!u&&!Wc(r)&&!sc(r)&&(r=tn(r));const m=tn(this),{has:x,get:S}=kd(m);let I=x.call(m,i);I||(i=tn(i),I=x.call(m,i));const c=S.call(m,i);return m.set(i,r),I?bl(r,c)&&Da(m,"set",i,r):Da(m,"add",i,r),this}function dg(i){const r=tn(this),{has:u,get:m}=kd(r);let x=u.call(r,i);x||(i=tn(i),x=u.call(r,i)),m&&m.call(r,i);const S=r.delete(i);return x&&Da(r,"delete",i,void 0),S}function pg(){const i=tn(this),r=i.size!==0,u=i.clear();return r&&Da(i,"clear",void 0,void 0),u}function Fh(i,r){return function(m,x){const S=this,I=S.__v_raw,c=tn(I),F=r?Xf:i?tm:Ju;return!i&&so(c,"iterate",Ql),I.forEach((D,q)=>m.call(x,F(D),F(q),S))}}function Nh(i,r,u){return function(...m){const x=this.__v_raw,S=tn(x),I=Uc(S),c=i==="entries"||i===Symbol.iterator&&I,F=i==="keys"&&I,D=x[i](...m),q=u?Xf:r?tm:Ju;return!r&&so(S,"iterate",F?nf:Ql),{next(){const{value:W,done:K}=D.next();return K?{value:W,done:K}:{value:c?[q(W[0]),q(W[1])]:q(W),done:K}},[Symbol.iterator](){return this}}}}function ml(i){return function(...r){return i==="delete"?!1:i==="clear"?void 0:this}}function hw(){const i={get(S){return Dh(this,S)},get size(){return Oh(this)},has:Bh,add:ug,set:hg,delete:dg,clear:pg,forEach:Fh(!1,!1)},r={get(S){return Dh(this,S,!1,!0)},get size(){return Oh(this)},has:Bh,add(S){return ug.call(this,S,!0)},set(S,I){return hg.call(this,S,I,!0)},delete:dg,clear:pg,forEach:Fh(!1,!0)},u={get(S){return Dh(this,S,!0)},get size(){return Oh(this,!0)},has(S){return Bh.call(this,S,!0)},add:ml("add"),set:ml("set"),delete:ml("delete"),clear:ml("clear"),forEach:Fh(!0,!1)},m={get(S){return Dh(this,S,!0,!0)},get size(){return Oh(this,!0)},has(S){return Bh.call(this,S,!0)},add:ml("add"),set:ml("set"),delete:ml("delete"),clear:ml("clear"),forEach:Fh(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(S=>{i[S]=Nh(S,!1,!1),u[S]=Nh(S,!0,!1),r[S]=Nh(S,!1,!0),m[S]=Nh(S,!0,!0)}),[i,u,r,m]}const[dw,pw,fw,mw]=hw();function Yf(i,r){const u=r?i?mw:fw:i?pw:dw;return(m,x,S)=>x==="__v_isReactive"?!i:x==="__v_isReadonly"?i:x==="__v_raw"?m:Reflect.get(Zi(u,x)&&x in m?u:m,x,S)}const _w={get:Yf(!1,!1)},gw={get:Yf(!1,!0)},yw={get:Yf(!0,!1)};const Cv=new WeakMap,Ev=new WeakMap,Lv=new WeakMap,vw=new WeakMap;function xw(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function bw(i){return i.__v_skip||!Object.isExtensible(i)?0:xw(jb(i))}function Jf(i){return sc(i)?i:Qf(i,!1,lw,_w,Cv)}function ww(i){return Qf(i,!1,uw,gw,Ev)}function Mv(i){return Qf(i,!0,cw,yw,Lv)}function Qf(i,r,u,m,x){if(!Pn(i)||i.__v_raw&&!(r&&i.__v_isReactive))return i;const S=x.get(i);if(S)return S;const I=bw(i);if(I===0)return i;const c=new Proxy(i,I===2?m:u);return x.set(i,c),c}function Ku(i){return sc(i)?Ku(i.__v_raw):!!(i&&i.__v_isReactive)}function sc(i){return!!(i&&i.__v_isReadonly)}function Wc(i){return!!(i&&i.__v_isShallow)}function kv(i){return i?!!i.__v_raw:!1}function tn(i){const r=i&&i.__v_raw;return r?tn(r):i}function Tw(i){return Object.isExtensible(i)&&mv(i,"__v_skip",!0),i}const Ju=i=>Pn(i)?Jf(i):i,tm=i=>Pn(i)?Mv(i):i;class zv{constructor(r,u,m,x){this.getter=r,this._setter=u,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Hf(()=>r(this._value),()=>Kh(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!x,this.__v_isReadonly=m}get value(){const r=tn(this);return(!r._cacheable||r.effect.dirty)&&bl(r._value,r._value=r.effect.run())&&Kh(r,4),Rv(r),r.effect._dirtyLevel>=2&&Kh(r,2),r._value}set value(r){this._setter(r)}get _dirty(){return this.effect.dirty}set _dirty(r){this.effect.dirty=r}}function Sw(i,r,u=!1){let m,x;const S=Ii(i);return S?(m=i,x=Yo):(m=i.get,x=i.set),new zv(m,x,S||!x,u)}function Rv(i){var r;vl&&Jl&&(i=tn(i),wv(Jl,(r=i.dep)!=null?r:i.dep=Sv(()=>i.dep=void 0,i instanceof zv?i:void 0)))}function Kh(i,r=4,u,m){i=tn(i);const x=i.dep;x&&Tv(x,r)}function ao(i){return!!(i&&i.__v_isRef===!0)}function Er(i){return Pw(i,!1)}function Pw(i,r){return ao(i)?i:new Aw(i,r)}class Aw{constructor(r,u){this.__v_isShallow=u,this.dep=void 0,this.__v_isRef=!0,this._rawValue=u?r:tn(r),this._value=u?r:Ju(r)}get value(){return Rv(this),this._value}set value(r){const u=this.__v_isShallow||Wc(r)||sc(r);r=u?r:tn(r),bl(r,this._rawValue)&&(this._rawValue,this._rawValue=r,this._value=u?r:Ju(r),Kh(this,4))}}function Gr(i){return ao(i)?i.value:i}const Iw={get:(i,r,u)=>Gr(Reflect.get(i,r,u)),set:(i,r,u,m)=>{const x=i[r];return ao(x)&&!ao(u)?(x.value=u,!0):Reflect.set(i,r,u,m)}};function Dv(i){return Ku(i)?i:new Proxy(i,Iw)}/**
* @vue/runtime-core v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function xl(i,r,u,m){try{return m?i(...m):i()}catch(x){zd(x,r,u)}}function As(i,r,u,m){if(Ii(i)){const x=xl(i,r,u,m);return x&&hv(x)&&x.catch(S=>{zd(S,r,u)}),x}if(pi(i)){const x=[];for(let S=0;S<i.length;S++)x.push(As(i[S],r,u,m));return x}}function zd(i,r,u,m=!0){const x=r?r.vnode:null;if(r){let S=r.parent;const I=r.proxy,c=`https://vuejs.org/error-reference/#runtime-${u}`;for(;S;){const D=S.ec;if(D){for(let q=0;q<D.length;q++)if(D[q](i,I,c)===!1)return}S=S.parent}const F=r.appContext.config.errorHandler;if(F){Tl(),xl(F,null,10,[i,I,c]),Sl();return}}Cw(i,u,x,m)}function Cw(i,r,u,m=!0){console.error(i)}let Qu=!1,rf=!1;const Lr=[];let Ys=0;const Vc=[];let _l=null,Kl=0;const Bv=Promise.resolve();let em=null;function Ew(i){const r=em||Bv;return i?r.then(this?i.bind(this):i):r}function Lw(i){let r=Ys+1,u=Lr.length;for(;r<u;){const m=r+u>>>1,x=Lr[m],S=th(x);S<i||S===i&&x.pre?r=m+1:u=m}return r}function im(i){(!Lr.length||!Lr.includes(i,Qu&&i.allowRecurse?Ys+1:Ys))&&(i.id==null?Lr.push(i):Lr.splice(Lw(i.id),0,i),Ov())}function Ov(){!Qu&&!rf&&(rf=!0,em=Bv.then(Nv))}function Mw(i){const r=Lr.indexOf(i);r>Ys&&Lr.splice(r,1)}function kw(i){pi(i)?Vc.push(...i):(!_l||!_l.includes(i,i.allowRecurse?Kl+1:Kl))&&Vc.push(i),Ov()}function fg(i,r,u=Qu?Ys+1:0){for(;u<Lr.length;u++){const m=Lr[u];if(m&&m.pre){if(i&&m.id!==i.uid)continue;Lr.splice(u,1),u--,m()}}}function Fv(i){if(Vc.length){const r=[...new Set(Vc)].sort((u,m)=>th(u)-th(m));if(Vc.length=0,_l){_l.push(...r);return}for(_l=r,Kl=0;Kl<_l.length;Kl++){const u=_l[Kl];u.active!==!1&&u()}_l=null,Kl=0}}const th=i=>i.id==null?1/0:i.id,zw=(i,r)=>{const u=th(i)-th(r);if(u===0){if(i.pre&&!r.pre)return-1;if(r.pre&&!i.pre)return 1}return u};function Nv(i){rf=!1,Qu=!0,Lr.sort(zw);try{for(Ys=0;Ys<Lr.length;Ys++){const r=Lr[Ys];r&&r.active!==!1&&xl(r,r.i,r.i?15:14)}}finally{Ys=0,Lr.length=0,Fv(),Qu=!1,em=null,(Lr.length||Vc.length)&&Nv()}}let ta=null,Uv=null;function ud(i){const r=ta;return ta=i,Uv=i&&i.type.__scopeId||null,r}function Vv(i,r=ta,u){if(!r||i._n)return i;const m=(...x)=>{m._d&&wg(-1);const S=ud(r);let I;try{I=i(...x)}finally{ud(S),m._d&&wg(1)}return I};return m._n=!0,m._c=!0,m._d=!0,m}function ql(i,r,u,m){const x=i.dirs,S=r&&r.dirs;for(let I=0;I<x.length;I++){const c=x[I];S&&(c.oldValue=S[I].value);let F=c.dir[m];F&&(Tl(),As(F,u,8,[i.el,c,i,r]),Sl())}}function $v(i,r){i.shapeFlag&6&&i.component?$v(i.component.subTree,r):i.shapeFlag&128?(i.ssContent.transition=r.clone(i.ssContent),i.ssFallback.transition=r.clone(i.ssFallback)):i.transition=r}/*! #__NO_SIDE_EFFECTS__ */function lh(i,r){return Ii(i)?Mr({name:i.name},r,{setup:i}):i}const Xh=i=>!!i.type.__asyncLoader,Zv=i=>i.type.__isKeepAlive;function Rw(i,r){jv(i,"a",r)}function Dw(i,r){jv(i,"da",r)}function jv(i,r,u=qr){const m=i.__wdc||(i.__wdc=()=>{let x=u;for(;x;){if(x.isDeactivated)return;x=x.parent}return i()});if(Rd(r,m,u),u){let x=u.parent;for(;x&&x.parent;)Zv(x.parent.vnode)&&Bw(m,r,u,x),x=x.parent}}function Bw(i,r,u,m){const x=Rd(r,i,m,!0);qv(()=>{Gf(m[r],x)},u)}function Rd(i,r,u=qr,m=!1){if(u){const x=u[i]||(u[i]=[]),S=r.__weh||(r.__weh=(...I)=>{Tl();const c=ch(u),F=As(r,u,i,I);return c(),Sl(),F});return m?x.unshift(S):x.push(S),S}}const Oa=i=>(r,u=qr)=>{(!Od||i==="sp")&&Rd(i,(...m)=>r(...m),u)},Ow=Oa("bm"),nm=Oa("m"),Fw=Oa("bu"),Nw=Oa("u"),Gv=Oa("bum"),qv=Oa("um"),Uw=Oa("sp"),Vw=Oa("rtg"),$w=Oa("rtc");function Zw(i,r=qr){Rd("ec",i,r)}const jw=Symbol.for("v-ndc");function of(i,r,u,m){let x;const S=u;if(pi(i)||Kn(i)){x=new Array(i.length);for(let I=0,c=i.length;I<c;I++)x[I]=r(i[I],I,void 0,S)}else if(typeof i=="number"){x=new Array(i);for(let I=0;I<i;I++)x[I]=r(I+1,I,void 0,S)}else if(Pn(i))if(i[Symbol.iterator])x=Array.from(i,(I,c)=>r(I,c,void 0,S));else{const I=Object.keys(i);x=new Array(I.length);for(let c=0,F=I.length;c<F;c++){const D=I[c];x[c]=r(i[D],D,c,S)}}else x=[];return x}const sf=i=>i?p0(i)?am(i):sf(i.parent):null,Xu=Mr(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>sf(i.parent),$root:i=>sf(i.root),$emit:i=>i.emit,$options:i=>rm(i),$forceUpdate:i=>i.f||(i.f=()=>{i.effect.dirty=!0,im(i.update)}),$nextTick:i=>i.n||(i.n=Ew.bind(i.proxy)),$watch:i=>f2.bind(i)}),Fp=(i,r)=>i!==Sn&&!i.__isScriptSetup&&Zi(i,r),Gw={get({_:i},r){if(r==="__v_skip")return!0;const{ctx:u,setupState:m,data:x,props:S,accessCache:I,type:c,appContext:F}=i;let D;if(r[0]!=="$"){const bt=I[r];if(bt!==void 0)switch(bt){case 1:return m[r];case 2:return x[r];case 4:return u[r];case 3:return S[r]}else{if(Fp(m,r))return I[r]=1,m[r];if(x!==Sn&&Zi(x,r))return I[r]=2,x[r];if((D=i.propsOptions[0])&&Zi(D,r))return I[r]=3,S[r];if(u!==Sn&&Zi(u,r))return I[r]=4,u[r];af&&(I[r]=0)}}const q=Xu[r];let W,K;if(q)return r==="$attrs"&&so(i.attrs,"get",""),q(i);if((W=c.__cssModules)&&(W=W[r]))return W;if(u!==Sn&&Zi(u,r))return I[r]=4,u[r];if(K=F.config.globalProperties,Zi(K,r))return K[r]},set({_:i},r,u){const{data:m,setupState:x,ctx:S}=i;return Fp(x,r)?(x[r]=u,!0):m!==Sn&&Zi(m,r)?(m[r]=u,!0):Zi(i.props,r)||r[0]==="$"&&r.slice(1)in i?!1:(S[r]=u,!0)},has({_:{data:i,setupState:r,accessCache:u,ctx:m,appContext:x,propsOptions:S}},I){let c;return!!u[I]||i!==Sn&&Zi(i,I)||Fp(r,I)||(c=S[0])&&Zi(c,I)||Zi(m,I)||Zi(Xu,I)||Zi(x.config.globalProperties,I)},defineProperty(i,r,u){return u.get!=null?i._.accessCache[r]=0:Zi(u,"value")&&this.set(i,r,u.value,null),Reflect.defineProperty(i,r,u)}};function mg(i){return pi(i)?i.reduce((r,u)=>(r[u]=null,r),{}):i}let af=!0;function qw(i){const r=rm(i),u=i.proxy,m=i.ctx;af=!1,r.beforeCreate&&_g(r.beforeCreate,i,"bc");const{data:x,computed:S,methods:I,watch:c,provide:F,inject:D,created:q,beforeMount:W,mounted:K,beforeUpdate:bt,updated:zt,activated:Pt,deactivated:oe,beforeDestroy:Jt,beforeUnmount:Ut,destroyed:Zt,unmounted:Le,render:de,renderTracked:te,renderTriggered:Ce,errorCaptured:pe,serverPrefetch:Fe,expose:ce,inheritAttrs:Qt,components:fe,directives:ke,filters:Ae}=r;if(D&&Hw(D,m,null),I)for(const Me in I){const Ht=I[Me];Ii(Ht)&&(m[Me]=Ht.bind(u))}if(x){const Me=x.call(u,u);Pn(Me)&&(i.data=Jf(Me))}if(af=!0,S)for(const Me in S){const Ht=S[Me],fi=Ii(Ht)?Ht.bind(u,u):Ii(Ht.get)?Ht.get.bind(u,u):Yo,ze=!Ii(Ht)&&Ii(Ht.set)?Ht.set.bind(u):Yo,Ue=td({get:fi,set:ze});Object.defineProperty(m,Me,{enumerable:!0,configurable:!0,get:()=>Ue.value,set:si=>Ue.value=si})}if(c)for(const Me in c)Hv(c[Me],m,u,Me);if(F){const Me=Ii(F)?F.call(u):F;Reflect.ownKeys(Me).forEach(Ht=>{Qw(Ht,Me[Ht])})}q&&_g(q,i,"c");function we(Me,Ht){pi(Ht)?Ht.forEach(fi=>Me(fi.bind(u))):Ht&&Me(Ht.bind(u))}if(we(Ow,W),we(nm,K),we(Fw,bt),we(Nw,zt),we(Rw,Pt),we(Dw,oe),we(Zw,pe),we($w,te),we(Vw,Ce),we(Gv,Ut),we(qv,Le),we(Uw,Fe),pi(ce))if(ce.length){const Me=i.exposed||(i.exposed={});ce.forEach(Ht=>{Object.defineProperty(Me,Ht,{get:()=>u[Ht],set:fi=>u[Ht]=fi})})}else i.exposed||(i.exposed={});de&&i.render===Yo&&(i.render=de),Qt!=null&&(i.inheritAttrs=Qt),fe&&(i.components=fe),ke&&(i.directives=ke)}function Hw(i,r,u=Yo){pi(i)&&(i=lf(i));for(const m in i){const x=i[m];let S;Pn(x)?"default"in x?S=Yh(x.from||m,x.default,!0):S=Yh(x.from||m):S=Yh(x),ao(S)?Object.defineProperty(r,m,{enumerable:!0,configurable:!0,get:()=>S.value,set:I=>S.value=I}):r[m]=S}}function _g(i,r,u){As(pi(i)?i.map(m=>m.bind(r.proxy)):i.bind(r.proxy),r,u)}function Hv(i,r,u,m){const x=m.includes(".")?a0(u,m):()=>u[m];if(Kn(i)){const S=r[i];Ii(S)&&Jh(x,S)}else if(Ii(i))Jh(x,i.bind(u));else if(Pn(i))if(pi(i))i.forEach(S=>Hv(S,r,u,m));else{const S=Ii(i.handler)?i.handler.bind(u):r[i.handler];Ii(S)&&Jh(x,S,i)}}function rm(i){const r=i.type,{mixins:u,extends:m}=r,{mixins:x,optionsCache:S,config:{optionMergeStrategies:I}}=i.appContext,c=S.get(r);let F;return c?F=c:!x.length&&!u&&!m?F=r:(F={},x.length&&x.forEach(D=>hd(F,D,I,!0)),hd(F,r,I)),Pn(r)&&S.set(r,F),F}function hd(i,r,u,m=!1){const{mixins:x,extends:S}=r;S&&hd(i,S,u,!0),x&&x.forEach(I=>hd(i,I,u,!0));for(const I in r)if(!(m&&I==="expose")){const c=Ww[I]||u&&u[I];i[I]=c?c(i[I],r[I]):r[I]}return i}const Ww={data:gg,props:yg,emits:yg,methods:Nu,computed:Nu,beforeCreate:jr,created:jr,beforeMount:jr,mounted:jr,beforeUpdate:jr,updated:jr,beforeDestroy:jr,beforeUnmount:jr,destroyed:jr,unmounted:jr,activated:jr,deactivated:jr,errorCaptured:jr,serverPrefetch:jr,components:Nu,directives:Nu,watch:Xw,provide:gg,inject:Kw};function gg(i,r){return r?i?function(){return Mr(Ii(i)?i.call(this,this):i,Ii(r)?r.call(this,this):r)}:r:i}function Kw(i,r){return Nu(lf(i),lf(r))}function lf(i){if(pi(i)){const r={};for(let u=0;u<i.length;u++)r[i[u]]=i[u];return r}return i}function jr(i,r){return i?[...new Set([].concat(i,r))]:r}function Nu(i,r){return i?Mr(Object.create(null),i,r):r}function yg(i,r){return i?pi(i)&&pi(r)?[...new Set([...i,...r])]:Mr(Object.create(null),mg(i),mg(r??{})):r}function Xw(i,r){if(!i)return r;if(!r)return i;const u=Mr(Object.create(null),i);for(const m in r)u[m]=jr(i[m],r[m]);return u}function Wv(){return{app:null,config:{isNativeTag:$b,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Yw=0;function Jw(i,r){return function(m,x=null){Ii(m)||(m=Mr({},m)),x!=null&&!Pn(x)&&(x=null);const S=Wv(),I=new WeakSet;let c=!1;const F=S.app={_uid:Yw++,_component:m,_props:x,_container:null,_context:S,_instance:null,version:B2,get config(){return S.config},set config(D){},use(D,...q){return I.has(D)||(D&&Ii(D.install)?(I.add(D),D.install(F,...q)):Ii(D)&&(I.add(D),D(F,...q))),F},mixin(D){return S.mixins.includes(D)||S.mixins.push(D),F},component(D,q){return q?(S.components[D]=q,F):S.components[D]},directive(D,q){return q?(S.directives[D]=q,F):S.directives[D]},mount(D,q,W){if(!c){const K=Qo(m,x);return K.appContext=S,W===!0?W="svg":W===!1&&(W=void 0),q&&r?r(K,D):i(K,D,W),c=!0,F._container=D,D.__vue_app__=F,am(K.component)}},unmount(){c&&(i(null,F._container),delete F._container.__vue_app__)},provide(D,q){return S.provides[D]=q,F},runWithContext(D){const q=$c;$c=F;try{return D()}finally{$c=q}}};return F}}let $c=null;function Qw(i,r){if(qr){let u=qr.provides;const m=qr.parent&&qr.parent.provides;m===u&&(u=qr.provides=Object.create(m)),u[i]=r}}function Yh(i,r,u=!1){const m=qr||ta;if(m||$c){const x=$c?$c._context.provides:m?m.parent==null?m.vnode.appContext&&m.vnode.appContext.provides:m.parent.provides:void 0;if(x&&i in x)return x[i];if(arguments.length>1)return u&&Ii(r)?r.call(m&&m.proxy):r}}const Kv={},Xv=()=>Object.create(Kv),Yv=i=>Object.getPrototypeOf(i)===Kv;function t2(i,r,u,m=!1){const x={},S=Xv();i.propsDefaults=Object.create(null),Jv(i,r,x,S);for(const I in i.propsOptions[0])I in x||(x[I]=void 0);u?i.props=m?x:ww(x):i.type.props?i.props=x:i.props=S,i.attrs=S}function e2(i,r,u,m){const{props:x,attrs:S,vnode:{patchFlag:I}}=i,c=tn(x),[F]=i.propsOptions;let D=!1;if((m||I>0)&&!(I&16)){if(I&8){const q=i.vnode.dynamicProps;for(let W=0;W<q.length;W++){let K=q[W];if(Dd(i.emitsOptions,K))continue;const bt=r[K];if(F)if(Zi(S,K))bt!==S[K]&&(S[K]=bt,D=!0);else{const zt=oc(K);x[zt]=cf(F,c,zt,bt,i,!1)}else bt!==S[K]&&(S[K]=bt,D=!0)}}}else{Jv(i,r,x,S)&&(D=!0);let q;for(const W in c)(!r||!Zi(r,W)&&((q=dc(W))===W||!Zi(r,q)))&&(F?u&&(u[W]!==void 0||u[q]!==void 0)&&(x[W]=cf(F,c,W,void 0,i,!0)):delete x[W]);if(S!==c)for(const W in S)(!r||!Zi(r,W))&&(delete S[W],D=!0)}D&&Da(i.attrs,"set","")}function Jv(i,r,u,m){const[x,S]=i.propsOptions;let I=!1,c;if(r)for(let F in r){if(Wu(F))continue;const D=r[F];let q;x&&Zi(x,q=oc(F))?!S||!S.includes(q)?u[q]=D:(c||(c={}))[q]=D:Dd(i.emitsOptions,F)||(!(F in m)||D!==m[F])&&(m[F]=D,I=!0)}if(S){const F=tn(u),D=c||Sn;for(let q=0;q<S.length;q++){const W=S[q];u[W]=cf(x,F,W,D[W],i,!Zi(D,W))}}return I}function cf(i,r,u,m,x,S){const I=i[u];if(I!=null){const c=Zi(I,"default");if(c&&m===void 0){const F=I.default;if(I.type!==Function&&!I.skipFactory&&Ii(F)){const{propsDefaults:D}=x;if(u in D)m=D[u];else{const q=ch(x);m=D[u]=F.call(null,r),q()}}else m=F}I[0]&&(S&&!c?m=!1:I[1]&&(m===""||m===dc(u))&&(m=!0))}return m}const i2=new WeakMap;function Qv(i,r,u=!1){const m=u?i2:r.propsCache,x=m.get(i);if(x)return x;const S=i.props,I={},c=[];let F=!1;if(!Ii(i)){const q=W=>{F=!0;const[K,bt]=Qv(W,r,!0);Mr(I,K),bt&&c.push(...bt)};!u&&r.mixins.length&&r.mixins.forEach(q),i.extends&&q(i.extends),i.mixins&&i.mixins.forEach(q)}if(!S&&!F)return Pn(i)&&m.set(i,Nc),Nc;if(pi(S))for(let q=0;q<S.length;q++){const W=oc(S[q]);vg(W)&&(I[W]=Sn)}else if(S)for(const q in S){const W=oc(q);if(vg(W)){const K=S[q],bt=I[W]=pi(K)||Ii(K)?{type:K}:Mr({},K),zt=bt.type;let Pt=!1,oe=!0;if(pi(zt))for(let Jt=0;Jt<zt.length;++Jt){const Ut=zt[Jt],Zt=Ii(Ut)&&Ut.name;if(Zt==="Boolean"){Pt=!0;break}else Zt==="String"&&(oe=!1)}else Pt=Ii(zt)&&zt.name==="Boolean";bt[0]=Pt,bt[1]=oe,(Pt||Zi(bt,"default"))&&c.push(W)}}const D=[I,c];return Pn(i)&&m.set(i,D),D}function vg(i){return i[0]!=="$"&&!Wu(i)}const t0=i=>i[0]==="_"||i==="$stable",om=i=>pi(i)?i.map(Xs):[Xs(i)],n2=(i,r,u)=>{if(r._n)return r;const m=Vv((...x)=>om(r(...x)),u);return m._c=!1,m},e0=(i,r,u)=>{const m=i._ctx;for(const x in i){if(t0(x))continue;const S=i[x];if(Ii(S))r[x]=n2(x,S,m);else if(S!=null){const I=om(S);r[x]=()=>I}}},i0=(i,r)=>{const u=om(r);i.slots.default=()=>u},n0=(i,r,u)=>{for(const m in r)(u||m!=="_")&&(i[m]=r[m])},r2=(i,r,u)=>{const m=i.slots=Xv();if(i.vnode.shapeFlag&32){const x=r._;x?(n0(m,r,u),u&&mv(m,"_",x,!0)):e0(r,m)}else r&&i0(i,r)},o2=(i,r,u)=>{const{vnode:m,slots:x}=i;let S=!0,I=Sn;if(m.shapeFlag&32){const c=r._;c?u&&c===1?S=!1:n0(x,r,u):(S=!r.$stable,e0(r,x)),I=r}else r&&(i0(i,r),I={default:1});if(S)for(const c in x)!t0(c)&&I[c]==null&&delete x[c]};function uf(i,r,u,m,x=!1){if(pi(i)){i.forEach((K,bt)=>uf(K,r&&(pi(r)?r[bt]:r),u,m,x));return}if(Xh(m)&&!x)return;const S=m.shapeFlag&4?am(m.component):m.el,I=x?null:S,{i:c,r:F}=i,D=r&&r.r,q=c.refs===Sn?c.refs={}:c.refs,W=c.setupState;if(D!=null&&D!==F&&(Kn(D)?(q[D]=null,Zi(W,D)&&(W[D]=null)):ao(D)&&(D.value=null)),Ii(F))xl(F,c,12,[I,q]);else{const K=Kn(F),bt=ao(F);if(K||bt){const zt=()=>{if(i.f){const Pt=K?Zi(W,F)?W[F]:q[F]:F.value;x?pi(Pt)&&Gf(Pt,S):pi(Pt)?Pt.includes(S)||Pt.push(S):K?(q[F]=[S],Zi(W,F)&&(W[F]=q[F])):(F.value=[S],i.k&&(q[i.k]=F.value))}else K?(q[F]=I,Zi(W,F)&&(W[F]=I)):bt&&(F.value=I,i.k&&(q[i.k]=I))};I?(zt.id=-1,no(zt,u)):zt()}}}const s2=Symbol("_vte"),a2=i=>i.__isTeleport,no=w2;function l2(i){return c2(i)}function c2(i,r){const u=_v();u.__VUE__=!0;const{insert:m,remove:x,patchProp:S,createElement:I,createText:c,createComment:F,setText:D,setElementText:q,parentNode:W,nextSibling:K,setScopeId:bt=Yo,insertStaticContent:zt}=i,Pt=(ut,mt,Mt,Vt=null,Bt=null,Nt=null,re=void 0,dt=null,Yt=!!mt.dynamicChildren)=>{if(ut===mt)return;ut&&!Ru(ut,mt)&&(Vt=pn(ut),si(ut,Bt,Nt,!0),ut=null),mt.patchFlag===-2&&(Yt=!1,mt.dynamicChildren=null);const{type:Ft,ref:Kt,shapeFlag:ie}=mt;switch(Ft){case Bd:oe(ut,mt,Mt,Vt);break;case ac:Jt(ut,mt,Mt,Vt);break;case Vp:ut==null&&Ut(mt,Mt,Vt,re);break;case Wo:fe(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt);break;default:ie&1?de(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt):ie&6?ke(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt):(ie&64||ie&128)&&Ft.process(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt,ti)}Kt!=null&&Bt&&uf(Kt,ut&&ut.ref,Nt,mt||ut,!mt)},oe=(ut,mt,Mt,Vt)=>{if(ut==null)m(mt.el=c(mt.children),Mt,Vt);else{const Bt=mt.el=ut.el;mt.children!==ut.children&&D(Bt,mt.children)}},Jt=(ut,mt,Mt,Vt)=>{ut==null?m(mt.el=F(mt.children||""),Mt,Vt):mt.el=ut.el},Ut=(ut,mt,Mt,Vt)=>{[ut.el,ut.anchor]=zt(ut.children,mt,Mt,Vt,ut.el,ut.anchor)},Zt=({el:ut,anchor:mt},Mt,Vt)=>{let Bt;for(;ut&&ut!==mt;)Bt=K(ut),m(ut,Mt,Vt),ut=Bt;m(mt,Mt,Vt)},Le=({el:ut,anchor:mt})=>{let Mt;for(;ut&&ut!==mt;)Mt=K(ut),x(ut),ut=Mt;x(mt)},de=(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt)=>{mt.type==="svg"?re="svg":mt.type==="math"&&(re="mathml"),ut==null?te(mt,Mt,Vt,Bt,Nt,re,dt,Yt):Fe(ut,mt,Bt,Nt,re,dt,Yt)},te=(ut,mt,Mt,Vt,Bt,Nt,re,dt)=>{let Yt,Ft;const{props:Kt,shapeFlag:ie,transition:Te,dirs:$e}=ut;if(Yt=ut.el=I(ut.type,Nt,Kt&&Kt.is,Kt),ie&8?q(Yt,ut.children):ie&16&&pe(ut.children,Yt,null,Vt,Bt,Np(ut,Nt),re,dt),$e&&ql(ut,null,Vt,"created"),Ce(Yt,ut,ut.scopeId,re,Vt),Kt){for(const ki in Kt)ki!=="value"&&!Wu(ki)&&S(Yt,ki,null,Kt[ki],Nt,Vt);"value"in Kt&&S(Yt,"value",null,Kt.value,Nt),(Ft=Kt.onVnodeBeforeMount)&&Hs(Ft,Vt,ut)}$e&&ql(ut,null,Vt,"beforeMount");const Xe=u2(Bt,Te);Xe&&Te.beforeEnter(Yt),m(Yt,mt,Mt),((Ft=Kt&&Kt.onVnodeMounted)||Xe||$e)&&no(()=>{Ft&&Hs(Ft,Vt,ut),Xe&&Te.enter(Yt),$e&&ql(ut,null,Vt,"mounted")},Bt)},Ce=(ut,mt,Mt,Vt,Bt)=>{if(Mt&&bt(ut,Mt),Vt)for(let Nt=0;Nt<Vt.length;Nt++)bt(ut,Vt[Nt]);if(Bt){let Nt=Bt.subTree;if(mt===Nt){const re=Bt.vnode;Ce(ut,re,re.scopeId,re.slotScopeIds,Bt.parent)}}},pe=(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt=0)=>{for(let Ft=Yt;Ft<ut.length;Ft++){const Kt=ut[Ft]=dt?gl(ut[Ft]):Xs(ut[Ft]);Pt(null,Kt,mt,Mt,Vt,Bt,Nt,re,dt)}},Fe=(ut,mt,Mt,Vt,Bt,Nt,re)=>{const dt=mt.el=ut.el;let{patchFlag:Yt,dynamicChildren:Ft,dirs:Kt}=mt;Yt|=ut.patchFlag&16;const ie=ut.props||Sn,Te=mt.props||Sn;let $e;if(Mt&&Hl(Mt,!1),($e=Te.onVnodeBeforeUpdate)&&Hs($e,Mt,mt,ut),Kt&&ql(mt,ut,Mt,"beforeUpdate"),Mt&&Hl(Mt,!0),(ie.innerHTML&&Te.innerHTML==null||ie.textContent&&Te.textContent==null)&&q(dt,""),Ft?ce(ut.dynamicChildren,Ft,dt,Mt,Vt,Np(mt,Bt),Nt):re||Ht(ut,mt,dt,null,Mt,Vt,Np(mt,Bt),Nt,!1),Yt>0){if(Yt&16)Qt(dt,ie,Te,Mt,Bt);else if(Yt&2&&ie.class!==Te.class&&S(dt,"class",null,Te.class,Bt),Yt&4&&S(dt,"style",ie.style,Te.style,Bt),Yt&8){const Xe=mt.dynamicProps;for(let ki=0;ki<Xe.length;ki++){const Ti=Xe[ki],ji=ie[Ti],gn=Te[Ti];(gn!==ji||Ti==="value")&&S(dt,Ti,ji,gn,Bt,Mt)}}Yt&1&&ut.children!==mt.children&&q(dt,mt.children)}else!re&&Ft==null&&Qt(dt,ie,Te,Mt,Bt);(($e=Te.onVnodeUpdated)||Kt)&&no(()=>{$e&&Hs($e,Mt,mt,ut),Kt&&ql(mt,ut,Mt,"updated")},Vt)},ce=(ut,mt,Mt,Vt,Bt,Nt,re)=>{for(let dt=0;dt<mt.length;dt++){const Yt=ut[dt],Ft=mt[dt],Kt=Yt.el&&(Yt.type===Wo||!Ru(Yt,Ft)||Yt.shapeFlag&70)?W(Yt.el):Mt;Pt(Yt,Ft,Kt,null,Vt,Bt,Nt,re,!0)}},Qt=(ut,mt,Mt,Vt,Bt)=>{if(mt!==Mt){if(mt!==Sn)for(const Nt in mt)!Wu(Nt)&&!(Nt in Mt)&&S(ut,Nt,mt[Nt],null,Bt,Vt);for(const Nt in Mt){if(Wu(Nt))continue;const re=Mt[Nt],dt=mt[Nt];re!==dt&&Nt!=="value"&&S(ut,Nt,dt,re,Bt,Vt)}"value"in Mt&&S(ut,"value",mt.value,Mt.value,Bt)}},fe=(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt)=>{const Ft=mt.el=ut?ut.el:c(""),Kt=mt.anchor=ut?ut.anchor:c("");let{patchFlag:ie,dynamicChildren:Te,slotScopeIds:$e}=mt;$e&&(dt=dt?dt.concat($e):$e),ut==null?(m(Ft,Mt,Vt),m(Kt,Mt,Vt),pe(mt.children||[],Mt,Kt,Bt,Nt,re,dt,Yt)):ie>0&&ie&64&&Te&&ut.dynamicChildren?(ce(ut.dynamicChildren,Te,Mt,Bt,Nt,re,dt),(mt.key!=null||Bt&&mt===Bt.subTree)&&r0(ut,mt,!0)):Ht(ut,mt,Mt,Kt,Bt,Nt,re,dt,Yt)},ke=(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt)=>{mt.slotScopeIds=dt,ut==null?mt.shapeFlag&512?Bt.ctx.activate(mt,Mt,Vt,re,Yt):Ae(mt,Mt,Vt,Bt,Nt,re,Yt):Ke(ut,mt,Yt)},Ae=(ut,mt,Mt,Vt,Bt,Nt,re)=>{const dt=ut.component=L2(ut,Vt,Bt);if(Zv(ut)&&(dt.ctx.renderer=ti),M2(dt,!1,re),dt.asyncDep){if(Bt&&Bt.registerDep(dt,we,re),!ut.el){const Yt=dt.subTree=Qo(ac);Jt(null,Yt,mt,Mt)}}else we(dt,ut,mt,Mt,Bt,Nt,re)},Ke=(ut,mt,Mt)=>{const Vt=mt.component=ut.component;if(v2(ut,mt,Mt))if(Vt.asyncDep&&!Vt.asyncResolved){Me(Vt,mt,Mt);return}else Vt.next=mt,Mw(Vt.update),Vt.effect.dirty=!0,Vt.update();else mt.el=ut.el,Vt.vnode=mt},we=(ut,mt,Mt,Vt,Bt,Nt,re)=>{const dt=()=>{if(ut.isMounted){let{next:Kt,bu:ie,u:Te,parent:$e,vnode:Xe}=ut;{const Wt=o0(ut);if(Wt){Kt&&(Kt.el=Xe.el,Me(ut,Kt,re)),Wt.asyncDep.then(()=>{ut.isUnmounted||dt()});return}}let ki=Kt,Ti;Hl(ut,!1),Kt?(Kt.el=Xe.el,Me(ut,Kt,re)):Kt=Xe,ie&&Bp(ie),(Ti=Kt.props&&Kt.props.onVnodeBeforeUpdate)&&Hs(Ti,$e,Kt,Xe),Hl(ut,!0);const ji=Up(ut),gn=ut.subTree;ut.subTree=ji,Pt(gn,ji,W(gn.el),pn(gn),ut,Bt,Nt),Kt.el=ji.el,ki===null&&x2(ut,ji.el),Te&&no(Te,Bt),(Ti=Kt.props&&Kt.props.onVnodeUpdated)&&no(()=>Hs(Ti,$e,Kt,Xe),Bt)}else{let Kt;const{el:ie,props:Te}=mt,{bm:$e,m:Xe,parent:ki}=ut,Ti=Xh(mt);if(Hl(ut,!1),$e&&Bp($e),!Ti&&(Kt=Te&&Te.onVnodeBeforeMount)&&Hs(Kt,ki,mt),Hl(ut,!0),ie&&ei){const ji=()=>{ut.subTree=Up(ut),ei(ie,ut.subTree,ut,Bt,null)};Ti?mt.type.__asyncLoader().then(()=>!ut.isUnmounted&&ji()):ji()}else{const ji=ut.subTree=Up(ut);Pt(null,ji,Mt,Vt,ut,Bt,Nt),mt.el=ji.el}if(Xe&&no(Xe,Bt),!Ti&&(Kt=Te&&Te.onVnodeMounted)){const ji=mt;no(()=>Hs(Kt,ki,ji),Bt)}(mt.shapeFlag&256||ki&&Xh(ki.vnode)&&ki.vnode.shapeFlag&256)&&ut.a&&no(ut.a,Bt),ut.isMounted=!0,mt=Mt=Vt=null}},Yt=ut.effect=new Hf(dt,Yo,()=>im(Ft),ut.scope),Ft=ut.update=()=>{Yt.dirty&&Yt.run()};Ft.i=ut,Ft.id=ut.uid,Hl(ut,!0),Ft()},Me=(ut,mt,Mt)=>{mt.component=ut;const Vt=ut.vnode.props;ut.vnode=mt,ut.next=null,e2(ut,mt.props,Vt,Mt),o2(ut,mt.children,Mt),Tl(),fg(ut),Sl()},Ht=(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt=!1)=>{const Ft=ut&&ut.children,Kt=ut?ut.shapeFlag:0,ie=mt.children,{patchFlag:Te,shapeFlag:$e}=mt;if(Te>0){if(Te&128){ze(Ft,ie,Mt,Vt,Bt,Nt,re,dt,Yt);return}else if(Te&256){fi(Ft,ie,Mt,Vt,Bt,Nt,re,dt,Yt);return}}$e&8?(Kt&16&&Oe(Ft,Bt,Nt),ie!==Ft&&q(Mt,ie)):Kt&16?$e&16?ze(Ft,ie,Mt,Vt,Bt,Nt,re,dt,Yt):Oe(Ft,Bt,Nt,!0):(Kt&8&&q(Mt,""),$e&16&&pe(ie,Mt,Vt,Bt,Nt,re,dt,Yt))},fi=(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt)=>{ut=ut||Nc,mt=mt||Nc;const Ft=ut.length,Kt=mt.length,ie=Math.min(Ft,Kt);let Te;for(Te=0;Te<ie;Te++){const $e=mt[Te]=Yt?gl(mt[Te]):Xs(mt[Te]);Pt(ut[Te],$e,Mt,null,Bt,Nt,re,dt,Yt)}Ft>Kt?Oe(ut,Bt,Nt,!0,!1,ie):pe(mt,Mt,Vt,Bt,Nt,re,dt,Yt,ie)},ze=(ut,mt,Mt,Vt,Bt,Nt,re,dt,Yt)=>{let Ft=0;const Kt=mt.length;let ie=ut.length-1,Te=Kt-1;for(;Ft<=ie&&Ft<=Te;){const $e=ut[Ft],Xe=mt[Ft]=Yt?gl(mt[Ft]):Xs(mt[Ft]);if(Ru($e,Xe))Pt($e,Xe,Mt,null,Bt,Nt,re,dt,Yt);else break;Ft++}for(;Ft<=ie&&Ft<=Te;){const $e=ut[ie],Xe=mt[Te]=Yt?gl(mt[Te]):Xs(mt[Te]);if(Ru($e,Xe))Pt($e,Xe,Mt,null,Bt,Nt,re,dt,Yt);else break;ie--,Te--}if(Ft>ie){if(Ft<=Te){const $e=Te+1,Xe=$e<Kt?mt[$e].el:Vt;for(;Ft<=Te;)Pt(null,mt[Ft]=Yt?gl(mt[Ft]):Xs(mt[Ft]),Mt,Xe,Bt,Nt,re,dt,Yt),Ft++}}else if(Ft>Te)for(;Ft<=ie;)si(ut[Ft],Bt,Nt,!0),Ft++;else{const $e=Ft,Xe=Ft,ki=new Map;for(Ft=Xe;Ft<=Te;Ft++){const cn=mt[Ft]=Yt?gl(mt[Ft]):Xs(mt[Ft]);cn.key!=null&&ki.set(cn.key,Ft)}let Ti,ji=0;const gn=Te-Xe+1;let Wt=!1,Xn=0;const zi=new Array(gn);for(Ft=0;Ft<gn;Ft++)zi[Ft]=0;for(Ft=$e;Ft<=ie;Ft++){const cn=ut[Ft];if(ji>=gn){si(cn,Bt,Nt,!0);continue}let jt;if(cn.key!=null)jt=ki.get(cn.key);else for(Ti=Xe;Ti<=Te;Ti++)if(zi[Ti-Xe]===0&&Ru(cn,mt[Ti])){jt=Ti;break}jt===void 0?si(cn,Bt,Nt,!0):(zi[jt-Xe]=Ft+1,jt>=Xn?Xn=jt:Wt=!0,Pt(cn,mt[jt],Mt,null,Bt,Nt,re,dt,Yt),ji++)}const kr=Wt?h2(zi):Nc;for(Ti=kr.length-1,Ft=gn-1;Ft>=0;Ft--){const cn=Xe+Ft,jt=mt[cn],Ye=cn+1<Kt?mt[cn+1].el:Vt;zi[Ft]===0?Pt(null,jt,Mt,Ye,Bt,Nt,re,dt,Yt):Wt&&(Ti<0||Ft!==kr[Ti]?Ue(jt,Mt,Ye,2):Ti--)}}},Ue=(ut,mt,Mt,Vt,Bt=null)=>{const{el:Nt,type:re,transition:dt,children:Yt,shapeFlag:Ft}=ut;if(Ft&6){Ue(ut.component.subTree,mt,Mt,Vt);return}if(Ft&128){ut.suspense.move(mt,Mt,Vt);return}if(Ft&64){re.move(ut,mt,Mt,ti);return}if(re===Wo){m(Nt,mt,Mt);for(let ie=0;ie<Yt.length;ie++)Ue(Yt[ie],mt,Mt,Vt);m(ut.anchor,mt,Mt);return}if(re===Vp){Zt(ut,mt,Mt);return}if(Vt!==2&&Ft&1&&dt)if(Vt===0)dt.beforeEnter(Nt),m(Nt,mt,Mt),no(()=>dt.enter(Nt),Bt);else{const{leave:ie,delayLeave:Te,afterLeave:$e}=dt,Xe=()=>m(Nt,mt,Mt),ki=()=>{ie(Nt,()=>{Xe(),$e&&$e()})};Te?Te(Nt,Xe,ki):ki()}else m(Nt,mt,Mt)},si=(ut,mt,Mt,Vt=!1,Bt=!1)=>{const{type:Nt,props:re,ref:dt,children:Yt,dynamicChildren:Ft,shapeFlag:Kt,patchFlag:ie,dirs:Te,cacheIndex:$e}=ut;if(ie===-2&&(Bt=!1),dt!=null&&uf(dt,null,Mt,ut,!0),$e!=null&&(mt.renderCache[$e]=void 0),Kt&256){mt.ctx.deactivate(ut);return}const Xe=Kt&1&&Te,ki=!Xh(ut);let Ti;if(ki&&(Ti=re&&re.onVnodeBeforeUnmount)&&Hs(Ti,mt,ut),Kt&6)hi(ut.component,Mt,Vt);else{if(Kt&128){ut.suspense.unmount(Mt,Vt);return}Xe&&ql(ut,null,mt,"beforeUnmount"),Kt&64?ut.type.remove(ut,mt,Mt,ti,Vt):Ft&&!Ft.hasOnce&&(Nt!==Wo||ie>0&&ie&64)?Oe(Ft,mt,Mt,!1,!0):(Nt===Wo&&ie&384||!Bt&&Kt&16)&&Oe(Yt,mt,Mt),Vt&&je(ut)}(ki&&(Ti=re&&re.onVnodeUnmounted)||Xe)&&no(()=>{Ti&&Hs(Ti,mt,ut),Xe&&ql(ut,null,mt,"unmounted")},Mt)},je=ut=>{const{type:mt,el:Mt,anchor:Vt,transition:Bt}=ut;if(mt===Wo){ui(Mt,Vt);return}if(mt===Vp){Le(ut);return}const Nt=()=>{x(Mt),Bt&&!Bt.persisted&&Bt.afterLeave&&Bt.afterLeave()};if(ut.shapeFlag&1&&Bt&&!Bt.persisted){const{leave:re,delayLeave:dt}=Bt,Yt=()=>re(Mt,Nt);dt?dt(ut.el,Nt,Yt):Yt()}else Nt()},ui=(ut,mt)=>{let Mt;for(;ut!==mt;)Mt=K(ut),x(ut),ut=Mt;x(mt)},hi=(ut,mt,Mt)=>{const{bum:Vt,scope:Bt,update:Nt,subTree:re,um:dt,m:Yt,a:Ft}=ut;xg(Yt),xg(Ft),Vt&&Bp(Vt),Bt.stop(),Nt&&(Nt.active=!1,si(re,ut,mt,Mt)),dt&&no(dt,mt),no(()=>{ut.isUnmounted=!0},mt),mt&&mt.pendingBranch&&!mt.isUnmounted&&ut.asyncDep&&!ut.asyncResolved&&ut.suspenseId===mt.pendingId&&(mt.deps--,mt.deps===0&&mt.resolve())},Oe=(ut,mt,Mt,Vt=!1,Bt=!1,Nt=0)=>{for(let re=Nt;re<ut.length;re++)si(ut[re],mt,Mt,Vt,Bt)},pn=ut=>{if(ut.shapeFlag&6)return pn(ut.component.subTree);if(ut.shapeFlag&128)return ut.suspense.next();const mt=K(ut.anchor||ut.el),Mt=mt&&mt[s2];return Mt?K(Mt):mt};let be=!1;const Ge=(ut,mt,Mt)=>{ut==null?mt._vnode&&si(mt._vnode,null,null,!0):Pt(mt._vnode||null,ut,mt,null,null,null,Mt),mt._vnode=ut,be||(be=!0,fg(),Fv(),be=!1)},ti={p:Pt,um:si,m:Ue,r:je,mt:Ae,mc:pe,pc:Ht,pbc:ce,n:pn,o:i};let en,ei;return{render:Ge,hydrate:en,createApp:Jw(Ge,en)}}function Np({type:i,props:r},u){return u==="svg"&&i==="foreignObject"||u==="mathml"&&i==="annotation-xml"&&r&&r.encoding&&r.encoding.includes("html")?void 0:u}function Hl({effect:i,update:r},u){i.allowRecurse=r.allowRecurse=u}function u2(i,r){return(!i||i&&!i.pendingBranch)&&r&&!r.persisted}function r0(i,r,u=!1){const m=i.children,x=r.children;if(pi(m)&&pi(x))for(let S=0;S<m.length;S++){const I=m[S];let c=x[S];c.shapeFlag&1&&!c.dynamicChildren&&((c.patchFlag<=0||c.patchFlag===32)&&(c=x[S]=gl(x[S]),c.el=I.el),!u&&c.patchFlag!==-2&&r0(I,c)),c.type===Bd&&(c.el=I.el)}}function h2(i){const r=i.slice(),u=[0];let m,x,S,I,c;const F=i.length;for(m=0;m<F;m++){const D=i[m];if(D!==0){if(x=u[u.length-1],i[x]<D){r[m]=x,u.push(m);continue}for(S=0,I=u.length-1;S<I;)c=S+I>>1,i[u[c]]<D?S=c+1:I=c;D<i[u[S]]&&(S>0&&(r[m]=u[S-1]),u[S]=m)}}for(S=u.length,I=u[S-1];S-- >0;)u[S]=I,I=r[I];return u}function o0(i){const r=i.subTree.component;if(r)return r.asyncDep&&!r.asyncResolved?r:o0(r)}function xg(i){if(i)for(let r=0;r<i.length;r++)i[r].active=!1}const d2=Symbol.for("v-scx"),p2=()=>Yh(d2),Uh={};function Jh(i,r,u){return s0(i,r,u)}function s0(i,r,{immediate:u,deep:m,flush:x,once:S,onTrack:I,onTrigger:c}=Sn){if(r&&S){const te=r;r=(...Ce)=>{te(...Ce),de()}}const F=qr,D=te=>m===!0?te:Xl(te,m===!1?1:void 0);let q,W=!1,K=!1;if(ao(i)?(q=()=>i.value,W=Wc(i)):Ku(i)?(q=()=>D(i),W=!0):pi(i)?(K=!0,W=i.some(te=>Ku(te)||Wc(te)),q=()=>i.map(te=>{if(ao(te))return te.value;if(Ku(te))return D(te);if(Ii(te))return xl(te,F,2)})):Ii(i)?r?q=()=>xl(i,F,2):q=()=>(bt&&bt(),As(i,F,3,[zt])):q=Yo,r&&m){const te=q;q=()=>Xl(te())}let bt,zt=te=>{bt=Zt.onStop=()=>{xl(te,F,4),bt=Zt.onStop=void 0}},Pt;if(Od)if(zt=Yo,r?u&&As(r,F,3,[q(),K?[]:void 0,zt]):q(),x==="sync"){const te=p2();Pt=te.__watcherHandles||(te.__watcherHandles=[])}else return Yo;let oe=K?new Array(i.length).fill(Uh):Uh;const Jt=()=>{if(!(!Zt.active||!Zt.dirty))if(r){const te=Zt.run();(m||W||(K?te.some((Ce,pe)=>bl(Ce,oe[pe])):bl(te,oe)))&&(bt&&bt(),As(r,F,3,[te,oe===Uh?void 0:K&&oe[0]===Uh?[]:oe,zt]),oe=te)}else Zt.run()};Jt.allowRecurse=!!r;let Ut;x==="sync"?Ut=Jt:x==="post"?Ut=()=>no(Jt,F&&F.suspense):(Jt.pre=!0,F&&(Jt.id=F.uid),Ut=()=>im(Jt));const Zt=new Hf(q,Yo,Ut),Le=iw(),de=()=>{Zt.stop(),Le&&Gf(Le.effects,Zt)};return r?u?Jt():oe=Zt.run():x==="post"?no(Zt.run.bind(Zt),F&&F.suspense):Zt.run(),Pt&&Pt.push(de),de}function f2(i,r,u){const m=this.proxy,x=Kn(i)?i.includes(".")?a0(m,i):()=>m[i]:i.bind(m,m);let S;Ii(r)?S=r:(S=r.handler,u=r);const I=ch(this),c=s0(x,S.bind(m),u);return I(),c}function a0(i,r){const u=r.split(".");return()=>{let m=i;for(let x=0;x<u.length&&m;x++)m=m[u[x]];return m}}function Xl(i,r=1/0,u){if(r<=0||!Pn(i)||i.__v_skip||(u=u||new Set,u.has(i)))return i;if(u.add(i),r--,ao(i))Xl(i.value,r,u);else if(pi(i))for(let m=0;m<i.length;m++)Xl(i[m],r,u);else if(uv(i)||Uc(i))i.forEach(m=>{Xl(m,r,u)});else if(pv(i)){for(const m in i)Xl(i[m],r,u);for(const m of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,m)&&Xl(i[m],r,u)}return i}const m2=(i,r)=>r==="modelValue"||r==="model-value"?i.modelModifiers:i[`${r}Modifiers`]||i[`${oc(r)}Modifiers`]||i[`${dc(r)}Modifiers`];function _2(i,r,...u){if(i.isUnmounted)return;const m=i.vnode.props||Sn;let x=u;const S=r.startsWith("update:"),I=S&&m2(m,r.slice(7));I&&(I.trim&&(x=u.map(q=>Kn(q)?q.trim():q)),I.number&&(x=u.map(Hb)));let c,F=m[c=Dp(r)]||m[c=Dp(oc(r))];!F&&S&&(F=m[c=Dp(dc(r))]),F&&As(F,i,6,x);const D=m[c+"Once"];if(D){if(!i.emitted)i.emitted={};else if(i.emitted[c])return;i.emitted[c]=!0,As(D,i,6,x)}}function l0(i,r,u=!1){const m=r.emitsCache,x=m.get(i);if(x!==void 0)return x;const S=i.emits;let I={},c=!1;if(!Ii(i)){const F=D=>{const q=l0(D,r,!0);q&&(c=!0,Mr(I,q))};!u&&r.mixins.length&&r.mixins.forEach(F),i.extends&&F(i.extends),i.mixins&&i.mixins.forEach(F)}return!S&&!c?(Pn(i)&&m.set(i,null),null):(pi(S)?S.forEach(F=>I[F]=null):Mr(I,S),Pn(i)&&m.set(i,I),I)}function Dd(i,r){return!i||!Ed(r)?!1:(r=r.slice(2).replace(/Once$/,""),Zi(i,r[0].toLowerCase()+r.slice(1))||Zi(i,dc(r))||Zi(i,r))}function Up(i){const{type:r,vnode:u,proxy:m,withProxy:x,propsOptions:[S],slots:I,attrs:c,emit:F,render:D,renderCache:q,props:W,data:K,setupState:bt,ctx:zt,inheritAttrs:Pt}=i,oe=ud(i);let Jt,Ut;try{if(u.shapeFlag&4){const Le=x||m,de=Le;Jt=Xs(D.call(de,Le,q,W,bt,K,zt)),Ut=c}else{const Le=r;Jt=Xs(Le.length>1?Le(W,{attrs:c,slots:I,emit:F}):Le(W,null)),Ut=r.props?c:g2(c)}}catch(Le){Yu.length=0,zd(Le,i,1),Jt=Qo(ac)}let Zt=Jt;if(Ut&&Pt!==!1){const Le=Object.keys(Ut),{shapeFlag:de}=Zt;Le.length&&de&7&&(S&&Le.some(jf)&&(Ut=y2(Ut,S)),Zt=Kc(Zt,Ut,!1,!0))}return u.dirs&&(Zt=Kc(Zt,null,!1,!0),Zt.dirs=Zt.dirs?Zt.dirs.concat(u.dirs):u.dirs),u.transition&&(Zt.transition=u.transition),Jt=Zt,ud(oe),Jt}const g2=i=>{let r;for(const u in i)(u==="class"||u==="style"||Ed(u))&&((r||(r={}))[u]=i[u]);return r},y2=(i,r)=>{const u={};for(const m in i)(!jf(m)||!(m.slice(9)in r))&&(u[m]=i[m]);return u};function v2(i,r,u){const{props:m,children:x,component:S}=i,{props:I,children:c,patchFlag:F}=r,D=S.emitsOptions;if(r.dirs||r.transition)return!0;if(u&&F>=0){if(F&1024)return!0;if(F&16)return m?bg(m,I,D):!!I;if(F&8){const q=r.dynamicProps;for(let W=0;W<q.length;W++){const K=q[W];if(I[K]!==m[K]&&!Dd(D,K))return!0}}}else return(x||c)&&(!c||!c.$stable)?!0:m===I?!1:m?I?bg(m,I,D):!0:!!I;return!1}function bg(i,r,u){const m=Object.keys(r);if(m.length!==Object.keys(i).length)return!0;for(let x=0;x<m.length;x++){const S=m[x];if(r[S]!==i[S]&&!Dd(u,S))return!0}return!1}function x2({vnode:i,parent:r},u){for(;r;){const m=r.subTree;if(m.suspense&&m.suspense.activeBranch===i&&(m.el=i.el),m===i)(i=r.vnode).el=u,r=r.parent;else break}}const b2=i=>i.__isSuspense;function w2(i,r){r&&r.pendingBranch?pi(i)?r.effects.push(...i):r.effects.push(i):kw(i)}const Wo=Symbol.for("v-fgt"),Bd=Symbol.for("v-txt"),ac=Symbol.for("v-cmt"),Vp=Symbol.for("v-stc"),Yu=[];let Io=null;function Jo(i=!1){Yu.push(Io=i?null:[])}function T2(){Yu.pop(),Io=Yu[Yu.length-1]||null}let eh=1;function wg(i){eh+=i,i<0&&Io&&(Io.hasOnce=!0)}function c0(i){return i.dynamicChildren=eh>0?Io||Nc:null,T2(),eh>0&&Io&&Io.push(i),i}function ia(i,r,u,m,x,S){return c0(bi(i,r,u,m,x,S,!0))}function u0(i,r,u,m,x){return c0(Qo(i,r,u,m,x,!0))}function S2(i){return i?i.__v_isVNode===!0:!1}function Ru(i,r){return i.type===r.type&&i.key===r.key}const h0=({key:i})=>i??null,Qh=({ref:i,ref_key:r,ref_for:u})=>(typeof i=="number"&&(i=""+i),i!=null?Kn(i)||ao(i)||Ii(i)?{i:ta,r:i,k:r,f:!!u}:i:null);function bi(i,r=null,u=null,m=0,x=null,S=i===Wo?0:1,I=!1,c=!1){const F={__v_isVNode:!0,__v_skip:!0,type:i,props:r,key:r&&h0(r),ref:r&&Qh(r),scopeId:Uv,slotScopeIds:null,children:u,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:S,patchFlag:m,dynamicProps:x,dynamicChildren:null,appContext:null,ctx:ta};return c?(sm(F,u),S&128&&i.normalize(F)):u&&(F.shapeFlag|=Kn(u)?8:16),eh>0&&!I&&Io&&(F.patchFlag>0||S&6)&&F.patchFlag!==32&&Io.push(F),F}const Qo=P2;function P2(i,r=null,u=null,m=0,x=null,S=!1){if((!i||i===jw)&&(i=ac),S2(i)){const c=Kc(i,r,!0);return u&&sm(c,u),eh>0&&!S&&Io&&(c.shapeFlag&6?Io[Io.indexOf(i)]=c:Io.push(c)),c.patchFlag=-2,c}if(D2(i)&&(i=i.__vccOpts),r){r=A2(r);let{class:c,style:F}=r;c&&!Kn(c)&&(r.class=Po(c)),Pn(F)&&(kv(F)&&!pi(F)&&(F=Mr({},F)),r.style=eu(F))}const I=Kn(i)?1:b2(i)?128:a2(i)?64:Pn(i)?4:Ii(i)?2:0;return bi(i,r,u,m,x,I,S,!0)}function A2(i){return i?kv(i)||Yv(i)?Mr({},i):i:null}function Kc(i,r,u=!1,m=!1){const{props:x,ref:S,patchFlag:I,children:c,transition:F}=i,D=r?I2(x||{},r):x,q={__v_isVNode:!0,__v_skip:!0,type:i.type,props:D,key:D&&h0(D),ref:r&&r.ref?u&&S?pi(S)?S.concat(Qh(r)):[S,Qh(r)]:Qh(r):S,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:c,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:r&&i.type!==Wo?I===-1?16:I|16:I,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:F,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&Kc(i.ssContent),ssFallback:i.ssFallback&&Kc(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return F&&m&&$v(q,F.clone(q)),q}function dd(i=" ",r=0){return Qo(Bd,null,i,r)}function d0(i="",r=!1){return r?(Jo(),u0(ac,null,i)):Qo(ac,null,i)}function Xs(i){return i==null||typeof i=="boolean"?Qo(ac):pi(i)?Qo(Wo,null,i.slice()):typeof i=="object"?gl(i):Qo(Bd,null,String(i))}function gl(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:Kc(i)}function sm(i,r){let u=0;const{shapeFlag:m}=i;if(r==null)r=null;else if(pi(r))u=16;else if(typeof r=="object")if(m&65){const x=r.default;x&&(x._c&&(x._d=!1),sm(i,x()),x._c&&(x._d=!0));return}else{u=32;const x=r._;!x&&!Yv(r)?r._ctx=ta:x===3&&ta&&(ta.slots._===1?r._=1:(r._=2,i.patchFlag|=1024))}else Ii(r)?(r={default:r,_ctx:ta},u=32):(r=String(r),m&64?(u=16,r=[dd(r)]):u=8);i.children=r,i.shapeFlag|=u}function I2(...i){const r={};for(let u=0;u<i.length;u++){const m=i[u];for(const x in m)if(x==="class")r.class!==m.class&&(r.class=Po([r.class,m.class]));else if(x==="style")r.style=eu([r.style,m.style]);else if(Ed(x)){const S=r[x],I=m[x];I&&S!==I&&!(pi(S)&&S.includes(I))&&(r[x]=S?[].concat(S,I):I)}else x!==""&&(r[x]=m[x])}return r}function Hs(i,r,u,m=null){As(i,r,7,[u,m])}const C2=Wv();let E2=0;function L2(i,r,u){const m=i.type,x=(r?r.appContext:i.appContext)||C2,S={uid:E2++,vnode:i,type:m,parent:r,appContext:x,root:null,next:null,subTree:null,effect:null,update:null,scope:new tw(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(x.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Qv(m,x),emitsOptions:l0(m,x),emit:null,emitted:null,propsDefaults:Sn,inheritAttrs:m.inheritAttrs,ctx:Sn,data:Sn,props:Sn,attrs:Sn,slots:Sn,refs:Sn,setupState:Sn,setupContext:null,suspense:u,suspenseId:u?u.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return S.ctx={_:S},S.root=r?r.root:S,S.emit=_2.bind(null,S),i.ce&&i.ce(S),S}let qr=null,pd,hf;{const i=_v(),r=(u,m)=>{let x;return(x=i[u])||(x=i[u]=[]),x.push(m),S=>{x.length>1?x.forEach(I=>I(S)):x[0](S)}};pd=r("__VUE_INSTANCE_SETTERS__",u=>qr=u),hf=r("__VUE_SSR_SETTERS__",u=>Od=u)}const ch=i=>{const r=qr;return pd(i),i.scope.on(),()=>{i.scope.off(),pd(r)}},Tg=()=>{qr&&qr.scope.off(),pd(null)};function p0(i){return i.vnode.shapeFlag&4}let Od=!1;function M2(i,r=!1,u=!1){r&&hf(r);const{props:m,children:x}=i.vnode,S=p0(i);t2(i,m,S,r),r2(i,x,u);const I=S?k2(i,r):void 0;return r&&hf(!1),I}function k2(i,r){const u=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,Gw);const{setup:m}=u;if(m){const x=i.setupContext=m.length>1?R2(i):null,S=ch(i);Tl();const I=xl(m,i,0,[i.props,x]);if(Sl(),S(),hv(I)){if(I.then(Tg,Tg),r)return I.then(c=>{Sg(i,c,r)}).catch(c=>{zd(c,i,0)});i.asyncDep=I}else Sg(i,I,r)}else f0(i,r)}function Sg(i,r,u){Ii(r)?i.type.__ssrInlineRender?i.ssrRender=r:i.render=r:Pn(r)&&(i.setupState=Dv(r)),f0(i,u)}let Pg;function f0(i,r,u){const m=i.type;if(!i.render){if(!r&&Pg&&!m.render){const x=m.template||rm(i).template;if(x){const{isCustomElement:S,compilerOptions:I}=i.appContext.config,{delimiters:c,compilerOptions:F}=m,D=Mr(Mr({isCustomElement:S,delimiters:c},I),F);m.render=Pg(x,D)}}i.render=m.render||Yo}{const x=ch(i);Tl();try{qw(i)}finally{Sl(),x()}}}const z2={get(i,r){return so(i,"get",""),i[r]}};function R2(i){const r=u=>{i.exposed=u||{}};return{attrs:new Proxy(i.attrs,z2),slots:i.slots,emit:i.emit,expose:r}}function am(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(Dv(Tw(i.exposed)),{get(r,u){if(u in r)return r[u];if(u in Xu)return Xu[u](i)},has(r,u){return u in r||u in Xu}})):i.proxy}function D2(i){return Ii(i)&&"__vccOpts"in i}const td=(i,r)=>Sw(i,r,Od),B2="3.4.38";/**
* @vue/runtime-dom v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const O2="http://www.w3.org/2000/svg",F2="http://www.w3.org/1998/Math/MathML",ka=typeof document<"u"?document:null,Ag=ka&&ka.createElement("template"),N2={insert:(i,r,u)=>{r.insertBefore(i,u||null)},remove:i=>{const r=i.parentNode;r&&r.removeChild(i)},createElement:(i,r,u,m)=>{const x=r==="svg"?ka.createElementNS(O2,i):r==="mathml"?ka.createElementNS(F2,i):u?ka.createElement(i,{is:u}):ka.createElement(i);return i==="select"&&m&&m.multiple!=null&&x.setAttribute("multiple",m.multiple),x},createText:i=>ka.createTextNode(i),createComment:i=>ka.createComment(i),setText:(i,r)=>{i.nodeValue=r},setElementText:(i,r)=>{i.textContent=r},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>ka.querySelector(i),setScopeId(i,r){i.setAttribute(r,"")},insertStaticContent(i,r,u,m,x,S){const I=u?u.previousSibling:r.lastChild;if(x&&(x===S||x.nextSibling))for(;r.insertBefore(x.cloneNode(!0),u),!(x===S||!(x=x.nextSibling)););else{Ag.innerHTML=m==="svg"?`<svg>${i}</svg>`:m==="mathml"?`<math>${i}</math>`:i;const c=Ag.content;if(m==="svg"||m==="mathml"){const F=c.firstChild;for(;F.firstChild;)c.appendChild(F.firstChild);c.removeChild(F)}r.insertBefore(c,u)}return[I?I.nextSibling:r.firstChild,u?u.previousSibling:r.lastChild]}},U2=Symbol("_vtc");function V2(i,r,u){const m=i[U2];m&&(r=(r?[r,...m]:[...m]).join(" ")),r==null?i.removeAttribute("class"):u?i.setAttribute("class",r):i.className=r}const Ig=Symbol("_vod"),$2=Symbol("_vsh"),Z2=Symbol(""),j2=/(^|;)\s*display\s*:/;function G2(i,r,u){const m=i.style,x=Kn(u);let S=!1;if(u&&!x){if(r)if(Kn(r))for(const I of r.split(";")){const c=I.slice(0,I.indexOf(":")).trim();u[c]==null&&ed(m,c,"")}else for(const I in r)u[I]==null&&ed(m,I,"");for(const I in u)I==="display"&&(S=!0),ed(m,I,u[I])}else if(x){if(r!==u){const I=m[Z2];I&&(u+=";"+I),m.cssText=u,S=j2.test(u)}}else r&&i.removeAttribute("style");Ig in i&&(i[Ig]=S?m.display:"",i[$2]&&(m.display="none"))}const Cg=/\s*!important$/;function ed(i,r,u){if(pi(u))u.forEach(m=>ed(i,r,m));else if(u==null&&(u=""),r.startsWith("--"))i.setProperty(r,u);else{const m=q2(i,r);Cg.test(u)?i.setProperty(dc(m),u.replace(Cg,""),"important"):i[m]=u}}const Eg=["Webkit","Moz","ms"],$p={};function q2(i,r){const u=$p[r];if(u)return u;let m=oc(r);if(m!=="filter"&&m in i)return $p[r]=m;m=fv(m);for(let x=0;x<Eg.length;x++){const S=Eg[x]+m;if(S in i)return $p[r]=S}return r}const Lg="http://www.w3.org/1999/xlink";function Mg(i,r,u,m,x,S=Qb(r)){m&&r.startsWith("xlink:")?u==null?i.removeAttributeNS(Lg,r.slice(6,r.length)):i.setAttributeNS(Lg,r,u):u==null||S&&!gv(u)?i.removeAttribute(r):i.setAttribute(r,S?"":wl(u)?String(u):u)}function H2(i,r,u,m){if(r==="innerHTML"||r==="textContent"){if(u==null)return;i[r]=u;return}const x=i.tagName;if(r==="value"&&x!=="PROGRESS"&&!x.includes("-")){const I=x==="OPTION"?i.getAttribute("value")||"":i.value,c=u==null?"":String(u);(I!==c||!("_value"in i))&&(i.value=c),u==null&&i.removeAttribute(r),i._value=u;return}let S=!1;if(u===""||u==null){const I=typeof i[r];I==="boolean"?u=gv(u):u==null&&I==="string"?(u="",S=!0):I==="number"&&(u=0,S=!0)}try{i[r]=u}catch{}S&&i.removeAttribute(r)}function W2(i,r,u,m){i.addEventListener(r,u,m)}function K2(i,r,u,m){i.removeEventListener(r,u,m)}const kg=Symbol("_vei");function X2(i,r,u,m,x=null){const S=i[kg]||(i[kg]={}),I=S[r];if(m&&I)I.value=m;else{const[c,F]=Y2(r);if(m){const D=S[r]=tT(m,x);W2(i,c,D,F)}else I&&(K2(i,c,I,F),S[r]=void 0)}}const zg=/(?:Once|Passive|Capture)$/;function Y2(i){let r;if(zg.test(i)){r={};let m;for(;m=i.match(zg);)i=i.slice(0,i.length-m[0].length),r[m[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):dc(i.slice(2)),r]}let Zp=0;const J2=Promise.resolve(),Q2=()=>Zp||(J2.then(()=>Zp=0),Zp=Date.now());function tT(i,r){const u=m=>{if(!m._vts)m._vts=Date.now();else if(m._vts<=u.attached)return;As(eT(m,u.value),r,5,[m])};return u.value=i,u.attached=Q2(),u}function eT(i,r){if(pi(r)){const u=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{u.call(i),i._stopped=!0},r.map(m=>x=>!x._stopped&&m&&m(x))}else return r}const Rg=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,iT=(i,r,u,m,x,S)=>{const I=x==="svg";r==="class"?V2(i,m,I):r==="style"?G2(i,u,m):Ed(r)?jf(r)||X2(i,r,u,m,S):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):nT(i,r,m,I))?(H2(i,r,m),!i.tagName.includes("-")&&(r==="value"||r==="checked"||r==="selected")&&Mg(i,r,m,I,S,r!=="value")):(r==="true-value"?i._trueValue=m:r==="false-value"&&(i._falseValue=m),Mg(i,r,m,I))};function nT(i,r,u,m){if(m)return!!(r==="innerHTML"||r==="textContent"||r in i&&Rg(r)&&Ii(u));if(r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&i.tagName==="INPUT"||r==="type"&&i.tagName==="TEXTAREA")return!1;if(r==="width"||r==="height"){const x=i.tagName;if(x==="IMG"||x==="VIDEO"||x==="CANVAS"||x==="SOURCE")return!1}return Rg(r)&&Kn(u)?!1:r in i}const rT=Mr({patchProp:iT},N2);let Dg;function oT(){return Dg||(Dg=l2(rT))}const sT=(...i)=>{const r=oT().createApp(...i),{mount:u}=r;return r.mount=m=>{const x=lT(m);if(!x)return;const S=r._component;!Ii(S)&&!S.render&&!S.template&&(S.template=x.innerHTML),x.innerHTML="";const I=u(x,!1,aT(x));return x instanceof Element&&(x.removeAttribute("v-cloak"),x.setAttribute("data-v-app","")),I},r};function aT(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function lT(i){return Kn(i)?document.querySelector(i):i}const cT="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20width='119.827px'%20height='122.88px'%20viewBox='0%200%20119.827%20122.88'%20enable-background='new%200%200%20119.827%20122.88'%20xml:space='preserve'%3e%3cg%3e%3cpath%20fill='white'%20d='M78.693,87.06c-0.221-0.22-0.406-0.46-0.561-0.715c-8.213,6.447-18.564,10.292-29.814,10.292%20c-13.343,0-25.423-5.408-34.167-14.152C5.408,73.74,0,61.661,0,48.318s5.408-25.422,14.152-34.166C22.896,5.408,34.976,0,48.319,0%20C61.662,0,73.74,5.408,82.484,14.152s14.152,20.823,14.152,34.166c0,12.808-4.984,24.451-13.117,33.099%20c0.148,0.108,0.291,0.229,0.424,0.363l34.787,34.737c1.457,1.449,1.463,3.807,0.014,5.265c-1.449,1.457-3.807,1.464-5.264,0.015%20L78.693,87.06L78.693,87.06z%20M29.458,52.052c-2.062,0-3.733-1.671-3.733-3.733c0-2.062,1.672-3.733,3.733-3.733h15.126V29.459%20c0-2.062,1.671-3.733,3.733-3.733c2.062,0,3.733,1.672,3.733,3.733v15.126h15.126c2.063,0,3.732,1.672,3.732,3.733%20c0,2.062-1.67,3.733-3.732,3.733H52.051v15.126c0,2.062-1.671,3.733-3.733,3.733c-2.062,0-3.733-1.672-3.733-3.733V52.052H29.458%20L29.458,52.052z%20M77.082,19.555c-7.361-7.361-17.53-11.914-28.763-11.914c-11.233,0-21.403,4.553-28.764,11.914%20S7.641,37.085,7.641,48.318s4.553,21.403,11.914,28.764c7.361,7.361,17.531,11.914,28.764,11.914%20c11.233,0,21.402-4.553,28.763-11.914c7.361-7.36,11.914-17.53,11.914-28.764S84.443,26.916,77.082,19.555L77.082,19.555z'%20/%3e%3c/g%3e%3c/svg%3e",uT="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20width='119.828px'%20height='122.88px'%20viewBox='0%200%20119.828%20122.88'%20enable-background='new%200%200%20119.828%20122.88'%20xml:space='preserve'%3e%3cg%3e%3cpath%20fill='white'%20d='M29.459,52.052c-2.062,0-3.734-1.671-3.734-3.733c0-2.062,1.672-3.733,3.734-3.733h37.719c2.063,0,3.732,1.672,3.732,3.733%20c0,2.062-1.67,3.733-3.732,3.733H29.459L29.459,52.052z%20M48.318,0C61.66,0,73.74,5.408,82.484,14.152s14.152,20.824,14.152,34.166%20c0,12.808-4.984,24.451-13.117,33.098c0.148,0.109,0.291,0.23,0.424,0.364l34.787,34.737c1.457,1.449,1.465,3.807,0.014,5.265%20c-1.449,1.458-3.807,1.464-5.264,0.015L78.693,87.06c-0.221-0.22-0.408-0.46-0.561-0.715c-8.213,6.447-18.565,10.292-29.814,10.292%20c-13.342,0-25.422-5.408-34.167-14.152C5.408,73.74,0,61.661,0,48.318c0-13.342,5.408-25.422,14.152-34.166%20C22.896,5.408,34.976,0,48.318,0L48.318,0z%20M77.082,19.555C69.721,12.193,59.551,7.641,48.318,7.641%20c-11.233,0-21.403,4.553-28.764,11.914c-7.361,7.36-11.914,17.53-11.914,28.764s4.553,21.403,11.914,28.764%20c7.361,7.361,17.531,11.914,28.764,11.914c11.233,0,21.402-4.553,28.764-11.914c7.361-7.36,11.914-17.53,11.914-28.764%20S84.443,26.915,77.082,19.555L77.082,19.555z'%20/%3e%3c/g%3e%3c/svg%3e",hT="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%20122.88%20122.87'%20style='enable-background:new%200%200%20122.88%20122.87'%20xml:space='preserve'%3e%3cg%3e%3cpath%20fill='white'%20d='M122.88,77.63v41.12c0,2.28-1.85,4.12-4.12,4.12H77.33v-9.62h35.95c0-12.34,0-23.27,0-35.62H122.88L122.88,77.63z%20M77.39,9.53V0h41.37c2.28,0,4.12,1.85,4.12,4.12v41.18h-9.63V9.53H77.39L77.39,9.53z%20M9.63,45.24H0V4.12C0,1.85,1.85,0,4.12,0h41%20v9.64H9.63V45.24L9.63,45.24z%20M45.07,113.27v9.6H4.12c-2.28,0-4.12-1.85-4.12-4.13V77.57h9.63v35.71H45.07L45.07,113.27z'%20/%3e%3c/g%3e%3c/svg%3e",dT={class:"relative mt-2 mb-10 lg:mt-10 max-w-screen-xl mx-auto"},pT={class:"w-full text-gray-600 justify-between items-center lg:items-start flex flex-col lg:flex-row mt-4 gap-4 lg:gap-0"},fT={class:"flex justify-end mr-4 md:mr-10 md:w-auto"},mT=bi("img",{src:cT,width:"20",height:"20"},null,-1),_T=[mT],gT=bi("img",{src:uT,width:"20",height:"20"},null,-1),yT=[gT],vT=bi("img",{src:hT,width:"20",height:"20"},null,-1),xT=[vT],bT={class:"flex justify-start items-center"},wT={class:"bg-gray-50 p-2 flex"},TT={class:"lg:mr-10 w-[325px]"},ST=bi("span",{id:"rent-indicator",class:"h-full hidden w-1 bg-white absolute bg-opacity-75"},null,-1),PT=[ST],AT={class:"flex justify-between w-[300px] mx-2.5 pt-1"},IT={class:"w-full flex justify-between text-sm"},CT={class:"hidden md:block"},ET=bi("div",{class:"w-full flex justify-center"},[bi("div",{class:"-mt-4 text-sm md:text-base md:mt-2"},"Nettokaltmiete € / m²")],-1),LT=bi("div",{class:"mt-2 md:mt-6 text-xs md:text-sm"},"Daten: Wohnatlas Berlin 2009 und 2020",-1),MT={class:"flex gap-4 w-2/3 md:w-auto lg:flex-col"},kT=["onClick"],zT={class:"w-10 h-10 p-0.5 flex justify-center items-center bg-gray-100 rounded transition-all"},RT=["disabled"],DT=lh({__name:"Legend",props:{state:{},zoomLevel:{},minZoom:{},maxZoom:{},initZoomLevel:{},selectedYear:{},selectedButton:{},unselectedButton:{},minRent:{},meanRent:{},maxRent:{},colorScale2009:{type:Boolean},colorScale2020:{type:Boolean},legendScale:{}},emits:["zoomIn","zoomOut","zoomInitial","toggleYear2020","toggleYear2009","toggleColorScales2009","toggleColorScales2020"],setup(i,{emit:r}){const u=i,m=r;function x(S){u.selectedYear!==S&&m(S===2020?"toggleColorScales2020":"toggleColorScales2009")}return(S,I)=>(Jo(),ia("div",dT,[bi("div",pT,[bi("div",{class:Po(["flex items-center justify-end relative",S.state&&S.state<5&&"opacity-40"])},[bi("div",fT,[bi("button",{id:"zoom-in",class:Po(["w-12 p-2 mr-2 flex justify-center items-center text-white border-none rounded text-3xl transition-all",S.zoomLevel===S.maxZoom?"bg-gray-100 pointer-events-none":"bg-gray-300"]),onClick:I[0]||(I[0]=c=>S.$emit("zoomIn"))},_T,2),bi("button",{id:"zoom-out",class:Po(["w-12 p-2 mr-2 flex justify-center items-center text-white border-none rounded text-3xl transition-all",S.zoomLevel===S.minZoom?"bg-gray-100 pointer-events-none":"bg-gray-300"]),onClick:I[1]||(I[1]=c=>S.$emit("zoomOut"))},yT,2),bi("button",{id:"zoom-out",class:Po(["w-12 p-2 mr-2 flex justify-center items-center text-white border-none rounded text-3xl transition-all",S.zoomLevel===S.initZoomLevel?"bg-gray-100 pointer-events-none":"bg-gray-300"]),onClick:I[2]||(I[2]=c=>S.$emit("zoomInitial"))},xT,2)]),bi("div",bT,[bi("div",wT,[bi("button",{class:Po([S.selectedYear===2020?S.selectedButton:S.unselectedButton,"mr-2"]),onClick:I[3]||(I[3]=c=>S.$emit("toggleYear2020"))}," 2020 ",2),bi("button",{class:Po(S.selectedYear===2009?S.selectedButton:S.unselectedButton),onClick:I[4]||(I[4]=c=>S.$emit("toggleYear2009"))}," 2009 ",2)])])],2),bi("div",TT,[bi("div",{class:"relative w-[300px] mx-2.5 h-6",style:eu(S.legendScale)},PT,4),bi("div",AT,[(Jo(),ia(Wo,null,of(3,c=>bi("span",{class:"bg-gray-600 w-0.5 h-2",key:c})),64))]),bi("div",IT,[bi("span",null,Ra(S.minRent),1),bi("span",CT,Ra(S.meanRent),1),bi("span",null,Ra(S.maxRent),1)]),ET,LT]),bi("div",{class:Po(["text-xs md:text-base flex md:flex-col gap-6 md:gap-2 items-start mt-4",S.state&&S.state<5&&"opacity-40"])},[dd(" Farbskala berücksichtigt Werte aus den Jahren: "),bi("div",MT,[(Jo(),ia(Wo,null,of([2009,2020],c=>bi("div",{key:c,class:Po(["flex items-center gap-2",S.selectedYear===c?"opacity-60":"cursor-pointer"]),onClick:F=>x(c)},[bi("div",zT,[bi("button",{disabled:S.selectedYear===c,class:Po(["w-7 h-7 border-white border-4",c===2009&&S.colorScale2009||c===2020&&S.colorScale2020||S.selectedYear===c?"bg-gray-400":"bg-white"])},null,10,RT)]),dd(" "+Ra(c),1)],10,kT)),64))])],2)])]))}}),BT={id:"wrapper relative "},OT={class:"w-full relative max-w-screen-xl mx-auto"},FT={class:"absolute border-4 border-gray-800 m-2 left-2 xl:right-auto bg-white z-10 p-1 sm:p-2 sm:text-xl opacity-90"},NT={id:"tooltip",class:"absolute transition-opacity border-2 border-gray-800 right-4 top-2 md:right-auto bg-white p-2 z-[1000] opacity-0 pointer-events-none"},UT={class:"relative"},VT=bi("div",{class:"h-full w-full absolute bg-white z-[1]"},null,-1),$T=lh({__name:"MapTemplate",props:{selectedYear:{},selected:{},mapHeightCalculated:{},mapIsMoving:{type:Boolean},state:{}},setup(i){return(r,u)=>{var m,x;return Jo(),ia("div",BT,[bi("div",OT,[bi("div",FT,Ra(r.selectedYear),1)]),bi("div",NT,[bi("p",null,Ra((m=r.selected)==null?void 0:m.PROGNOSERA),1),bi("p",null,Ra((x=r.selected)==null?void 0:x.ANGEBOTSMIETEN.toFixed(2))+" € / m²",1)]),bi("div",UT,[bi("div",{id:"main-map",class:"w-full relative",style:eu(r.mapHeightCalculated)},[VT,bi("div",{id:"border-map",class:Po([[r.mapIsMoving?"invisible":"visible"],"w-full z-1 relative h-full"])},null,2)],4)])])}}});function id(i,r){return i==null||r==null?NaN:i<r?-1:i>r?1:i>=r?0:NaN}function ZT(i,r){return i==null||r==null?NaN:r<i?-1:r>i?1:r>=i?0:NaN}function m0(i){let r,u,m;i.length!==2?(r=id,u=(c,F)=>id(i(c),F),m=(c,F)=>i(c)-F):(r=i===id||i===ZT?i:jT,u=i,m=i);function x(c,F,D=0,q=c.length){if(D<q){if(r(F,F)!==0)return q;do{const W=D+q>>>1;u(c[W],F)<0?D=W+1:q=W}while(D<q)}return D}function S(c,F,D=0,q=c.length){if(D<q){if(r(F,F)!==0)return q;do{const W=D+q>>>1;u(c[W],F)<=0?D=W+1:q=W}while(D<q)}return D}function I(c,F,D=0,q=c.length){const W=x(c,F,D,q-1);return W>D&&m(c[W-1],F)>-m(c[W],F)?W-1:W}return{left:x,center:I,right:S}}function jT(){return 0}function GT(i){return i===null?NaN:+i}const qT=m0(id),HT=qT.right;m0(GT).center;class Xc{constructor(){this._partials=new Float64Array(32),this._n=0}add(r){const u=this._partials;let m=0;for(let x=0;x<this._n&&x<32;x++){const S=u[x],I=r+S,c=Math.abs(r)<Math.abs(S)?r-(I-S):S-(I-r);c&&(u[m++]=c),r=I}return u[m]=r,this._n=m+1,this}valueOf(){const r=this._partials;let u=this._n,m,x,S,I=0;if(u>0){for(I=r[--u];u>0&&(m=I,x=r[--u],I=m+x,S=x-(I-m),!S););u>0&&(S<0&&r[u-1]<0||S>0&&r[u-1]>0)&&(x=S*2,m=I+x,x==m-I&&(I=m))}return I}}const WT=Math.sqrt(50),KT=Math.sqrt(10),XT=Math.sqrt(2);function fd(i,r,u){const m=(r-i)/Math.max(0,u),x=Math.floor(Math.log10(m)),S=m/Math.pow(10,x),I=S>=WT?10:S>=KT?5:S>=XT?2:1;let c,F,D;return x<0?(D=Math.pow(10,-x)/I,c=Math.round(i*D),F=Math.round(r*D),c/D<i&&++c,F/D>r&&--F,D=-D):(D=Math.pow(10,x)*I,c=Math.round(i/D),F=Math.round(r/D),c*D<i&&++c,F*D>r&&--F),F<c&&.5<=u&&u<2?fd(i,r,u*2):[c,F,D]}function YT(i,r,u){if(r=+r,i=+i,u=+u,!(u>0))return[];if(i===r)return[i];const m=r<i,[x,S,I]=m?fd(r,i,u):fd(i,r,u);if(!(S>=x))return[];const c=S-x+1,F=new Array(c);if(m)if(I<0)for(let D=0;D<c;++D)F[D]=(S-D)/-I;else for(let D=0;D<c;++D)F[D]=(S-D)*I;else if(I<0)for(let D=0;D<c;++D)F[D]=(x+D)/-I;else for(let D=0;D<c;++D)F[D]=(x+D)*I;return F}function df(i,r,u){return r=+r,i=+i,u=+u,fd(i,r,u)[2]}function JT(i,r,u){r=+r,i=+i,u=+u;const m=r<i,x=m?df(r,i,u):df(i,r,u);return(m?-1:1)*(x<0?1/-x:x)}function Bg(i,r){let u;if(r===void 0)for(const m of i)m!=null&&(u<m||u===void 0&&m>=m)&&(u=m);else{let m=-1;for(let x of i)(x=r(x,++m,i))!=null&&(u<x||u===void 0&&x>=x)&&(u=x)}return u}function Og(i,r){let u;if(r===void 0)for(const m of i)m!=null&&(u>m||u===void 0&&m>=m)&&(u=m);else{let m=-1;for(let x of i)(x=r(x,++m,i))!=null&&(u>x||u===void 0&&x>=x)&&(u=x)}return u}function Fg(i,r){let u=0,m=0;if(r===void 0)for(let x of i)x!=null&&(x=+x)>=x&&(++u,m+=x);else{let x=-1;for(let S of i)(S=r(S,++x,i))!=null&&(S=+S)>=S&&(++u,m+=S)}if(u)return m/u}var QT={value:()=>{}};function _0(){for(var i=0,r=arguments.length,u={},m;i<r;++i){if(!(m=arguments[i]+"")||m in u||/[\s.]/.test(m))throw new Error("illegal type: "+m);u[m]=[]}return new nd(u)}function nd(i){this._=i}function tS(i,r){return i.trim().split(/^|\s+/).map(function(u){var m="",x=u.indexOf(".");if(x>=0&&(m=u.slice(x+1),u=u.slice(0,x)),u&&!r.hasOwnProperty(u))throw new Error("unknown type: "+u);return{type:u,name:m}})}nd.prototype=_0.prototype={constructor:nd,on:function(i,r){var u=this._,m=tS(i+"",u),x,S=-1,I=m.length;if(arguments.length<2){for(;++S<I;)if((x=(i=m[S]).type)&&(x=eS(u[x],i.name)))return x;return}if(r!=null&&typeof r!="function")throw new Error("invalid callback: "+r);for(;++S<I;)if(x=(i=m[S]).type)u[x]=Ng(u[x],i.name,r);else if(r==null)for(x in u)u[x]=Ng(u[x],i.name,null);return this},copy:function(){var i={},r=this._;for(var u in r)i[u]=r[u].slice();return new nd(i)},call:function(i,r){if((x=arguments.length-2)>0)for(var u=new Array(x),m=0,x,S;m<x;++m)u[m]=arguments[m+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(S=this._[i],m=0,x=S.length;m<x;++m)S[m].value.apply(r,u)},apply:function(i,r,u){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var m=this._[i],x=0,S=m.length;x<S;++x)m[x].value.apply(r,u)}};function eS(i,r){for(var u=0,m=i.length,x;u<m;++u)if((x=i[u]).name===r)return x.value}function Ng(i,r,u){for(var m=0,x=i.length;m<x;++m)if(i[m].name===r){i[m]=QT,i=i.slice(0,m).concat(i.slice(m+1));break}return u!=null&&i.push({name:r,value:u}),i}var pf="http://www.w3.org/1999/xhtml";const Ug={svg:"http://www.w3.org/2000/svg",xhtml:pf,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Fd(i){var r=i+="",u=r.indexOf(":");return u>=0&&(r=i.slice(0,u))!=="xmlns"&&(i=i.slice(u+1)),Ug.hasOwnProperty(r)?{space:Ug[r],local:i}:i}function iS(i){return function(){var r=this.ownerDocument,u=this.namespaceURI;return u===pf&&r.documentElement.namespaceURI===pf?r.createElement(i):r.createElementNS(u,i)}}function nS(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function g0(i){var r=Fd(i);return(r.local?nS:iS)(r)}function rS(){}function lm(i){return i==null?rS:function(){return this.querySelector(i)}}function oS(i){typeof i!="function"&&(i=lm(i));for(var r=this._groups,u=r.length,m=new Array(u),x=0;x<u;++x)for(var S=r[x],I=S.length,c=m[x]=new Array(I),F,D,q=0;q<I;++q)(F=S[q])&&(D=i.call(F,F.__data__,q,S))&&("__data__"in F&&(D.__data__=F.__data__),c[q]=D);return new Co(m,this._parents)}function sS(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function aS(){return[]}function y0(i){return i==null?aS:function(){return this.querySelectorAll(i)}}function lS(i){return function(){return sS(i.apply(this,arguments))}}function cS(i){typeof i=="function"?i=lS(i):i=y0(i);for(var r=this._groups,u=r.length,m=[],x=[],S=0;S<u;++S)for(var I=r[S],c=I.length,F,D=0;D<c;++D)(F=I[D])&&(m.push(i.call(F,F.__data__,D,I)),x.push(F));return new Co(m,x)}function v0(i){return function(){return this.matches(i)}}function x0(i){return function(r){return r.matches(i)}}var uS=Array.prototype.find;function hS(i){return function(){return uS.call(this.children,i)}}function dS(){return this.firstElementChild}function pS(i){return this.select(i==null?dS:hS(typeof i=="function"?i:x0(i)))}var fS=Array.prototype.filter;function mS(){return Array.from(this.children)}function _S(i){return function(){return fS.call(this.children,i)}}function gS(i){return this.selectAll(i==null?mS:_S(typeof i=="function"?i:x0(i)))}function yS(i){typeof i!="function"&&(i=v0(i));for(var r=this._groups,u=r.length,m=new Array(u),x=0;x<u;++x)for(var S=r[x],I=S.length,c=m[x]=[],F,D=0;D<I;++D)(F=S[D])&&i.call(F,F.__data__,D,S)&&c.push(F);return new Co(m,this._parents)}function b0(i){return new Array(i.length)}function vS(){return new Co(this._enter||this._groups.map(b0),this._parents)}function md(i,r){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=r}md.prototype={constructor:md,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,r){return this._parent.insertBefore(i,r)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function xS(i){return function(){return i}}function bS(i,r,u,m,x,S){for(var I=0,c,F=r.length,D=S.length;I<D;++I)(c=r[I])?(c.__data__=S[I],m[I]=c):u[I]=new md(i,S[I]);for(;I<F;++I)(c=r[I])&&(x[I]=c)}function wS(i,r,u,m,x,S,I){var c,F,D=new Map,q=r.length,W=S.length,K=new Array(q),bt;for(c=0;c<q;++c)(F=r[c])&&(K[c]=bt=I.call(F,F.__data__,c,r)+"",D.has(bt)?x[c]=F:D.set(bt,F));for(c=0;c<W;++c)bt=I.call(i,S[c],c,S)+"",(F=D.get(bt))?(m[c]=F,F.__data__=S[c],D.delete(bt)):u[c]=new md(i,S[c]);for(c=0;c<q;++c)(F=r[c])&&D.get(K[c])===F&&(x[c]=F)}function TS(i){return i.__data__}function SS(i,r){if(!arguments.length)return Array.from(this,TS);var u=r?wS:bS,m=this._parents,x=this._groups;typeof i!="function"&&(i=xS(i));for(var S=x.length,I=new Array(S),c=new Array(S),F=new Array(S),D=0;D<S;++D){var q=m[D],W=x[D],K=W.length,bt=PS(i.call(q,q&&q.__data__,D,m)),zt=bt.length,Pt=c[D]=new Array(zt),oe=I[D]=new Array(zt),Jt=F[D]=new Array(K);u(q,W,Pt,oe,Jt,bt,r);for(var Ut=0,Zt=0,Le,de;Ut<zt;++Ut)if(Le=Pt[Ut]){for(Ut>=Zt&&(Zt=Ut+1);!(de=oe[Zt])&&++Zt<zt;);Le._next=de||null}}return I=new Co(I,m),I._enter=c,I._exit=F,I}function PS(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function AS(){return new Co(this._exit||this._groups.map(b0),this._parents)}function IS(i,r,u){var m=this.enter(),x=this,S=this.exit();return typeof i=="function"?(m=i(m),m&&(m=m.selection())):m=m.append(i+""),r!=null&&(x=r(x),x&&(x=x.selection())),u==null?S.remove():u(S),m&&x?m.merge(x).order():x}function CS(i){for(var r=i.selection?i.selection():i,u=this._groups,m=r._groups,x=u.length,S=m.length,I=Math.min(x,S),c=new Array(x),F=0;F<I;++F)for(var D=u[F],q=m[F],W=D.length,K=c[F]=new Array(W),bt,zt=0;zt<W;++zt)(bt=D[zt]||q[zt])&&(K[zt]=bt);for(;F<x;++F)c[F]=u[F];return new Co(c,this._parents)}function ES(){for(var i=this._groups,r=-1,u=i.length;++r<u;)for(var m=i[r],x=m.length-1,S=m[x],I;--x>=0;)(I=m[x])&&(S&&I.compareDocumentPosition(S)^4&&S.parentNode.insertBefore(I,S),S=I);return this}function LS(i){i||(i=MS);function r(W,K){return W&&K?i(W.__data__,K.__data__):!W-!K}for(var u=this._groups,m=u.length,x=new Array(m),S=0;S<m;++S){for(var I=u[S],c=I.length,F=x[S]=new Array(c),D,q=0;q<c;++q)(D=I[q])&&(F[q]=D);F.sort(r)}return new Co(x,this._parents).order()}function MS(i,r){return i<r?-1:i>r?1:i>=r?0:NaN}function kS(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function zS(){return Array.from(this)}function RS(){for(var i=this._groups,r=0,u=i.length;r<u;++r)for(var m=i[r],x=0,S=m.length;x<S;++x){var I=m[x];if(I)return I}return null}function DS(){let i=0;for(const r of this)++i;return i}function BS(){return!this.node()}function OS(i){for(var r=this._groups,u=0,m=r.length;u<m;++u)for(var x=r[u],S=0,I=x.length,c;S<I;++S)(c=x[S])&&i.call(c,c.__data__,S,x);return this}function FS(i){return function(){this.removeAttribute(i)}}function NS(i){return function(){this.removeAttributeNS(i.space,i.local)}}function US(i,r){return function(){this.setAttribute(i,r)}}function VS(i,r){return function(){this.setAttributeNS(i.space,i.local,r)}}function $S(i,r){return function(){var u=r.apply(this,arguments);u==null?this.removeAttribute(i):this.setAttribute(i,u)}}function ZS(i,r){return function(){var u=r.apply(this,arguments);u==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,u)}}function jS(i,r){var u=Fd(i);if(arguments.length<2){var m=this.node();return u.local?m.getAttributeNS(u.space,u.local):m.getAttribute(u)}return this.each((r==null?u.local?NS:FS:typeof r=="function"?u.local?ZS:$S:u.local?VS:US)(u,r))}function w0(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function GS(i){return function(){this.style.removeProperty(i)}}function qS(i,r,u){return function(){this.style.setProperty(i,r,u)}}function HS(i,r,u){return function(){var m=r.apply(this,arguments);m==null?this.style.removeProperty(i):this.style.setProperty(i,m,u)}}function WS(i,r,u){return arguments.length>1?this.each((r==null?GS:typeof r=="function"?HS:qS)(i,r,u??"")):Yc(this.node(),i)}function Yc(i,r){return i.style.getPropertyValue(r)||w0(i).getComputedStyle(i,null).getPropertyValue(r)}function KS(i){return function(){delete this[i]}}function XS(i,r){return function(){this[i]=r}}function YS(i,r){return function(){var u=r.apply(this,arguments);u==null?delete this[i]:this[i]=u}}function JS(i,r){return arguments.length>1?this.each((r==null?KS:typeof r=="function"?YS:XS)(i,r)):this.node()[i]}function T0(i){return i.trim().split(/^|\s+/)}function cm(i){return i.classList||new S0(i)}function S0(i){this._node=i,this._names=T0(i.getAttribute("class")||"")}S0.prototype={add:function(i){var r=this._names.indexOf(i);r<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var r=this._names.indexOf(i);r>=0&&(this._names.splice(r,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function P0(i,r){for(var u=cm(i),m=-1,x=r.length;++m<x;)u.add(r[m])}function A0(i,r){for(var u=cm(i),m=-1,x=r.length;++m<x;)u.remove(r[m])}function QS(i){return function(){P0(this,i)}}function tP(i){return function(){A0(this,i)}}function eP(i,r){return function(){(r.apply(this,arguments)?P0:A0)(this,i)}}function iP(i,r){var u=T0(i+"");if(arguments.length<2){for(var m=cm(this.node()),x=-1,S=u.length;++x<S;)if(!m.contains(u[x]))return!1;return!0}return this.each((typeof r=="function"?eP:r?QS:tP)(u,r))}function nP(){this.textContent=""}function rP(i){return function(){this.textContent=i}}function oP(i){return function(){var r=i.apply(this,arguments);this.textContent=r??""}}function sP(i){return arguments.length?this.each(i==null?nP:(typeof i=="function"?oP:rP)(i)):this.node().textContent}function aP(){this.innerHTML=""}function lP(i){return function(){this.innerHTML=i}}function cP(i){return function(){var r=i.apply(this,arguments);this.innerHTML=r??""}}function uP(i){return arguments.length?this.each(i==null?aP:(typeof i=="function"?cP:lP)(i)):this.node().innerHTML}function hP(){this.nextSibling&&this.parentNode.appendChild(this)}function dP(){return this.each(hP)}function pP(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function fP(){return this.each(pP)}function mP(i){var r=typeof i=="function"?i:g0(i);return this.select(function(){return this.appendChild(r.apply(this,arguments))})}function _P(){return null}function gP(i,r){var u=typeof i=="function"?i:g0(i),m=r==null?_P:typeof r=="function"?r:lm(r);return this.select(function(){return this.insertBefore(u.apply(this,arguments),m.apply(this,arguments)||null)})}function yP(){var i=this.parentNode;i&&i.removeChild(this)}function vP(){return this.each(yP)}function xP(){var i=this.cloneNode(!1),r=this.parentNode;return r?r.insertBefore(i,this.nextSibling):i}function bP(){var i=this.cloneNode(!0),r=this.parentNode;return r?r.insertBefore(i,this.nextSibling):i}function wP(i){return this.select(i?bP:xP)}function TP(i){return arguments.length?this.property("__data__",i):this.node().__data__}function SP(i){return function(r){i.call(this,r,this.__data__)}}function PP(i){return i.trim().split(/^|\s+/).map(function(r){var u="",m=r.indexOf(".");return m>=0&&(u=r.slice(m+1),r=r.slice(0,m)),{type:r,name:u}})}function AP(i){return function(){var r=this.__on;if(r){for(var u=0,m=-1,x=r.length,S;u<x;++u)S=r[u],(!i.type||S.type===i.type)&&S.name===i.name?this.removeEventListener(S.type,S.listener,S.options):r[++m]=S;++m?r.length=m:delete this.__on}}}function IP(i,r,u){return function(){var m=this.__on,x,S=SP(r);if(m){for(var I=0,c=m.length;I<c;++I)if((x=m[I]).type===i.type&&x.name===i.name){this.removeEventListener(x.type,x.listener,x.options),this.addEventListener(x.type,x.listener=S,x.options=u),x.value=r;return}}this.addEventListener(i.type,S,u),x={type:i.type,name:i.name,value:r,listener:S,options:u},m?m.push(x):this.__on=[x]}}function CP(i,r,u){var m=PP(i+""),x,S=m.length,I;if(arguments.length<2){var c=this.node().__on;if(c){for(var F=0,D=c.length,q;F<D;++F)for(x=0,q=c[F];x<S;++x)if((I=m[x]).type===q.type&&I.name===q.name)return q.value}return}for(c=r?IP:AP,x=0;x<S;++x)this.each(c(m[x],r,u));return this}function I0(i,r,u){var m=w0(i),x=m.CustomEvent;typeof x=="function"?x=new x(r,u):(x=m.document.createEvent("Event"),u?(x.initEvent(r,u.bubbles,u.cancelable),x.detail=u.detail):x.initEvent(r,!1,!1)),i.dispatchEvent(x)}function EP(i,r){return function(){return I0(this,i,r)}}function LP(i,r){return function(){return I0(this,i,r.apply(this,arguments))}}function MP(i,r){return this.each((typeof r=="function"?LP:EP)(i,r))}function*kP(){for(var i=this._groups,r=0,u=i.length;r<u;++r)for(var m=i[r],x=0,S=m.length,I;x<S;++x)(I=m[x])&&(yield I)}var C0=[null];function Co(i,r){this._groups=i,this._parents=r}function uh(){return new Co([[document.documentElement]],C0)}function zP(){return this}Co.prototype=uh.prototype={constructor:Co,select:oS,selectAll:cS,selectChild:pS,selectChildren:gS,filter:yS,data:SS,enter:vS,exit:AS,join:IS,merge:CS,selection:zP,order:ES,sort:LS,call:kS,nodes:zS,node:RS,size:DS,empty:BS,each:OS,attr:jS,style:WS,property:JS,classed:iP,text:sP,html:uP,raise:dP,lower:fP,append:mP,insert:gP,remove:vP,clone:wP,datum:TP,on:CP,dispatch:MP,[Symbol.iterator]:kP};function Zr(i){return typeof i=="string"?new Co([[document.querySelector(i)]],[document.documentElement]):new Co([[i]],C0)}function RP(i){let r;for(;r=i.sourceEvent;)i=r;return i}function DP(i,r){if(i=RP(i),r===void 0&&(r=i.currentTarget),r){var u=r.ownerSVGElement||r;if(u.createSVGPoint){var m=u.createSVGPoint();return m.x=i.clientX,m.y=i.clientY,m=m.matrixTransform(r.getScreenCTM().inverse()),[m.x,m.y]}if(r.getBoundingClientRect){var x=r.getBoundingClientRect();return[i.clientX-x.left-r.clientLeft,i.clientY-x.top-r.clientTop]}}return[i.pageX,i.pageY]}function um(i,r,u){i.prototype=r.prototype=u,u.constructor=i}function E0(i,r){var u=Object.create(i.prototype);for(var m in r)u[m]=r[m];return u}function hh(){}var ih=.7,_d=1/ih,Zc="\\s*([+-]?\\d+)\\s*",nh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",na="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",BP=/^#([0-9a-f]{3,8})$/,OP=new RegExp(`^rgb\\(${Zc},${Zc},${Zc}\\)$`),FP=new RegExp(`^rgb\\(${na},${na},${na}\\)$`),NP=new RegExp(`^rgba\\(${Zc},${Zc},${Zc},${nh}\\)$`),UP=new RegExp(`^rgba\\(${na},${na},${na},${nh}\\)$`),VP=new RegExp(`^hsl\\(${nh},${na},${na}\\)$`),$P=new RegExp(`^hsla\\(${nh},${na},${na},${nh}\\)$`),Vg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};um(hh,lc,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:$g,formatHex:$g,formatHex8:ZP,formatHsl:jP,formatRgb:Zg,toString:Zg});function $g(){return this.rgb().formatHex()}function ZP(){return this.rgb().formatHex8()}function jP(){return L0(this).formatHsl()}function Zg(){return this.rgb().formatRgb()}function lc(i){var r,u;return i=(i+"").trim().toLowerCase(),(r=BP.exec(i))?(u=r[1].length,r=parseInt(r[1],16),u===6?jg(r):u===3?new oo(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):u===8?Vh(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):u===4?Vh(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=OP.exec(i))?new oo(r[1],r[2],r[3],1):(r=FP.exec(i))?new oo(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=NP.exec(i))?Vh(r[1],r[2],r[3],r[4]):(r=UP.exec(i))?Vh(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=VP.exec(i))?Hg(r[1],r[2]/100,r[3]/100,1):(r=$P.exec(i))?Hg(r[1],r[2]/100,r[3]/100,r[4]):Vg.hasOwnProperty(i)?jg(Vg[i]):i==="transparent"?new oo(NaN,NaN,NaN,0):null}function jg(i){return new oo(i>>16&255,i>>8&255,i&255,1)}function Vh(i,r,u,m){return m<=0&&(i=r=u=NaN),new oo(i,r,u,m)}function GP(i){return i instanceof hh||(i=lc(i)),i?(i=i.rgb(),new oo(i.r,i.g,i.b,i.opacity)):new oo}function ff(i,r,u,m){return arguments.length===1?GP(i):new oo(i,r,u,m??1)}function oo(i,r,u,m){this.r=+i,this.g=+r,this.b=+u,this.opacity=+m}um(oo,ff,E0(hh,{brighter(i){return i=i==null?_d:Math.pow(_d,i),new oo(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?ih:Math.pow(ih,i),new oo(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new oo(tc(this.r),tc(this.g),tc(this.b),gd(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Gg,formatHex:Gg,formatHex8:qP,formatRgb:qg,toString:qg}));function Gg(){return`#${Yl(this.r)}${Yl(this.g)}${Yl(this.b)}`}function qP(){return`#${Yl(this.r)}${Yl(this.g)}${Yl(this.b)}${Yl((isNaN(this.opacity)?1:this.opacity)*255)}`}function qg(){const i=gd(this.opacity);return`${i===1?"rgb(":"rgba("}${tc(this.r)}, ${tc(this.g)}, ${tc(this.b)}${i===1?")":`, ${i})`}`}function gd(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function tc(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function Yl(i){return i=tc(i),(i<16?"0":"")+i.toString(16)}function Hg(i,r,u,m){return m<=0?i=r=u=NaN:u<=0||u>=1?i=r=NaN:r<=0&&(i=NaN),new Ss(i,r,u,m)}function L0(i){if(i instanceof Ss)return new Ss(i.h,i.s,i.l,i.opacity);if(i instanceof hh||(i=lc(i)),!i)return new Ss;if(i instanceof Ss)return i;i=i.rgb();var r=i.r/255,u=i.g/255,m=i.b/255,x=Math.min(r,u,m),S=Math.max(r,u,m),I=NaN,c=S-x,F=(S+x)/2;return c?(r===S?I=(u-m)/c+(u<m)*6:u===S?I=(m-r)/c+2:I=(r-u)/c+4,c/=F<.5?S+x:2-S-x,I*=60):c=F>0&&F<1?0:I,new Ss(I,c,F,i.opacity)}function HP(i,r,u,m){return arguments.length===1?L0(i):new Ss(i,r,u,m??1)}function Ss(i,r,u,m){this.h=+i,this.s=+r,this.l=+u,this.opacity=+m}um(Ss,HP,E0(hh,{brighter(i){return i=i==null?_d:Math.pow(_d,i),new Ss(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?ih:Math.pow(ih,i),new Ss(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,r=isNaN(i)||isNaN(this.s)?0:this.s,u=this.l,m=u+(u<.5?u:1-u)*r,x=2*u-m;return new oo(jp(i>=240?i-240:i+120,x,m),jp(i,x,m),jp(i<120?i+240:i-120,x,m),this.opacity)},clamp(){return new Ss(Wg(this.h),$h(this.s),$h(this.l),gd(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=gd(this.opacity);return`${i===1?"hsl(":"hsla("}${Wg(this.h)}, ${$h(this.s)*100}%, ${$h(this.l)*100}%${i===1?")":`, ${i})`}`}}));function Wg(i){return i=(i||0)%360,i<0?i+360:i}function $h(i){return Math.max(0,Math.min(1,i||0))}function jp(i,r,u){return(i<60?r+(u-r)*i/60:i<180?u:i<240?r+(u-r)*(240-i)/60:r)*255}const hm=i=>()=>i;function WP(i,r){return function(u){return i+u*r}}function KP(i,r,u){return i=Math.pow(i,u),r=Math.pow(r,u)-i,u=1/u,function(m){return Math.pow(i+m*r,u)}}function XP(i){return(i=+i)==1?M0:function(r,u){return u-r?KP(r,u,i):hm(isNaN(r)?u:r)}}function M0(i,r){var u=r-i;return u?WP(i,u):hm(isNaN(i)?r:i)}const rh=function i(r){var u=XP(r);function m(x,S){var I=u((x=ff(x)).r,(S=ff(S)).r),c=u(x.g,S.g),F=u(x.b,S.b),D=M0(x.opacity,S.opacity);return function(q){return x.r=I(q),x.g=c(q),x.b=F(q),x.opacity=D(q),x+""}}return m.gamma=i,m}(1);function YP(i,r){r||(r=[]);var u=i?Math.min(r.length,i.length):0,m=r.slice(),x;return function(S){for(x=0;x<u;++x)m[x]=i[x]*(1-S)+r[x]*S;return m}}function JP(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function QP(i,r){var u=r?r.length:0,m=i?Math.min(u,i.length):0,x=new Array(m),S=new Array(u),I;for(I=0;I<m;++I)x[I]=dm(i[I],r[I]);for(;I<u;++I)S[I]=r[I];return function(c){for(I=0;I<m;++I)S[I]=x[I](c);return S}}function tA(i,r){var u=new Date;return i=+i,r=+r,function(m){return u.setTime(i*(1-m)+r*m),u}}function Ts(i,r){return i=+i,r=+r,function(u){return i*(1-u)+r*u}}function eA(i,r){var u={},m={},x;(i===null||typeof i!="object")&&(i={}),(r===null||typeof r!="object")&&(r={});for(x in r)x in i?u[x]=dm(i[x],r[x]):m[x]=r[x];return function(S){for(x in u)m[x]=u[x](S);return m}}var mf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Gp=new RegExp(mf.source,"g");function iA(i){return function(){return i}}function nA(i){return function(r){return i(r)+""}}function k0(i,r){var u=mf.lastIndex=Gp.lastIndex=0,m,x,S,I=-1,c=[],F=[];for(i=i+"",r=r+"";(m=mf.exec(i))&&(x=Gp.exec(r));)(S=x.index)>u&&(S=r.slice(u,S),c[I]?c[I]+=S:c[++I]=S),(m=m[0])===(x=x[0])?c[I]?c[I]+=x:c[++I]=x:(c[++I]=null,F.push({i:I,x:Ts(m,x)})),u=Gp.lastIndex;return u<r.length&&(S=r.slice(u),c[I]?c[I]+=S:c[++I]=S),c.length<2?F[0]?nA(F[0].x):iA(r):(r=F.length,function(D){for(var q=0,W;q<r;++q)c[(W=F[q]).i]=W.x(D);return c.join("")})}function dm(i,r){var u=typeof r,m;return r==null||u==="boolean"?hm(r):(u==="number"?Ts:u==="string"?(m=lc(r))?(r=m,rh):k0:r instanceof lc?rh:r instanceof Date?tA:JP(r)?YP:Array.isArray(r)?QP:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?eA:Ts)(i,r)}function rA(i,r){return i=+i,r=+r,function(u){return Math.round(i*(1-u)+r*u)}}var Kg=180/Math.PI,_f={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function z0(i,r,u,m,x,S){var I,c,F;return(I=Math.sqrt(i*i+r*r))&&(i/=I,r/=I),(F=i*u+r*m)&&(u-=i*F,m-=r*F),(c=Math.sqrt(u*u+m*m))&&(u/=c,m/=c,F/=c),i*m<r*u&&(i=-i,r=-r,F=-F,I=-I),{translateX:x,translateY:S,rotate:Math.atan2(r,i)*Kg,skewX:Math.atan(F)*Kg,scaleX:I,scaleY:c}}var Zh;function oA(i){const r=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return r.isIdentity?_f:z0(r.a,r.b,r.c,r.d,r.e,r.f)}function sA(i){return i==null||(Zh||(Zh=document.createElementNS("http://www.w3.org/2000/svg","g")),Zh.setAttribute("transform",i),!(i=Zh.transform.baseVal.consolidate()))?_f:(i=i.matrix,z0(i.a,i.b,i.c,i.d,i.e,i.f))}function R0(i,r,u,m){function x(D){return D.length?D.pop()+" ":""}function S(D,q,W,K,bt,zt){if(D!==W||q!==K){var Pt=bt.push("translate(",null,r,null,u);zt.push({i:Pt-4,x:Ts(D,W)},{i:Pt-2,x:Ts(q,K)})}else(W||K)&&bt.push("translate("+W+r+K+u)}function I(D,q,W,K){D!==q?(D-q>180?q+=360:q-D>180&&(D+=360),K.push({i:W.push(x(W)+"rotate(",null,m)-2,x:Ts(D,q)})):q&&W.push(x(W)+"rotate("+q+m)}function c(D,q,W,K){D!==q?K.push({i:W.push(x(W)+"skewX(",null,m)-2,x:Ts(D,q)}):q&&W.push(x(W)+"skewX("+q+m)}function F(D,q,W,K,bt,zt){if(D!==W||q!==K){var Pt=bt.push(x(bt)+"scale(",null,",",null,")");zt.push({i:Pt-4,x:Ts(D,W)},{i:Pt-2,x:Ts(q,K)})}else(W!==1||K!==1)&&bt.push(x(bt)+"scale("+W+","+K+")")}return function(D,q){var W=[],K=[];return D=i(D),q=i(q),S(D.translateX,D.translateY,q.translateX,q.translateY,W,K),I(D.rotate,q.rotate,W,K),c(D.skewX,q.skewX,W,K),F(D.scaleX,D.scaleY,q.scaleX,q.scaleY,W,K),D=q=null,function(bt){for(var zt=-1,Pt=K.length,oe;++zt<Pt;)W[(oe=K[zt]).i]=oe.x(bt);return W.join("")}}}var aA=R0(oA,"px, ","px)","deg)"),lA=R0(sA,", ",")",")"),Jc=0,Uu=0,Du=0,D0=1e3,yd,Vu,vd=0,cc=0,Nd=0,oh=typeof performance=="object"&&performance.now?performance:Date,B0=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function pm(){return cc||(B0(cA),cc=oh.now()+Nd)}function cA(){cc=0}function xd(){this._call=this._time=this._next=null}xd.prototype=O0.prototype={constructor:xd,restart:function(i,r,u){if(typeof i!="function")throw new TypeError("callback is not a function");u=(u==null?pm():+u)+(r==null?0:+r),!this._next&&Vu!==this&&(Vu?Vu._next=this:yd=this,Vu=this),this._call=i,this._time=u,gf()},stop:function(){this._call&&(this._call=null,this._time=1/0,gf())}};function O0(i,r,u){var m=new xd;return m.restart(i,r,u),m}function uA(){pm(),++Jc;for(var i=yd,r;i;)(r=cc-i._time)>=0&&i._call.call(void 0,r),i=i._next;--Jc}function Xg(){cc=(vd=oh.now())+Nd,Jc=Uu=0;try{uA()}finally{Jc=0,dA(),cc=0}}function hA(){var i=oh.now(),r=i-vd;r>D0&&(Nd-=r,vd=i)}function dA(){for(var i,r=yd,u,m=1/0;r;)r._call?(m>r._time&&(m=r._time),i=r,r=r._next):(u=r._next,r._next=null,r=i?i._next=u:yd=u);Vu=i,gf(m)}function gf(i){if(!Jc){Uu&&(Uu=clearTimeout(Uu));var r=i-cc;r>24?(i<1/0&&(Uu=setTimeout(Xg,i-oh.now()-Nd)),Du&&(Du=clearInterval(Du))):(Du||(vd=oh.now(),Du=setInterval(hA,D0)),Jc=1,B0(Xg))}}function Yg(i,r,u){var m=new xd;return r=r==null?0:+r,m.restart(x=>{m.stop(),i(x+r)},r,u),m}var pA=_0("start","end","cancel","interrupt"),fA=[],F0=0,Jg=1,yf=2,rd=3,Qg=4,vf=5,od=6;function Ud(i,r,u,m,x,S){var I=i.__transition;if(!I)i.__transition={};else if(u in I)return;mA(i,u,{name:r,index:m,group:x,on:pA,tween:fA,time:S.time,delay:S.delay,duration:S.duration,ease:S.ease,timer:null,state:F0})}function fm(i,r){var u=Is(i,r);if(u.state>F0)throw new Error("too late; already scheduled");return u}function ra(i,r){var u=Is(i,r);if(u.state>rd)throw new Error("too late; already running");return u}function Is(i,r){var u=i.__transition;if(!u||!(u=u[r]))throw new Error("transition not found");return u}function mA(i,r,u){var m=i.__transition,x;m[r]=u,u.timer=O0(S,0,u.time);function S(D){u.state=Jg,u.timer.restart(I,u.delay,u.time),u.delay<=D&&I(D-u.delay)}function I(D){var q,W,K,bt;if(u.state!==Jg)return F();for(q in m)if(bt=m[q],bt.name===u.name){if(bt.state===rd)return Yg(I);bt.state===Qg?(bt.state=od,bt.timer.stop(),bt.on.call("interrupt",i,i.__data__,bt.index,bt.group),delete m[q]):+q<r&&(bt.state=od,bt.timer.stop(),bt.on.call("cancel",i,i.__data__,bt.index,bt.group),delete m[q])}if(Yg(function(){u.state===rd&&(u.state=Qg,u.timer.restart(c,u.delay,u.time),c(D))}),u.state=yf,u.on.call("start",i,i.__data__,u.index,u.group),u.state===yf){for(u.state=rd,x=new Array(K=u.tween.length),q=0,W=-1;q<K;++q)(bt=u.tween[q].value.call(i,i.__data__,u.index,u.group))&&(x[++W]=bt);x.length=W+1}}function c(D){for(var q=D<u.duration?u.ease.call(null,D/u.duration):(u.timer.restart(F),u.state=vf,1),W=-1,K=x.length;++W<K;)x[W].call(i,q);u.state===vf&&(u.on.call("end",i,i.__data__,u.index,u.group),F())}function F(){u.state=od,u.timer.stop(),delete m[r];for(var D in m)return;delete i.__transition}}function _A(i,r){var u=i.__transition,m,x,S=!0,I;if(u){r=r==null?null:r+"";for(I in u){if((m=u[I]).name!==r){S=!1;continue}x=m.state>yf&&m.state<vf,m.state=od,m.timer.stop(),m.on.call(x?"interrupt":"cancel",i,i.__data__,m.index,m.group),delete u[I]}S&&delete i.__transition}}function gA(i){return this.each(function(){_A(this,i)})}function yA(i,r){var u,m;return function(){var x=ra(this,i),S=x.tween;if(S!==u){m=u=S;for(var I=0,c=m.length;I<c;++I)if(m[I].name===r){m=m.slice(),m.splice(I,1);break}}x.tween=m}}function vA(i,r,u){var m,x;if(typeof u!="function")throw new Error;return function(){var S=ra(this,i),I=S.tween;if(I!==m){x=(m=I).slice();for(var c={name:r,value:u},F=0,D=x.length;F<D;++F)if(x[F].name===r){x[F]=c;break}F===D&&x.push(c)}S.tween=x}}function xA(i,r){var u=this._id;if(i+="",arguments.length<2){for(var m=Is(this.node(),u).tween,x=0,S=m.length,I;x<S;++x)if((I=m[x]).name===i)return I.value;return null}return this.each((r==null?yA:vA)(u,i,r))}function mm(i,r,u){var m=i._id;return i.each(function(){var x=ra(this,m);(x.value||(x.value={}))[r]=u.apply(this,arguments)}),function(x){return Is(x,m).value[r]}}function N0(i,r){var u;return(typeof r=="number"?Ts:r instanceof lc?rh:(u=lc(r))?(r=u,rh):k0)(i,r)}function bA(i){return function(){this.removeAttribute(i)}}function wA(i){return function(){this.removeAttributeNS(i.space,i.local)}}function TA(i,r,u){var m,x=u+"",S;return function(){var I=this.getAttribute(i);return I===x?null:I===m?S:S=r(m=I,u)}}function SA(i,r,u){var m,x=u+"",S;return function(){var I=this.getAttributeNS(i.space,i.local);return I===x?null:I===m?S:S=r(m=I,u)}}function PA(i,r,u){var m,x,S;return function(){var I,c=u(this),F;return c==null?void this.removeAttribute(i):(I=this.getAttribute(i),F=c+"",I===F?null:I===m&&F===x?S:(x=F,S=r(m=I,c)))}}function AA(i,r,u){var m,x,S;return function(){var I,c=u(this),F;return c==null?void this.removeAttributeNS(i.space,i.local):(I=this.getAttributeNS(i.space,i.local),F=c+"",I===F?null:I===m&&F===x?S:(x=F,S=r(m=I,c)))}}function IA(i,r){var u=Fd(i),m=u==="transform"?lA:N0;return this.attrTween(i,typeof r=="function"?(u.local?AA:PA)(u,m,mm(this,"attr."+i,r)):r==null?(u.local?wA:bA)(u):(u.local?SA:TA)(u,m,r))}function CA(i,r){return function(u){this.setAttribute(i,r.call(this,u))}}function EA(i,r){return function(u){this.setAttributeNS(i.space,i.local,r.call(this,u))}}function LA(i,r){var u,m;function x(){var S=r.apply(this,arguments);return S!==m&&(u=(m=S)&&EA(i,S)),u}return x._value=r,x}function MA(i,r){var u,m;function x(){var S=r.apply(this,arguments);return S!==m&&(u=(m=S)&&CA(i,S)),u}return x._value=r,x}function kA(i,r){var u="attr."+i;if(arguments.length<2)return(u=this.tween(u))&&u._value;if(r==null)return this.tween(u,null);if(typeof r!="function")throw new Error;var m=Fd(i);return this.tween(u,(m.local?LA:MA)(m,r))}function zA(i,r){return function(){fm(this,i).delay=+r.apply(this,arguments)}}function RA(i,r){return r=+r,function(){fm(this,i).delay=r}}function DA(i){var r=this._id;return arguments.length?this.each((typeof i=="function"?zA:RA)(r,i)):Is(this.node(),r).delay}function BA(i,r){return function(){ra(this,i).duration=+r.apply(this,arguments)}}function OA(i,r){return r=+r,function(){ra(this,i).duration=r}}function FA(i){var r=this._id;return arguments.length?this.each((typeof i=="function"?BA:OA)(r,i)):Is(this.node(),r).duration}function NA(i,r){if(typeof r!="function")throw new Error;return function(){ra(this,i).ease=r}}function UA(i){var r=this._id;return arguments.length?this.each(NA(r,i)):Is(this.node(),r).ease}function VA(i,r){return function(){var u=r.apply(this,arguments);if(typeof u!="function")throw new Error;ra(this,i).ease=u}}function $A(i){if(typeof i!="function")throw new Error;return this.each(VA(this._id,i))}function ZA(i){typeof i!="function"&&(i=v0(i));for(var r=this._groups,u=r.length,m=new Array(u),x=0;x<u;++x)for(var S=r[x],I=S.length,c=m[x]=[],F,D=0;D<I;++D)(F=S[D])&&i.call(F,F.__data__,D,S)&&c.push(F);return new Ba(m,this._parents,this._name,this._id)}function jA(i){if(i._id!==this._id)throw new Error;for(var r=this._groups,u=i._groups,m=r.length,x=u.length,S=Math.min(m,x),I=new Array(m),c=0;c<S;++c)for(var F=r[c],D=u[c],q=F.length,W=I[c]=new Array(q),K,bt=0;bt<q;++bt)(K=F[bt]||D[bt])&&(W[bt]=K);for(;c<m;++c)I[c]=r[c];return new Ba(I,this._parents,this._name,this._id)}function GA(i){return(i+"").trim().split(/^|\s+/).every(function(r){var u=r.indexOf(".");return u>=0&&(r=r.slice(0,u)),!r||r==="start"})}function qA(i,r,u){var m,x,S=GA(r)?fm:ra;return function(){var I=S(this,i),c=I.on;c!==m&&(x=(m=c).copy()).on(r,u),I.on=x}}function HA(i,r){var u=this._id;return arguments.length<2?Is(this.node(),u).on.on(i):this.each(qA(u,i,r))}function WA(i){return function(){var r=this.parentNode;for(var u in this.__transition)if(+u!==i)return;r&&r.removeChild(this)}}function KA(){return this.on("end.remove",WA(this._id))}function XA(i){var r=this._name,u=this._id;typeof i!="function"&&(i=lm(i));for(var m=this._groups,x=m.length,S=new Array(x),I=0;I<x;++I)for(var c=m[I],F=c.length,D=S[I]=new Array(F),q,W,K=0;K<F;++K)(q=c[K])&&(W=i.call(q,q.__data__,K,c))&&("__data__"in q&&(W.__data__=q.__data__),D[K]=W,Ud(D[K],r,u,K,D,Is(q,u)));return new Ba(S,this._parents,r,u)}function YA(i){var r=this._name,u=this._id;typeof i!="function"&&(i=y0(i));for(var m=this._groups,x=m.length,S=[],I=[],c=0;c<x;++c)for(var F=m[c],D=F.length,q,W=0;W<D;++W)if(q=F[W]){for(var K=i.call(q,q.__data__,W,F),bt,zt=Is(q,u),Pt=0,oe=K.length;Pt<oe;++Pt)(bt=K[Pt])&&Ud(bt,r,u,Pt,K,zt);S.push(K),I.push(q)}return new Ba(S,I,r,u)}var JA=uh.prototype.constructor;function QA(){return new JA(this._groups,this._parents)}function tI(i,r){var u,m,x;return function(){var S=Yc(this,i),I=(this.style.removeProperty(i),Yc(this,i));return S===I?null:S===u&&I===m?x:x=r(u=S,m=I)}}function U0(i){return function(){this.style.removeProperty(i)}}function eI(i,r,u){var m,x=u+"",S;return function(){var I=Yc(this,i);return I===x?null:I===m?S:S=r(m=I,u)}}function iI(i,r,u){var m,x,S;return function(){var I=Yc(this,i),c=u(this),F=c+"";return c==null&&(F=c=(this.style.removeProperty(i),Yc(this,i))),I===F?null:I===m&&F===x?S:(x=F,S=r(m=I,c))}}function nI(i,r){var u,m,x,S="style."+r,I="end."+S,c;return function(){var F=ra(this,i),D=F.on,q=F.value[S]==null?c||(c=U0(r)):void 0;(D!==u||x!==q)&&(m=(u=D).copy()).on(I,x=q),F.on=m}}function rI(i,r,u){var m=(i+="")=="transform"?aA:N0;return r==null?this.styleTween(i,tI(i,m)).on("end.style."+i,U0(i)):typeof r=="function"?this.styleTween(i,iI(i,m,mm(this,"style."+i,r))).each(nI(this._id,i)):this.styleTween(i,eI(i,m,r),u).on("end.style."+i,null)}function oI(i,r,u){return function(m){this.style.setProperty(i,r.call(this,m),u)}}function sI(i,r,u){var m,x;function S(){var I=r.apply(this,arguments);return I!==x&&(m=(x=I)&&oI(i,I,u)),m}return S._value=r,S}function aI(i,r,u){var m="style."+(i+="");if(arguments.length<2)return(m=this.tween(m))&&m._value;if(r==null)return this.tween(m,null);if(typeof r!="function")throw new Error;return this.tween(m,sI(i,r,u??""))}function lI(i){return function(){this.textContent=i}}function cI(i){return function(){var r=i(this);this.textContent=r??""}}function uI(i){return this.tween("text",typeof i=="function"?cI(mm(this,"text",i)):lI(i==null?"":i+""))}function hI(i){return function(r){this.textContent=i.call(this,r)}}function dI(i){var r,u;function m(){var x=i.apply(this,arguments);return x!==u&&(r=(u=x)&&hI(x)),r}return m._value=i,m}function pI(i){var r="text";if(arguments.length<1)return(r=this.tween(r))&&r._value;if(i==null)return this.tween(r,null);if(typeof i!="function")throw new Error;return this.tween(r,dI(i))}function fI(){for(var i=this._name,r=this._id,u=V0(),m=this._groups,x=m.length,S=0;S<x;++S)for(var I=m[S],c=I.length,F,D=0;D<c;++D)if(F=I[D]){var q=Is(F,r);Ud(F,i,u,D,I,{time:q.time+q.delay+q.duration,delay:0,duration:q.duration,ease:q.ease})}return new Ba(m,this._parents,i,u)}function mI(){var i,r,u=this,m=u._id,x=u.size();return new Promise(function(S,I){var c={value:I},F={value:function(){--x===0&&S()}};u.each(function(){var D=ra(this,m),q=D.on;q!==i&&(r=(i=q).copy(),r._.cancel.push(c),r._.interrupt.push(c),r._.end.push(F)),D.on=r}),x===0&&S()})}var _I=0;function Ba(i,r,u,m){this._groups=i,this._parents=r,this._name=u,this._id=m}function V0(){return++_I}var La=uh.prototype;Ba.prototype={constructor:Ba,select:XA,selectAll:YA,selectChild:La.selectChild,selectChildren:La.selectChildren,filter:ZA,merge:jA,selection:QA,transition:fI,call:La.call,nodes:La.nodes,node:La.node,size:La.size,empty:La.empty,each:La.each,on:HA,attr:IA,attrTween:kA,style:rI,styleTween:aI,text:uI,textTween:pI,remove:KA,tween:xA,delay:DA,duration:FA,ease:UA,easeVarying:$A,end:mI,[Symbol.iterator]:La[Symbol.iterator]};function gI(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var yI={time:null,delay:0,duration:250,ease:gI};function vI(i,r){for(var u;!(u=i.__transition)||!(u=u[r]);)if(!(i=i.parentNode))throw new Error(`transition ${r} not found`);return u}function xI(i){var r,u;i instanceof Ba?(r=i._id,i=i._name):(r=V0(),(u=yI).time=pm(),i=i==null?null:i+"");for(var m=this._groups,x=m.length,S=0;S<x;++S)for(var I=m[S],c=I.length,F,D=0;D<c;++D)(F=I[D])&&Ud(F,i,r,D,I,u||vI(F,r));return new Ba(m,this._parents,i,r)}uh.prototype.interrupt=gA;uh.prototype.transition=xI;var ty={},qp={},Hp=34,Bu=10,Wp=13;function $0(i){return new Function("d","return {"+i.map(function(r,u){return JSON.stringify(r)+": d["+u+'] || ""'}).join(",")+"}")}function bI(i,r){var u=$0(i);return function(m,x){return r(u(m),x,i)}}function ey(i){var r=Object.create(null),u=[];return i.forEach(function(m){for(var x in m)x in r||u.push(r[x]=x)}),u}function ro(i,r){var u=i+"",m=u.length;return m<r?new Array(r-m+1).join(0)+u:u}function wI(i){return i<0?"-"+ro(-i,6):i>9999?"+"+ro(i,6):ro(i,4)}function TI(i){var r=i.getUTCHours(),u=i.getUTCMinutes(),m=i.getUTCSeconds(),x=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":wI(i.getUTCFullYear())+"-"+ro(i.getUTCMonth()+1,2)+"-"+ro(i.getUTCDate(),2)+(x?"T"+ro(r,2)+":"+ro(u,2)+":"+ro(m,2)+"."+ro(x,3)+"Z":m?"T"+ro(r,2)+":"+ro(u,2)+":"+ro(m,2)+"Z":u||r?"T"+ro(r,2)+":"+ro(u,2)+"Z":"")}function SI(i){var r=new RegExp('["'+i+`
\r]`),u=i.charCodeAt(0);function m(W,K){var bt,zt,Pt=x(W,function(oe,Jt){if(bt)return bt(oe,Jt-1);zt=oe,bt=K?bI(oe,K):$0(oe)});return Pt.columns=zt||[],Pt}function x(W,K){var bt=[],zt=W.length,Pt=0,oe=0,Jt,Ut=zt<=0,Zt=!1;W.charCodeAt(zt-1)===Bu&&--zt,W.charCodeAt(zt-1)===Wp&&--zt;function Le(){if(Ut)return qp;if(Zt)return Zt=!1,ty;var te,Ce=Pt,pe;if(W.charCodeAt(Ce)===Hp){for(;Pt++<zt&&W.charCodeAt(Pt)!==Hp||W.charCodeAt(++Pt)===Hp;);return(te=Pt)>=zt?Ut=!0:(pe=W.charCodeAt(Pt++))===Bu?Zt=!0:pe===Wp&&(Zt=!0,W.charCodeAt(Pt)===Bu&&++Pt),W.slice(Ce+1,te-1).replace(/""/g,'"')}for(;Pt<zt;){if((pe=W.charCodeAt(te=Pt++))===Bu)Zt=!0;else if(pe===Wp)Zt=!0,W.charCodeAt(Pt)===Bu&&++Pt;else if(pe!==u)continue;return W.slice(Ce,te)}return Ut=!0,W.slice(Ce,zt)}for(;(Jt=Le())!==qp;){for(var de=[];Jt!==ty&&Jt!==qp;)de.push(Jt),Jt=Le();K&&(de=K(de,oe++))==null||bt.push(de)}return bt}function S(W,K){return W.map(function(bt){return K.map(function(zt){return q(bt[zt])}).join(i)})}function I(W,K){return K==null&&(K=ey(W)),[K.map(q).join(i)].concat(S(W,K)).join(`
`)}function c(W,K){return K==null&&(K=ey(W)),S(W,K).join(`
`)}function F(W){return W.map(D).join(`
`)}function D(W){return W.map(q).join(i)}function q(W){return W==null?"":W instanceof Date?TI(W):r.test(W+="")?'"'+W.replace(/"/g,'""')+'"':W}return{parse:m,parseRows:x,format:I,formatBody:c,formatRows:F,formatRow:D,formatValue:q}}var PI=SI(","),AI=PI.parse;function II(i){if(!i.ok)throw new Error(i.status+" "+i.statusText);return i.text()}function CI(i,r){return fetch(i,r).then(II)}function EI(i){return function(r,u,m){return arguments.length===2&&typeof u=="function"&&(m=u,u=void 0),CI(r,u).then(function(x){return i(x,m)})}}var iy=EI(AI);function LI(i){if(!i.ok)throw new Error(i.status+" "+i.statusText);if(!(i.status===204||i.status===205))return i.json()}function MI(i,r){return fetch(i,r).then(LI)}function kI(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function bd(i,r){if((u=(i=r?i.toExponential(r-1):i.toExponential()).indexOf("e"))<0)return null;var u,m=i.slice(0,u);return[m.length>1?m[0]+m.slice(2):m,+i.slice(u+1)]}function Qc(i){return i=bd(Math.abs(i)),i?i[1]:NaN}function zI(i,r){return function(u,m){for(var x=u.length,S=[],I=0,c=i[0],F=0;x>0&&c>0&&(F+c+1>m&&(c=Math.max(1,m-F)),S.push(u.substring(x-=c,x+c)),!((F+=c+1)>m));)c=i[I=(I+1)%i.length];return S.reverse().join(r)}}function RI(i){return function(r){return r.replace(/[0-9]/g,function(u){return i[+u]})}}var DI=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function wd(i){if(!(r=DI.exec(i)))throw new Error("invalid format: "+i);var r;return new _m({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}wd.prototype=_m.prototype;function _m(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}_m.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function BI(i){t:for(var r=i.length,u=1,m=-1,x;u<r;++u)switch(i[u]){case".":m=x=u;break;case"0":m===0&&(m=u),x=u;break;default:if(!+i[u])break t;m>0&&(m=0);break}return m>0?i.slice(0,m)+i.slice(x+1):i}var Z0;function OI(i,r){var u=bd(i,r);if(!u)return i+"";var m=u[0],x=u[1],S=x-(Z0=Math.max(-8,Math.min(8,Math.floor(x/3)))*3)+1,I=m.length;return S===I?m:S>I?m+new Array(S-I+1).join("0"):S>0?m.slice(0,S)+"."+m.slice(S):"0."+new Array(1-S).join("0")+bd(i,Math.max(0,r+S-1))[0]}function ny(i,r){var u=bd(i,r);if(!u)return i+"";var m=u[0],x=u[1];return x<0?"0."+new Array(-x).join("0")+m:m.length>x+1?m.slice(0,x+1)+"."+m.slice(x+1):m+new Array(x-m.length+2).join("0")}const ry={"%":(i,r)=>(i*100).toFixed(r),b:i=>Math.round(i).toString(2),c:i=>i+"",d:kI,e:(i,r)=>i.toExponential(r),f:(i,r)=>i.toFixed(r),g:(i,r)=>i.toPrecision(r),o:i=>Math.round(i).toString(8),p:(i,r)=>ny(i*100,r),r:ny,s:OI,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function oy(i){return i}var sy=Array.prototype.map,ay=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function FI(i){var r=i.grouping===void 0||i.thousands===void 0?oy:zI(sy.call(i.grouping,Number),i.thousands+""),u=i.currency===void 0?"":i.currency[0]+"",m=i.currency===void 0?"":i.currency[1]+"",x=i.decimal===void 0?".":i.decimal+"",S=i.numerals===void 0?oy:RI(sy.call(i.numerals,String)),I=i.percent===void 0?"%":i.percent+"",c=i.minus===void 0?"−":i.minus+"",F=i.nan===void 0?"NaN":i.nan+"";function D(W){W=wd(W);var K=W.fill,bt=W.align,zt=W.sign,Pt=W.symbol,oe=W.zero,Jt=W.width,Ut=W.comma,Zt=W.precision,Le=W.trim,de=W.type;de==="n"?(Ut=!0,de="g"):ry[de]||(Zt===void 0&&(Zt=12),Le=!0,de="g"),(oe||K==="0"&&bt==="=")&&(oe=!0,K="0",bt="=");var te=Pt==="$"?u:Pt==="#"&&/[boxX]/.test(de)?"0"+de.toLowerCase():"",Ce=Pt==="$"?m:/[%p]/.test(de)?I:"",pe=ry[de],Fe=/[defgprs%]/.test(de);Zt=Zt===void 0?6:/[gprs]/.test(de)?Math.max(1,Math.min(21,Zt)):Math.max(0,Math.min(20,Zt));function ce(Qt){var fe=te,ke=Ce,Ae,Ke,we;if(de==="c")ke=pe(Qt)+ke,Qt="";else{Qt=+Qt;var Me=Qt<0||1/Qt<0;if(Qt=isNaN(Qt)?F:pe(Math.abs(Qt),Zt),Le&&(Qt=BI(Qt)),Me&&+Qt==0&&zt!=="+"&&(Me=!1),fe=(Me?zt==="("?zt:c:zt==="-"||zt==="("?"":zt)+fe,ke=(de==="s"?ay[8+Z0/3]:"")+ke+(Me&&zt==="("?")":""),Fe){for(Ae=-1,Ke=Qt.length;++Ae<Ke;)if(we=Qt.charCodeAt(Ae),48>we||we>57){ke=(we===46?x+Qt.slice(Ae+1):Qt.slice(Ae))+ke,Qt=Qt.slice(0,Ae);break}}}Ut&&!oe&&(Qt=r(Qt,1/0));var Ht=fe.length+Qt.length+ke.length,fi=Ht<Jt?new Array(Jt-Ht+1).join(K):"";switch(Ut&&oe&&(Qt=r(fi+Qt,fi.length?Jt-ke.length:1/0),fi=""),bt){case"<":Qt=fe+Qt+ke+fi;break;case"=":Qt=fe+fi+Qt+ke;break;case"^":Qt=fi.slice(0,Ht=fi.length>>1)+fe+Qt+ke+fi.slice(Ht);break;default:Qt=fi+fe+Qt+ke;break}return S(Qt)}return ce.toString=function(){return W+""},ce}function q(W,K){var bt=D((W=wd(W),W.type="f",W)),zt=Math.max(-8,Math.min(8,Math.floor(Qc(K)/3)))*3,Pt=Math.pow(10,-zt),oe=ay[8+zt/3];return function(Jt){return bt(Pt*Jt)+oe}}return{format:D,formatPrefix:q}}var jh,j0,G0;NI({thousands:",",grouping:[3],currency:["$",""]});function NI(i){return jh=FI(i),j0=jh.format,G0=jh.formatPrefix,jh}function UI(i){return Math.max(0,-Qc(Math.abs(i)))}function VI(i,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qc(r)/3)))*3-Qc(Math.abs(i)))}function $I(i,r){return i=Math.abs(i),r=Math.abs(r)-i,Math.max(0,Qc(r)-Qc(i))+1}var ZI=Math.PI,jI=ZI*2,GI=Math.abs,gm=Math.sqrt;function Ps(){}function Td(i,r){i&&cy.hasOwnProperty(i.type)&&cy[i.type](i,r)}var ly={Feature:function(i,r){Td(i.geometry,r)},FeatureCollection:function(i,r){for(var u=i.features,m=-1,x=u.length;++m<x;)Td(u[m].geometry,r)}},cy={Sphere:function(i,r){r.sphere()},Point:function(i,r){i=i.coordinates,r.point(i[0],i[1],i[2])},MultiPoint:function(i,r){for(var u=i.coordinates,m=-1,x=u.length;++m<x;)i=u[m],r.point(i[0],i[1],i[2])},LineString:function(i,r){xf(i.coordinates,r,0)},MultiLineString:function(i,r){for(var u=i.coordinates,m=-1,x=u.length;++m<x;)xf(u[m],r,0)},Polygon:function(i,r){uy(i.coordinates,r)},MultiPolygon:function(i,r){for(var u=i.coordinates,m=-1,x=u.length;++m<x;)uy(u[m],r)},GeometryCollection:function(i,r){for(var u=i.geometries,m=-1,x=u.length;++m<x;)Td(u[m],r)}};function xf(i,r,u){var m=-1,x=i.length-u,S;for(r.lineStart();++m<x;)S=i[m],r.point(S[0],S[1],S[2]);r.lineEnd()}function uy(i,r){var u=-1,m=i.length;for(r.polygonStart();++u<m;)xf(i[u],r,1);r.polygonEnd()}function Ou(i,r){i&&ly.hasOwnProperty(i.type)?ly[i.type](i,r):Td(i,r)}const qI=i=>i;var Kp=new Xc,bf=new Xc,q0,H0,wf,Tf,za={point:Ps,lineStart:Ps,lineEnd:Ps,polygonStart:function(){za.lineStart=HI,za.lineEnd=KI},polygonEnd:function(){za.lineStart=za.lineEnd=za.point=Ps,Kp.add(GI(bf)),bf=new Xc},result:function(){var i=Kp/2;return Kp=new Xc,i}};function HI(){za.point=WI}function WI(i,r){za.point=W0,q0=wf=i,H0=Tf=r}function W0(i,r){bf.add(Tf*i-wf*r),wf=i,Tf=r}function KI(){W0(q0,H0)}var tu=1/0,Sd=tu,sh=-tu,Pd=sh,hy={point:XI,lineStart:Ps,lineEnd:Ps,polygonStart:Ps,polygonEnd:Ps,result:function(){var i=[[tu,Sd],[sh,Pd]];return sh=Pd=-(Sd=tu=1/0),i}};function XI(i,r){i<tu&&(tu=i),i>sh&&(sh=i),r<Sd&&(Sd=r),r>Pd&&(Pd=r)}var Sf=0,Pf=0,$u=0,Ad=0,Id=0,Oc=0,Af=0,If=0,Zu=0,K0,X0,Js,Qs,Xo={point:uc,lineStart:dy,lineEnd:py,polygonStart:function(){Xo.lineStart=QI,Xo.lineEnd=tC},polygonEnd:function(){Xo.point=uc,Xo.lineStart=dy,Xo.lineEnd=py},result:function(){var i=Zu?[Af/Zu,If/Zu]:Oc?[Ad/Oc,Id/Oc]:$u?[Sf/$u,Pf/$u]:[NaN,NaN];return Sf=Pf=$u=Ad=Id=Oc=Af=If=Zu=0,i}};function uc(i,r){Sf+=i,Pf+=r,++$u}function dy(){Xo.point=YI}function YI(i,r){Xo.point=JI,uc(Js=i,Qs=r)}function JI(i,r){var u=i-Js,m=r-Qs,x=gm(u*u+m*m);Ad+=x*(Js+i)/2,Id+=x*(Qs+r)/2,Oc+=x,uc(Js=i,Qs=r)}function py(){Xo.point=uc}function QI(){Xo.point=eC}function tC(){Y0(K0,X0)}function eC(i,r){Xo.point=Y0,uc(K0=Js=i,X0=Qs=r)}function Y0(i,r){var u=i-Js,m=r-Qs,x=gm(u*u+m*m);Ad+=x*(Js+i)/2,Id+=x*(Qs+r)/2,Oc+=x,x=Qs*i-Js*r,Af+=x*(Js+i),If+=x*(Qs+r),Zu+=x*3,uc(Js=i,Qs=r)}function J0(i){this._context=i}J0.prototype={_radius:4.5,pointRadius:function(i){return this._radius=i,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(i,r){switch(this._point){case 0:{this._context.moveTo(i,r),this._point=1;break}case 1:{this._context.lineTo(i,r);break}default:{this._context.moveTo(i+this._radius,r),this._context.arc(i,r,this._radius,0,jI);break}}},result:Ps};var Cf=new Xc,Xp,Q0,tx,ju,Gu,ah={point:Ps,lineStart:function(){ah.point=iC},lineEnd:function(){Xp&&ex(Q0,tx),ah.point=Ps},polygonStart:function(){Xp=!0},polygonEnd:function(){Xp=null},result:function(){var i=+Cf;return Cf=new Xc,i}};function iC(i,r){ah.point=ex,Q0=ju=i,tx=Gu=r}function ex(i,r){ju-=i,Gu-=r,Cf.add(gm(ju*ju+Gu*Gu)),ju=i,Gu=r}let fy,Cd,my,_y;class gy{constructor(r){this._append=r==null?ix:nC(r),this._radius=4.5,this._=""}pointRadius(r){return this._radius=+r,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(r,u){switch(this._point){case 0:{this._append`M${r},${u}`,this._point=1;break}case 1:{this._append`L${r},${u}`;break}default:{if(this._append`M${r},${u}`,this._radius!==my||this._append!==Cd){const m=this._radius,x=this._;this._="",this._append`m0,${m}a${m},${m} 0 1,1 0,${-2*m}a${m},${m} 0 1,1 0,${2*m}z`,my=m,Cd=this._append,_y=this._,this._=x}this._+=_y;break}}}result(){const r=this._;return this._="",r.length?r:null}}function ix(i){let r=1;this._+=i[0];for(const u=i.length;r<u;++r)this._+=arguments[r]+i[r]}function nC(i){const r=Math.floor(i);if(!(r>=0))throw new RangeError(`invalid digits: ${i}`);if(r>15)return ix;if(r!==fy){const u=10**r;fy=r,Cd=function(x){let S=1;this._+=x[0];for(const I=x.length;S<I;++S)this._+=Math.round(arguments[S]*u)/u+x[S]}}return Cd}function rC(i,r){let u=3,m=4.5,x,S;function I(c){return c&&(typeof m=="function"&&S.pointRadius(+m.apply(this,arguments)),Ou(c,x(S))),S.result()}return I.area=function(c){return Ou(c,x(za)),za.result()},I.measure=function(c){return Ou(c,x(ah)),ah.result()},I.bounds=function(c){return Ou(c,x(hy)),hy.result()},I.centroid=function(c){return Ou(c,x(Xo)),Xo.result()},I.projection=function(c){return arguments.length?(x=c==null?(i=null,qI):(i=c).stream,I):i},I.context=function(c){return arguments.length?(S=c==null?(r=null,new gy(u)):new J0(r=c),typeof m!="function"&&S.pointRadius(m),I):r},I.pointRadius=function(c){return arguments.length?(m=typeof c=="function"?c:(S.pointRadius(+c),+c),I):m},I.digits=function(c){if(!arguments.length)return u;if(c==null)u=null;else{const F=Math.floor(c);if(!(F>=0))throw new RangeError(`invalid digits: ${c}`);u=F}return r===null&&(S=new gy(u)),I},I.projection(i).digits(u).context(r)}function oC(i){return{stream:sC(i)}}function sC(i){return function(r){var u=new Ef;for(var m in i)u[m]=i[m];return u.stream=r,u}}function Ef(){}Ef.prototype={constructor:Ef,point:function(i,r){this.stream.point(i,r)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function aC(i,r){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(r).domain(i);break}return this}function lC(i){return function(){return i}}function cC(i){return+i}var yy=[0,1];function Fc(i){return i}function Lf(i,r){return(r-=i=+i)?function(u){return(u-i)/r}:lC(isNaN(r)?NaN:.5)}function uC(i,r){var u;return i>r&&(u=i,i=r,r=u),function(m){return Math.max(i,Math.min(r,m))}}function hC(i,r,u){var m=i[0],x=i[1],S=r[0],I=r[1];return x<m?(m=Lf(x,m),S=u(I,S)):(m=Lf(m,x),S=u(S,I)),function(c){return S(m(c))}}function dC(i,r,u){var m=Math.min(i.length,r.length)-1,x=new Array(m),S=new Array(m),I=-1;for(i[m]<i[0]&&(i=i.slice().reverse(),r=r.slice().reverse());++I<m;)x[I]=Lf(i[I],i[I+1]),S[I]=u(r[I],r[I+1]);return function(c){var F=HT(i,c,1,m)-1;return S[F](x[F](c))}}function pC(i,r){return r.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function fC(){var i=yy,r=yy,u=dm,m,x,S,I=Fc,c,F,D;function q(){var K=Math.min(i.length,r.length);return I!==Fc&&(I=uC(i[0],i[K-1])),c=K>2?dC:hC,F=D=null,W}function W(K){return K==null||isNaN(K=+K)?S:(F||(F=c(i.map(m),r,u)))(m(I(K)))}return W.invert=function(K){return I(x((D||(D=c(r,i.map(m),Ts)))(K)))},W.domain=function(K){return arguments.length?(i=Array.from(K,cC),q()):i.slice()},W.range=function(K){return arguments.length?(r=Array.from(K),q()):r.slice()},W.rangeRound=function(K){return r=Array.from(K),u=rA,q()},W.clamp=function(K){return arguments.length?(I=K?!0:Fc,q()):I!==Fc},W.interpolate=function(K){return arguments.length?(u=K,q()):u},W.unknown=function(K){return arguments.length?(S=K,W):S},function(K,bt){return m=K,x=bt,q()}}function mC(){return fC()(Fc,Fc)}function _C(i,r,u,m){var x=JT(i,r,u),S;switch(m=wd(m??",f"),m.type){case"s":{var I=Math.max(Math.abs(i),Math.abs(r));return m.precision==null&&!isNaN(S=VI(x,I))&&(m.precision=S),G0(m,I)}case"":case"e":case"g":case"p":case"r":{m.precision==null&&!isNaN(S=$I(x,Math.max(Math.abs(i),Math.abs(r))))&&(m.precision=S-(m.type==="e"));break}case"f":case"%":{m.precision==null&&!isNaN(S=UI(x))&&(m.precision=S-(m.type==="%")*2);break}}return j0(m)}function gC(i){var r=i.domain;return i.ticks=function(u){var m=r();return YT(m[0],m[m.length-1],u??10)},i.tickFormat=function(u,m){var x=r();return _C(x[0],x[x.length-1],u??10,m)},i.nice=function(u){u==null&&(u=10);var m=r(),x=0,S=m.length-1,I=m[x],c=m[S],F,D,q=10;for(c<I&&(D=I,I=c,c=D,D=x,x=S,S=D);q-- >0;){if(D=df(I,c,u),D===F)return m[x]=I,m[S]=c,r(m);if(D>0)I=Math.floor(I/D)*D,c=Math.ceil(c/D)*D;else if(D<0)I=Math.ceil(I*D)/D,c=Math.floor(c*D)/D;else break;F=D}return i},i}function Mf(){var i=mC();return i.copy=function(){return pC(i,Mf())},aC.apply(i,arguments),gC(i)}function qu(i,r,u){this.k=i,this.x=r,this.y=u}qu.prototype={constructor:qu,scale:function(i){return i===1?this:new qu(this.k*i,this.x,this.y)},translate:function(i,r){return i===0&r===0?this:new qu(this.k,this.x+this.k*i,this.y+this.k*r)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};qu.prototype;function yC(i){return i}function vC(i){if(i==null)return yC;var r,u,m=i.scale[0],x=i.scale[1],S=i.translate[0],I=i.translate[1];return function(c,F){F||(r=u=0);var D=2,q=c.length,W=new Array(q);for(W[0]=(r+=c[0])*m+S,W[1]=(u+=c[1])*x+I;D<q;)W[D]=c[D],++D;return W}}function xC(i,r){for(var u,m=i.length,x=m-r;x<--m;)u=i[x],i[x++]=i[m],i[m]=u}function vy(i,r){return r.type==="GeometryCollection"?{type:"FeatureCollection",features:r.geometries.map(function(u){return xy(i,u)})}:xy(i,r)}function xy(i,r){var u=r.id,m=r.bbox,x=r.properties==null?{}:r.properties,S=bC(i,r);return u==null&&m==null?{type:"Feature",properties:x,geometry:S}:m==null?{type:"Feature",id:u,properties:x,geometry:S}:{type:"Feature",id:u,bbox:m,properties:x,geometry:S}}function bC(i,r){var u=vC(i.transform),m=i.arcs;function x(q,W){W.length&&W.pop();for(var K=m[q<0?~q:q],bt=0,zt=K.length;bt<zt;++bt)W.push(u(K[bt],bt));q<0&&xC(W,zt)}function S(q){return u(q)}function I(q){for(var W=[],K=0,bt=q.length;K<bt;++K)x(q[K],W);return W.length<2&&W.push(W[0]),W}function c(q){for(var W=I(q);W.length<4;)W.push(W[0]);return W}function F(q){return q.map(c)}function D(q){var W=q.type,K;switch(W){case"GeometryCollection":return{type:W,geometries:q.geometries.map(D)};case"Point":K=S(q.coordinates);break;case"MultiPoint":K=q.coordinates.map(S);break;case"LineString":K=I(q.arcs);break;case"MultiLineString":K=q.arcs.map(I);break;case"Polygon":K=F(q.arcs);break;case"MultiPolygon":K=q.arcs.map(F);break;default:return null}return{type:W,coordinates:K}}return D(r)}var nx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ym(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var kf={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(i,r){(function(u,m){m(r)})(nx,function(u){var m="1.9.4";function x(s){var d,b,C,B;for(b=1,C=arguments.length;b<C;b++){B=arguments[b];for(d in B)s[d]=B[d]}return s}var S=Object.create||function(){function s(){}return function(d){return s.prototype=d,new s}}();function I(s,d){var b=Array.prototype.slice;if(s.bind)return s.bind.apply(s,b.call(arguments,1));var C=b.call(arguments,2);return function(){return s.apply(d,C.length?C.concat(b.call(arguments)):arguments)}}var c=0;function F(s){return"_leaflet_id"in s||(s._leaflet_id=++c),s._leaflet_id}function D(s,d,b){var C,B,j,at;return at=function(){C=!1,B&&(j.apply(b,B),B=!1)},j=function(){C?B=arguments:(s.apply(b,arguments),setTimeout(at,d),C=!0)},j}function q(s,d,b){var C=d[1],B=d[0],j=C-B;return s===C&&b?s:((s-B)%j+j)%j+B}function W(){return!1}function K(s,d){if(d===!1)return s;var b=Math.pow(10,d===void 0?6:d);return Math.round(s*b)/b}function bt(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")}function zt(s){return bt(s).split(/\s+/)}function Pt(s,d){Object.prototype.hasOwnProperty.call(s,"options")||(s.options=s.options?S(s.options):{});for(var b in d)s.options[b]=d[b];return s.options}function oe(s,d,b){var C=[];for(var B in s)C.push(encodeURIComponent(b?B.toUpperCase():B)+"="+encodeURIComponent(s[B]));return(!d||d.indexOf("?")===-1?"?":"&")+C.join("&")}var Jt=/\{ *([\w_ -]+) *\}/g;function Ut(s,d){return s.replace(Jt,function(b,C){var B=d[C];if(B===void 0)throw new Error("No value provided for variable "+b);return typeof B=="function"&&(B=B(d)),B})}var Zt=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"};function Le(s,d){for(var b=0;b<s.length;b++)if(s[b]===d)return b;return-1}var de="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function te(s){return window["webkit"+s]||window["moz"+s]||window["ms"+s]}var Ce=0;function pe(s){var d=+new Date,b=Math.max(0,16-(d-Ce));return Ce=d+b,window.setTimeout(s,b)}var Fe=window.requestAnimationFrame||te("RequestAnimationFrame")||pe,ce=window.cancelAnimationFrame||te("CancelAnimationFrame")||te("CancelRequestAnimationFrame")||function(s){window.clearTimeout(s)};function Qt(s,d,b){if(b&&Fe===pe)s.call(d);else return Fe.call(window,I(s,d))}function fe(s){s&&ce.call(window,s)}var ke={__proto__:null,extend:x,create:S,bind:I,get lastId(){return c},stamp:F,throttle:D,wrapNum:q,falseFn:W,formatNum:K,trim:bt,splitWords:zt,setOptions:Pt,getParamString:oe,template:Ut,isArray:Zt,indexOf:Le,emptyImageUrl:de,requestFn:Fe,cancelFn:ce,requestAnimFrame:Qt,cancelAnimFrame:fe};function Ae(){}Ae.extend=function(s){var d=function(){Pt(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},b=d.__super__=this.prototype,C=S(b);C.constructor=d,d.prototype=C;for(var B in this)Object.prototype.hasOwnProperty.call(this,B)&&B!=="prototype"&&B!=="__super__"&&(d[B]=this[B]);return s.statics&&x(d,s.statics),s.includes&&(Ke(s.includes),x.apply(null,[C].concat(s.includes))),x(C,s),delete C.statics,delete C.includes,C.options&&(C.options=b.options?S(b.options):{},x(C.options,s.options)),C._initHooks=[],C.callInitHooks=function(){if(!this._initHooksCalled){b.callInitHooks&&b.callInitHooks.call(this),this._initHooksCalled=!0;for(var j=0,at=C._initHooks.length;j<at;j++)C._initHooks[j].call(this)}},d},Ae.include=function(s){var d=this.prototype.options;return x(this.prototype,s),s.options&&(this.prototype.options=d,this.mergeOptions(s.options)),this},Ae.mergeOptions=function(s){return x(this.prototype.options,s),this},Ae.addInitHook=function(s){var d=Array.prototype.slice.call(arguments,1),b=typeof s=="function"?s:function(){this[s].apply(this,d)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(b),this};function Ke(s){if(!(typeof L>"u"||!L||!L.Mixin)){s=Zt(s)?s:[s];for(var d=0;d<s.length;d++)s[d]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var we={on:function(s,d,b){if(typeof s=="object")for(var C in s)this._on(C,s[C],d);else{s=zt(s);for(var B=0,j=s.length;B<j;B++)this._on(s[B],d,b)}return this},off:function(s,d,b){if(!arguments.length)delete this._events;else if(typeof s=="object")for(var C in s)this._off(C,s[C],d);else{s=zt(s);for(var B=arguments.length===1,j=0,at=s.length;j<at;j++)B?this._off(s[j]):this._off(s[j],d,b)}return this},_on:function(s,d,b,C){if(typeof d!="function"){console.warn("wrong listener type: "+typeof d);return}if(this._listens(s,d,b)===!1){b===this&&(b=void 0);var B={fn:d,ctx:b};C&&(B.once=!0),this._events=this._events||{},this._events[s]=this._events[s]||[],this._events[s].push(B)}},_off:function(s,d,b){var C,B,j;if(this._events&&(C=this._events[s],!!C)){if(arguments.length===1){if(this._firingCount)for(B=0,j=C.length;B<j;B++)C[B].fn=W;delete this._events[s];return}if(typeof d!="function"){console.warn("wrong listener type: "+typeof d);return}var at=this._listens(s,d,b);if(at!==!1){var Tt=C[at];this._firingCount&&(Tt.fn=W,this._events[s]=C=C.slice()),C.splice(at,1)}}},fire:function(s,d,b){if(!this.listens(s,b))return this;var C=x({},d,{type:s,target:this,sourceTarget:d&&d.sourceTarget||this});if(this._events){var B=this._events[s];if(B){this._firingCount=this._firingCount+1||1;for(var j=0,at=B.length;j<at;j++){var Tt=B[j],Et=Tt.fn;Tt.once&&this.off(s,Et,Tt.ctx),Et.call(Tt.ctx||this,C)}this._firingCount--}}return b&&this._propagateEvent(C),this},listens:function(s,d,b,C){typeof s!="string"&&console.warn('"string" type argument expected');var B=d;typeof d!="function"&&(C=!!d,B=void 0,b=void 0);var j=this._events&&this._events[s];if(j&&j.length&&this._listens(s,B,b)!==!1)return!0;if(C){for(var at in this._eventParents)if(this._eventParents[at].listens(s,d,b,C))return!0}return!1},_listens:function(s,d,b){if(!this._events)return!1;var C=this._events[s]||[];if(!d)return!!C.length;b===this&&(b=void 0);for(var B=0,j=C.length;B<j;B++)if(C[B].fn===d&&C[B].ctx===b)return B;return!1},once:function(s,d,b){if(typeof s=="object")for(var C in s)this._on(C,s[C],d,!0);else{s=zt(s);for(var B=0,j=s.length;B<j;B++)this._on(s[B],d,b,!0)}return this},addEventParent:function(s){return this._eventParents=this._eventParents||{},this._eventParents[F(s)]=s,this},removeEventParent:function(s){return this._eventParents&&delete this._eventParents[F(s)],this},_propagateEvent:function(s){for(var d in this._eventParents)this._eventParents[d].fire(s.type,x({layer:s.target,propagatedFrom:s.target},s),!0)}};we.addEventListener=we.on,we.removeEventListener=we.clearAllEventListeners=we.off,we.addOneTimeEventListener=we.once,we.fireEvent=we.fire,we.hasEventListeners=we.listens;var Me=Ae.extend(we);function Ht(s,d,b){this.x=b?Math.round(s):s,this.y=b?Math.round(d):d}var fi=Math.trunc||function(s){return s>0?Math.floor(s):Math.ceil(s)};Ht.prototype={clone:function(){return new Ht(this.x,this.y)},add:function(s){return this.clone()._add(ze(s))},_add:function(s){return this.x+=s.x,this.y+=s.y,this},subtract:function(s){return this.clone()._subtract(ze(s))},_subtract:function(s){return this.x-=s.x,this.y-=s.y,this},divideBy:function(s){return this.clone()._divideBy(s)},_divideBy:function(s){return this.x/=s,this.y/=s,this},multiplyBy:function(s){return this.clone()._multiplyBy(s)},_multiplyBy:function(s){return this.x*=s,this.y*=s,this},scaleBy:function(s){return new Ht(this.x*s.x,this.y*s.y)},unscaleBy:function(s){return new Ht(this.x/s.x,this.y/s.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=fi(this.x),this.y=fi(this.y),this},distanceTo:function(s){s=ze(s);var d=s.x-this.x,b=s.y-this.y;return Math.sqrt(d*d+b*b)},equals:function(s){return s=ze(s),s.x===this.x&&s.y===this.y},contains:function(s){return s=ze(s),Math.abs(s.x)<=Math.abs(this.x)&&Math.abs(s.y)<=Math.abs(this.y)},toString:function(){return"Point("+K(this.x)+", "+K(this.y)+")"}};function ze(s,d,b){return s instanceof Ht?s:Zt(s)?new Ht(s[0],s[1]):s==null?s:typeof s=="object"&&"x"in s&&"y"in s?new Ht(s.x,s.y):new Ht(s,d,b)}function Ue(s,d){if(s)for(var b=d?[s,d]:s,C=0,B=b.length;C<B;C++)this.extend(b[C])}Ue.prototype={extend:function(s){var d,b;if(!s)return this;if(s instanceof Ht||typeof s[0]=="number"||"x"in s)d=b=ze(s);else if(s=si(s),d=s.min,b=s.max,!d||!b)return this;return!this.min&&!this.max?(this.min=d.clone(),this.max=b.clone()):(this.min.x=Math.min(d.x,this.min.x),this.max.x=Math.max(b.x,this.max.x),this.min.y=Math.min(d.y,this.min.y),this.max.y=Math.max(b.y,this.max.y)),this},getCenter:function(s){return ze((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,s)},getBottomLeft:function(){return ze(this.min.x,this.max.y)},getTopRight:function(){return ze(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(s){var d,b;return typeof s[0]=="number"||s instanceof Ht?s=ze(s):s=si(s),s instanceof Ue?(d=s.min,b=s.max):d=b=s,d.x>=this.min.x&&b.x<=this.max.x&&d.y>=this.min.y&&b.y<=this.max.y},intersects:function(s){s=si(s);var d=this.min,b=this.max,C=s.min,B=s.max,j=B.x>=d.x&&C.x<=b.x,at=B.y>=d.y&&C.y<=b.y;return j&&at},overlaps:function(s){s=si(s);var d=this.min,b=this.max,C=s.min,B=s.max,j=B.x>d.x&&C.x<b.x,at=B.y>d.y&&C.y<b.y;return j&&at},isValid:function(){return!!(this.min&&this.max)},pad:function(s){var d=this.min,b=this.max,C=Math.abs(d.x-b.x)*s,B=Math.abs(d.y-b.y)*s;return si(ze(d.x-C,d.y-B),ze(b.x+C,b.y+B))},equals:function(s){return s?(s=si(s),this.min.equals(s.getTopLeft())&&this.max.equals(s.getBottomRight())):!1}};function si(s,d){return!s||s instanceof Ue?s:new Ue(s,d)}function je(s,d){if(s)for(var b=d?[s,d]:s,C=0,B=b.length;C<B;C++)this.extend(b[C])}je.prototype={extend:function(s){var d=this._southWest,b=this._northEast,C,B;if(s instanceof hi)C=s,B=s;else if(s instanceof je){if(C=s._southWest,B=s._northEast,!C||!B)return this}else return s?this.extend(Oe(s)||ui(s)):this;return!d&&!b?(this._southWest=new hi(C.lat,C.lng),this._northEast=new hi(B.lat,B.lng)):(d.lat=Math.min(C.lat,d.lat),d.lng=Math.min(C.lng,d.lng),b.lat=Math.max(B.lat,b.lat),b.lng=Math.max(B.lng,b.lng)),this},pad:function(s){var d=this._southWest,b=this._northEast,C=Math.abs(d.lat-b.lat)*s,B=Math.abs(d.lng-b.lng)*s;return new je(new hi(d.lat-C,d.lng-B),new hi(b.lat+C,b.lng+B))},getCenter:function(){return new hi((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new hi(this.getNorth(),this.getWest())},getSouthEast:function(){return new hi(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(s){typeof s[0]=="number"||s instanceof hi||"lat"in s?s=Oe(s):s=ui(s);var d=this._southWest,b=this._northEast,C,B;return s instanceof je?(C=s.getSouthWest(),B=s.getNorthEast()):C=B=s,C.lat>=d.lat&&B.lat<=b.lat&&C.lng>=d.lng&&B.lng<=b.lng},intersects:function(s){s=ui(s);var d=this._southWest,b=this._northEast,C=s.getSouthWest(),B=s.getNorthEast(),j=B.lat>=d.lat&&C.lat<=b.lat,at=B.lng>=d.lng&&C.lng<=b.lng;return j&&at},overlaps:function(s){s=ui(s);var d=this._southWest,b=this._northEast,C=s.getSouthWest(),B=s.getNorthEast(),j=B.lat>d.lat&&C.lat<b.lat,at=B.lng>d.lng&&C.lng<b.lng;return j&&at},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(s,d){return s?(s=ui(s),this._southWest.equals(s.getSouthWest(),d)&&this._northEast.equals(s.getNorthEast(),d)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ui(s,d){return s instanceof je?s:new je(s,d)}function hi(s,d,b){if(isNaN(s)||isNaN(d))throw new Error("Invalid LatLng object: ("+s+", "+d+")");this.lat=+s,this.lng=+d,b!==void 0&&(this.alt=+b)}hi.prototype={equals:function(s,d){if(!s)return!1;s=Oe(s);var b=Math.max(Math.abs(this.lat-s.lat),Math.abs(this.lng-s.lng));return b<=(d===void 0?1e-9:d)},toString:function(s){return"LatLng("+K(this.lat,s)+", "+K(this.lng,s)+")"},distanceTo:function(s){return be.distance(this,Oe(s))},wrap:function(){return be.wrapLatLng(this)},toBounds:function(s){var d=180*s/40075017,b=d/Math.cos(Math.PI/180*this.lat);return ui([this.lat-d,this.lng-b],[this.lat+d,this.lng+b])},clone:function(){return new hi(this.lat,this.lng,this.alt)}};function Oe(s,d,b){return s instanceof hi?s:Zt(s)&&typeof s[0]!="object"?s.length===3?new hi(s[0],s[1],s[2]):s.length===2?new hi(s[0],s[1]):null:s==null?s:typeof s=="object"&&"lat"in s?new hi(s.lat,"lng"in s?s.lng:s.lon,s.alt):d===void 0?null:new hi(s,d,b)}var pn={latLngToPoint:function(s,d){var b=this.projection.project(s),C=this.scale(d);return this.transformation._transform(b,C)},pointToLatLng:function(s,d){var b=this.scale(d),C=this.transformation.untransform(s,b);return this.projection.unproject(C)},project:function(s){return this.projection.project(s)},unproject:function(s){return this.projection.unproject(s)},scale:function(s){return 256*Math.pow(2,s)},zoom:function(s){return Math.log(s/256)/Math.LN2},getProjectedBounds:function(s){if(this.infinite)return null;var d=this.projection.bounds,b=this.scale(s),C=this.transformation.transform(d.min,b),B=this.transformation.transform(d.max,b);return new Ue(C,B)},infinite:!1,wrapLatLng:function(s){var d=this.wrapLng?q(s.lng,this.wrapLng,!0):s.lng,b=this.wrapLat?q(s.lat,this.wrapLat,!0):s.lat,C=s.alt;return new hi(b,d,C)},wrapLatLngBounds:function(s){var d=s.getCenter(),b=this.wrapLatLng(d),C=d.lat-b.lat,B=d.lng-b.lng;if(C===0&&B===0)return s;var j=s.getSouthWest(),at=s.getNorthEast(),Tt=new hi(j.lat-C,j.lng-B),Et=new hi(at.lat-C,at.lng-B);return new je(Tt,Et)}},be=x({},pn,{wrapLng:[-180,180],R:6371e3,distance:function(s,d){var b=Math.PI/180,C=s.lat*b,B=d.lat*b,j=Math.sin((d.lat-s.lat)*b/2),at=Math.sin((d.lng-s.lng)*b/2),Tt=j*j+Math.cos(C)*Math.cos(B)*at*at,Et=2*Math.atan2(Math.sqrt(Tt),Math.sqrt(1-Tt));return this.R*Et}}),Ge=6378137,ti={R:Ge,MAX_LATITUDE:85.0511287798,project:function(s){var d=Math.PI/180,b=this.MAX_LATITUDE,C=Math.max(Math.min(b,s.lat),-b),B=Math.sin(C*d);return new Ht(this.R*s.lng*d,this.R*Math.log((1+B)/(1-B))/2)},unproject:function(s){var d=180/Math.PI;return new hi((2*Math.atan(Math.exp(s.y/this.R))-Math.PI/2)*d,s.x*d/this.R)},bounds:function(){var s=Ge*Math.PI;return new Ue([-s,-s],[s,s])}()};function en(s,d,b,C){if(Zt(s)){this._a=s[0],this._b=s[1],this._c=s[2],this._d=s[3];return}this._a=s,this._b=d,this._c=b,this._d=C}en.prototype={transform:function(s,d){return this._transform(s.clone(),d)},_transform:function(s,d){return d=d||1,s.x=d*(this._a*s.x+this._b),s.y=d*(this._c*s.y+this._d),s},untransform:function(s,d){return d=d||1,new Ht((s.x/d-this._b)/this._a,(s.y/d-this._d)/this._c)}};function ei(s,d,b,C){return new en(s,d,b,C)}var ut=x({},be,{code:"EPSG:3857",projection:ti,transformation:function(){var s=.5/(Math.PI*ti.R);return ei(s,.5,-s,.5)}()}),mt=x({},ut,{code:"EPSG:900913"});function Mt(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Vt(s,d){var b="",C,B,j,at,Tt,Et;for(C=0,j=s.length;C<j;C++){for(Tt=s[C],B=0,at=Tt.length;B<at;B++)Et=Tt[B],b+=(B?"L":"M")+Et.x+" "+Et.y;b+=d?wt.svg?"z":"x":""}return b||"M0 0"}var Bt=document.documentElement.style,Nt="ActiveXObject"in window,re=Nt&&!document.addEventListener,dt="msLaunchUri"in navigator&&!("documentMode"in document),Yt=Lt("webkit"),Ft=Lt("android"),Kt=Lt("android 2")||Lt("android 3"),ie=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Te=Ft&&Lt("Google")&&ie<537&&!("AudioNode"in window),$e=!!window.opera,Xe=!dt&&Lt("chrome"),ki=Lt("gecko")&&!Yt&&!$e&&!Nt,Ti=!Xe&&Lt("safari"),ji=Lt("phantom"),gn="OTransition"in Bt,Wt=navigator.platform.indexOf("Win")===0,Xn=Nt&&"transition"in Bt,zi="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Kt,kr="MozPerspective"in Bt,cn=!window.L_DISABLE_3D&&(Xn||zi||kr)&&!gn&&!ji,jt=typeof orientation<"u"||Lt("mobile"),Ye=jt&&Yt,We=jt&&zi,Nn=!window.PointerEvent&&window.MSPointerEvent,zr=!!(window.PointerEvent||Nn),Je="ontouchstart"in window||!!window.TouchEvent,lo=!window.L_NO_TOUCH&&(Je||zr),et=jt&&$e,U=jt&&ki,$=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,X=function(){var s=!1;try{var d=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("testPassiveEventSupport",W,d),window.removeEventListener("testPassiveEventSupport",W,d)}catch{}return s}(),nt=function(){return!!document.createElement("canvas").getContext}(),rt=!!(document.createElementNS&&Mt("svg").createSVGRect),vt=!!rt&&function(){var s=document.createElement("div");return s.innerHTML="<svg/>",(s.firstChild&&s.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),pt=!rt&&function(){try{var s=document.createElement("div");s.innerHTML='<v:shape adj="1"/>';var d=s.firstChild;return d.style.behavior="url(#default#VML)",d&&typeof d.adj=="object"}catch{return!1}}(),lt=navigator.platform.indexOf("Mac")===0,_t=navigator.platform.indexOf("Linux")===0;function Lt(s){return navigator.userAgent.toLowerCase().indexOf(s)>=0}var wt={ie:Nt,ielt9:re,edge:dt,webkit:Yt,android:Ft,android23:Kt,androidStock:Te,opera:$e,chrome:Xe,gecko:ki,safari:Ti,phantom:ji,opera12:gn,win:Wt,ie3d:Xn,webkit3d:zi,gecko3d:kr,any3d:cn,mobile:jt,mobileWebkit:Ye,mobileWebkit3d:We,msPointer:Nn,pointer:zr,touch:lo,touchNative:Je,mobileOpera:et,mobileGecko:U,retina:$,passiveEvents:X,canvas:nt,svg:rt,vml:pt,inlineSvg:vt,mac:lt,linux:_t},Rt=wt.msPointer?"MSPointerDown":"pointerdown",Re=wt.msPointer?"MSPointerMove":"pointermove",Ve=wt.msPointer?"MSPointerUp":"pointerup",ve=wt.msPointer?"MSPointerCancel":"pointercancel",De={touchstart:Rt,touchmove:Re,touchend:Ve,touchcancel:ve},qe={touchstart:pc,touchmove:$n,touchend:$n,touchcancel:$n},Si={},Fi=!1;function Ci(s,d,b){return d==="touchstart"&&En(),qe[d]?(b=qe[d].bind(this,b),s.addEventListener(De[d],b,!1),b):(console.warn("wrong event specified:",d),W)}function Pi(s,d,b){if(!De[d]){console.warn("wrong event specified:",d);return}s.removeEventListener(De[d],b,!1)}function Un(s){Si[s.pointerId]=s}function Hi(s){Si[s.pointerId]&&(Si[s.pointerId]=s)}function fn(s){delete Si[s.pointerId]}function En(){Fi||(document.addEventListener(Rt,Un,!0),document.addEventListener(Re,Hi,!0),document.addEventListener(Ve,fn,!0),document.addEventListener(ve,fn,!0),Fi=!0)}function $n(s,d){if(d.pointerType!==(d.MSPOINTER_TYPE_MOUSE||"mouse")){d.touches=[];for(var b in Si)d.touches.push(Si[b]);d.changedTouches=[d],s(d)}}function pc(s,d){d.MSPOINTER_TYPE_TOUCH&&d.pointerType===d.MSPOINTER_TYPE_TOUCH&&dn(d),$n(s,d)}function Cs(s){var d={},b,C;for(C in s)b=s[C],d[C]=b&&b.bind?b.bind(s):b;return s=d,d.type="dblclick",d.detail=2,d.isTrusted=!1,d._simulated=!0,d}var Es=200;function nu(s,d){s.addEventListener("dblclick",d);var b=0,C;function B(j){if(j.detail!==1){C=j.detail;return}if(!(j.pointerType==="mouse"||j.sourceCapabilities&&!j.sourceCapabilities.firesTouchEvents)){var at=_i(j);if(!(at.some(function(Et){return Et instanceof HTMLLabelElement&&Et.attributes.for})&&!at.some(function(Et){return Et instanceof HTMLInputElement||Et instanceof HTMLSelectElement}))){var Tt=Date.now();Tt-b<=Es?(C++,C===2&&d(Cs(j))):C=1,b=Tt}}}return s.addEventListener("click",B),{dblclick:d,simDblclick:B}}function Ni(s,d){s.removeEventListener("dblclick",d.dblclick),s.removeEventListener("click",d.simDblclick)}var oa=aa(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Eo=aa(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ln=Eo==="webkitTransition"||Eo==="OTransition"?Eo+"End":"transitionend";function Yn(s){return typeof s=="string"?document.getElementById(s):s}function sa(s,d){var b=s.style[d]||s.currentStyle&&s.currentStyle[d];if((!b||b==="auto")&&document.defaultView){var C=document.defaultView.getComputedStyle(s,null);b=C?C[d]:null}return b==="auto"?null:b}function ii(s,d,b){var C=document.createElement(s);return C.className=d||"",b&&b.appendChild(C),C}function mi(s){var d=s.parentNode;d&&d.removeChild(s)}function ts(s){for(;s.firstChild;)s.removeChild(s.firstChild)}function Rr(s){var d=s.parentNode;d&&d.lastChild!==s&&d.appendChild(s)}function Vi(s){var d=s.parentNode;d&&d.firstChild!==s&&d.insertBefore(s,d.firstChild)}function Mi(s,d){if(s.classList!==void 0)return s.classList.contains(d);var b=Zn(s);return b.length>0&&new RegExp("(^|\\s)"+d+"(\\s|$)").test(b)}function Qe(s,d){if(s.classList!==void 0)for(var b=zt(d),C=0,B=b.length;C<B;C++)s.classList.add(b[C]);else if(!Mi(s,d)){var j=Zn(s);Ls(s,(j?j+" ":"")+d)}}function ni(s,d){s.classList!==void 0?s.classList.remove(d):Ls(s,bt((" "+Zn(s)+" ").replace(" "+d+" "," ")))}function Ls(s,d){s.className.baseVal===void 0?s.className=d:s.className.baseVal=d}function Zn(s){return s.correspondingElement&&(s=s.correspondingElement),s.className.baseVal===void 0?s.className:s.className.baseVal}function Jn(s,d){"opacity"in s.style?s.style.opacity=d:"filter"in s.style&&Lo(s,d)}function Lo(s,d){var b=!1,C="DXImageTransform.Microsoft.Alpha";try{b=s.filters.item(C)}catch{if(d===1)return}d=Math.round(d*100),b?(b.Enabled=d!==100,b.Opacity=d):s.style.filter+=" progid:"+C+"(opacity="+d+")"}function aa(s){for(var d=document.documentElement.style,b=0;b<s.length;b++)if(s[b]in d)return s[b];return!1}function co(s,d,b){var C=d||new Ht(0,0);s.style[oa]=(wt.ie3d?"translate("+C.x+"px,"+C.y+"px)":"translate3d("+C.x+"px,"+C.y+"px,0)")+(b?" scale("+b+")":"")}function un(s,d){s._leaflet_pos=d,wt.any3d?co(s,d):(s.style.left=d.x+"px",s.style.top=d.y+"px")}function Hr(s){return s._leaflet_pos||new Ht(0,0)}var vr,es,is;if("onselectstart"in document)vr=function(){ri(window,"selectstart",dn)},es=function(){Gi(window,"selectstart",dn)};else{var Ms=aa(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);vr=function(){if(Ms){var s=document.documentElement.style;is=s[Ms],s[Ms]="none"}},es=function(){Ms&&(document.documentElement.style[Ms]=is,is=void 0)}}function Pl(){ri(window,"dragstart",dn)}function la(){Gi(window,"dragstart",dn)}var ks,Fa;function Al(s){for(;s.tabIndex===-1;)s=s.parentNode;s.style&&(ca(),ks=s,Fa=s.style.outlineStyle,s.style.outlineStyle="none",ri(window,"keydown",ca))}function ca(){ks&&(ks.style.outlineStyle=Fa,ks=void 0,Fa=void 0,Gi(window,"keydown",ca))}function Il(s){do s=s.parentNode;while((!s.offsetWidth||!s.offsetHeight)&&s!==document.body);return s}function zs(s){var d=s.getBoundingClientRect();return{x:d.width/s.offsetWidth||1,y:d.height/s.offsetHeight||1,boundingClientRect:d}}var fc={__proto__:null,TRANSFORM:oa,TRANSITION:Eo,TRANSITION_END:Ln,get:Yn,getStyle:sa,create:ii,remove:mi,empty:ts,toFront:Rr,toBack:Vi,hasClass:Mi,addClass:Qe,removeClass:ni,setClass:Ls,getClass:Zn,setOpacity:Jn,testProp:aa,setTransform:co,setPosition:un,getPosition:Hr,get disableTextSelection(){return vr},get enableTextSelection(){return es},disableImageDrag:Pl,enableImageDrag:la,preventOutline:Al,restoreOutline:ca,getSizedParentNode:Il,getScale:zs};function ri(s,d,b,C){if(d&&typeof d=="object")for(var B in d)Qn(s,B,d[B],b);else{d=zt(d);for(var j=0,at=d.length;j<at;j++)Qn(s,d[j],b,C)}return this}var xr="_leaflet_events";function Gi(s,d,b,C){if(arguments.length===1)Mo(s),delete s[xr];else if(d&&typeof d=="object")for(var B in d)Ds(s,B,d[B],b);else if(d=zt(d),arguments.length===2)Mo(s,function(Tt){return Le(d,Tt)!==-1});else for(var j=0,at=d.length;j<at;j++)Ds(s,d[j],b,C);return this}function Mo(s,d){for(var b in s[xr]){var C=b.split(/\d/)[0];(!d||d(C))&&Ds(s,C,null,null,b)}}var Rs={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Qn(s,d,b,C){var B=d+F(b)+(C?"_"+F(C):"");if(s[xr]&&s[xr][B])return this;var j=function(Tt){return b.call(C||s,Tt||window.event)},at=j;!wt.touchNative&&wt.pointer&&d.indexOf("touch")===0?j=Ci(s,d,j):wt.touch&&d==="dblclick"?j=nu(s,j):"addEventListener"in s?d==="touchstart"||d==="touchmove"||d==="wheel"||d==="mousewheel"?s.addEventListener(Rs[d]||d,j,wt.passiveEvents?{passive:!1}:!1):d==="mouseenter"||d==="mouseleave"?(j=function(Tt){Tt=Tt||window.event,ha(s,Tt)&&at(Tt)},s.addEventListener(Rs[d],j,!1)):s.addEventListener(d,at,!1):s.attachEvent("on"+d,j),s[xr]=s[xr]||{},s[xr][B]=j}function Ds(s,d,b,C,B){B=B||d+F(b)+(C?"_"+F(C):"");var j=s[xr]&&s[xr][B];if(!j)return this;!wt.touchNative&&wt.pointer&&d.indexOf("touch")===0?Pi(s,d,j):wt.touch&&d==="dblclick"?Ni(s,j):"removeEventListener"in s?s.removeEventListener(Rs[d]||d,j,!1):s.detachEvent("on"+d,j),s[xr][B]=null}function Wr(s){return s.stopPropagation?s.stopPropagation():s.originalEvent?s.originalEvent._stopped=!0:s.cancelBubble=!0,this}function ns(s){return Qn(s,"wheel",Wr),this}function ko(s){return ri(s,"mousedown touchstart dblclick contextmenu",Wr),s._leaflet_disable_click=!0,this}function dn(s){return s.preventDefault?s.preventDefault():s.returnValue=!1,this}function tr(s){return dn(s),Wr(s),this}function _i(s){if(s.composedPath)return s.composedPath();for(var d=[],b=s.target;b;)d.push(b),b=b.parentNode;return d}function ua(s,d){if(!d)return new Ht(s.clientX,s.clientY);var b=zs(d),C=b.boundingClientRect;return new Ht((s.clientX-C.left)/b.x-d.clientLeft,(s.clientY-C.top)/b.y-d.clientTop)}var lr=wt.linux&&wt.chrome?window.devicePixelRatio:wt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function er(s){return wt.edge?s.wheelDeltaY/2:s.deltaY&&s.deltaMode===0?-s.deltaY/lr:s.deltaY&&s.deltaMode===1?-s.deltaY*20:s.deltaY&&s.deltaMode===2?-s.deltaY*60:s.deltaX||s.deltaZ?0:s.wheelDelta?(s.wheelDeltaY||s.wheelDelta)/2:s.detail&&Math.abs(s.detail)<32765?-s.detail*20:s.detail?s.detail/-32765*60:0}function ha(s,d){var b=d.relatedTarget;if(!b)return!0;try{for(;b&&b!==s;)b=b.parentNode}catch{return!1}return b!==s}var Na={__proto__:null,on:ri,off:Gi,stopPropagation:Wr,disableScrollPropagation:ns,disableClickPropagation:ko,preventDefault:dn,stop:tr,getPropagationPath:_i,getMousePosition:ua,getWheelDelta:er,isExternalTarget:ha,addListener:ri,removeListener:Gi},da=Me.extend({run:function(s,d,b,C){this.stop(),this._el=s,this._inProgress=!0,this._duration=b||.25,this._easeOutPower=1/Math.max(C||.5,.2),this._startPos=Hr(s),this._offset=d.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Qt(this._animate,this),this._step()},_step:function(s){var d=+new Date-this._startTime,b=this._duration*1e3;d<b?this._runFrame(this._easeOut(d/b),s):(this._runFrame(1),this._complete())},_runFrame:function(s,d){var b=this._startPos.add(this._offset.multiplyBy(s));d&&b._round(),un(this._el,b),this.fire("step")},_complete:function(){fe(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(s){return 1-Math.pow(1-s,this._easeOutPower)}}),Ei=Me.extend({options:{crs:ut,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(s,d){d=Pt(this,d),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(s),this._initLayout(),this._onResize=I(this._onResize,this),this._initEvents(),d.maxBounds&&this.setMaxBounds(d.maxBounds),d.zoom!==void 0&&(this._zoom=this._limitZoom(d.zoom)),d.center&&d.zoom!==void 0&&this.setView(Oe(d.center),d.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Eo&&wt.any3d&&!wt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ri(this._proxy,Ln,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(s,d,b){if(d=d===void 0?this._zoom:this._limitZoom(d),s=this._limitCenter(Oe(s),d,this.options.maxBounds),b=b||{},this._stop(),this._loaded&&!b.reset&&b!==!0){b.animate!==void 0&&(b.zoom=x({animate:b.animate},b.zoom),b.pan=x({animate:b.animate,duration:b.duration},b.pan));var C=this._zoom!==d?this._tryAnimatedZoom&&this._tryAnimatedZoom(s,d,b.zoom):this._tryAnimatedPan(s,b.pan);if(C)return clearTimeout(this._sizeTimer),this}return this._resetView(s,d,b.pan&&b.pan.noMoveStart),this},setZoom:function(s,d){return this._loaded?this.setView(this.getCenter(),s,{zoom:d}):(this._zoom=s,this)},zoomIn:function(s,d){return s=s||(wt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+s,d)},zoomOut:function(s,d){return s=s||(wt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-s,d)},setZoomAround:function(s,d,b){var C=this.getZoomScale(d),B=this.getSize().divideBy(2),j=s instanceof Ht?s:this.latLngToContainerPoint(s),at=j.subtract(B).multiplyBy(1-1/C),Tt=this.containerPointToLatLng(B.add(at));return this.setView(Tt,d,{zoom:b})},_getBoundsCenterZoom:function(s,d){d=d||{},s=s.getBounds?s.getBounds():ui(s);var b=ze(d.paddingTopLeft||d.padding||[0,0]),C=ze(d.paddingBottomRight||d.padding||[0,0]),B=this.getBoundsZoom(s,!1,b.add(C));if(B=typeof d.maxZoom=="number"?Math.min(d.maxZoom,B):B,B===1/0)return{center:s.getCenter(),zoom:B};var j=C.subtract(b).divideBy(2),at=this.project(s.getSouthWest(),B),Tt=this.project(s.getNorthEast(),B),Et=this.unproject(at.add(Tt).divideBy(2).add(j),B);return{center:Et,zoom:B}},fitBounds:function(s,d){if(s=ui(s),!s.isValid())throw new Error("Bounds are not valid.");var b=this._getBoundsCenterZoom(s,d);return this.setView(b.center,b.zoom,d)},fitWorld:function(s){return this.fitBounds([[-90,-180],[90,180]],s)},panTo:function(s,d){return this.setView(s,this._zoom,{pan:d})},panBy:function(s,d){if(s=ze(s).round(),d=d||{},!s.x&&!s.y)return this.fire("moveend");if(d.animate!==!0&&!this.getSize().contains(s))return this._resetView(this.unproject(this.project(this.getCenter()).add(s)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new da,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),d.noMoveStart||this.fire("movestart"),d.animate!==!1){Qe(this._mapPane,"leaflet-pan-anim");var b=this._getMapPanePos().subtract(s).round();this._panAnim.run(this._mapPane,b,d.duration||.25,d.easeLinearity)}else this._rawPanBy(s),this.fire("move").fire("moveend");return this},flyTo:function(s,d,b){if(b=b||{},b.animate===!1||!wt.any3d)return this.setView(s,d,b);this._stop();var C=this.project(this.getCenter()),B=this.project(s),j=this.getSize(),at=this._zoom;s=Oe(s),d=d===void 0?at:d;var Tt=Math.max(j.x,j.y),Et=Tt*this.getZoomScale(at,d),$t=B.distanceTo(C)||1,ye=1.42,He=ye*ye;function yi(Xi){var Yi=Xi?-1:1,on=Xi?Et:Tt,Zs=Et*Et-Tt*Tt+Yi*He*He*$t*$t,ba=2*on*He*$t,_s=Zs/ba,Fo=Math.sqrt(_s*_s+1)-_s,Ul=Fo<1e-9?-18:Math.log(Fo);return Ul}function $i(Xi){return(Math.exp(Xi)-Math.exp(-Xi))/2}function mn(Xi){return(Math.exp(Xi)+Math.exp(-Xi))/2}function me(Xi){return $i(Xi)/mn(Xi)}var xe=yi(0);function to(Xi){return Tt*(mn(xe)/mn(xe+ye*Xi))}function Ol(Xi){return Tt*(mn(xe)*me(xe+ye*Xi)-$i(xe))/He}function Fl(Xi){return 1-Math.pow(1-Xi,1.5)}var _n=Date.now(),sl=(yi(1)-xe)/ye,wr=b.duration?1e3*b.duration:1e3*sl*.8;function Nl(){var Xi=(Date.now()-_n)/wr,Yi=Fl(Xi)*sl;Xi<=1?(this._flyToFrame=Qt(Nl,this),this._move(this.unproject(C.add(B.subtract(C).multiplyBy(Ol(Yi)/$t)),at),this.getScaleZoom(Tt/to(Yi),at),{flyTo:!0})):this._move(s,d)._moveEnd(!0)}return this._moveStart(!0,b.noMoveStart),Nl.call(this),this},flyToBounds:function(s,d){var b=this._getBoundsCenterZoom(s,d);return this.flyTo(b.center,b.zoom,d)},setMaxBounds:function(s){return s=ui(s),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),s.isValid()?(this.options.maxBounds=s,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(s){var d=this.options.minZoom;return this.options.minZoom=s,this._loaded&&d!==s&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(s):this},setMaxZoom:function(s){var d=this.options.maxZoom;return this.options.maxZoom=s,this._loaded&&d!==s&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(s):this},panInsideBounds:function(s,d){this._enforcingBounds=!0;var b=this.getCenter(),C=this._limitCenter(b,this._zoom,ui(s));return b.equals(C)||this.panTo(C,d),this._enforcingBounds=!1,this},panInside:function(s,d){d=d||{};var b=ze(d.paddingTopLeft||d.padding||[0,0]),C=ze(d.paddingBottomRight||d.padding||[0,0]),B=this.project(this.getCenter()),j=this.project(s),at=this.getPixelBounds(),Tt=si([at.min.add(b),at.max.subtract(C)]),Et=Tt.getSize();if(!Tt.contains(j)){this._enforcingBounds=!0;var $t=j.subtract(Tt.getCenter()),ye=Tt.extend(j).getSize().subtract(Et);B.x+=$t.x<0?-ye.x:ye.x,B.y+=$t.y<0?-ye.y:ye.y,this.panTo(this.unproject(B),d),this._enforcingBounds=!1}return this},invalidateSize:function(s){if(!this._loaded)return this;s=x({animate:!1,pan:!0},s===!0?{animate:!0}:s);var d=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var b=this.getSize(),C=d.divideBy(2).round(),B=b.divideBy(2).round(),j=C.subtract(B);return!j.x&&!j.y?this:(s.animate&&s.pan?this.panBy(j):(s.pan&&this._rawPanBy(j),this.fire("move"),s.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(I(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:d,newSize:b}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(s){if(s=this._locateOptions=x({timeout:1e4,watch:!1},s),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var d=I(this._handleGeolocationResponse,this),b=I(this._handleGeolocationError,this);return s.watch?this._locationWatchId=navigator.geolocation.watchPosition(d,b,s):navigator.geolocation.getCurrentPosition(d,b,s),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(s){if(this._container._leaflet_id){var d=s.code,b=s.message||(d===1?"permission denied":d===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:d,message:"Geolocation error: "+b+"."})}},_handleGeolocationResponse:function(s){if(this._container._leaflet_id){var d=s.coords.latitude,b=s.coords.longitude,C=new hi(d,b),B=C.toBounds(s.coords.accuracy*2),j=this._locateOptions;if(j.setView){var at=this.getBoundsZoom(B);this.setView(C,j.maxZoom?Math.min(at,j.maxZoom):at)}var Tt={latlng:C,bounds:B,timestamp:s.timestamp};for(var Et in s.coords)typeof s.coords[Et]=="number"&&(Tt[Et]=s.coords[Et]);this.fire("locationfound",Tt)}},addHandler:function(s,d){if(!d)return this;var b=this[s]=new d(this);return this._handlers.push(b),this.options[s]&&b.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),mi(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(fe(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var s;for(s in this._layers)this._layers[s].remove();for(s in this._panes)mi(this._panes[s]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(s,d){var b="leaflet-pane"+(s?" leaflet-"+s.replace("Pane","")+"-pane":""),C=ii("div",b,d||this._mapPane);return s&&(this._panes[s]=C),C},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var s=this.getPixelBounds(),d=this.unproject(s.getBottomLeft()),b=this.unproject(s.getTopRight());return new je(d,b)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(s,d,b){s=ui(s),b=ze(b||[0,0]);var C=this.getZoom()||0,B=this.getMinZoom(),j=this.getMaxZoom(),at=s.getNorthWest(),Tt=s.getSouthEast(),Et=this.getSize().subtract(b),$t=si(this.project(Tt,C),this.project(at,C)).getSize(),ye=wt.any3d?this.options.zoomSnap:1,He=Et.x/$t.x,yi=Et.y/$t.y,$i=d?Math.max(He,yi):Math.min(He,yi);return C=this.getScaleZoom($i,C),ye&&(C=Math.round(C/(ye/100))*(ye/100),C=d?Math.ceil(C/ye)*ye:Math.floor(C/ye)*ye),Math.max(B,Math.min(j,C))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Ht(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(s,d){var b=this._getTopLeftPoint(s,d);return new Ue(b,b.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(s){return this.options.crs.getProjectedBounds(s===void 0?this.getZoom():s)},getPane:function(s){return typeof s=="string"?this._panes[s]:s},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(s,d){var b=this.options.crs;return d=d===void 0?this._zoom:d,b.scale(s)/b.scale(d)},getScaleZoom:function(s,d){var b=this.options.crs;d=d===void 0?this._zoom:d;var C=b.zoom(s*b.scale(d));return isNaN(C)?1/0:C},project:function(s,d){return d=d===void 0?this._zoom:d,this.options.crs.latLngToPoint(Oe(s),d)},unproject:function(s,d){return d=d===void 0?this._zoom:d,this.options.crs.pointToLatLng(ze(s),d)},layerPointToLatLng:function(s){var d=ze(s).add(this.getPixelOrigin());return this.unproject(d)},latLngToLayerPoint:function(s){var d=this.project(Oe(s))._round();return d._subtract(this.getPixelOrigin())},wrapLatLng:function(s){return this.options.crs.wrapLatLng(Oe(s))},wrapLatLngBounds:function(s){return this.options.crs.wrapLatLngBounds(ui(s))},distance:function(s,d){return this.options.crs.distance(Oe(s),Oe(d))},containerPointToLayerPoint:function(s){return ze(s).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(s){return ze(s).add(this._getMapPanePos())},containerPointToLatLng:function(s){var d=this.containerPointToLayerPoint(ze(s));return this.layerPointToLatLng(d)},latLngToContainerPoint:function(s){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Oe(s)))},mouseEventToContainerPoint:function(s){return ua(s,this._container)},mouseEventToLayerPoint:function(s){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(s))},mouseEventToLatLng:function(s){return this.layerPointToLatLng(this.mouseEventToLayerPoint(s))},_initContainer:function(s){var d=this._container=Yn(s);if(d){if(d._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ri(d,"scroll",this._onScroll,this),this._containerId=F(d)},_initLayout:function(){var s=this._container;this._fadeAnimated=this.options.fadeAnimation&&wt.any3d,Qe(s,"leaflet-container"+(wt.touch?" leaflet-touch":"")+(wt.retina?" leaflet-retina":"")+(wt.ielt9?" leaflet-oldie":"")+(wt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var d=sa(s,"position");d!=="absolute"&&d!=="relative"&&d!=="fixed"&&d!=="sticky"&&(s.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var s=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),un(this._mapPane,new Ht(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Qe(s.markerPane,"leaflet-zoom-hide"),Qe(s.shadowPane,"leaflet-zoom-hide"))},_resetView:function(s,d,b){un(this._mapPane,new Ht(0,0));var C=!this._loaded;this._loaded=!0,d=this._limitZoom(d),this.fire("viewprereset");var B=this._zoom!==d;this._moveStart(B,b)._move(s,d)._moveEnd(B),this.fire("viewreset"),C&&this.fire("load")},_moveStart:function(s,d){return s&&this.fire("zoomstart"),d||this.fire("movestart"),this},_move:function(s,d,b,C){d===void 0&&(d=this._zoom);var B=this._zoom!==d;return this._zoom=d,this._lastCenter=s,this._pixelOrigin=this._getNewPixelOrigin(s),C?b&&b.pinch&&this.fire("zoom",b):((B||b&&b.pinch)&&this.fire("zoom",b),this.fire("move",b)),this},_moveEnd:function(s){return s&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return fe(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(s){un(this._mapPane,this._getMapPanePos().subtract(s))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(s){this._targets={},this._targets[F(this._container)]=this;var d=s?Gi:ri;d(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&d(window,"resize",this._onResize,this),wt.any3d&&this.options.transform3DLimit&&(s?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){fe(this._resizeRequest),this._resizeRequest=Qt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var s=this._getMapPanePos();Math.max(Math.abs(s.x),Math.abs(s.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(s,d){for(var b=[],C,B=d==="mouseout"||d==="mouseover",j=s.target||s.srcElement,at=!1;j;){if(C=this._targets[F(j)],C&&(d==="click"||d==="preclick")&&this._draggableMoved(C)){at=!0;break}if(C&&C.listens(d,!0)&&(B&&!ha(j,s)||(b.push(C),B))||j===this._container)break;j=j.parentNode}return!b.length&&!at&&!B&&this.listens(d,!0)&&(b=[this]),b},_isClickDisabled:function(s){for(;s&&s!==this._container;){if(s._leaflet_disable_click)return!0;s=s.parentNode}},_handleDOMEvent:function(s){var d=s.target||s.srcElement;if(!(!this._loaded||d._leaflet_disable_events||s.type==="click"&&this._isClickDisabled(d))){var b=s.type;b==="mousedown"&&Al(d),this._fireDOMEvent(s,b)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(s,d,b){if(s.type==="click"){var C=x({},s);C.type="preclick",this._fireDOMEvent(C,C.type,b)}var B=this._findEventTargets(s,d);if(b){for(var j=[],at=0;at<b.length;at++)b[at].listens(d,!0)&&j.push(b[at]);B=j.concat(B)}if(B.length){d==="contextmenu"&&dn(s);var Tt=B[0],Et={originalEvent:s};if(s.type!=="keypress"&&s.type!=="keydown"&&s.type!=="keyup"){var $t=Tt.getLatLng&&(!Tt._radius||Tt._radius<=10);Et.containerPoint=$t?this.latLngToContainerPoint(Tt.getLatLng()):this.mouseEventToContainerPoint(s),Et.layerPoint=this.containerPointToLayerPoint(Et.containerPoint),Et.latlng=$t?Tt.getLatLng():this.layerPointToLatLng(Et.layerPoint)}for(at=0;at<B.length;at++)if(B[at].fire(d,Et,!0),Et.originalEvent._stopped||B[at].options.bubblingMouseEvents===!1&&Le(this._mouseEvents,d)!==-1)return}},_draggableMoved:function(s){return s=s.dragging&&s.dragging.enabled()?s:this,s.dragging&&s.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var s=0,d=this._handlers.length;s<d;s++)this._handlers[s].disable()},whenReady:function(s,d){return this._loaded?s.call(d||this,{target:this}):this.on("load",s,d),this},_getMapPanePos:function(){return Hr(this._mapPane)||new Ht(0,0)},_moved:function(){var s=this._getMapPanePos();return s&&!s.equals([0,0])},_getTopLeftPoint:function(s,d){var b=s&&d!==void 0?this._getNewPixelOrigin(s,d):this.getPixelOrigin();return b.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(s,d){var b=this.getSize()._divideBy(2);return this.project(s,d)._subtract(b)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(s,d,b){var C=this._getNewPixelOrigin(b,d);return this.project(s,d)._subtract(C)},_latLngBoundsToNewLayerBounds:function(s,d,b){var C=this._getNewPixelOrigin(b,d);return si([this.project(s.getSouthWest(),d)._subtract(C),this.project(s.getNorthWest(),d)._subtract(C),this.project(s.getSouthEast(),d)._subtract(C),this.project(s.getNorthEast(),d)._subtract(C)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(s){return this.latLngToLayerPoint(s).subtract(this._getCenterLayerPoint())},_limitCenter:function(s,d,b){if(!b)return s;var C=this.project(s,d),B=this.getSize().divideBy(2),j=new Ue(C.subtract(B),C.add(B)),at=this._getBoundsOffset(j,b,d);return Math.abs(at.x)<=1&&Math.abs(at.y)<=1?s:this.unproject(C.add(at),d)},_limitOffset:function(s,d){if(!d)return s;var b=this.getPixelBounds(),C=new Ue(b.min.add(s),b.max.add(s));return s.add(this._getBoundsOffset(C,d))},_getBoundsOffset:function(s,d,b){var C=si(this.project(d.getNorthEast(),b),this.project(d.getSouthWest(),b)),B=C.min.subtract(s.min),j=C.max.subtract(s.max),at=this._rebound(B.x,-j.x),Tt=this._rebound(B.y,-j.y);return new Ht(at,Tt)},_rebound:function(s,d){return s+d>0?Math.round(s-d)/2:Math.max(0,Math.ceil(s))-Math.max(0,Math.floor(d))},_limitZoom:function(s){var d=this.getMinZoom(),b=this.getMaxZoom(),C=wt.any3d?this.options.zoomSnap:1;return C&&(s=Math.round(s/C)*C),Math.max(d,Math.min(b,s))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){ni(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(s,d){var b=this._getCenterOffset(s)._trunc();return(d&&d.animate)!==!0&&!this.getSize().contains(b)?!1:(this.panBy(b,d),!0)},_createAnimProxy:function(){var s=this._proxy=ii("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(s),this.on("zoomanim",function(d){var b=oa,C=this._proxy.style[b];co(this._proxy,this.project(d.center,d.zoom),this.getZoomScale(d.zoom,1)),C===this._proxy.style[b]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){mi(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var s=this.getCenter(),d=this.getZoom();co(this._proxy,this.project(s,d),this.getZoomScale(d,1))},_catchTransitionEnd:function(s){this._animatingZoom&&s.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(s,d,b){if(this._animatingZoom)return!0;if(b=b||{},!this._zoomAnimated||b.animate===!1||this._nothingToAnimate()||Math.abs(d-this._zoom)>this.options.zoomAnimationThreshold)return!1;var C=this.getZoomScale(d),B=this._getCenterOffset(s)._divideBy(1-1/C);return b.animate!==!0&&!this.getSize().contains(B)?!1:(Qt(function(){this._moveStart(!0,b.noMoveStart||!1)._animateZoom(s,d,!0)},this),!0)},_animateZoom:function(s,d,b,C){this._mapPane&&(b&&(this._animatingZoom=!0,this._animateToCenter=s,this._animateToZoom=d,Qe(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:s,zoom:d,noUpdate:C}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(I(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&ni(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Cl(s,d){return new Ei(s,d)}var ir=Ae.extend({options:{position:"topright"},initialize:function(s){Pt(this,s)},getPosition:function(){return this.options.position},setPosition:function(s){var d=this._map;return d&&d.removeControl(this),this.options.position=s,d&&d.addControl(this),this},getContainer:function(){return this._container},addTo:function(s){this.remove(),this._map=s;var d=this._container=this.onAdd(s),b=this.getPosition(),C=s._controlCorners[b];return Qe(d,"leaflet-control"),b.indexOf("bottom")!==-1?C.insertBefore(d,C.firstChild):C.appendChild(d),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(mi(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(s){this._map&&s&&s.screenX>0&&s.screenY>0&&this._map.getContainer().focus()}}),rs=function(s){return new ir(s)};Ei.include({addControl:function(s){return s.addTo(this),this},removeControl:function(s){return s.remove(),this},_initControlPos:function(){var s=this._controlCorners={},d="leaflet-",b=this._controlContainer=ii("div",d+"control-container",this._container);function C(B,j){var at=d+B+" "+d+j;s[B+j]=ii("div",at,b)}C("top","left"),C("top","right"),C("bottom","left"),C("bottom","right")},_clearControlPos:function(){for(var s in this._controlCorners)mi(this._controlCorners[s]);mi(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ua=ir.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(s,d,b,C){return b<C?-1:C<b?1:0}},initialize:function(s,d,b){Pt(this,b),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var C in s)this._addLayer(s[C],C);for(C in d)this._addLayer(d[C],C,!0)},onAdd:function(s){this._initLayout(),this._update(),this._map=s,s.on("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(s){return ir.prototype.addTo.call(this,s),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var s=0;s<this._layers.length;s++)this._layers[s].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(s,d){return this._addLayer(s,d),this._map?this._update():this},addOverlay:function(s,d){return this._addLayer(s,d,!0),this._map?this._update():this},removeLayer:function(s){s.off("add remove",this._onLayerChange,this);var d=this._getLayer(F(s));return d&&this._layers.splice(this._layers.indexOf(d),1),this._map?this._update():this},expand:function(){Qe(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var s=this._map.getSize().y-(this._container.offsetTop+50);return s<this._section.clientHeight?(Qe(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=s+"px"):ni(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return ni(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var s="leaflet-control-layers",d=this._container=ii("div",s),b=this.options.collapsed;d.setAttribute("aria-haspopup",!0),ko(d),ns(d);var C=this._section=ii("section",s+"-list");b&&(this._map.on("click",this.collapse,this),ri(d,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var B=this._layersLink=ii("a",s+"-toggle",d);B.href="#",B.title="Layers",B.setAttribute("role","button"),ri(B,{keydown:function(j){j.keyCode===13&&this._expandSafely()},click:function(j){dn(j),this._expandSafely()}},this),b||this.expand(),this._baseLayersList=ii("div",s+"-base",C),this._separator=ii("div",s+"-separator",C),this._overlaysList=ii("div",s+"-overlays",C),d.appendChild(C)},_getLayer:function(s){for(var d=0;d<this._layers.length;d++)if(this._layers[d]&&F(this._layers[d].layer)===s)return this._layers[d]},_addLayer:function(s,d,b){this._map&&s.on("add remove",this._onLayerChange,this),this._layers.push({layer:s,name:d,overlay:b}),this.options.sortLayers&&this._layers.sort(I(function(C,B){return this.options.sortFunction(C.layer,B.layer,C.name,B.name)},this)),this.options.autoZIndex&&s.setZIndex&&(this._lastZIndex++,s.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ts(this._baseLayersList),ts(this._overlaysList),this._layerControlInputs=[];var s,d,b,C,B=0;for(b=0;b<this._layers.length;b++)C=this._layers[b],this._addItem(C),d=d||C.overlay,s=s||!C.overlay,B+=C.overlay?0:1;return this.options.hideSingleBase&&(s=s&&B>1,this._baseLayersList.style.display=s?"":"none"),this._separator.style.display=d&&s?"":"none",this},_onLayerChange:function(s){this._handlingClick||this._update();var d=this._getLayer(F(s.target)),b=d.overlay?s.type==="add"?"overlayadd":"overlayremove":s.type==="add"?"baselayerchange":null;b&&this._map.fire(b,d)},_createRadioElement:function(s,d){var b='<input type="radio" class="leaflet-control-layers-selector" name="'+s+'"'+(d?' checked="checked"':"")+"/>",C=document.createElement("div");return C.innerHTML=b,C.firstChild},_addItem:function(s){var d=document.createElement("label"),b=this._map.hasLayer(s.layer),C;s.overlay?(C=document.createElement("input"),C.type="checkbox",C.className="leaflet-control-layers-selector",C.defaultChecked=b):C=this._createRadioElement("leaflet-base-layers_"+F(this),b),this._layerControlInputs.push(C),C.layerId=F(s.layer),ri(C,"click",this._onInputClick,this);var B=document.createElement("span");B.innerHTML=" "+s.name;var j=document.createElement("span");d.appendChild(j),j.appendChild(C),j.appendChild(B);var at=s.overlay?this._overlaysList:this._baseLayersList;return at.appendChild(d),this._checkDisabledLayers(),d},_onInputClick:function(){if(!this._preventClick){var s=this._layerControlInputs,d,b,C=[],B=[];this._handlingClick=!0;for(var j=s.length-1;j>=0;j--)d=s[j],b=this._getLayer(d.layerId).layer,d.checked?C.push(b):d.checked||B.push(b);for(j=0;j<B.length;j++)this._map.hasLayer(B[j])&&this._map.removeLayer(B[j]);for(j=0;j<C.length;j++)this._map.hasLayer(C[j])||this._map.addLayer(C[j]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var s=this._layerControlInputs,d,b,C=this._map.getZoom(),B=s.length-1;B>=0;B--)d=s[B],b=this._getLayer(d.layerId).layer,d.disabled=b.options.minZoom!==void 0&&C<b.options.minZoom||b.options.maxZoom!==void 0&&C>b.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var s=this._section;this._preventClick=!0,ri(s,"click",dn),this.expand();var d=this;setTimeout(function(){Gi(s,"click",dn),d._preventClick=!1})}}),Va=function(s,d,b){return new Ua(s,d,b)},$a=ir.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(s){var d="leaflet-control-zoom",b=ii("div",d+" leaflet-bar"),C=this.options;return this._zoomInButton=this._createButton(C.zoomInText,C.zoomInTitle,d+"-in",b,this._zoomIn),this._zoomOutButton=this._createButton(C.zoomOutText,C.zoomOutTitle,d+"-out",b,this._zoomOut),this._updateDisabled(),s.on("zoomend zoomlevelschange",this._updateDisabled,this),b},onRemove:function(s){s.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(s){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(s.shiftKey?3:1))},_zoomOut:function(s){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(s.shiftKey?3:1))},_createButton:function(s,d,b,C,B){var j=ii("a",b,C);return j.innerHTML=s,j.href="#",j.title=d,j.setAttribute("role","button"),j.setAttribute("aria-label",d),ko(j),ri(j,"click",tr),ri(j,"click",B,this),ri(j,"click",this._refocusOnMap,this),j},_updateDisabled:function(){var s=this._map,d="leaflet-disabled";ni(this._zoomInButton,d),ni(this._zoomOutButton,d),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||s._zoom===s.getMinZoom())&&(Qe(this._zoomOutButton,d),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||s._zoom===s.getMaxZoom())&&(Qe(this._zoomInButton,d),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ei.mergeOptions({zoomControl:!0}),Ei.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new $a,this.addControl(this.zoomControl))});var mc=function(s){return new $a(s)},os=ir.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(s){var d="leaflet-control-scale",b=ii("div",d),C=this.options;return this._addScales(C,d+"-line",b),s.on(C.updateWhenIdle?"moveend":"move",this._update,this),s.whenReady(this._update,this),b},onRemove:function(s){s.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(s,d,b){s.metric&&(this._mScale=ii("div",d,b)),s.imperial&&(this._iScale=ii("div",d,b))},_update:function(){var s=this._map,d=s.getSize().y/2,b=s.distance(s.containerPointToLatLng([0,d]),s.containerPointToLatLng([this.options.maxWidth,d]));this._updateScales(b)},_updateScales:function(s){this.options.metric&&s&&this._updateMetric(s),this.options.imperial&&s&&this._updateImperial(s)},_updateMetric:function(s){var d=this._getRoundNum(s),b=d<1e3?d+" m":d/1e3+" km";this._updateScale(this._mScale,b,d/s)},_updateImperial:function(s){var d=s*3.2808399,b,C,B;d>5280?(b=d/5280,C=this._getRoundNum(b),this._updateScale(this._iScale,C+" mi",C/b)):(B=this._getRoundNum(d),this._updateScale(this._iScale,B+" ft",B/d))},_updateScale:function(s,d,b){s.style.width=Math.round(this.options.maxWidth*b)+"px",s.innerHTML=d},_getRoundNum:function(s){var d=Math.pow(10,(Math.floor(s)+"").length-1),b=s/d;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:1,d*b}}),ru=function(s){return new os(s)},ou='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',El=ir.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(wt.inlineSvg?ou+" ":"")+"Leaflet</a>"},initialize:function(s){Pt(this,s),this._attributions={}},onAdd:function(s){s.attributionControl=this,this._container=ii("div","leaflet-control-attribution"),ko(this._container);for(var d in s._layers)s._layers[d].getAttribution&&this.addAttribution(s._layers[d].getAttribution());return this._update(),s.on("layeradd",this._addAttribution,this),this._container},onRemove:function(s){s.off("layeradd",this._addAttribution,this)},_addAttribution:function(s){s.layer.getAttribution&&(this.addAttribution(s.layer.getAttribution()),s.layer.once("remove",function(){this.removeAttribution(s.layer.getAttribution())},this))},setPrefix:function(s){return this.options.prefix=s,this._update(),this},addAttribution:function(s){return s?(this._attributions[s]||(this._attributions[s]=0),this._attributions[s]++,this._update(),this):this},removeAttribution:function(s){return s?(this._attributions[s]&&(this._attributions[s]--,this._update()),this):this},_update:function(){if(this._map){var s=[];for(var d in this._attributions)this._attributions[d]&&s.push(d);var b=[];this.options.prefix&&b.push(this.options.prefix),s.length&&b.push(s.join(", ")),this._container.innerHTML=b.join(' <span aria-hidden="true">|</span> ')}}});Ei.mergeOptions({attributionControl:!0}),Ei.addInitHook(function(){this.options.attributionControl&&new El().addTo(this)});var su=function(s){return new El(s)};ir.Layers=Ua,ir.Zoom=$a,ir.Scale=os,ir.Attribution=El,rs.layers=Va,rs.zoom=mc,rs.scale=ru,rs.attribution=su;var Kr=Ae.extend({initialize:function(s){this._map=s},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Kr.addTo=function(s,d){return s.addHandler(d,this),this};var au={Events:we},Za=wt.touch?"touchstart mousedown":"mousedown",Dr=Me.extend({options:{clickTolerance:3},initialize:function(s,d,b,C){Pt(this,C),this._element=s,this._dragStartTarget=d||s,this._preventOutline=b},enable:function(){this._enabled||(ri(this._dragStartTarget,Za,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Dr._dragging===this&&this.finishDrag(!0),Gi(this._dragStartTarget,Za,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(s){if(this._enabled&&(this._moved=!1,!Mi(this._element,"leaflet-zoom-anim"))){if(s.touches&&s.touches.length!==1){Dr._dragging===this&&this.finishDrag();return}if(!(Dr._dragging||s.shiftKey||s.which!==1&&s.button!==1&&!s.touches)&&(Dr._dragging=this,this._preventOutline&&Al(this._element),Pl(),vr(),!this._moving)){this.fire("down");var d=s.touches?s.touches[0]:s,b=Il(this._element);this._startPoint=new Ht(d.clientX,d.clientY),this._startPos=Hr(this._element),this._parentScale=zs(b);var C=s.type==="mousedown";ri(document,C?"mousemove":"touchmove",this._onMove,this),ri(document,C?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(s){if(this._enabled){if(s.touches&&s.touches.length>1){this._moved=!0;return}var d=s.touches&&s.touches.length===1?s.touches[0]:s,b=new Ht(d.clientX,d.clientY)._subtract(this._startPoint);!b.x&&!b.y||Math.abs(b.x)+Math.abs(b.y)<this.options.clickTolerance||(b.x/=this._parentScale.x,b.y/=this._parentScale.y,dn(s),this._moved||(this.fire("dragstart"),this._moved=!0,Qe(document.body,"leaflet-dragging"),this._lastTarget=s.target||s.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Qe(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(b),this._moving=!0,this._lastEvent=s,this._updatePosition())}},_updatePosition:function(){var s={originalEvent:this._lastEvent};this.fire("predrag",s),un(this._element,this._newPos),this.fire("drag",s)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(s){ni(document.body,"leaflet-dragging"),this._lastTarget&&(ni(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Gi(document,"mousemove touchmove",this._onMove,this),Gi(document,"mouseup touchend touchcancel",this._onUp,this),la(),es();var d=this._moved&&this._moving;this._moving=!1,Dr._dragging=!1,d&&this.fire("dragend",{noInertia:s,distance:this._newPos.distanceTo(this._startPos)})}});function ja(s,d,b){var C,B=[1,4,2,8],j,at,Tt,Et,$t,ye,He,yi;for(j=0,ye=s.length;j<ye;j++)s[j]._code=Ui(s[j],d);for(Tt=0;Tt<4;Tt++){for(He=B[Tt],C=[],j=0,ye=s.length,at=ye-1;j<ye;at=j++)Et=s[j],$t=s[at],Et._code&He?$t._code&He||(yi=Li($t,Et,He,d,b),yi._code=Ui(yi,d),C.push(yi)):($t._code&He&&(yi=Li($t,Et,He,d,b),yi._code=Ui(yi,d),C.push(yi)),C.push(Et));s=C}return s}function Ga(s,d){var b,C,B,j,at,Tt,Et,$t,ye;if(!s||s.length===0)throw new Error("latlngs not passed");An(s)||(console.warn("latlngs are not flat! Only the first ring will be used"),s=s[0]);var He=Oe([0,0]),yi=ui(s),$i=yi.getNorthWest().distanceTo(yi.getSouthWest())*yi.getNorthEast().distanceTo(yi.getNorthWest());$i<1700&&(He=zo(s));var mn=s.length,me=[];for(b=0;b<mn;b++){var xe=Oe(s[b]);me.push(d.project(Oe([xe.lat-He.lat,xe.lng-He.lng])))}for(Tt=Et=$t=0,b=0,C=mn-1;b<mn;C=b++)B=me[b],j=me[C],at=B.y*j.x-j.y*B.x,Et+=(B.x+j.x)*at,$t+=(B.y+j.y)*at,Tt+=at*3;Tt===0?ye=me[0]:ye=[Et/Tt,$t/Tt];var to=d.unproject(ze(ye));return Oe([to.lat+He.lat,to.lng+He.lng])}function zo(s){for(var d=0,b=0,C=0,B=0;B<s.length;B++){var j=Oe(s[B]);d+=j.lat,b+=j.lng,C++}return Oe([d/C,b/C])}var _c={__proto__:null,clipPolygon:ja,polygonCenter:Ga,centroid:zo};function Ll(s,d){if(!d||!s.length)return s.slice();var b=d*d;return s=Bs(s,b),s=gc(s,b),s}function qa(s,d,b){return Math.sqrt(ai(s,d,b,!0))}function ss(s,d,b){return ai(s,d,b)}function gc(s,d){var b=s.length,C=typeof Uint8Array<"u"?Uint8Array:Array,B=new C(b);B[0]=B[b-1]=1,Xr(s,B,d,0,b-1);var j,at=[];for(j=0;j<b;j++)B[j]&&at.push(s[j]);return at}function Xr(s,d,b,C,B){var j=0,at,Tt,Et;for(Tt=C+1;Tt<=B-1;Tt++)Et=ai(s[Tt],s[C],s[B],!0),Et>j&&(at=Tt,j=Et);j>b&&(d[at]=1,Xr(s,d,b,C,at),Xr(s,d,b,at,B))}function Bs(s,d){for(var b=[s[0]],C=1,B=0,j=s.length;C<j;C++)lu(s[C],s[B])>d&&(b.push(s[C]),B=C);return B<j-1&&b.push(s[j-1]),b}var Ml;function Ha(s,d,b,C,B){var j=C?Ml:Ui(s,b),at=Ui(d,b),Tt,Et,$t;for(Ml=at;;){if(!(j|at))return[s,d];if(j&at)return!1;Tt=j||at,Et=Li(s,d,Tt,b,B),$t=Ui(Et,b),Tt===j?(s=Et,j=$t):(d=Et,at=$t)}}function Li(s,d,b,C,B){var j=d.x-s.x,at=d.y-s.y,Tt=C.min,Et=C.max,$t,ye;return b&8?($t=s.x+j*(Et.y-s.y)/at,ye=Et.y):b&4?($t=s.x+j*(Tt.y-s.y)/at,ye=Tt.y):b&2?($t=Et.x,ye=s.y+at*(Et.x-s.x)/j):b&1&&($t=Tt.x,ye=s.y+at*(Tt.x-s.x)/j),new Ht($t,ye,B)}function Ui(s,d){var b=0;return s.x<d.min.x?b|=1:s.x>d.max.x&&(b|=2),s.y<d.min.y?b|=4:s.y>d.max.y&&(b|=8),b}function lu(s,d){var b=d.x-s.x,C=d.y-s.y;return b*b+C*C}function ai(s,d,b,C){var B=d.x,j=d.y,at=b.x-B,Tt=b.y-j,Et=at*at+Tt*Tt,$t;return Et>0&&($t=((s.x-B)*at+(s.y-j)*Tt)/Et,$t>1?(B=b.x,j=b.y):$t>0&&(B+=at*$t,j+=Tt*$t)),at=s.x-B,Tt=s.y-j,C?at*at+Tt*Tt:new Ht(B,j)}function An(s){return!Zt(s[0])||typeof s[0][0]!="object"&&typeof s[0][0]<"u"}function nn(s){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),An(s)}function Ki(s,d){var b,C,B,j,at,Tt,Et,$t;if(!s||s.length===0)throw new Error("latlngs not passed");An(s)||(console.warn("latlngs are not flat! Only the first ring will be used"),s=s[0]);var ye=Oe([0,0]),He=ui(s),yi=He.getNorthWest().distanceTo(He.getSouthWest())*He.getNorthEast().distanceTo(He.getNorthWest());yi<1700&&(ye=zo(s));var $i=s.length,mn=[];for(b=0;b<$i;b++){var me=Oe(s[b]);mn.push(d.project(Oe([me.lat-ye.lat,me.lng-ye.lng])))}for(b=0,C=0;b<$i-1;b++)C+=mn[b].distanceTo(mn[b+1])/2;if(C===0)$t=mn[0];else for(b=0,j=0;b<$i-1;b++)if(at=mn[b],Tt=mn[b+1],B=at.distanceTo(Tt),j+=B,j>C){Et=(j-C)/B,$t=[Tt.x-Et*(Tt.x-at.x),Tt.y-Et*(Tt.y-at.y)];break}var xe=d.unproject(ze($t));return Oe([xe.lat+ye.lat,xe.lng+ye.lng])}var pa={__proto__:null,simplify:Ll,pointToSegmentDistance:qa,closestPointOnSegment:ss,clipSegment:Ha,_getEdgeIntersection:Li,_getBitCode:Ui,_sqClosestPointOnSegment:ai,isFlat:An,_flat:nn,polylineCenter:Ki},Wa={project:function(s){return new Ht(s.lng,s.lat)},unproject:function(s){return new hi(s.y,s.x)},bounds:new Ue([-180,-90],[180,90])},fa={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Ue([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(s){var d=Math.PI/180,b=this.R,C=s.lat*d,B=this.R_MINOR/b,j=Math.sqrt(1-B*B),at=j*Math.sin(C),Tt=Math.tan(Math.PI/4-C/2)/Math.pow((1-at)/(1+at),j/2);return C=-b*Math.log(Math.max(Tt,1e-10)),new Ht(s.lng*d*b,C)},unproject:function(s){for(var d=180/Math.PI,b=this.R,C=this.R_MINOR/b,B=Math.sqrt(1-C*C),j=Math.exp(-s.y/b),at=Math.PI/2-2*Math.atan(j),Tt=0,Et=.1,$t;Tt<15&&Math.abs(Et)>1e-7;Tt++)$t=B*Math.sin(at),$t=Math.pow((1-$t)/(1+$t),B/2),Et=Math.PI/2-2*Math.atan(j*$t)-at,at+=Et;return new hi(at*d,s.x*d/b)}},Ka={__proto__:null,LonLat:Wa,Mercator:fa,SphericalMercator:ti},Xa=x({},be,{code:"EPSG:3395",projection:fa,transformation:function(){var s=.5/(Math.PI*fa.R);return ei(s,.5,-s,.5)}()}),Ya=x({},be,{code:"EPSG:4326",projection:Wa,transformation:ei(1/180,1,-1/180,.5)}),Ja=x({},pn,{projection:Wa,transformation:ei(1,0,-1,0),scale:function(s){return Math.pow(2,s)},zoom:function(s){return Math.log(s)/Math.LN2},distance:function(s,d){var b=d.lng-s.lng,C=d.lat-s.lat;return Math.sqrt(b*b+C*C)},infinite:!0});pn.Earth=be,pn.EPSG3395=Xa,pn.EPSG3857=ut,pn.EPSG900913=mt,pn.EPSG4326=Ya,pn.Simple=Ja;var cr=Me.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(s){return s.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(s){return s&&s.removeLayer(this),this},getPane:function(s){return this._map.getPane(s?this.options[s]||s:this.options.pane)},addInteractiveTarget:function(s){return this._map._targets[F(s)]=this,this},removeInteractiveTarget:function(s){return delete this._map._targets[F(s)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(s){var d=s.target;if(d.hasLayer(this)){if(this._map=d,this._zoomAnimated=d._zoomAnimated,this.getEvents){var b=this.getEvents();d.on(b,this),this.once("remove",function(){d.off(b,this)},this)}this.onAdd(d),this.fire("add"),d.fire("layeradd",{layer:this})}}});Ei.include({addLayer:function(s){if(!s._layerAdd)throw new Error("The provided object is not a Layer.");var d=F(s);return this._layers[d]?this:(this._layers[d]=s,s._mapToAdd=this,s.beforeAdd&&s.beforeAdd(this),this.whenReady(s._layerAdd,s),this)},removeLayer:function(s){var d=F(s);return this._layers[d]?(this._loaded&&s.onRemove(this),delete this._layers[d],this._loaded&&(this.fire("layerremove",{layer:s}),s.fire("remove")),s._map=s._mapToAdd=null,this):this},hasLayer:function(s){return F(s)in this._layers},eachLayer:function(s,d){for(var b in this._layers)s.call(d,this._layers[b]);return this},_addLayers:function(s){s=s?Zt(s)?s:[s]:[];for(var d=0,b=s.length;d<b;d++)this.addLayer(s[d])},_addZoomLimit:function(s){(!isNaN(s.options.maxZoom)||!isNaN(s.options.minZoom))&&(this._zoomBoundLayers[F(s)]=s,this._updateZoomLevels())},_removeZoomLimit:function(s){var d=F(s);this._zoomBoundLayers[d]&&(delete this._zoomBoundLayers[d],this._updateZoomLevels())},_updateZoomLevels:function(){var s=1/0,d=-1/0,b=this._getZoomSpan();for(var C in this._zoomBoundLayers){var B=this._zoomBoundLayers[C].options;s=B.minZoom===void 0?s:Math.min(s,B.minZoom),d=B.maxZoom===void 0?d:Math.max(d,B.maxZoom)}this._layersMaxZoom=d===-1/0?void 0:d,this._layersMinZoom=s===1/0?void 0:s,b!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Yr=cr.extend({initialize:function(s,d){Pt(this,d),this._layers={};var b,C;if(s)for(b=0,C=s.length;b<C;b++)this.addLayer(s[b])},addLayer:function(s){var d=this.getLayerId(s);return this._layers[d]=s,this._map&&this._map.addLayer(s),this},removeLayer:function(s){var d=s in this._layers?s:this.getLayerId(s);return this._map&&this._layers[d]&&this._map.removeLayer(this._layers[d]),delete this._layers[d],this},hasLayer:function(s){var d=typeof s=="number"?s:this.getLayerId(s);return d in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(s){var d=Array.prototype.slice.call(arguments,1),b,C;for(b in this._layers)C=this._layers[b],C[s]&&C[s].apply(C,d);return this},onAdd:function(s){this.eachLayer(s.addLayer,s)},onRemove:function(s){this.eachLayer(s.removeLayer,s)},eachLayer:function(s,d){for(var b in this._layers)s.call(d,this._layers[b]);return this},getLayer:function(s){return this._layers[s]},getLayers:function(){var s=[];return this.eachLayer(s.push,s),s},setZIndex:function(s){return this.invoke("setZIndex",s)},getLayerId:function(s){return F(s)}}),ma=function(s,d){return new Yr(s,d)},ur=Yr.extend({addLayer:function(s){return this.hasLayer(s)?this:(s.addEventParent(this),Yr.prototype.addLayer.call(this,s),this.fire("layeradd",{layer:s}))},removeLayer:function(s){return this.hasLayer(s)?(s in this._layers&&(s=this._layers[s]),s.removeEventParent(this),Yr.prototype.removeLayer.call(this,s),this.fire("layerremove",{layer:s})):this},setStyle:function(s){return this.invoke("setStyle",s)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var s=new je;for(var d in this._layers){var b=this._layers[d];s.extend(b.getBounds?b.getBounds():b.getLatLng())}return s}}),cu=function(s,d){return new ur(s,d)},Ro=Ae.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(s){Pt(this,s)},createIcon:function(s){return this._createIcon("icon",s)},createShadow:function(s){return this._createIcon("shadow",s)},_createIcon:function(s,d){var b=this._getIconUrl(s);if(!b){if(s==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var C=this._createImg(b,d&&d.tagName==="IMG"?d:null);return this._setIconStyles(C,s),(this.options.crossOrigin||this.options.crossOrigin==="")&&(C.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),C},_setIconStyles:function(s,d){var b=this.options,C=b[d+"Size"];typeof C=="number"&&(C=[C,C]);var B=ze(C),j=ze(d==="shadow"&&b.shadowAnchor||b.iconAnchor||B&&B.divideBy(2,!0));s.className="leaflet-marker-"+d+" "+(b.className||""),j&&(s.style.marginLeft=-j.x+"px",s.style.marginTop=-j.y+"px"),B&&(s.style.width=B.x+"px",s.style.height=B.y+"px")},_createImg:function(s,d){return d=d||document.createElement("img"),d.src=s,d},_getIconUrl:function(s){return wt.retina&&this.options[s+"RetinaUrl"]||this.options[s+"Url"]}});function uu(s){return new Ro(s)}var Os=Ro.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(s){return typeof Os.imagePath!="string"&&(Os.imagePath=this._detectIconPath()),(this.options.imagePath||Os.imagePath)+Ro.prototype._getIconUrl.call(this,s)},_stripUrl:function(s){var d=function(b,C,B){var j=C.exec(b);return j&&j[B]};return s=d(s,/^url\((['"])?(.+)\1\)$/,2),s&&d(s,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var s=ii("div","leaflet-default-icon-path",document.body),d=sa(s,"background-image")||sa(s,"backgroundImage");if(document.body.removeChild(s),d=this._stripUrl(d),d)return d;var b=document.querySelector('link[href$="leaflet.css"]');return b?b.href.substring(0,b.href.length-11-1):""}}),_a=Kr.extend({initialize:function(s){this._marker=s},addHooks:function(){var s=this._marker._icon;this._draggable||(this._draggable=new Dr(s,s,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Qe(s,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&ni(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(s){var d=this._marker,b=d._map,C=this._marker.options.autoPanSpeed,B=this._marker.options.autoPanPadding,j=Hr(d._icon),at=b.getPixelBounds(),Tt=b.getPixelOrigin(),Et=si(at.min._subtract(Tt).add(B),at.max._subtract(Tt).subtract(B));if(!Et.contains(j)){var $t=ze((Math.max(Et.max.x,j.x)-Et.max.x)/(at.max.x-Et.max.x)-(Math.min(Et.min.x,j.x)-Et.min.x)/(at.min.x-Et.min.x),(Math.max(Et.max.y,j.y)-Et.max.y)/(at.max.y-Et.max.y)-(Math.min(Et.min.y,j.y)-Et.min.y)/(at.min.y-Et.min.y)).multiplyBy(C);b.panBy($t,{animate:!1}),this._draggable._newPos._add($t),this._draggable._startPos._add($t),un(d._icon,this._draggable._newPos),this._onDrag(s),this._panRequest=Qt(this._adjustPan.bind(this,s))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(s){this._marker.options.autoPan&&(fe(this._panRequest),this._panRequest=Qt(this._adjustPan.bind(this,s)))},_onDrag:function(s){var d=this._marker,b=d._shadow,C=Hr(d._icon),B=d._map.layerPointToLatLng(C);b&&un(b,C),d._latlng=B,s.latlng=B,s.oldLatLng=this._oldLatLng,d.fire("move",s).fire("drag",s)},_onDragEnd:function(s){fe(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",s)}}),Fs=cr.extend({options:{icon:new Os,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(s,d){Pt(this,d),this._latlng=Oe(s)},onAdd:function(s){this._zoomAnimated=this._zoomAnimated&&s.options.markerZoomAnimation,this._zoomAnimated&&s.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(s){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&s.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(s){var d=this._latlng;return this._latlng=Oe(s),this.update(),this.fire("move",{oldLatLng:d,latlng:this._latlng})},setZIndexOffset:function(s){return this.options.zIndexOffset=s,this.update()},getIcon:function(){return this.options.icon},setIcon:function(s){return this.options.icon=s,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var s=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(s)}return this},_initIcon:function(){var s=this.options,d="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),b=s.icon.createIcon(this._icon),C=!1;b!==this._icon&&(this._icon&&this._removeIcon(),C=!0,s.title&&(b.title=s.title),b.tagName==="IMG"&&(b.alt=s.alt||"")),Qe(b,d),s.keyboard&&(b.tabIndex="0",b.setAttribute("role","button")),this._icon=b,s.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ri(b,"focus",this._panOnFocus,this);var B=s.icon.createShadow(this._shadow),j=!1;B!==this._shadow&&(this._removeShadow(),j=!0),B&&(Qe(B,d),B.alt=""),this._shadow=B,s.opacity<1&&this._updateOpacity(),C&&this.getPane().appendChild(this._icon),this._initInteraction(),B&&j&&this.getPane(s.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Gi(this._icon,"focus",this._panOnFocus,this),mi(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&mi(this._shadow),this._shadow=null},_setPos:function(s){this._icon&&un(this._icon,s),this._shadow&&un(this._shadow,s),this._zIndex=s.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(s){this._icon&&(this._icon.style.zIndex=this._zIndex+s)},_animateZoom:function(s){var d=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center).round();this._setPos(d)},_initInteraction:function(){if(this.options.interactive&&(Qe(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),_a)){var s=this.options.draggable;this.dragging&&(s=this.dragging.enabled(),this.dragging.disable()),this.dragging=new _a(this),s&&this.dragging.enable()}},setOpacity:function(s){return this.options.opacity=s,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var s=this.options.opacity;this._icon&&Jn(this._icon,s),this._shadow&&Jn(this._shadow,s)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var s=this._map;if(s){var d=this.options.icon.options,b=d.iconSize?ze(d.iconSize):ze(0,0),C=d.iconAnchor?ze(d.iconAnchor):ze(0,0);s.panInside(this._latlng,{paddingTopLeft:C,paddingBottomRight:b.subtract(C)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function yc(s,d){return new Fs(s,d)}var uo=cr.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(s){this._renderer=s.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(s){return Pt(this,s),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&s&&Object.prototype.hasOwnProperty.call(s,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Do=uo.extend({options:{fill:!0,radius:10},initialize:function(s,d){Pt(this,d),this._latlng=Oe(s),this._radius=this.options.radius},setLatLng:function(s){var d=this._latlng;return this._latlng=Oe(s),this.redraw(),this.fire("move",{oldLatLng:d,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(s){return this.options.radius=this._radius=s,this.redraw()},getRadius:function(){return this._radius},setStyle:function(s){var d=s&&s.radius||this._radius;return uo.prototype.setStyle.call(this,s),this.setRadius(d),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var s=this._radius,d=this._radiusY||s,b=this._clickTolerance(),C=[s+b,d+b];this._pxBounds=new Ue(this._point.subtract(C),this._point.add(C))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(s){return s.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Qa(s,d){return new Do(s,d)}var Ns=Do.extend({initialize:function(s,d,b){if(typeof d=="number"&&(d=x({},b,{radius:d})),Pt(this,d),this._latlng=Oe(s),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(s){return this._mRadius=s,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var s=[this._radius,this._radiusY||this._radius];return new je(this._map.layerPointToLatLng(this._point.subtract(s)),this._map.layerPointToLatLng(this._point.add(s)))},setStyle:uo.prototype.setStyle,_project:function(){var s=this._latlng.lng,d=this._latlng.lat,b=this._map,C=b.options.crs;if(C.distance===be.distance){var B=Math.PI/180,j=this._mRadius/be.R/B,at=b.project([d+j,s]),Tt=b.project([d-j,s]),Et=at.add(Tt).divideBy(2),$t=b.unproject(Et).lat,ye=Math.acos((Math.cos(j*B)-Math.sin(d*B)*Math.sin($t*B))/(Math.cos(d*B)*Math.cos($t*B)))/B;(isNaN(ye)||ye===0)&&(ye=j/Math.cos(Math.PI/180*d)),this._point=Et.subtract(b.getPixelOrigin()),this._radius=isNaN(ye)?0:Et.x-b.project([$t,s-ye]).x,this._radiusY=Et.y-at.y}else{var He=C.unproject(C.project(this._latlng).subtract([this._mRadius,0]));this._point=b.latLngToLayerPoint(this._latlng),this._radius=this._point.x-b.latLngToLayerPoint(He).x}this._updateBounds()}});function vc(s,d,b){return new Ns(s,d,b)}var Ri=uo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(s,d){Pt(this,d),this._setLatLngs(s)},getLatLngs:function(){return this._latlngs},setLatLngs:function(s){return this._setLatLngs(s),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(s){for(var d=1/0,b=null,C=ai,B,j,at=0,Tt=this._parts.length;at<Tt;at++)for(var Et=this._parts[at],$t=1,ye=Et.length;$t<ye;$t++){B=Et[$t-1],j=Et[$t];var He=C(s,B,j,!0);He<d&&(d=He,b=C(s,B,j))}return b&&(b.distance=Math.sqrt(d)),b},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ki(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(s,d){return d=d||this._defaultShape(),s=Oe(s),d.push(s),this._bounds.extend(s),this.redraw()},_setLatLngs:function(s){this._bounds=new je,this._latlngs=this._convertLatLngs(s)},_defaultShape:function(){return An(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(s){for(var d=[],b=An(s),C=0,B=s.length;C<B;C++)b?(d[C]=Oe(s[C]),this._bounds.extend(d[C])):d[C]=this._convertLatLngs(s[C]);return d},_project:function(){var s=new Ue;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,s),this._bounds.isValid()&&s.isValid()&&(this._rawPxBounds=s,this._updateBounds())},_updateBounds:function(){var s=this._clickTolerance(),d=new Ht(s,s);this._rawPxBounds&&(this._pxBounds=new Ue([this._rawPxBounds.min.subtract(d),this._rawPxBounds.max.add(d)]))},_projectLatlngs:function(s,d,b){var C=s[0]instanceof hi,B=s.length,j,at;if(C){for(at=[],j=0;j<B;j++)at[j]=this._map.latLngToLayerPoint(s[j]),b.extend(at[j]);d.push(at)}else for(j=0;j<B;j++)this._projectLatlngs(s[j],d,b)},_clipPoints:function(){var s=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(s))){if(this.options.noClip){this._parts=this._rings;return}var d=this._parts,b,C,B,j,at,Tt,Et;for(b=0,B=0,j=this._rings.length;b<j;b++)for(Et=this._rings[b],C=0,at=Et.length;C<at-1;C++)Tt=Ha(Et[C],Et[C+1],s,C,!0),Tt&&(d[B]=d[B]||[],d[B].push(Tt[0]),(Tt[1]!==Et[C+1]||C===at-2)&&(d[B].push(Tt[1]),B++))}},_simplifyPoints:function(){for(var s=this._parts,d=this.options.smoothFactor,b=0,C=s.length;b<C;b++)s[b]=Ll(s[b],d)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(s,d){var b,C,B,j,at,Tt,Et=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(s))return!1;for(b=0,j=this._parts.length;b<j;b++)for(Tt=this._parts[b],C=0,at=Tt.length,B=at-1;C<at;B=C++)if(!(!d&&C===0)&&qa(s,Tt[B],Tt[C])<=Et)return!0;return!1}});function as(s,d){return new Ri(s,d)}Ri._flat=nn;var bn=Ri.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ga(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(s){var d=Ri.prototype._convertLatLngs.call(this,s),b=d.length;return b>=2&&d[0]instanceof hi&&d[0].equals(d[b-1])&&d.pop(),d},_setLatLngs:function(s){Ri.prototype._setLatLngs.call(this,s),An(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return An(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var s=this._renderer._bounds,d=this.options.weight,b=new Ht(d,d);if(s=new Ue(s.min.subtract(b),s.max.add(b)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(s))){if(this.options.noClip){this._parts=this._rings;return}for(var C=0,B=this._rings.length,j;C<B;C++)j=ja(this._rings[C],s,!0),j.length&&this._parts.push(j)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(s){var d=!1,b,C,B,j,at,Tt,Et,$t;if(!this._pxBounds||!this._pxBounds.contains(s))return!1;for(j=0,Et=this._parts.length;j<Et;j++)for(b=this._parts[j],at=0,$t=b.length,Tt=$t-1;at<$t;Tt=at++)C=b[at],B=b[Tt],C.y>s.y!=B.y>s.y&&s.x<(B.x-C.x)*(s.y-C.y)/(B.y-C.y)+C.x&&(d=!d);return d||Ri.prototype._containsPoint.call(this,s,!0)}});function Us(s,d){return new bn(s,d)}var hr=ur.extend({initialize:function(s,d){Pt(this,d),this._layers={},s&&this.addData(s)},addData:function(s){var d=Zt(s)?s:s.features,b,C,B;if(d){for(b=0,C=d.length;b<C;b++)B=d[b],(B.geometries||B.geometry||B.features||B.coordinates)&&this.addData(B);return this}var j=this.options;if(j.filter&&!j.filter(s))return this;var at=ls(s,j);return at?(at.feature=ya(s),at.defaultOptions=at.options,this.resetStyle(at),j.onEachFeature&&j.onEachFeature(s,at),this.addLayer(at)):this},resetStyle:function(s){return s===void 0?this.eachLayer(this.resetStyle,this):(s.options=x({},s.defaultOptions),this._setLayerStyle(s,this.options.style),this)},setStyle:function(s){return this.eachLayer(function(d){this._setLayerStyle(d,s)},this)},_setLayerStyle:function(s,d){s.setStyle&&(typeof d=="function"&&(d=d(s.feature)),s.setStyle(d))}});function ls(s,d){var b=s.type==="Feature"?s.geometry:s,C=b?b.coordinates:null,B=[],j=d&&d.pointToLayer,at=d&&d.coordsToLatLng||cs,Tt,Et,$t,ye;if(!C&&!b)return null;switch(b.type){case"Point":return Tt=at(C),Bo(j,s,Tt,d);case"MultiPoint":for($t=0,ye=C.length;$t<ye;$t++)Tt=at(C[$t]),B.push(Bo(j,s,Tt,d));return new ur(B);case"LineString":case"MultiLineString":return Et=ho(C,b.type==="LineString"?0:1,at),new Ri(Et,d);case"Polygon":case"MultiPolygon":return Et=ho(C,b.type==="Polygon"?1:2,at),new bn(Et,d);case"GeometryCollection":for($t=0,ye=b.geometries.length;$t<ye;$t++){var He=ls({geometry:b.geometries[$t],type:"Feature",properties:s.properties},d);He&&B.push(He)}return new ur(B);case"FeatureCollection":for($t=0,ye=b.features.length;$t<ye;$t++){var yi=ls(b.features[$t],d);yi&&B.push(yi)}return new ur(B);default:throw new Error("Invalid GeoJSON object.")}}function Bo(s,d,b,C){return s?s(d,b):new Fs(b,C&&C.markersInheritOptions&&C)}function cs(s){return new hi(s[1],s[0],s[2])}function ho(s,d,b){for(var C=[],B=0,j=s.length,at;B<j;B++)at=d?ho(s[B],d-1,b):(b||cs)(s[B]),C.push(at);return C}function tl(s,d){return s=Oe(s),s.alt!==void 0?[K(s.lng,d),K(s.lat,d),K(s.alt,d)]:[K(s.lng,d),K(s.lat,d)]}function ga(s,d,b,C){for(var B=[],j=0,at=s.length;j<at;j++)B.push(d?ga(s[j],An(s[j])?0:d-1,b,C):tl(s[j],C));return!d&&b&&B.length>0&&B.push(B[0].slice()),B}function us(s,d){return s.feature?x({},s.feature,{geometry:d}):ya(d)}function ya(s){return s.type==="Feature"||s.type==="FeatureCollection"?s:{type:"Feature",properties:{},geometry:s}}var el={toGeoJSON:function(s){return us(this,{type:"Point",coordinates:tl(this.getLatLng(),s)})}};Fs.include(el),Ns.include(el),Do.include(el),Ri.include({toGeoJSON:function(s){var d=!An(this._latlngs),b=ga(this._latlngs,d?1:0,!1,s);return us(this,{type:(d?"Multi":"")+"LineString",coordinates:b})}}),bn.include({toGeoJSON:function(s){var d=!An(this._latlngs),b=d&&!An(this._latlngs[0]),C=ga(this._latlngs,b?2:d?1:0,!0,s);return d||(C=[C]),us(this,{type:(b?"Multi":"")+"Polygon",coordinates:C})}}),Yr.include({toMultiPoint:function(s){var d=[];return this.eachLayer(function(b){d.push(b.toGeoJSON(s).geometry.coordinates)}),us(this,{type:"MultiPoint",coordinates:d})},toGeoJSON:function(s){var d=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(d==="MultiPoint")return this.toMultiPoint(s);var b=d==="GeometryCollection",C=[];return this.eachLayer(function(B){if(B.toGeoJSON){var j=B.toGeoJSON(s);if(b)C.push(j.geometry);else{var at=ya(j);at.type==="FeatureCollection"?C.push.apply(C,at.features):C.push(at)}}}),b?us(this,{geometries:C,type:"GeometryCollection"}):{type:"FeatureCollection",features:C}}});function Br(s,d){return new hr(s,d)}var va=Br,Vn=cr.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(s,d,b){this._url=s,this._bounds=ui(d),Pt(this,b)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Qe(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){mi(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(s){return this.options.opacity=s,this._image&&this._updateOpacity(),this},setStyle:function(s){return s.opacity&&this.setOpacity(s.opacity),this},bringToFront:function(){return this._map&&Rr(this._image),this},bringToBack:function(){return this._map&&Vi(this._image),this},setUrl:function(s){return this._url=s,this._image&&(this._image.src=s),this},setBounds:function(s){return this._bounds=ui(s),this._map&&this._reset(),this},getEvents:function(){var s={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},setZIndex:function(s){return this.options.zIndex=s,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var s=this._url.tagName==="IMG",d=this._image=s?this._url:ii("img");if(Qe(d,"leaflet-image-layer"),this._zoomAnimated&&Qe(d,"leaflet-zoom-animated"),this.options.className&&Qe(d,this.options.className),d.onselectstart=W,d.onmousemove=W,d.onload=I(this.fire,this,"load"),d.onerror=I(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(d.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),s){this._url=d.src;return}d.src=this._url,d.alt=this.options.alt},_animateZoom:function(s){var d=this._map.getZoomScale(s.zoom),b=this._map._latLngBoundsToNewLayerBounds(this._bounds,s.zoom,s.center).min;co(this._image,b,d)},_reset:function(){var s=this._image,d=new Ue(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),b=d.getSize();un(s,d.min),s.style.width=b.x+"px",s.style.height=b.y+"px"},_updateOpacity:function(){Jn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var s=this.options.errorOverlayUrl;s&&this._url!==s&&(this._url=s,this._image.src=s)},getCenter:function(){return this._bounds.getCenter()}}),xa=function(s,d,b){return new Vn(s,d,b)},kl=Vn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var s=this._url.tagName==="VIDEO",d=this._image=s?this._url:ii("video");if(Qe(d,"leaflet-image-layer"),this._zoomAnimated&&Qe(d,"leaflet-zoom-animated"),this.options.className&&Qe(d,this.options.className),d.onselectstart=W,d.onmousemove=W,d.onloadeddata=I(this.fire,this,"load"),s){for(var b=d.getElementsByTagName("source"),C=[],B=0;B<b.length;B++)C.push(b[B].src);this._url=b.length>0?C:[d.src];return}Zt(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(d.style,"objectFit")&&(d.style.objectFit="fill"),d.autoplay=!!this.options.autoplay,d.loop=!!this.options.loop,d.muted=!!this.options.muted,d.playsInline=!!this.options.playsInline;for(var j=0;j<this._url.length;j++){var at=ii("source");at.src=this._url[j],d.appendChild(at)}}});function xc(s,d,b){return new kl(s,d,b)}var zl=Vn.extend({_initImage:function(){var s=this._image=this._url;Qe(s,"leaflet-image-layer"),this._zoomAnimated&&Qe(s,"leaflet-zoom-animated"),this.options.className&&Qe(s,this.options.className),s.onselectstart=W,s.onmousemove=W}});function po(s,d,b){return new zl(s,d,b)}var Or=cr.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(s,d){s&&(s instanceof hi||Zt(s))?(this._latlng=Oe(s),Pt(this,d)):(Pt(this,s),this._source=d),this.options.content&&(this._content=this.options.content)},openOn:function(s){return s=arguments.length?s:this._source._map,s.hasLayer(this)||s.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(s){return this._map?this.close():(arguments.length?this._source=s:s=this._source,this._prepareOpen(),this.openOn(s._map)),this},onAdd:function(s){this._zoomAnimated=s._zoomAnimated,this._container||this._initLayout(),s._fadeAnimated&&Jn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),s._fadeAnimated&&Jn(this._container,1),this.bringToFront(),this.options.interactive&&(Qe(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(s){s._fadeAnimated?(Jn(this._container,0),this._removeTimeout=setTimeout(I(mi,void 0,this._container),200)):mi(this._container),this.options.interactive&&(ni(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(s){return this._latlng=Oe(s),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(s){return this._content=s,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var s={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Rr(this._container),this},bringToBack:function(){return this._map&&Vi(this._container),this},_prepareOpen:function(s){var d=this._source;if(!d._map)return!1;if(d instanceof ur){d=null;var b=this._source._layers;for(var C in b)if(b[C]._map){d=b[C];break}if(!d)return!1;this._source=d}if(!s)if(d.getCenter)s=d.getCenter();else if(d.getLatLng)s=d.getLatLng();else if(d.getBounds)s=d.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(s),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var s=this._contentNode,d=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof d=="string")s.innerHTML=d;else{for(;s.hasChildNodes();)s.removeChild(s.firstChild);s.appendChild(d)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var s=this._map.latLngToLayerPoint(this._latlng),d=ze(this.options.offset),b=this._getAnchor();this._zoomAnimated?un(this._container,s.add(b)):d=d.add(s).add(b);var C=this._containerBottom=-d.y,B=this._containerLeft=-Math.round(this._containerWidth/2)+d.x;this._container.style.bottom=C+"px",this._container.style.left=B+"px"}},_getAnchor:function(){return[0,0]}});Ei.include({_initOverlay:function(s,d,b,C){var B=d;return B instanceof s||(B=new s(C).setContent(d)),b&&B.setLatLng(b),B}}),cr.include({_initOverlay:function(s,d,b,C){var B=b;return B instanceof s?(Pt(B,C),B._source=this):(B=d&&!C?d:new s(C,this),B.setContent(b)),B}});var jn=Or.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(s){return s=arguments.length?s:this._source._map,!s.hasLayer(this)&&s._popup&&s._popup.options.autoClose&&s.removeLayer(s._popup),s._popup=this,Or.prototype.openOn.call(this,s)},onAdd:function(s){Or.prototype.onAdd.call(this,s),s.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof uo||this._source.on("preclick",Wr))},onRemove:function(s){Or.prototype.onRemove.call(this,s),s.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof uo||this._source.off("preclick",Wr))},getEvents:function(){var s=Or.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(s.preclick=this.close),this.options.keepInView&&(s.moveend=this._adjustPan),s},_initLayout:function(){var s="leaflet-popup",d=this._container=ii("div",s+" "+(this.options.className||"")+" leaflet-zoom-animated"),b=this._wrapper=ii("div",s+"-content-wrapper",d);if(this._contentNode=ii("div",s+"-content",b),ko(d),ns(this._contentNode),ri(d,"contextmenu",Wr),this._tipContainer=ii("div",s+"-tip-container",d),this._tip=ii("div",s+"-tip",this._tipContainer),this.options.closeButton){var C=this._closeButton=ii("a",s+"-close-button",d);C.setAttribute("role","button"),C.setAttribute("aria-label","Close popup"),C.href="#close",C.innerHTML='<span aria-hidden="true">&#215;</span>',ri(C,"click",function(B){dn(B),this.close()},this)}},_updateLayout:function(){var s=this._contentNode,d=s.style;d.width="",d.whiteSpace="nowrap";var b=s.offsetWidth;b=Math.min(b,this.options.maxWidth),b=Math.max(b,this.options.minWidth),d.width=b+1+"px",d.whiteSpace="",d.height="";var C=s.offsetHeight,B=this.options.maxHeight,j="leaflet-popup-scrolled";B&&C>B?(d.height=B+"px",Qe(s,j)):ni(s,j),this._containerWidth=this._container.offsetWidth},_animateZoom:function(s){var d=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center),b=this._getAnchor();un(this._container,d.add(b))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var s=this._map,d=parseInt(sa(this._container,"marginBottom"),10)||0,b=this._container.offsetHeight+d,C=this._containerWidth,B=new Ht(this._containerLeft,-b-this._containerBottom);B._add(Hr(this._container));var j=s.layerPointToContainerPoint(B),at=ze(this.options.autoPanPadding),Tt=ze(this.options.autoPanPaddingTopLeft||at),Et=ze(this.options.autoPanPaddingBottomRight||at),$t=s.getSize(),ye=0,He=0;j.x+C+Et.x>$t.x&&(ye=j.x+C-$t.x+Et.x),j.x-ye-Tt.x<0&&(ye=j.x-Tt.x),j.y+b+Et.y>$t.y&&(He=j.y+b-$t.y+Et.y),j.y-He-Tt.y<0&&(He=j.y-Tt.y),(ye||He)&&(this.options.keepInView&&(this._autopanning=!0),s.fire("autopanstart").panBy([ye,He]))}},_getAnchor:function(){return ze(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),fo=function(s,d){return new jn(s,d)};Ei.mergeOptions({closePopupOnClick:!0}),Ei.include({openPopup:function(s,d,b){return this._initOverlay(jn,s,d,b).openOn(this),this},closePopup:function(s){return s=arguments.length?s:this._popup,s&&s.close(),this}}),cr.include({bindPopup:function(s,d){return this._popup=this._initOverlay(jn,this._popup,s,d),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(s){return this._popup&&(this instanceof ur||(this._popup._source=this),this._popup._prepareOpen(s||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(s){return this._popup&&this._popup.setContent(s),this},getPopup:function(){return this._popup},_openPopup:function(s){if(!(!this._popup||!this._map)){tr(s);var d=s.layer||s.target;if(this._popup._source===d&&!(d instanceof uo)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(s.latlng);return}this._popup._source=d,this.openPopup(s.latlng)}},_movePopup:function(s){this._popup.setLatLng(s.latlng)},_onKeyPress:function(s){s.originalEvent.keyCode===13&&this._openPopup(s)}});var hs=Or.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(s){Or.prototype.onAdd.call(this,s),this.setOpacity(this.options.opacity),s.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(s){Or.prototype.onRemove.call(this,s),s.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var s=Or.prototype.getEvents.call(this);return this.options.permanent||(s.preclick=this.close),s},_initLayout:function(){var s="leaflet-tooltip",d=s+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ii("div",d),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+F(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(s){var d,b,C=this._map,B=this._container,j=C.latLngToContainerPoint(C.getCenter()),at=C.layerPointToContainerPoint(s),Tt=this.options.direction,Et=B.offsetWidth,$t=B.offsetHeight,ye=ze(this.options.offset),He=this._getAnchor();Tt==="top"?(d=Et/2,b=$t):Tt==="bottom"?(d=Et/2,b=0):Tt==="center"?(d=Et/2,b=$t/2):Tt==="right"?(d=0,b=$t/2):Tt==="left"?(d=Et,b=$t/2):at.x<j.x?(Tt="right",d=0,b=$t/2):(Tt="left",d=Et+(ye.x+He.x)*2,b=$t/2),s=s.subtract(ze(d,b,!0)).add(ye).add(He),ni(B,"leaflet-tooltip-right"),ni(B,"leaflet-tooltip-left"),ni(B,"leaflet-tooltip-top"),ni(B,"leaflet-tooltip-bottom"),Qe(B,"leaflet-tooltip-"+Tt),un(B,s)},_updatePosition:function(){var s=this._map.latLngToLayerPoint(this._latlng);this._setPosition(s)},setOpacity:function(s){this.options.opacity=s,this._container&&Jn(this._container,s)},_animateZoom:function(s){var d=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center);this._setPosition(d)},_getAnchor:function(){return ze(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),mo=function(s,d){return new hs(s,d)};Ei.include({openTooltip:function(s,d,b){return this._initOverlay(hs,s,d,b).openOn(this),this},closeTooltip:function(s){return s.close(),this}}),cr.include({bindTooltip:function(s,d){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(hs,this._tooltip,s,d),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(s){if(!(!s&&this._tooltipHandlersAdded)){var d=s?"off":"on",b={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?b.add=this._openTooltip:(b.mouseover=this._openTooltip,b.mouseout=this.closeTooltip,b.click=this._openTooltip,this._map?this._addFocusListeners():b.add=this._addFocusListeners),this._tooltip.options.sticky&&(b.mousemove=this._moveTooltip),this[d](b),this._tooltipHandlersAdded=!s}},openTooltip:function(s){return this._tooltip&&(this instanceof ur||(this._tooltip._source=this),this._tooltip._prepareOpen(s)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(s){return this._tooltip&&this._tooltip.setContent(s),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(s){var d=typeof s.getElement=="function"&&s.getElement();d&&(ri(d,"focus",function(){this._tooltip._source=s,this.openTooltip()},this),ri(d,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(s){var d=typeof s.getElement=="function"&&s.getElement();d&&d.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(s){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var d=this;this._map.once("moveend",function(){d._openOnceFlag=!1,d._openTooltip(s)});return}this._tooltip._source=s.layer||s.target,this.openTooltip(this._tooltip.options.sticky?s.latlng:void 0)}},_moveTooltip:function(s){var d=s.latlng,b,C;this._tooltip.options.sticky&&s.originalEvent&&(b=this._map.mouseEventToContainerPoint(s.originalEvent),C=this._map.containerPointToLayerPoint(b),d=this._map.layerPointToLatLng(C)),this._tooltip.setLatLng(d)}});var Jr=Ro.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(s){var d=s&&s.tagName==="DIV"?s:document.createElement("div"),b=this.options;if(b.html instanceof Element?(ts(d),d.appendChild(b.html)):d.innerHTML=b.html!==!1?b.html:"",b.bgPos){var C=ze(b.bgPos);d.style.backgroundPosition=-C.x+"px "+-C.y+"px"}return this._setIconStyles(d,"icon"),d},createShadow:function(){return null}});function hu(s){return new Jr(s)}Ro.Default=Os;var ds=cr.extend({options:{tileSize:256,opacity:1,updateWhenIdle:wt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(s){Pt(this,s)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(s){s._addZoomLimit(this)},onRemove:function(s){this._removeAllTiles(),mi(this._container),s._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Rr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Vi(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(s){return this.options.opacity=s,this._updateOpacity(),this},setZIndex:function(s){return this.options.zIndex=s,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var s=this._clampZoom(this._map.getZoom());s!==this._tileZoom&&(this._tileZoom=s,this._updateLevels()),this._update()}return this},getEvents:function(){var s={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=D(this._onMoveEnd,this.options.updateInterval,this)),s.move=this._onMove),this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},createTile:function(){return document.createElement("div")},getTileSize:function(){var s=this.options.tileSize;return s instanceof Ht?s:new Ht(s,s)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(s){for(var d=this.getPane().children,b=-s(-1/0,1/0),C=0,B=d.length,j;C<B;C++)j=d[C].style.zIndex,d[C]!==this._container&&j&&(b=s(b,+j));isFinite(b)&&(this.options.zIndex=b+s(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!wt.ielt9){Jn(this._container,this.options.opacity);var s=+new Date,d=!1,b=!1;for(var C in this._tiles){var B=this._tiles[C];if(!(!B.current||!B.loaded)){var j=Math.min(1,(s-B.loaded)/200);Jn(B.el,j),j<1?d=!0:(B.active?b=!0:this._onOpaqueTile(B),B.active=!0)}}b&&!this._noPrune&&this._pruneTiles(),d&&(fe(this._fadeFrame),this._fadeFrame=Qt(this._updateOpacity,this))}},_onOpaqueTile:W,_initContainer:function(){this._container||(this._container=ii("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var s=this._tileZoom,d=this.options.maxZoom;if(s!==void 0){for(var b in this._levels)b=Number(b),this._levels[b].el.children.length||b===s?(this._levels[b].el.style.zIndex=d-Math.abs(s-b),this._onUpdateLevel(b)):(mi(this._levels[b].el),this._removeTilesAtZoom(b),this._onRemoveLevel(b),delete this._levels[b]);var C=this._levels[s],B=this._map;return C||(C=this._levels[s]={},C.el=ii("div","leaflet-tile-container leaflet-zoom-animated",this._container),C.el.style.zIndex=d,C.origin=B.project(B.unproject(B.getPixelOrigin()),s).round(),C.zoom=s,this._setZoomTransform(C,B.getCenter(),B.getZoom()),W(C.el.offsetWidth),this._onCreateLevel(C)),this._level=C,C}},_onUpdateLevel:W,_onRemoveLevel:W,_onCreateLevel:W,_pruneTiles:function(){if(this._map){var s,d,b=this._map.getZoom();if(b>this.options.maxZoom||b<this.options.minZoom){this._removeAllTiles();return}for(s in this._tiles)d=this._tiles[s],d.retain=d.current;for(s in this._tiles)if(d=this._tiles[s],d.current&&!d.active){var C=d.coords;this._retainParent(C.x,C.y,C.z,C.z-5)||this._retainChildren(C.x,C.y,C.z,C.z+2)}for(s in this._tiles)this._tiles[s].retain||this._removeTile(s)}},_removeTilesAtZoom:function(s){for(var d in this._tiles)this._tiles[d].coords.z===s&&this._removeTile(d)},_removeAllTiles:function(){for(var s in this._tiles)this._removeTile(s)},_invalidateAll:function(){for(var s in this._levels)mi(this._levels[s].el),this._onRemoveLevel(Number(s)),delete this._levels[s];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(s,d,b,C){var B=Math.floor(s/2),j=Math.floor(d/2),at=b-1,Tt=new Ht(+B,+j);Tt.z=+at;var Et=this._tileCoordsToKey(Tt),$t=this._tiles[Et];return $t&&$t.active?($t.retain=!0,!0):($t&&$t.loaded&&($t.retain=!0),at>C?this._retainParent(B,j,at,C):!1)},_retainChildren:function(s,d,b,C){for(var B=2*s;B<2*s+2;B++)for(var j=2*d;j<2*d+2;j++){var at=new Ht(B,j);at.z=b+1;var Tt=this._tileCoordsToKey(at),Et=this._tiles[Tt];if(Et&&Et.active){Et.retain=!0;continue}else Et&&Et.loaded&&(Et.retain=!0);b+1<C&&this._retainChildren(B,j,b+1,C)}},_resetView:function(s){var d=s&&(s.pinch||s.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),d,d)},_animateZoom:function(s){this._setView(s.center,s.zoom,!0,s.noUpdate)},_clampZoom:function(s){var d=this.options;return d.minNativeZoom!==void 0&&s<d.minNativeZoom?d.minNativeZoom:d.maxNativeZoom!==void 0&&d.maxNativeZoom<s?d.maxNativeZoom:s},_setView:function(s,d,b,C){var B=Math.round(d);this.options.maxZoom!==void 0&&B>this.options.maxZoom||this.options.minZoom!==void 0&&B<this.options.minZoom?B=void 0:B=this._clampZoom(B);var j=this.options.updateWhenZooming&&B!==this._tileZoom;(!C||j)&&(this._tileZoom=B,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),B!==void 0&&this._update(s),b||this._pruneTiles(),this._noPrune=!!b),this._setZoomTransforms(s,d)},_setZoomTransforms:function(s,d){for(var b in this._levels)this._setZoomTransform(this._levels[b],s,d)},_setZoomTransform:function(s,d,b){var C=this._map.getZoomScale(b,s.zoom),B=s.origin.multiplyBy(C).subtract(this._map._getNewPixelOrigin(d,b)).round();wt.any3d?co(s.el,B,C):un(s.el,B)},_resetGrid:function(){var s=this._map,d=s.options.crs,b=this._tileSize=this.getTileSize(),C=this._tileZoom,B=this._map.getPixelWorldBounds(this._tileZoom);B&&(this._globalTileRange=this._pxBoundsToTileRange(B)),this._wrapX=d.wrapLng&&!this.options.noWrap&&[Math.floor(s.project([0,d.wrapLng[0]],C).x/b.x),Math.ceil(s.project([0,d.wrapLng[1]],C).x/b.y)],this._wrapY=d.wrapLat&&!this.options.noWrap&&[Math.floor(s.project([d.wrapLat[0],0],C).y/b.x),Math.ceil(s.project([d.wrapLat[1],0],C).y/b.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(s){var d=this._map,b=d._animatingZoom?Math.max(d._animateToZoom,d.getZoom()):d.getZoom(),C=d.getZoomScale(b,this._tileZoom),B=d.project(s,this._tileZoom).floor(),j=d.getSize().divideBy(C*2);return new Ue(B.subtract(j),B.add(j))},_update:function(s){var d=this._map;if(d){var b=this._clampZoom(d.getZoom());if(s===void 0&&(s=d.getCenter()),this._tileZoom!==void 0){var C=this._getTiledPixelBounds(s),B=this._pxBoundsToTileRange(C),j=B.getCenter(),at=[],Tt=this.options.keepBuffer,Et=new Ue(B.getBottomLeft().subtract([Tt,-Tt]),B.getTopRight().add([Tt,-Tt]));if(!(isFinite(B.min.x)&&isFinite(B.min.y)&&isFinite(B.max.x)&&isFinite(B.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var $t in this._tiles){var ye=this._tiles[$t].coords;(ye.z!==this._tileZoom||!Et.contains(new Ht(ye.x,ye.y)))&&(this._tiles[$t].current=!1)}if(Math.abs(b-this._tileZoom)>1){this._setView(s,b);return}for(var He=B.min.y;He<=B.max.y;He++)for(var yi=B.min.x;yi<=B.max.x;yi++){var $i=new Ht(yi,He);if($i.z=this._tileZoom,!!this._isValidTile($i)){var mn=this._tiles[this._tileCoordsToKey($i)];mn?mn.current=!0:at.push($i)}}if(at.sort(function(xe,to){return xe.distanceTo(j)-to.distanceTo(j)}),at.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var me=document.createDocumentFragment();for(yi=0;yi<at.length;yi++)this._addTile(at[yi],me);this._level.el.appendChild(me)}}}},_isValidTile:function(s){var d=this._map.options.crs;if(!d.infinite){var b=this._globalTileRange;if(!d.wrapLng&&(s.x<b.min.x||s.x>b.max.x)||!d.wrapLat&&(s.y<b.min.y||s.y>b.max.y))return!1}if(!this.options.bounds)return!0;var C=this._tileCoordsToBounds(s);return ui(this.options.bounds).overlaps(C)},_keyToBounds:function(s){return this._tileCoordsToBounds(this._keyToTileCoords(s))},_tileCoordsToNwSe:function(s){var d=this._map,b=this.getTileSize(),C=s.scaleBy(b),B=C.add(b),j=d.unproject(C,s.z),at=d.unproject(B,s.z);return[j,at]},_tileCoordsToBounds:function(s){var d=this._tileCoordsToNwSe(s),b=new je(d[0],d[1]);return this.options.noWrap||(b=this._map.wrapLatLngBounds(b)),b},_tileCoordsToKey:function(s){return s.x+":"+s.y+":"+s.z},_keyToTileCoords:function(s){var d=s.split(":"),b=new Ht(+d[0],+d[1]);return b.z=+d[2],b},_removeTile:function(s){var d=this._tiles[s];d&&(mi(d.el),delete this._tiles[s],this.fire("tileunload",{tile:d.el,coords:this._keyToTileCoords(s)}))},_initTile:function(s){Qe(s,"leaflet-tile");var d=this.getTileSize();s.style.width=d.x+"px",s.style.height=d.y+"px",s.onselectstart=W,s.onmousemove=W,wt.ielt9&&this.options.opacity<1&&Jn(s,this.options.opacity)},_addTile:function(s,d){var b=this._getTilePos(s),C=this._tileCoordsToKey(s),B=this.createTile(this._wrapCoords(s),I(this._tileReady,this,s));this._initTile(B),this.createTile.length<2&&Qt(I(this._tileReady,this,s,null,B)),un(B,b),this._tiles[C]={el:B,coords:s,current:!0},d.appendChild(B),this.fire("tileloadstart",{tile:B,coords:s})},_tileReady:function(s,d,b){d&&this.fire("tileerror",{error:d,tile:b,coords:s});var C=this._tileCoordsToKey(s);b=this._tiles[C],b&&(b.loaded=+new Date,this._map._fadeAnimated?(Jn(b.el,0),fe(this._fadeFrame),this._fadeFrame=Qt(this._updateOpacity,this)):(b.active=!0,this._pruneTiles()),d||(Qe(b.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:b.el,coords:s})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),wt.ielt9||!this._map._fadeAnimated?Qt(this._pruneTiles,this):setTimeout(I(this._pruneTiles,this),250)))},_getTilePos:function(s){return s.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(s){var d=new Ht(this._wrapX?q(s.x,this._wrapX):s.x,this._wrapY?q(s.y,this._wrapY):s.y);return d.z=s.z,d},_pxBoundsToTileRange:function(s){var d=this.getTileSize();return new Ue(s.min.unscaleBy(d).floor(),s.max.unscaleBy(d).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var s in this._tiles)if(!this._tiles[s].loaded)return!1;return!0}});function bc(s){return new ds(s)}var _o=ds.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(s,d){this._url=s,d=Pt(this,d),d.detectRetina&&wt.retina&&d.maxZoom>0?(d.tileSize=Math.floor(d.tileSize/2),d.zoomReverse?(d.zoomOffset--,d.minZoom=Math.min(d.maxZoom,d.minZoom+1)):(d.zoomOffset++,d.maxZoom=Math.max(d.minZoom,d.maxZoom-1)),d.minZoom=Math.max(0,d.minZoom)):d.zoomReverse?d.minZoom=Math.min(d.maxZoom,d.minZoom):d.maxZoom=Math.max(d.minZoom,d.maxZoom),typeof d.subdomains=="string"&&(d.subdomains=d.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(s,d){return this._url===s&&d===void 0&&(d=!0),this._url=s,d||this.redraw(),this},createTile:function(s,d){var b=document.createElement("img");return ri(b,"load",I(this._tileOnLoad,this,d,b)),ri(b,"error",I(this._tileOnError,this,d,b)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(b.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(b.referrerPolicy=this.options.referrerPolicy),b.alt="",b.src=this.getTileUrl(s),b},getTileUrl:function(s){var d={r:wt.retina?"@2x":"",s:this._getSubdomain(s),x:s.x,y:s.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var b=this._globalTileRange.max.y-s.y;this.options.tms&&(d.y=b),d["-y"]=b}return Ut(this._url,x(d,this.options))},_tileOnLoad:function(s,d){wt.ielt9?setTimeout(I(s,this,null,d),0):s(null,d)},_tileOnError:function(s,d,b){var C=this.options.errorTileUrl;C&&d.getAttribute("src")!==C&&(d.src=C),s(b,d)},_onTileRemove:function(s){s.tile.onload=null},_getZoomForUrl:function(){var s=this._tileZoom,d=this.options.maxZoom,b=this.options.zoomReverse,C=this.options.zoomOffset;return b&&(s=d-s),s+C},_getSubdomain:function(s){var d=Math.abs(s.x+s.y)%this.options.subdomains.length;return this.options.subdomains[d]},_abortLoading:function(){var s,d;for(s in this._tiles)if(this._tiles[s].coords.z!==this._tileZoom&&(d=this._tiles[s].el,d.onload=W,d.onerror=W,!d.complete)){d.src=de;var b=this._tiles[s].coords;mi(d),delete this._tiles[s],this.fire("tileabort",{tile:d,coords:b})}},_removeTile:function(s){var d=this._tiles[s];if(d)return d.el.setAttribute("src",de),ds.prototype._removeTile.call(this,s)},_tileReady:function(s,d,b){if(!(!this._map||b&&b.getAttribute("src")===de))return ds.prototype._tileReady.call(this,s,d,b)}});function ps(s,d){return new _o(s,d)}var Qr=_o.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(s,d){this._url=s;var b=x({},this.defaultWmsParams);for(var C in d)C in this.options||(b[C]=d[C]);d=Pt(this,d);var B=d.detectRetina&&wt.retina?2:1,j=this.getTileSize();b.width=j.x*B,b.height=j.y*B,this.wmsParams=b},onAdd:function(s){this._crs=this.options.crs||s.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var d=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[d]=this._crs.code,_o.prototype.onAdd.call(this,s)},getTileUrl:function(s){var d=this._tileCoordsToNwSe(s),b=this._crs,C=si(b.project(d[0]),b.project(d[1])),B=C.min,j=C.max,at=(this._wmsVersion>=1.3&&this._crs===Ya?[B.y,B.x,j.y,j.x]:[B.x,B.y,j.x,j.y]).join(","),Tt=_o.prototype.getTileUrl.call(this,s);return Tt+oe(this.wmsParams,Tt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+at},setParams:function(s,d){return x(this.wmsParams,s),d||this.redraw(),this}});function _e(s,d){return new Qr(s,d)}_o.WMS=Qr,ps.wms=_e;var br=cr.extend({options:{padding:.1},initialize:function(s){Pt(this,s),F(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Qe(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var s={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(s.zoomanim=this._onAnimZoom),s},_onAnimZoom:function(s){this._updateTransform(s.center,s.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(s,d){var b=this._map.getZoomScale(d,this._zoom),C=this._map.getSize().multiplyBy(.5+this.options.padding),B=this._map.project(this._center,d),j=C.multiplyBy(-b).add(B).subtract(this._map._getNewPixelOrigin(s,d));wt.any3d?co(this._container,j,b):un(this._container,j)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var s in this._layers)this._layers[s]._reset()},_onZoomEnd:function(){for(var s in this._layers)this._layers[s]._project()},_updatePaths:function(){for(var s in this._layers)this._layers[s]._update()},_update:function(){var s=this.options.padding,d=this._map.getSize(),b=this._map.containerPointToLayerPoint(d.multiplyBy(-s)).round();this._bounds=new Ue(b,b.add(d.multiplyBy(1+s*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),go=br.extend({options:{tolerance:0},getEvents:function(){var s=br.prototype.getEvents.call(this);return s.viewprereset=this._onViewPreReset,s},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){br.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var s=this._container=document.createElement("canvas");ri(s,"mousemove",this._onMouseMove,this),ri(s,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ri(s,"mouseout",this._handleMouseOut,this),s._leaflet_disable_events=!0,this._ctx=s.getContext("2d")},_destroyContainer:function(){fe(this._redrawRequest),delete this._ctx,mi(this._container),Gi(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var s;this._redrawBounds=null;for(var d in this._layers)s=this._layers[d],s._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){br.prototype._update.call(this);var s=this._bounds,d=this._container,b=s.getSize(),C=wt.retina?2:1;un(d,s.min),d.width=C*b.x,d.height=C*b.y,d.style.width=b.x+"px",d.style.height=b.y+"px",wt.retina&&this._ctx.scale(2,2),this._ctx.translate(-s.min.x,-s.min.y),this.fire("update")}},_reset:function(){br.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(s){this._updateDashArray(s),this._layers[F(s)]=s;var d=s._order={layer:s,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=d),this._drawLast=d,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(s){this._requestRedraw(s)},_removePath:function(s){var d=s._order,b=d.next,C=d.prev;b?b.prev=C:this._drawLast=C,C?C.next=b:this._drawFirst=b,delete s._order,delete this._layers[F(s)],this._requestRedraw(s)},_updatePath:function(s){this._extendRedrawBounds(s),s._project(),s._update(),this._requestRedraw(s)},_updateStyle:function(s){this._updateDashArray(s),this._requestRedraw(s)},_updateDashArray:function(s){if(typeof s.options.dashArray=="string"){var d=s.options.dashArray.split(/[, ]+/),b=[],C,B;for(B=0;B<d.length;B++){if(C=Number(d[B]),isNaN(C))return;b.push(C)}s.options._dashArray=b}else s.options._dashArray=s.options.dashArray},_requestRedraw:function(s){this._map&&(this._extendRedrawBounds(s),this._redrawRequest=this._redrawRequest||Qt(this._redraw,this))},_extendRedrawBounds:function(s){if(s._pxBounds){var d=(s.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Ue,this._redrawBounds.extend(s._pxBounds.min.subtract([d,d])),this._redrawBounds.extend(s._pxBounds.max.add([d,d]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var s=this._redrawBounds;if(s){var d=s.getSize();this._ctx.clearRect(s.min.x,s.min.y,d.x,d.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var s,d=this._redrawBounds;if(this._ctx.save(),d){var b=d.getSize();this._ctx.beginPath(),this._ctx.rect(d.min.x,d.min.y,b.x,b.y),this._ctx.clip()}this._drawing=!0;for(var C=this._drawFirst;C;C=C.next)s=C.layer,(!d||s._pxBounds&&s._pxBounds.intersects(d))&&s._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(s,d){if(this._drawing){var b,C,B,j,at=s._parts,Tt=at.length,Et=this._ctx;if(Tt){for(Et.beginPath(),b=0;b<Tt;b++){for(C=0,B=at[b].length;C<B;C++)j=at[b][C],Et[C?"lineTo":"moveTo"](j.x,j.y);d&&Et.closePath()}this._fillStroke(Et,s)}}},_updateCircle:function(s){if(!(!this._drawing||s._empty())){var d=s._point,b=this._ctx,C=Math.max(Math.round(s._radius),1),B=(Math.max(Math.round(s._radiusY),1)||C)/C;B!==1&&(b.save(),b.scale(1,B)),b.beginPath(),b.arc(d.x,d.y/B,C,0,Math.PI*2,!1),B!==1&&b.restore(),this._fillStroke(b,s)}},_fillStroke:function(s,d){var b=d.options;b.fill&&(s.globalAlpha=b.fillOpacity,s.fillStyle=b.fillColor||b.color,s.fill(b.fillRule||"evenodd")),b.stroke&&b.weight!==0&&(s.setLineDash&&s.setLineDash(d.options&&d.options._dashArray||[]),s.globalAlpha=b.opacity,s.lineWidth=b.weight,s.strokeStyle=b.color,s.lineCap=b.lineCap,s.lineJoin=b.lineJoin,s.stroke())},_onClick:function(s){for(var d=this._map.mouseEventToLayerPoint(s),b,C,B=this._drawFirst;B;B=B.next)b=B.layer,b.options.interactive&&b._containsPoint(d)&&(!(s.type==="click"||s.type==="preclick")||!this._map._draggableMoved(b))&&(C=b);this._fireEvent(C?[C]:!1,s)},_onMouseMove:function(s){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var d=this._map.mouseEventToLayerPoint(s);this._handleMouseHover(s,d)}},_handleMouseOut:function(s){var d=this._hoveredLayer;d&&(ni(this._container,"leaflet-interactive"),this._fireEvent([d],s,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(s,d){if(!this._mouseHoverThrottled){for(var b,C,B=this._drawFirst;B;B=B.next)b=B.layer,b.options.interactive&&b._containsPoint(d)&&(C=b);C!==this._hoveredLayer&&(this._handleMouseOut(s),C&&(Qe(this._container,"leaflet-interactive"),this._fireEvent([C],s,"mouseover"),this._hoveredLayer=C)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,s),this._mouseHoverThrottled=!0,setTimeout(I(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(s,d,b){this._map._fireDOMEvent(d,b||d.type,s)},_bringToFront:function(s){var d=s._order;if(d){var b=d.next,C=d.prev;if(b)b.prev=C;else return;C?C.next=b:b&&(this._drawFirst=b),d.prev=this._drawLast,this._drawLast.next=d,d.next=null,this._drawLast=d,this._requestRedraw(s)}},_bringToBack:function(s){var d=s._order;if(d){var b=d.next,C=d.prev;if(C)C.next=b;else return;b?b.prev=C:C&&(this._drawLast=C),d.prev=null,d.next=this._drawFirst,this._drawFirst.prev=d,this._drawFirst=d,this._requestRedraw(s)}}});function fs(s){return wt.canvas?new go(s):null}var Vs=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(s){return document.createElement("<lvml:"+s+' class="lvml">')}}catch{}return function(s){return document.createElement("<"+s+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),le={_initContainer:function(){this._container=ii("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(br.prototype._update.call(this),this.fire("update"))},_initPath:function(s){var d=s._container=Vs("shape");Qe(d,"leaflet-vml-shape "+(this.options.className||"")),d.coordsize="1 1",s._path=Vs("path"),d.appendChild(s._path),this._updateStyle(s),this._layers[F(s)]=s},_addPath:function(s){var d=s._container;this._container.appendChild(d),s.options.interactive&&s.addInteractiveTarget(d)},_removePath:function(s){var d=s._container;mi(d),s.removeInteractiveTarget(d),delete this._layers[F(s)]},_updateStyle:function(s){var d=s._stroke,b=s._fill,C=s.options,B=s._container;B.stroked=!!C.stroke,B.filled=!!C.fill,C.stroke?(d||(d=s._stroke=Vs("stroke")),B.appendChild(d),d.weight=C.weight+"px",d.color=C.color,d.opacity=C.opacity,C.dashArray?d.dashStyle=Zt(C.dashArray)?C.dashArray.join(" "):C.dashArray.replace(/( *, *)/g," "):d.dashStyle="",d.endcap=C.lineCap.replace("butt","flat"),d.joinstyle=C.lineJoin):d&&(B.removeChild(d),s._stroke=null),C.fill?(b||(b=s._fill=Vs("fill")),B.appendChild(b),b.color=C.fillColor||C.color,b.opacity=C.fillOpacity):b&&(B.removeChild(b),s._fill=null)},_updateCircle:function(s){var d=s._point.round(),b=Math.round(s._radius),C=Math.round(s._radiusY||b);this._setPath(s,s._empty()?"M0 0":"AL "+d.x+","+d.y+" "+b+","+C+" 0,"+65535*360)},_setPath:function(s,d){s._path.v=d},_bringToFront:function(s){Rr(s._container)},_bringToBack:function(s){Vi(s._container)}},$s=wt.vml?Vs:Mt,ms=br.extend({_initContainer:function(){this._container=$s("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=$s("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){mi(this._container),Gi(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){br.prototype._update.call(this);var s=this._bounds,d=s.getSize(),b=this._container;(!this._svgSize||!this._svgSize.equals(d))&&(this._svgSize=d,b.setAttribute("width",d.x),b.setAttribute("height",d.y)),un(b,s.min),b.setAttribute("viewBox",[s.min.x,s.min.y,d.x,d.y].join(" ")),this.fire("update")}},_initPath:function(s){var d=s._path=$s("path");s.options.className&&Qe(d,s.options.className),s.options.interactive&&Qe(d,"leaflet-interactive"),this._updateStyle(s),this._layers[F(s)]=s},_addPath:function(s){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(s._path),s.addInteractiveTarget(s._path)},_removePath:function(s){mi(s._path),s.removeInteractiveTarget(s._path),delete this._layers[F(s)]},_updatePath:function(s){s._project(),s._update()},_updateStyle:function(s){var d=s._path,b=s.options;d&&(b.stroke?(d.setAttribute("stroke",b.color),d.setAttribute("stroke-opacity",b.opacity),d.setAttribute("stroke-width",b.weight),d.setAttribute("stroke-linecap",b.lineCap),d.setAttribute("stroke-linejoin",b.lineJoin),b.dashArray?d.setAttribute("stroke-dasharray",b.dashArray):d.removeAttribute("stroke-dasharray"),b.dashOffset?d.setAttribute("stroke-dashoffset",b.dashOffset):d.removeAttribute("stroke-dashoffset")):d.setAttribute("stroke","none"),b.fill?(d.setAttribute("fill",b.fillColor||b.color),d.setAttribute("fill-opacity",b.fillOpacity),d.setAttribute("fill-rule",b.fillRule||"evenodd")):d.setAttribute("fill","none"))},_updatePoly:function(s,d){this._setPath(s,Vt(s._parts,d))},_updateCircle:function(s){var d=s._point,b=Math.max(Math.round(s._radius),1),C=Math.max(Math.round(s._radiusY),1)||b,B="a"+b+","+C+" 0 1,0 ",j=s._empty()?"M0 0":"M"+(d.x-b)+","+d.y+B+b*2+",0 "+B+-b*2+",0 ";this._setPath(s,j)},_setPath:function(s,d){s._path.setAttribute("d",d)},_bringToFront:function(s){Rr(s._path)},_bringToBack:function(s){Vi(s._path)}});wt.vml&&ms.include(le);function wc(s){return wt.svg||wt.vml?new ms(s):null}Ei.include({getRenderer:function(s){var d=s.options.renderer||this._getPaneRenderer(s.options.pane)||this.options.renderer||this._renderer;return d||(d=this._renderer=this._createRenderer()),this.hasLayer(d)||this.addLayer(d),d},_getPaneRenderer:function(s){if(s==="overlayPane"||s===void 0)return!1;var d=this._paneRenderers[s];return d===void 0&&(d=this._createRenderer({pane:s}),this._paneRenderers[s]=d),d},_createRenderer:function(s){return this.options.preferCanvas&&fs(s)||wc(s)}});var il=bn.extend({initialize:function(s,d){bn.prototype.initialize.call(this,this._boundsToLatLngs(s),d)},setBounds:function(s){return this.setLatLngs(this._boundsToLatLngs(s))},_boundsToLatLngs:function(s){return s=ui(s),[s.getSouthWest(),s.getNorthWest(),s.getNorthEast(),s.getSouthEast()]}});function Tc(s,d){return new il(s,d)}ms.create=$s,ms.pointsToPath=Vt,hr.geometryToLayer=ls,hr.coordsToLatLng=cs,hr.coordsToLatLngs=ho,hr.latLngToCoords=tl,hr.latLngsToCoords=ga,hr.getFeature=us,hr.asFeature=ya,Ei.mergeOptions({boxZoom:!0});var Rl=Kr.extend({initialize:function(s){this._map=s,this._container=s._container,this._pane=s._panes.overlayPane,this._resetStateTimeout=0,s.on("unload",this._destroy,this)},addHooks:function(){ri(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Gi(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){mi(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(s){if(!s.shiftKey||s.which!==1&&s.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),vr(),Pl(),this._startPoint=this._map.mouseEventToContainerPoint(s),ri(document,{contextmenu:tr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(s){this._moved||(this._moved=!0,this._box=ii("div","leaflet-zoom-box",this._container),Qe(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(s);var d=new Ue(this._point,this._startPoint),b=d.getSize();un(this._box,d.min),this._box.style.width=b.x+"px",this._box.style.height=b.y+"px"},_finish:function(){this._moved&&(mi(this._box),ni(this._container,"leaflet-crosshair")),es(),la(),Gi(document,{contextmenu:tr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(s){if(!(s.which!==1&&s.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(I(this._resetState,this),0);var d=new je(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(d).fire("boxzoomend",{boxZoomBounds:d})}},_onKeyDown:function(s){s.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ei.addInitHook("addHandler","boxZoom",Rl),Ei.mergeOptions({doubleClickZoom:!0});var Dl=Kr.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(s){var d=this._map,b=d.getZoom(),C=d.options.zoomDelta,B=s.originalEvent.shiftKey?b-C:b+C;d.options.doubleClickZoom==="center"?d.setZoom(B):d.setZoomAround(s.containerPoint,B)}});Ei.addInitHook("addHandler","doubleClickZoom",Dl),Ei.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Sc=Kr.extend({addHooks:function(){if(!this._draggable){var s=this._map;this._draggable=new Dr(s._mapPane,s._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),s.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),s.on("zoomend",this._onZoomEnd,this),s.whenReady(this._onZoomEnd,this))}Qe(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){ni(this._map._container,"leaflet-grab"),ni(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var s=this._map;if(s._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var d=ui(this._map.options.maxBounds);this._offsetLimit=si(this._map.latLngToContainerPoint(d.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(d.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;s.fire("movestart").fire("dragstart"),s.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(s){if(this._map.options.inertia){var d=this._lastTime=+new Date,b=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(b),this._times.push(d),this._prunePositions(d)}this._map.fire("move",s).fire("drag",s)},_prunePositions:function(s){for(;this._positions.length>1&&s-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var s=this._map.getSize().divideBy(2),d=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=d.subtract(s).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(s,d){return s-(s-d)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var s=this._draggable._newPos.subtract(this._draggable._startPos),d=this._offsetLimit;s.x<d.min.x&&(s.x=this._viscousLimit(s.x,d.min.x)),s.y<d.min.y&&(s.y=this._viscousLimit(s.y,d.min.y)),s.x>d.max.x&&(s.x=this._viscousLimit(s.x,d.max.x)),s.y>d.max.y&&(s.y=this._viscousLimit(s.y,d.max.y)),this._draggable._newPos=this._draggable._startPos.add(s)}},_onPreDragWrap:function(){var s=this._worldWidth,d=Math.round(s/2),b=this._initialWorldOffset,C=this._draggable._newPos.x,B=(C-d+b)%s+d-b,j=(C+d+b)%s-d-b,at=Math.abs(B+b)<Math.abs(j+b)?B:j;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=at},_onDragEnd:function(s){var d=this._map,b=d.options,C=!b.inertia||s.noInertia||this._times.length<2;if(d.fire("dragend",s),C)d.fire("moveend");else{this._prunePositions(+new Date);var B=this._lastPos.subtract(this._positions[0]),j=(this._lastTime-this._times[0])/1e3,at=b.easeLinearity,Tt=B.multiplyBy(at/j),Et=Tt.distanceTo([0,0]),$t=Math.min(b.inertiaMaxSpeed,Et),ye=Tt.multiplyBy($t/Et),He=$t/(b.inertiaDeceleration*at),yi=ye.multiplyBy(-He/2).round();!yi.x&&!yi.y?d.fire("moveend"):(yi=d._limitOffset(yi,d.options.maxBounds),Qt(function(){d.panBy(yi,{duration:He,easeLinearity:at,noMoveStart:!0,animate:!0})}))}}});Ei.addInitHook("addHandler","dragging",Sc),Ei.mergeOptions({keyboard:!0,keyboardPanDelta:80});var nl=Kr.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(s){this._map=s,this._setPanDelta(s.options.keyboardPanDelta),this._setZoomDelta(s.options.zoomDelta)},addHooks:function(){var s=this._map._container;s.tabIndex<=0&&(s.tabIndex="0"),ri(s,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Gi(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var s=document.body,d=document.documentElement,b=s.scrollTop||d.scrollTop,C=s.scrollLeft||d.scrollLeft;this._map._container.focus(),window.scrollTo(C,b)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(s){var d=this._panKeys={},b=this.keyCodes,C,B;for(C=0,B=b.left.length;C<B;C++)d[b.left[C]]=[-1*s,0];for(C=0,B=b.right.length;C<B;C++)d[b.right[C]]=[s,0];for(C=0,B=b.down.length;C<B;C++)d[b.down[C]]=[0,s];for(C=0,B=b.up.length;C<B;C++)d[b.up[C]]=[0,-1*s]},_setZoomDelta:function(s){var d=this._zoomKeys={},b=this.keyCodes,C,B;for(C=0,B=b.zoomIn.length;C<B;C++)d[b.zoomIn[C]]=s;for(C=0,B=b.zoomOut.length;C<B;C++)d[b.zoomOut[C]]=-s},_addHooks:function(){ri(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Gi(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(s){if(!(s.altKey||s.ctrlKey||s.metaKey)){var d=s.keyCode,b=this._map,C;if(d in this._panKeys){if(!b._panAnim||!b._panAnim._inProgress)if(C=this._panKeys[d],s.shiftKey&&(C=ze(C).multiplyBy(3)),b.options.maxBounds&&(C=b._limitOffset(ze(C),b.options.maxBounds)),b.options.worldCopyJump){var B=b.wrapLatLng(b.unproject(b.project(b.getCenter()).add(C)));b.panTo(B)}else b.panBy(C)}else if(d in this._zoomKeys)b.setZoom(b.getZoom()+(s.shiftKey?3:1)*this._zoomKeys[d]);else if(d===27&&b._popup&&b._popup.options.closeOnEscapeKey)b.closePopup();else return;tr(s)}}});Ei.addInitHook("addHandler","keyboard",nl),Ei.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var rl=Kr.extend({addHooks:function(){ri(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Gi(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(s){var d=er(s),b=this._map.options.wheelDebounceTime;this._delta+=d,this._lastMousePos=this._map.mouseEventToContainerPoint(s),this._startTime||(this._startTime=+new Date);var C=Math.max(b-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(I(this._performZoom,this),C),tr(s)},_performZoom:function(){var s=this._map,d=s.getZoom(),b=this._map.options.zoomSnap||0;s._stop();var C=this._delta/(this._map.options.wheelPxPerZoomLevel*4),B=4*Math.log(2/(1+Math.exp(-Math.abs(C))))/Math.LN2,j=b?Math.ceil(B/b)*b:B,at=s._limitZoom(d+(this._delta>0?j:-j))-d;this._delta=0,this._startTime=null,at&&(s.options.scrollWheelZoom==="center"?s.setZoom(d+at):s.setZoomAround(this._lastMousePos,d+at))}});Ei.addInitHook("addHandler","scrollWheelZoom",rl);var Bl=600;Ei.mergeOptions({tapHold:wt.touchNative&&wt.safari&&wt.mobile,tapTolerance:15});var ol=Kr.extend({addHooks:function(){ri(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Gi(this._map._container,"touchstart",this._onDown,this)},_onDown:function(s){if(clearTimeout(this._holdTimeout),s.touches.length===1){var d=s.touches[0];this._startPos=this._newPos=new Ht(d.clientX,d.clientY),this._holdTimeout=setTimeout(I(function(){this._cancel(),this._isTapValid()&&(ri(document,"touchend",dn),ri(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",d))},this),Bl),ri(document,"touchend touchcancel contextmenu",this._cancel,this),ri(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function s(){Gi(document,"touchend",dn),Gi(document,"touchend touchcancel",s)},_cancel:function(){clearTimeout(this._holdTimeout),Gi(document,"touchend touchcancel contextmenu",this._cancel,this),Gi(document,"touchmove",this._onMove,this)},_onMove:function(s){var d=s.touches[0];this._newPos=new Ht(d.clientX,d.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(s,d){var b=new MouseEvent(s,{bubbles:!0,cancelable:!0,view:window,screenX:d.screenX,screenY:d.screenY,clientX:d.clientX,clientY:d.clientY});b._simulated=!0,d.target.dispatchEvent(b)}});Ei.addInitHook("addHandler","tapHold",ol),Ei.mergeOptions({touchZoom:wt.touch,bounceAtZoomLimits:!0});var Gn=Kr.extend({addHooks:function(){Qe(this._map._container,"leaflet-touch-zoom"),ri(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ni(this._map._container,"leaflet-touch-zoom"),Gi(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(s){var d=this._map;if(!(!s.touches||s.touches.length!==2||d._animatingZoom||this._zooming)){var b=d.mouseEventToContainerPoint(s.touches[0]),C=d.mouseEventToContainerPoint(s.touches[1]);this._centerPoint=d.getSize()._divideBy(2),this._startLatLng=d.containerPointToLatLng(this._centerPoint),d.options.touchZoom!=="center"&&(this._pinchStartLatLng=d.containerPointToLatLng(b.add(C)._divideBy(2))),this._startDist=b.distanceTo(C),this._startZoom=d.getZoom(),this._moved=!1,this._zooming=!0,d._stop(),ri(document,"touchmove",this._onTouchMove,this),ri(document,"touchend touchcancel",this._onTouchEnd,this),dn(s)}},_onTouchMove:function(s){if(!(!s.touches||s.touches.length!==2||!this._zooming)){var d=this._map,b=d.mouseEventToContainerPoint(s.touches[0]),C=d.mouseEventToContainerPoint(s.touches[1]),B=b.distanceTo(C)/this._startDist;if(this._zoom=d.getScaleZoom(B,this._startZoom),!d.options.bounceAtZoomLimits&&(this._zoom<d.getMinZoom()&&B<1||this._zoom>d.getMaxZoom()&&B>1)&&(this._zoom=d._limitZoom(this._zoom)),d.options.touchZoom==="center"){if(this._center=this._startLatLng,B===1)return}else{var j=b._add(C)._divideBy(2)._subtract(this._centerPoint);if(B===1&&j.x===0&&j.y===0)return;this._center=d.unproject(d.project(this._pinchStartLatLng,this._zoom).subtract(j),this._zoom)}this._moved||(d._moveStart(!0,!1),this._moved=!0),fe(this._animRequest);var at=I(d._move,d,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Qt(at,this,!0),dn(s)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,fe(this._animRequest),Gi(document,"touchmove",this._onTouchMove,this),Gi(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ei.addInitHook("addHandler","touchZoom",Gn),Ei.BoxZoom=Rl,Ei.DoubleClickZoom=Dl,Ei.Drag=Sc,Ei.Keyboard=nl,Ei.ScrollWheelZoom=rl,Ei.TapHold=ol,Ei.TouchZoom=Gn,u.Bounds=Ue,u.Browser=wt,u.CRS=pn,u.Canvas=go,u.Circle=Ns,u.CircleMarker=Do,u.Class=Ae,u.Control=ir,u.DivIcon=Jr,u.DivOverlay=Or,u.DomEvent=Na,u.DomUtil=fc,u.Draggable=Dr,u.Evented=Me,u.FeatureGroup=ur,u.GeoJSON=hr,u.GridLayer=ds,u.Handler=Kr,u.Icon=Ro,u.ImageOverlay=Vn,u.LatLng=hi,u.LatLngBounds=je,u.Layer=cr,u.LayerGroup=Yr,u.LineUtil=pa,u.Map=Ei,u.Marker=Fs,u.Mixin=au,u.Path=uo,u.Point=Ht,u.PolyUtil=_c,u.Polygon=bn,u.Polyline=Ri,u.Popup=jn,u.PosAnimation=da,u.Projection=Ka,u.Rectangle=il,u.Renderer=br,u.SVG=ms,u.SVGOverlay=zl,u.TileLayer=_o,u.Tooltip=hs,u.Transformation=en,u.Util=ke,u.VideoOverlay=kl,u.bind=I,u.bounds=si,u.canvas=fs,u.circle=vc,u.circleMarker=Qa,u.control=rs,u.divIcon=hu,u.extend=x,u.featureGroup=cu,u.geoJSON=Br,u.geoJson=va,u.gridLayer=bc,u.icon=uu,u.imageOverlay=xa,u.latLng=Oe,u.latLngBounds=ui,u.layerGroup=ma,u.map=Cl,u.marker=yc,u.point=ze,u.polygon=Us,u.polyline=as,u.popup=fo,u.rectangle=Tc,u.setOptions=Pt,u.stamp=F,u.svg=wc,u.svgOverlay=po,u.tileLayer=ps,u.tooltip=mo,u.transformation=ei,u.version=m,u.videoOverlay=xc;var Oo=window.L;u.noConflict=function(){return window.L=Oo,this},window.L=u})})(kf,kf.exports);var wC=kf.exports;const li=ym(wC);var rx={exports:{}};(function(i,r){(function(u,m){i.exports=m()})(nx,function(){var u,m,x;function S(c,F){if(!u)u=F;else if(!m)m=F;else{var D="var sharedChunk = {}; ("+u+")(sharedChunk); ("+m+")(sharedChunk);",q={};u(q),x=F(q),typeof window<"u"&&(x.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}S(["exports"],function(c){function F(n,t,o,l){return new(o||(o=Promise))(function(p,g){function v(M){try{A(l.next(M))}catch(z){g(z)}}function w(M){try{A(l.throw(M))}catch(z){g(z)}}function A(M){var z;M.done?p(M.value):(z=M.value,z instanceof o?z:new o(function(N){N(z)})).then(v,w)}A((l=l.apply(n,t||[])).next())})}function D(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var q=W;function W(n,t){this.x=n,this.y=t}W.prototype={clone:function(){return new W(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,o=n.y-this.y;return t*t+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),o=Math.sin(n),l=o*this.x+t*this.y;return this.x=t*this.x-o*this.y,this.y=l,this},_rotateAround:function(n,t){var o=Math.cos(n),l=Math.sin(n),p=t.y+l*(this.x-t.x)+o*(this.y-t.y);return this.x=t.x+o*(this.x-t.x)-l*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},W.convert=function(n){return n instanceof W?n:Array.isArray(n)?new W(n[0],n[1]):n};var K=D(q),bt=zt;function zt(n,t,o,l){this.cx=3*n,this.bx=3*(o-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=o,this.p2y=l}zt.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var o=n,l=0;l<8;l++){var p=this.sampleCurveX(o)-n;if(Math.abs(p)<t)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var v=0,w=1;for(o=n,l=0;l<20&&(p=this.sampleCurveX(o),!(Math.abs(p-n)<t));l++)n>p?v=o:w=o,o=.5*(w-v)+v;return o},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Pt=D(bt);let oe,Jt;function Ut(){return oe==null&&(oe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),oe}function Zt(){if(Jt==null&&(Jt=!1,Ut())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const p=4*l;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const o=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&o[l]!==l){Jt=!0;break}}}return Jt||!1}function Le(n,t,o,l){const p=new Pt(n,t,o,l);return function(g){return p.solve(g)}}const de=Le(.25,.1,.25,1);function te(n,t,o){return Math.min(o,Math.max(t,n))}function Ce(n,t,o){const l=o-t,p=((n-t)%l+l)%l+t;return p===t?o:p}function pe(n,...t){for(const o of t)for(const l in o)n[l]=o[l];return n}let Fe=1;function ce(n,t,o){const l={};for(const p in n)l[p]=t.call(o||this,n[p],p,n);return l}function Qt(n,t,o){const l={};for(const p in n)t.call(o||this,n[p],p,n)&&(l[p]=n[p]);return l}function fe(n){return Array.isArray(n)?n.map(fe):typeof n=="object"&&n?ce(n,fe):n}const ke={};function Ae(n){ke[n]||(typeof console<"u"&&console.warn(n),ke[n]=!0)}function Ke(n,t,o){return(o.y-n.y)*(t.x-n.x)>(t.y-n.y)*(o.x-n.x)}function we(n){let t=0;for(let o,l,p=0,g=n.length,v=g-1;p<g;v=p++)o=n[p],l=n[v],t+=(l.x-o.x)*(o.y+l.y);return t}function Me(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ht=null;function fi(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ue(n,t,o,l,p){return F(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(n,{timestamp:0});try{const v=g==null?void 0:g.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const w=v.startsWith("BGR"),A=new Uint8ClampedArray(l*p*4);if(yield g.copyTo(A,function(M,z,N,V,G){const H=4*Math.max(-z,0),J=(Math.max(0,N)-N)*V*4+H,ot=4*V,ct=Math.max(0,z),yt=Math.max(0,N);return{rect:{x:ct,y:yt,width:Math.min(M.width,z+V)-ct,height:Math.min(M.height,N+G)-yt},layout:[{offset:J,stride:ot}]}}(n,t,o,l,p)),w)for(let M=0;M<A.length;M+=4){const z=A[M];A[M]=A[M+2],A[M+2]=z}return A}finally{g.close()}})}let si,je,ui,hi;const Oe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(n){const t=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(n,t=0){return this.getImageCanvasContext(n).getImageData(-t,-t,n.width+2*t,n.height+2*t)},getImageCanvasContext(n){const t=window.document.createElement("canvas"),o=t.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return t.width=n.width,t.height=n.height,o.drawImage(n,0,0,n.width,n.height),o},resolveURL:n=>(ui||(ui=document.createElement("a")),ui.href=n,ui.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(hi==null&&(hi=matchMedia("(prefers-reduced-motion: reduce)")),hi.matches)}},pn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class be extends Error{constructor(t,o,l,p){super(`AJAXError: ${o} (${t}): ${l}`),this.status=t,this.statusText=o,this.url=l,this.body=p}}const Ge=Me()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,ti=n=>pn.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))];function en(n,t){const o=new AbortController,l=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,cache:n.cache,referrer:Ge(),signal:o.signal});let p=!1,g=!1;return n.type==="json"&&l.headers.set("Accept","application/json"),g||fetch(l).then(v=>v.ok?(w=>{(n.type==="arrayBuffer"||n.type==="image"?w.arrayBuffer():n.type==="json"?w.json():w.text()).then(A=>{g||(p=!0,t(null,A,w.headers.get("Cache-Control"),w.headers.get("Expires")))}).catch(A=>{g||t(new Error(A.message))})})(v):v.blob().then(w=>t(new be(v.status,v.statusText,n.url,w)))).catch(v=>{v.code!==20&&t(new Error(v.message))}),{cancel:()=>{g=!0,p||o.abort()}}}const ei=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){if(Me()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t);if(!Me())return(ti(n.url)||en)(n,t)}if(!(/^file:/.test(o=n.url)||/^file:/.test(Ge())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return en(n,t);if(Me()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var o;return function(l,p){const g=new XMLHttpRequest;g.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(g.responseType="arraybuffer");for(const v in l.headers)g.setRequestHeader(v,l.headers[v]);return l.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=l.credentials==="include",g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let v=g.response;if(l.type==="json")try{v=JSON.parse(g.response)}catch(w){return p(w)}p(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else{const v=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});p(new be(g.status,g.statusText,l.url,v))}},g.send(l.body),{cancel:()=>g.abort()}}(n,t)},ut=function(n,t){return ei(pe(n,{type:"arrayBuffer"}),t)};function mt(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),o=window.location;return t.protocol===o.protocol&&t.host===o.host}function Mt(n,t,o){o[n]&&o[n].indexOf(t)!==-1||(o[n]=o[n]||[],o[n].push(t))}function Vt(n,t,o){if(o&&o[n]){const l=o[n].indexOf(t);l!==-1&&o[n].splice(l,1)}}class Bt{constructor(t,o={}){pe(this,o),this.type=t}}class Nt extends Bt{constructor(t,o={}){super("error",pe({error:t},o))}}class re{on(t,o){return this._listeners=this._listeners||{},Mt(t,o,this._listeners),this}off(t,o){return Vt(t,o,this._listeners),Vt(t,o,this._oneTimeListeners),this}once(t,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Mt(t,o,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,o){typeof t=="string"&&(t=new Bt(t,o||{}));const l=t.type;if(this.listens(l)){t.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of p)w.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of g)Vt(l,w,this._oneTimeListeners),w.call(this,t);const v=this._eventedParent;v&&(pe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof Nt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,o){return this._eventedParent=t,this._eventedParentData=o,this}}var dt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Yt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ft(n,t){const o={};for(const l in n)l!=="ref"&&(o[l]=n[l]);return Yt.forEach(l=>{l in t&&(o[l]=t[l])}),o}function Kt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let o=0;o<n.length;o++)if(!Kt(n[o],t[o]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const o in n)if(!Kt(n[o],t[o]))return!1;return!0}return n===t}const ie={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Te(n,t,o){o.push({command:ie.addSource,args:[n,t[n]]})}function $e(n,t,o){t.push({command:ie.removeSource,args:[n]}),o[n]=!0}function Xe(n,t,o,l){$e(n,o,l),Te(n,t,o)}function ki(n,t,o){let l;for(l in n[o])if(Object.prototype.hasOwnProperty.call(n[o],l)&&l!=="data"&&!Kt(n[o][l],t[o][l]))return!1;for(l in t[o])if(Object.prototype.hasOwnProperty.call(t[o],l)&&l!=="data"&&!Kt(n[o][l],t[o][l]))return!1;return!0}function Ti(n,t,o,l,p,g){let v;for(v in t=t||{},n=n||{})Object.prototype.hasOwnProperty.call(n,v)&&(Kt(n[v],t[v])||o.push({command:g,args:[l,v,t[v],p]}));for(v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(n,v)&&(Kt(n[v],t[v])||o.push({command:g,args:[l,v,t[v],p]}))}function ji(n){return n.id}function gn(n,t){return n[t.id]=t,n}class Wt{constructor(t,o,l,p){this.message=(t?`${t}: `:"")+l,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function Xn(n,...t){for(const o of t)for(const l in o)n[l]=o[l];return n}class zi extends Error{constructor(t,o){super(o),this.message=o,this.key=t}}class kr{constructor(t,o=[]){this.parent=t,this.bindings={};for(const[l,p]of o)this.bindings[l]=p}concat(t){return new kr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const cn={kind:"null"},jt={kind:"number"},Ye={kind:"string"},We={kind:"boolean"},Nn={kind:"color"},zr={kind:"object"},Je={kind:"value"},lo={kind:"collator"},et={kind:"formatted"},U={kind:"padding"},$={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function nt(n,t){return{kind:"array",itemType:n,N:t}}function rt(n){if(n.kind==="array"){const t=rt(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const vt=[cn,jt,Ye,We,Nn,et,zr,nt(Je),U,$,X];function pt(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!pt(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const o of vt)if(!pt(o,t))return null}}return`Expected ${rt(n)} but found ${rt(t)} instead.`}function lt(n,t){return t.some(o=>o.kind===n.kind)}function _t(n,t){return t.some(o=>o==="null"?n===null:o==="array"?Array.isArray(n):o==="object"?n&&!Array.isArray(n)&&typeof n=="object":o===typeof n)}function Lt(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const wt=.96422,Rt=.82521,Re=4/29,Ve=6/29,ve=3*Ve*Ve,De=Ve*Ve*Ve,qe=Math.PI/180,Si=180/Math.PI;function Fi(n){return(n%=360)<0&&(n+=360),n}function Ci([n,t,o,l]){let p,g;const v=Un((.2225045*(n=Pi(n))+.7168786*(t=Pi(t))+.0606169*(o=Pi(o)))/1);n===t&&t===o?p=g=v:(p=Un((.4360747*n+.3850649*t+.1430804*o)/wt),g=Un((.0139322*n+.0971045*t+.7141733*o)/Rt));const w=116*v-16;return[w<0?0:w,500*(p-v),200*(v-g),l]}function Pi(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Un(n){return n>De?Math.pow(n,1/3):n/ve+Re}function Hi([n,t,o,l]){let p=(n+16)/116,g=isNaN(t)?p:p+t/500,v=isNaN(o)?p:p-o/200;return p=1*En(p),g=wt*En(g),v=Rt*En(v),[fn(3.1338561*g-1.6168667*p-.4906146*v),fn(-.9787684*g+1.9161415*p+.033454*v),fn(.0719453*g-.2289914*p+1.4052427*v),l]}function fn(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function En(n){return n>Ve?n*n*n:ve*(n-Re)}function $n(n){return parseInt(n.padEnd(2,n),16)/255}function pc(n,t){return Cs(t?n/100:n,0,1)}function Cs(n,t,o){return Math.min(Math.max(t,n),o)}function Es(n){return!n.some(Number.isNaN)}const nu={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ni{constructor(t,o,l,p=1,g=!0){this.r=t,this.g=o,this.b=l,this.a=p,g||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,o,l,p]))}static parse(t){if(t instanceof Ni)return t;if(typeof t!="string")return;const o=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=nu[l];if(p){const[v,w,A]=p;return[v/255,w/255,A/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const v=l.length<6?1:2;let w=1;return[$n(l.slice(w,w+=v)),$n(l.slice(w,w+=v)),$n(l.slice(w,w+=v)),$n(l.slice(w,w+v)||"ff")]}if(l.startsWith("rgb")){const v=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,A,M,z,N,V,G,H,J,ot,ct,yt]=v,ht=[z||" ",G||" ",ot].join("");if(ht==="  "||ht==="  /"||ht===",,"||ht===",,,"){const xt=[M,V,J].join(""),At=xt==="%%%"?100:xt===""?255:0;if(At){const Dt=[Cs(+A/At,0,1),Cs(+N/At,0,1),Cs(+H/At,0,1),ct?pc(+ct,yt):1];if(Es(Dt))return Dt}}return}}const g=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[v,w,A,M,z,N,V,G,H]=g,J=[A||" ",z||" ",V].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const ot=[+w,Cs(+M,0,100),Cs(+N,0,100),G?pc(+G,H):1];if(Es(ot))return function([ct,yt,ht,xt]){function At(Dt){const he=(Dt+ct/30)%12,Pe=yt*Math.min(ht,1-ht);return ht-Pe*Math.max(-1,Math.min(he-3,9-he,1))}return ct=Fi(ct),yt/=100,ht/=100,[At(0),At(8),At(4),xt]}(ot)}}}(t);return o?new Ni(...o,!1):void 0}get rgb(){const{r:t,g:o,b:l,a:p}=this,g=p||1/0;return this.overwriteGetter("rgb",[t/g,o/g,l/g,p])}get hcl(){return this.overwriteGetter("hcl",function(t){const[o,l,p,g]=Ci(t),v=Math.sqrt(l*l+p*p);return[Math.round(1e4*v)?Fi(Math.atan2(p,l)*Si):NaN,v,o,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ci(this.rgb))}overwriteGetter(t,o){return Object.defineProperty(this,t,{value:o}),o}toString(){const[t,o,l,p]=this.rgb;return`rgba(${[t,o,l].map(g=>Math.round(255*g)).join(",")},${p})`}}Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1);class oa{constructor(t,o,l){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,o){return this.collator.compare(t,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Eo{constructor(t,o,l,p,g){this.text=t,this.image=o,this.scale=l,this.fontStack=p,this.textColor=g}}class Ln{constructor(t){this.sections=t}static fromString(t){return new Ln([new Eo(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Ln?t:Ln.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Yn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Yn)return t;if(typeof t=="number")return new Yn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const o of t)if(typeof o!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Yn(t)}}toString(){return JSON.stringify(this.values)}}const sa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ii{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ii)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let o=0;o<t.length;o+=2){const l=t[o],p=t[o+1];if(typeof l!="string"||!sa.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new ii(t)}}toString(){return JSON.stringify(this.values)}}class mi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new mi({name:t,available:!1}):null}}function ts(n,t,o,l){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[n,t,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[n,t,o,l]:[n,t,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Ni||n instanceof oa||n instanceof Ln||n instanceof Yn||n instanceof ii||n instanceof mi)return!0;if(Array.isArray(n)){for(const t of n)if(!Rr(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Rr(n[t]))return!1;return!0}return!1}function Vi(n){if(n===null)return cn;if(typeof n=="string")return Ye;if(typeof n=="boolean")return We;if(typeof n=="number")return jt;if(n instanceof Ni)return Nn;if(n instanceof oa)return lo;if(n instanceof Ln)return et;if(n instanceof Yn)return U;if(n instanceof ii)return X;if(n instanceof mi)return $;if(Array.isArray(n)){const t=n.length;let o;for(const l of n){const p=Vi(l);if(o){if(o===p)continue;o=Je;break}o=p}return nt(o||Je,t)}return zr}function Mi(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Ni||n instanceof Ln||n instanceof Yn||n instanceof ii||n instanceof mi?n.toString():JSON.stringify(n)}class Qe{constructor(t,o){this.type=t,this.value=o}static parse(t,o){if(t.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Rr(t[1]))return o.error("invalid value");const l=t[1];let p=Vi(l);const g=o.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new Qe(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ni{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ls={string:Ye,number:jt,boolean:We,object:zr};class Zn{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let l,p=1;const g=t[0];if(g==="array"){let w,A;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in Ls)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);w=Ls[M],p++}else w=Je;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);A=t[2],p++}l=nt(w,A)}else{if(!Ls[g])throw new Error(`Types doesn't contain name = ${g}`);l=Ls[g]}const v=[];for(;p<t.length;p++){const w=o.parse(t[p],p,Je);if(!w)return null;v.push(w)}return new Zn(l,v)}evaluate(t){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(t);if(!pt(this.type,Vi(l)))return l;if(o===this.args.length-1)throw new ni(`Expected value to be of type ${rt(this.type)}, but found ${rt(Vi(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Jn={"to-boolean":We,"to-color":Nn,"to-number":jt,"to-string":Ye};class Lo{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const l=t[0];if(!Jn[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return o.error("Expected one argument.");const p=Jn[l],g=[];for(let v=1;v<t.length;v++){const w=o.parse(t[v],v,Je);if(!w)return null;g.push(w)}return new Lo(p,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let o,l;for(const p of this.args){if(o=p.evaluate(t),l=null,o instanceof Ni)return o;if(typeof o=="string"){const g=t.parseColor(o);if(g)return g}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:ts(o[0],o[1],o[2],o[3]),!l))return new Ni(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ni(l||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const l of this.args){o=l.evaluate(t);const p=Yn.parse(o);if(p)return p}throw new ni(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const l of this.args){o=l.evaluate(t);const p=ii.parse(o);if(p)return p}throw new ni(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const l of this.args){if(o=l.evaluate(t),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new ni(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return Ln.fromString(Mi(this.args[0].evaluate(t)));case"resolvedImage":return mi.fromString(Mi(this.args[0].evaluate(t)));default:return Mi(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const aa=["Unknown","Point","LineString","Polygon"];class co{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?aa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Ni.parse(t)),o}}class un{constructor(t,o,l=[],p,g=new kr,v=[]){this.registry=t,this.path=l,this.key=l.map(w=>`[${w}]`).join(""),this.scope=g,this.errors=v,this.expectedType=p,this._isConstant=o}parse(t,o,l,p,g={}){return o?this.concat(o,l,p)._parse(t,g):this._parse(t,g)}_parse(t,o){function l(p,g,v){return v==="assert"?new Zn(g,[p]):v==="coerce"?new Lo(g,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let v=g.parse(t,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,A=v.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||A.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string")if(w.kind!=="padding"||A.kind!=="value"&&A.kind!=="number"&&A.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||A.kind!=="value"&&A.kind!=="array"){if(this.checkSubtype(w,A))return null}else v=l(v,w,o.typeAnnotation||"coerce");else v=l(v,w,o.typeAnnotation||"coerce");else v=l(v,w,o.typeAnnotation||"coerce");else v=l(v,w,o.typeAnnotation||"assert")}if(!(v instanceof Qe)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const w=new co;try{v=new Qe(v.type,v.evaluate(w))}catch(A){return this.error(A.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,o,l){const p=typeof t=="number"?this.path.concat(t):this.path,g=l?this.scope.concat(l):this.scope;return new un(this.registry,this._isConstant,p,o||null,g,this.errors)}error(t,...o){const l=`${this.key}${o.map(p=>`[${p}]`).join("")}`;this.errors.push(new zi(l,t))}checkSubtype(t,o){const l=pt(t,o);return l&&this.error(l),l}}class Hr{constructor(t,o,l){this.type=lo,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=o}static parse(t,o){if(t.length!==2)return o.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return o.error("Collator options argument must be an object.");const p=o.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,We);if(!p)return null;const g=o.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,We);if(!g)return null;let v=null;return l.locale&&(v=o.parse(l.locale,1,Ye),!v)?null:new Hr(p,g,v)}evaluate(t){return new oa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const vr=8192;function es(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function is(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Ms(n,t){const o=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(o*p*vr),Math.round(l*p*vr)]}function Pl(n,t,o){const l=n[0]-t[0],p=n[1]-t[1],g=n[0]-o[0],v=n[1]-o[1];return l*v-g*p==0&&l*g<=0&&p*v<=0}function la(n,t){let o=!1;for(let v=0,w=t.length;v<w;v++){const A=t[v];for(let M=0,z=A.length;M<z-1;M++){if(Pl(n,A[M],A[M+1]))return!1;(p=A[M])[1]>(l=n)[1]!=(g=A[M+1])[1]>l[1]&&l[0]<(g[0]-p[0])*(l[1]-p[1])/(g[1]-p[1])+p[0]&&(o=!o)}}var l,p,g;return o}function ks(n,t){for(let o=0;o<t.length;o++)if(la(n,t[o]))return!0;return!1}function Fa(n,t,o,l){const p=l[0]-o[0],g=l[1]-o[1],v=(n[0]-o[0])*g-p*(n[1]-o[1]),w=(t[0]-o[0])*g-p*(t[1]-o[1]);return v>0&&w<0||v<0&&w>0}function Al(n,t,o){for(const M of o)for(let z=0;z<M.length-1;++z)if((w=[(v=M[z+1])[0]-(g=M[z])[0],v[1]-g[1]])[0]*(A=[(p=t)[0]-(l=n)[0],p[1]-l[1]])[1]-w[1]*A[0]!=0&&Fa(l,p,g,v)&&Fa(g,v,l,p))return!0;var l,p,g,v,w,A;return!1}function ca(n,t){for(let o=0;o<n.length;++o)if(!la(n[o],t))return!1;for(let o=0;o<n.length-1;++o)if(Al(n[o],n[o+1],t))return!1;return!0}function Il(n,t){for(let o=0;o<t.length;o++)if(ca(n,t[o]))return!0;return!1}function zs(n,t,o){const l=[];for(let p=0;p<n.length;p++){const g=[];for(let v=0;v<n[p].length;v++){const w=Ms(n[p][v],o);es(t,w),g.push(w)}l.push(g)}return l}function fc(n,t,o){const l=[];for(let p=0;p<n.length;p++){const g=zs(n[p],t,o);l.push(g)}return l}function ri(n,t,o,l){if(n[0]<o[0]||n[0]>o[2]){const p=.5*l;let g=n[0]-o[0]>p?-l:o[0]-n[0]>p?l:0;g===0&&(g=n[0]-o[2]>p?-l:o[2]-n[0]>p?l:0),n[0]+=g}es(t,n)}function xr(n,t,o,l){const p=Math.pow(2,l.z)*vr,g=[l.x*vr,l.y*vr],v=[];for(const w of n)for(const A of w){const M=[A.x+g[0],A.y+g[1]];ri(M,t,o,p),v.push(M)}return v}function Gi(n,t,o,l){const p=Math.pow(2,l.z)*vr,g=[l.x*vr,l.y*vr],v=[];for(const A of n){const M=[];for(const z of A){const N=[z.x+g[0],z.y+g[1]];es(t,N),M.push(N)}v.push(M)}if(t[2]-t[0]<=p/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const A of v)for(const M of A)ri(M,t,o,p)}var w;return v}class Mo{constructor(t,o){this.type=We,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Rr(t[1])){const l=t[1];if(l.type==="FeatureCollection")for(let p=0;p<l.features.length;++p){const g=l.features[p].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Mo(l,l.features[p].geometry)}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Mo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Mo(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,l){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=o.canonicalID();if(l.type==="Polygon"){const w=zs(l.coordinates,g,v),A=xr(o.geometry(),p,g,v);if(!is(p,g))return!1;for(const M of A)if(!la(M,w))return!1}if(l.type==="MultiPolygon"){const w=fc(l.coordinates,g,v),A=xr(o.geometry(),p,g,v);if(!is(p,g))return!1;for(const M of A)if(!ks(M,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,l){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=o.canonicalID();if(l.type==="Polygon"){const w=zs(l.coordinates,g,v),A=Gi(o.geometry(),p,g,v);if(!is(p,g))return!1;for(const M of A)if(!ca(M,w))return!1}if(l.type==="MultiPolygon"){const w=fc(l.coordinates,g,v),A=Gi(o.geometry(),p,g,v);if(!is(p,g))return!1;for(const M of A)if(!Il(M,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Rs{constructor(t,o){this.type=o.type,this.name=t,this.boundExpression=o}static parse(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const l=t[1];return o.scope.has(l)?new Rs(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Qn{constructor(t,o,l,p){this.name=t,this.type=o,this._evaluate=l,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,o){const l=t[0],p=Qn.definitions[l];if(!p)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=v.filter(([M])=>!Array.isArray(M)||M.length===t.length-1);let A=null;for(const[M,z]of w){A=new un(o.registry,Ds,o.path,null,o.scope);const N=[];let V=!1;for(let G=1;G<t.length;G++){const H=t[G],J=Array.isArray(M)?M[G-1]:M.type,ot=A.parse(H,1+N.length,J);if(!ot){V=!0;break}N.push(ot)}if(!V)if(Array.isArray(M)&&M.length!==N.length)A.error(`Expected ${M.length} arguments, but found ${N.length} instead.`);else{for(let G=0;G<N.length;G++){const H=Array.isArray(M)?M[G]:M.type,J=N[G];A.concat(G+1).checkSubtype(H,J.type)}if(A.errors.length===0)return new Qn(l,g,z,N)}}if(w.length===1)o.errors.push(...A.errors);else{const M=(w.length?w:v).map(([N])=>{return V=N,Array.isArray(V)?`(${V.map(rt).join(", ")})`:`(${rt(V.type)}...)`;var V}).join(" | "),z=[];for(let N=1;N<t.length;N++){const V=o.parse(t[N],1+z.length);if(!V)return null;z.push(rt(V.type))}o.error(`Expected arguments of type ${M}, but found (${z.join(", ")}) instead.`)}return null}static register(t,o){Qn.definitions=o;for(const l in o)t[l]=Qn}}function Ds(n){if(n instanceof Rs)return Ds(n.boundExpression);if(n instanceof Qn&&n.name==="error"||n instanceof Hr||n instanceof Mo)return!1;const t=n instanceof Lo||n instanceof Zn;let o=!0;return n.eachChild(l=>{o=t?o&&Ds(l):o&&l instanceof Qe}),!!o&&Wr(n)&&ko(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Wr(n){if(n instanceof Qn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Mo)return!1;let t=!0;return n.eachChild(o=>{t&&!Wr(o)&&(t=!1)}),t}function ns(n){if(n instanceof Qn&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(o=>{t&&!ns(o)&&(t=!1)}),t}function ko(n,t){if(n instanceof Qn&&t.indexOf(n.name)>=0)return!1;let o=!0;return n.eachChild(l=>{o&&!ko(l,t)&&(o=!1)}),o}function dn(n,t){const o=n.length-1;let l,p,g=0,v=o,w=0;for(;g<=v;)if(w=Math.floor((g+v)/2),l=n[w],p=n[w+1],l<=t){if(w===o||t<p)return w;g=w+1}else{if(!(l>t))throw new ni("Input is not a number.");v=w-1}return 0}class tr{constructor(t,o,l){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(const[p,g]of l)this.labels.push(p),this.outputs.push(g)}static parse(t,o){if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(t[1],1,jt);if(!l)return null;const p=[];let g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(let v=1;v<t.length;v+=2){const w=v===1?-1/0:t[v],A=t[v+1],M=v,z=v+1;if(typeof w!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=w)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const N=o.parse(A,z,g);if(!N)return null;g=g||N.type,p.push([w,N])}return new tr(g,l,p)}evaluate(t){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=o[0])return l[0].evaluate(t);const g=o.length;return p>=o[g-1]?l[g-1].evaluate(t):l[dn(o,p)].evaluate(t)}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function _i(n,t,o){return n+o*(t-n)}function ua(n,t,o){return n.map((l,p)=>_i(l,t[p],o))}const lr={number:_i,color:function(n,t,o,l="rgb"){switch(l){case"rgb":{const[p,g,v,w]=ua(n.rgb,t.rgb,o);return new Ni(p,g,v,w,!1)}case"hcl":{const[p,g,v,w]=n.hcl,[A,M,z,N]=t.hcl;let V,G;if(isNaN(p)||isNaN(A))isNaN(p)?isNaN(A)?V=NaN:(V=A,v!==1&&v!==0||(G=M)):(V=p,z!==1&&z!==0||(G=g));else{let yt=A-p;A>p&&yt>180?yt-=360:A<p&&p-A>180&&(yt+=360),V=p+o*yt}const[H,J,ot,ct]=function([yt,ht,xt,At]){return yt=isNaN(yt)?0:yt*qe,Hi([xt,Math.cos(yt)*ht,Math.sin(yt)*ht,At])}([V,G??_i(g,M,o),_i(v,z,o),_i(w,N,o)]);return new Ni(H,J,ot,ct,!1)}case"lab":{const[p,g,v,w]=Hi(ua(n.lab,t.lab,o));return new Ni(p,g,v,w,!1)}}},array:ua,padding:function(n,t,o){return new Yn(ua(n.values,t.values,o))},variableAnchorOffsetCollection:function(n,t,o){const l=n.values,p=t.values;if(l.length!==p.length)throw new ni(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const g=[];for(let v=0;v<l.length;v+=2){if(l[v]!==p[v])throw new ni(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${l[v]}, to[${v}]: ${p[v]}`);g.push(l[v]);const[w,A]=l[v+1],[M,z]=p[v+1];g.push([_i(w,M,o),_i(A,z,o)])}return new ii(g)}};class er{constructor(t,o,l,p,g){this.type=t,this.operator=o,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[v,w]of g)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(t,o,l,p){let g=0;if(t.name==="exponential")g=ha(o,t.base,l,p);else if(t.name==="linear")g=ha(o,1,l,p);else if(t.name==="cubic-bezier"){const v=t.controlPoints;g=new Pt(v[0],v[1],v[2],v[3]).solve(ha(o,1,l,p))}return g}static parse(t,o){let[l,p,g,...v]=t;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const M=p[1];if(typeof M!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(M.length!==4||M.some(z=>typeof z!="number"||z<0||z>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(g=o.parse(g,2,jt),!g)return null;const w=[];let A=null;l==="interpolate-hcl"||l==="interpolate-lab"?A=Nn:o.expectedType&&o.expectedType.kind!=="value"&&(A=o.expectedType);for(let M=0;M<v.length;M+=2){const z=v[M],N=v[M+1],V=M+3,G=M+4;if(typeof z!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(w.length&&w[w.length-1][0]>=z)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const H=o.parse(N,G,A);if(!H)return null;A=A||H.type,w.push([z,H])}return Lt(A,jt)||Lt(A,Nn)||Lt(A,U)||Lt(A,X)||Lt(A,nt(jt))?new er(A,l,p,g,w):o.error(`Type ${rt(A)} is not interpolatable.`)}evaluate(t){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=o[0])return l[0].evaluate(t);const g=o.length;if(p>=o[g-1])return l[g-1].evaluate(t);const v=dn(o,p),w=er.interpolationFactor(this.interpolation,p,o[v],o[v+1]),A=l[v].evaluate(t),M=l[v+1].evaluate(t);switch(this.operator){case"interpolate":return lr[this.type.kind](A,M,w);case"interpolate-hcl":return lr.color(A,M,w,"hcl");case"interpolate-lab":return lr.color(A,M,w,"lab")}}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ha(n,t,o,l){const p=l-o,g=n-o;return p===0?0:t===1?g/p:(Math.pow(t,g)-1)/(Math.pow(t,p)-1)}class Na{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expectected at least one argument.");let l=null;const p=o.expectedType;p&&p.kind!=="value"&&(l=p);const g=[];for(const w of t.slice(1)){const A=o.parse(w,1+g.length,l,void 0,{typeAnnotation:"omit"});if(!A)return null;l=l||A.type,g.push(A)}if(!l)throw new Error("No output type");const v=p&&g.some(w=>pt(p,w.type));return new Na(v?Je:l,g)}evaluate(t){let o,l=null,p=0;for(const g of this.args)if(p++,l=g.evaluate(t),l&&l instanceof mi&&!l.available&&(o||(o=l.name),l=null,p===this.args.length&&(l=o)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class da{constructor(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const o of this.bindings)t(o[1]);t(this.result)}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let g=1;g<t.length-1;g+=2){const v=t[g];if(typeof v!="string")return o.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return o.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=o.parse(t[g+1],g+1);if(!w)return null;l.push([v,w])}const p=o.parse(t[t.length-1],t.length-1,o.expectedType,l);return p?new da(l,p):null}outputDefined(){return this.result.outputDefined()}}class Ei{constructor(t,o,l){this.type=t,this.index=o,this.input=l}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,jt),p=o.parse(t[2],2,nt(o.expectedType||Je));return l&&p?new Ei(p.type.itemType,l,p):null}evaluate(t){const o=this.index.evaluate(t),l=this.input.evaluate(t);if(o<0)throw new ni(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new ni(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new ni(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Cl{constructor(t,o){this.type=We,this.needle=t,this.haystack=o}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,Je),p=o.parse(t[2],2,Je);return l&&p?lt(l.type,[We,Ye,jt,cn,Je])?new Cl(l,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${rt(l.type)} instead`):null}evaluate(t){const o=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!_t(o,["boolean","string","number","null"]))throw new ni(`Expected first argument to be of type boolean, string, number or null, but found ${rt(Vi(o))} instead.`);if(!_t(l,["string","array"]))throw new ni(`Expected second argument to be of type array or string, but found ${rt(Vi(l))} instead.`);return l.indexOf(o)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ir{constructor(t,o,l){this.type=jt,this.needle=t,this.haystack=o,this.fromIndex=l}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,Je),p=o.parse(t[2],2,Je);if(!l||!p)return null;if(!lt(l.type,[We,Ye,jt,cn,Je]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${rt(l.type)} instead`);if(t.length===4){const g=o.parse(t[3],3,jt);return g?new ir(l,p,g):null}return new ir(l,p)}evaluate(t){const o=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!_t(o,["boolean","string","number","null"]))throw new ni(`Expected first argument to be of type boolean, string, number or null, but found ${rt(Vi(o))} instead.`);if(!_t(l,["string","array"]))throw new ni(`Expected second argument to be of type array or string, but found ${rt(Vi(l))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return l.indexOf(o,p)}return l.indexOf(o)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class rs{constructor(t,o,l,p,g,v){this.inputType=t,this.type=o,this.input=l,this.cases=p,this.outputs=g,this.otherwise=v}static parse(t,o){if(t.length<5)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return o.error("Expected an even number of arguments.");let l,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const g={},v=[];for(let M=2;M<t.length-1;M+=2){let z=t[M];const N=t[M+1];Array.isArray(z)||(z=[z]);const V=o.concat(M);if(z.length===0)return V.error("Expected at least one branch label.");for(const H of z){if(typeof H!="number"&&typeof H!="string")return V.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return V.error("Numeric branch labels must be integer values.");if(l){if(V.checkSubtype(l,Vi(H)))return null}else l=Vi(H);if(g[String(H)]!==void 0)return V.error("Branch labels must be unique.");g[String(H)]=v.length}const G=o.parse(N,M,p);if(!G)return null;p=p||G.type,v.push(G)}const w=o.parse(t[1],1,Je);if(!w)return null;const A=o.parse(t[t.length-1],t.length-1,p);return A?w.type.kind!=="value"&&o.concat(1).checkSubtype(l,w.type)?null:new rs(l,p,w,g,v,A):null}evaluate(t){const o=this.input.evaluate(t);return(Vi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ua{constructor(t,o,l){this.type=t,this.branches=o,this.otherwise=l}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&o.expectedType.kind!=="value"&&(l=o.expectedType);const p=[];for(let v=1;v<t.length-1;v+=2){const w=o.parse(t[v],v,We);if(!w)return null;const A=o.parse(t[v+1],v+1,l);if(!A)return null;p.push([w,A]),l=l||A.type}const g=o.parse(t[t.length-1],t.length-1,l);if(!g)return null;if(!l)throw new Error("Can't infer output type");return new Ua(l,p,g)}evaluate(t){for(const[o,l]of this.branches)if(o.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[o,l]of this.branches)t(o),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class Va{constructor(t,o,l,p){this.type=t,this.input=o,this.beginIndex=l,this.endIndex=p}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,Je),p=o.parse(t[2],2,jt);if(!l||!p)return null;if(!lt(l.type,[nt(Je),Ye,Je]))return o.error(`Expected first argument to be of type array or string, but found ${rt(l.type)} instead`);if(t.length===4){const g=o.parse(t[3],3,jt);return g?new Va(l.type,l,p,g):null}return new Va(l.type,l,p)}evaluate(t){const o=this.input.evaluate(t),l=this.beginIndex.evaluate(t);if(!_t(o,["string","array"]))throw new ni(`Expected first argument to be of type array or string, but found ${rt(Vi(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return o.slice(l,p)}return o.slice(l)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function $a(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function mc(n,t,o,l){return l.compare(t,o)===0}function os(n,t,o){const l=n!=="=="&&n!=="!=";return class ox{constructor(g,v,w){this.type=We,this.lhs=g,this.rhs=v,this.collator=w,this.hasUntypedArgument=g.type.kind==="value"||v.type.kind==="value"}static parse(g,v){if(g.length!==3&&g.length!==4)return v.error("Expected two or three arguments.");const w=g[0];let A=v.parse(g[1],1,Je);if(!A)return null;if(!$a(w,A.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${rt(A.type)}'.`);let M=v.parse(g[2],2,Je);if(!M)return null;if(!$a(w,M.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${rt(M.type)}'.`);if(A.type.kind!==M.type.kind&&A.type.kind!=="value"&&M.type.kind!=="value")return v.error(`Cannot compare types '${rt(A.type)}' and '${rt(M.type)}'.`);l&&(A.type.kind==="value"&&M.type.kind!=="value"?A=new Zn(M.type,[A]):A.type.kind!=="value"&&M.type.kind==="value"&&(M=new Zn(A.type,[M])));let z=null;if(g.length===4){if(A.type.kind!=="string"&&M.type.kind!=="string"&&A.type.kind!=="value"&&M.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(z=v.parse(g[3],3,lo),!z)return null}return new ox(A,M,z)}evaluate(g){const v=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(l&&this.hasUntypedArgument){const A=Vi(v),M=Vi(w);if(A.kind!==M.kind||A.kind!=="string"&&A.kind!=="number")throw new ni(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${A.kind}, ${M.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const A=Vi(v),M=Vi(w);if(A.kind!=="string"||M.kind!=="string")return t(g,v,w)}return this.collator?o(g,v,w,this.collator.evaluate(g)):t(g,v,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const ru=os("==",function(n,t,o){return t===o},mc),ou=os("!=",function(n,t,o){return t!==o},function(n,t,o,l){return!mc(0,t,o,l)}),El=os("<",function(n,t,o){return t<o},function(n,t,o,l){return l.compare(t,o)<0}),su=os(">",function(n,t,o){return t>o},function(n,t,o,l){return l.compare(t,o)>0}),Kr=os("<=",function(n,t,o){return t<=o},function(n,t,o,l){return l.compare(t,o)<=0}),au=os(">=",function(n,t,o){return t>=o},function(n,t,o,l){return l.compare(t,o)>=0});class Za{constructor(t,o,l,p,g){this.type=Ye,this.number=t,this.locale=o,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(t,o){if(t.length!==3)return o.error("Expected two arguments.");const l=o.parse(t[1],1,jt);if(!l)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=o.parse(p.locale,1,Ye),!g))return null;let v=null;if(p.currency&&(v=o.parse(p.currency,1,Ye),!v))return null;let w=null;if(p["min-fraction-digits"]&&(w=o.parse(p["min-fraction-digits"],1,jt),!w))return null;let A=null;return p["max-fraction-digits"]&&(A=o.parse(p["max-fraction-digits"],1,jt),!A)?null:new Za(l,g,v,w,A)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Dr{constructor(t){this.type=et,this.sections=t}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return o.error("First argument must be an image or text section.");const p=[];let g=!1;for(let v=1;v<=t.length-1;++v){const w=t[v];if(g&&typeof w=="object"&&!Array.isArray(w)){g=!1;let A=null;if(w["font-scale"]&&(A=o.parse(w["font-scale"],1,jt),!A))return null;let M=null;if(w["text-font"]&&(M=o.parse(w["text-font"],1,nt(Ye)),!M))return null;let z=null;if(w["text-color"]&&(z=o.parse(w["text-color"],1,Nn),!z))return null;const N=p[p.length-1];N.scale=A,N.font=M,N.textColor=z}else{const A=o.parse(t[v],1,Je);if(!A)return null;const M=A.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:A,scale:null,font:null,textColor:null})}}return new Dr(p)}evaluate(t){return new Ln(this.sections.map(o=>{const l=o.content.evaluate(t);return Vi(l)===$?new Eo("",l,null,null,null):new Eo(Mi(l),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))}eachChild(t){for(const o of this.sections)t(o.content),o.scale&&t(o.scale),o.font&&t(o.font),o.textColor&&t(o.textColor)}outputDefined(){return!1}}class ja{constructor(t){this.type=$,this.input=t}static parse(t,o){if(t.length!==2)return o.error("Expected two arguments.");const l=o.parse(t[1],1,Ye);return l?new ja(l):o.error("No image name provided.")}evaluate(t){const o=this.input.evaluate(t),l=mi.fromString(o);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(o)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ga{constructor(t){this.type=jt,this.input=t}static parse(t,o){if(t.length!==2)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=o.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${rt(l.type)} instead.`):new Ga(l):null}evaluate(t){const o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ni(`Expected value to be of type string or array, but found ${rt(Vi(o))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const zo={"==":ru,"!=":ou,">":su,"<":El,">=":au,"<=":Kr,array:Zn,at:Ei,boolean:Zn,case:Ua,coalesce:Na,collator:Hr,format:Dr,image:ja,in:Cl,"index-of":ir,interpolate:er,"interpolate-hcl":er,"interpolate-lab":er,length:Ga,let:da,literal:Qe,match:rs,number:Zn,"number-format":Za,object:Zn,slice:Va,step:tr,string:Zn,"to-boolean":Lo,"to-color":Lo,"to-number":Lo,"to-string":Lo,var:Rs,within:Mo};function _c(n,[t,o,l,p]){t=t.evaluate(n),o=o.evaluate(n),l=l.evaluate(n);const g=p?p.evaluate(n):1,v=ts(t,o,l,g);if(v)throw new ni(v);return new Ni(t/255,o/255,l/255,g,!1)}function Ll(n,t){return n in t}function qa(n,t){const o=t[n];return o===void 0?null:o}function ss(n){return{type:n}}function gc(n){return{result:"success",value:n}}function Xr(n){return{result:"error",value:n}}function Bs(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Ml(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ha(n){return!!n.expression&&n.expression.interpolated}function Li(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Ui(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function lu(n){return n}function ai(n,t){const o=t.type==="color",l=n.stops&&typeof n.stops[0][0]=="object",p=l||!(l||n.property!==void 0),g=n.type||(Ha(t)?"exponential":"interval");if(o||t.type==="padding"){const z=o?Ni.parse:Yn.parse;(n=Xn({},n)).stops&&(n.stops=n.stops.map(N=>[N[0],z(N[1])])),n.default=z(n.default?n.default:t.default)}if(n.colorSpace&&(v=n.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var v;let w,A,M;if(g==="exponential")w=pa;else if(g==="interval")w=Ki;else if(g==="categorical"){w=nn,A=Object.create(null);for(const z of n.stops)A[z[0]]=z[1];M=typeof n.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);w=Wa}if(l){const z={},N=[];for(let H=0;H<n.stops.length;H++){const J=n.stops[H],ot=J[0].zoom;z[ot]===void 0&&(z[ot]={zoom:ot,type:n.type,property:n.property,default:n.default,stops:[]},N.push(ot)),z[ot].stops.push([J[0].value,J[1]])}const V=[];for(const H of N)V.push([z[H].zoom,ai(z[H],t)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:er.interpolationFactor.bind(void 0,G),zoomStops:V.map(H=>H[0]),evaluate:({zoom:H},J)=>pa({stops:V,base:n.base},t,H).evaluate(H,J)}}if(p){const z=g==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:er.interpolationFactor.bind(void 0,z),zoomStops:n.stops.map(N=>N[0]),evaluate:({zoom:N})=>w(n,t,N,A,M)}}return{kind:"source",evaluate(z,N){const V=N&&N.properties?N.properties[n.property]:void 0;return V===void 0?An(n.default,t.default):w(n,t,V,A,M)}}}function An(n,t,o){return n!==void 0?n:t!==void 0?t:o!==void 0?o:void 0}function nn(n,t,o,l,p){return An(typeof o===p?l[o]:void 0,n.default,t.default)}function Ki(n,t,o){if(Li(o)!=="number")return An(n.default,t.default);const l=n.stops.length;if(l===1||o<=n.stops[0][0])return n.stops[0][1];if(o>=n.stops[l-1][0])return n.stops[l-1][1];const p=dn(n.stops.map(g=>g[0]),o);return n.stops[p][1]}function pa(n,t,o){const l=n.base!==void 0?n.base:1;if(Li(o)!=="number")return An(n.default,t.default);const p=n.stops.length;if(p===1||o<=n.stops[0][0])return n.stops[0][1];if(o>=n.stops[p-1][0])return n.stops[p-1][1];const g=dn(n.stops.map(z=>z[0]),o),v=function(z,N,V,G){const H=G-V,J=z-V;return H===0?0:N===1?J/H:(Math.pow(N,J)-1)/(Math.pow(N,H)-1)}(o,l,n.stops[g][0],n.stops[g+1][0]),w=n.stops[g][1],A=n.stops[g+1][1],M=lr[t.type]||lu;return typeof w.evaluate=="function"?{evaluate(...z){const N=w.evaluate.apply(void 0,z),V=A.evaluate.apply(void 0,z);if(N!==void 0&&V!==void 0)return M(N,V,v,n.colorSpace)}}:M(w,A,v,n.colorSpace)}function Wa(n,t,o){switch(t.type){case"color":o=Ni.parse(o);break;case"formatted":o=Ln.fromString(o.toString());break;case"resolvedImage":o=mi.fromString(o.toString());break;case"padding":o=Yn.parse(o);break;default:Li(o)===t.type||t.type==="enum"&&t.values[o]||(o=void 0)}return An(o,n.default,t.default)}Qn.register(zo,{error:[{kind:"error"},[Ye],(n,[t])=>{throw new ni(t.evaluate(n))}],typeof:[Ye,[Je],(n,[t])=>rt(Vi(t.evaluate(n)))],"to-rgba":[nt(jt,4),[Nn],(n,[t])=>{const[o,l,p,g]=t.evaluate(n).rgb;return[255*o,255*l,255*p,g]}],rgb:[Nn,[jt,jt,jt],_c],rgba:[Nn,[jt,jt,jt,jt],_c],has:{type:We,overloads:[[[Ye],(n,[t])=>Ll(t.evaluate(n),n.properties())],[[Ye,zr],(n,[t,o])=>Ll(t.evaluate(n),o.evaluate(n))]]},get:{type:Je,overloads:[[[Ye],(n,[t])=>qa(t.evaluate(n),n.properties())],[[Ye,zr],(n,[t,o])=>qa(t.evaluate(n),o.evaluate(n))]]},"feature-state":[Je,[Ye],(n,[t])=>qa(t.evaluate(n),n.featureState||{})],properties:[zr,[],n=>n.properties()],"geometry-type":[Ye,[],n=>n.geometryType()],id:[Je,[],n=>n.id()],zoom:[jt,[],n=>n.globals.zoom],"heatmap-density":[jt,[],n=>n.globals.heatmapDensity||0],"line-progress":[jt,[],n=>n.globals.lineProgress||0],accumulated:[Je,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[jt,ss(jt),(n,t)=>{let o=0;for(const l of t)o+=l.evaluate(n);return o}],"*":[jt,ss(jt),(n,t)=>{let o=1;for(const l of t)o*=l.evaluate(n);return o}],"-":{type:jt,overloads:[[[jt,jt],(n,[t,o])=>t.evaluate(n)-o.evaluate(n)],[[jt],(n,[t])=>-t.evaluate(n)]]},"/":[jt,[jt,jt],(n,[t,o])=>t.evaluate(n)/o.evaluate(n)],"%":[jt,[jt,jt],(n,[t,o])=>t.evaluate(n)%o.evaluate(n)],ln2:[jt,[],()=>Math.LN2],pi:[jt,[],()=>Math.PI],e:[jt,[],()=>Math.E],"^":[jt,[jt,jt],(n,[t,o])=>Math.pow(t.evaluate(n),o.evaluate(n))],sqrt:[jt,[jt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[jt,[jt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[jt,[jt],(n,[t])=>Math.log(t.evaluate(n))],log2:[jt,[jt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[jt,[jt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[jt,[jt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[jt,[jt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[jt,[jt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[jt,[jt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[jt,[jt],(n,[t])=>Math.atan(t.evaluate(n))],min:[jt,ss(jt),(n,t)=>Math.min(...t.map(o=>o.evaluate(n)))],max:[jt,ss(jt),(n,t)=>Math.max(...t.map(o=>o.evaluate(n)))],abs:[jt,[jt],(n,[t])=>Math.abs(t.evaluate(n))],round:[jt,[jt],(n,[t])=>{const o=t.evaluate(n);return o<0?-Math.round(-o):Math.round(o)}],floor:[jt,[jt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[jt,[jt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[We,[Ye,Je],(n,[t,o])=>n.properties()[t.value]===o.value],"filter-id-==":[We,[Je],(n,[t])=>n.id()===t.value],"filter-type-==":[We,[Ye],(n,[t])=>n.geometryType()===t.value],"filter-<":[We,[Ye,Je],(n,[t,o])=>{const l=n.properties()[t.value],p=o.value;return typeof l==typeof p&&l<p}],"filter-id-<":[We,[Je],(n,[t])=>{const o=n.id(),l=t.value;return typeof o==typeof l&&o<l}],"filter->":[We,[Ye,Je],(n,[t,o])=>{const l=n.properties()[t.value],p=o.value;return typeof l==typeof p&&l>p}],"filter-id->":[We,[Je],(n,[t])=>{const o=n.id(),l=t.value;return typeof o==typeof l&&o>l}],"filter-<=":[We,[Ye,Je],(n,[t,o])=>{const l=n.properties()[t.value],p=o.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[We,[Je],(n,[t])=>{const o=n.id(),l=t.value;return typeof o==typeof l&&o<=l}],"filter->=":[We,[Ye,Je],(n,[t,o])=>{const l=n.properties()[t.value],p=o.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[We,[Je],(n,[t])=>{const o=n.id(),l=t.value;return typeof o==typeof l&&o>=l}],"filter-has":[We,[Je],(n,[t])=>t.value in n.properties()],"filter-has-id":[We,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[We,[nt(Ye)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[We,[nt(Je)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[We,[Ye,nt(Je)],(n,[t,o])=>o.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[We,[Ye,nt(Je)],(n,[t,o])=>function(l,p,g,v){for(;g<=v;){const w=g+v>>1;if(p[w]===l)return!0;p[w]>l?v=w-1:g=w+1}return!1}(n.properties()[t.value],o.value,0,o.value.length-1)],all:{type:We,overloads:[[[We,We],(n,[t,o])=>t.evaluate(n)&&o.evaluate(n)],[ss(We),(n,t)=>{for(const o of t)if(!o.evaluate(n))return!1;return!0}]]},any:{type:We,overloads:[[[We,We],(n,[t,o])=>t.evaluate(n)||o.evaluate(n)],[ss(We),(n,t)=>{for(const o of t)if(o.evaluate(n))return!0;return!1}]]},"!":[We,[We],(n,[t])=>!t.evaluate(n)],"is-supported-script":[We,[Ye],(n,[t])=>{const o=n.globals&&n.globals.isSupportedScript;return!o||o(t.evaluate(n))}],upcase:[Ye,[Ye],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[Ye,[Ye],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[Ye,ss(Je),(n,t)=>t.map(o=>Mi(o.evaluate(n))).join("")],"resolved-locale":[Ye,[lo],(n,[t])=>t.evaluate(n).resolvedLocale()]});class fa{constructor(t,o){var l;this.expression=t,this._warningHistory={},this._evaluator=new co,this._defaultValue=o?(l=o).type==="color"&&Ui(l.default)?new Ni(0,0,0,0):l.type==="color"?Ni.parse(l.default)||null:l.type==="padding"?Yn.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?ii.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(t,o,l,p,g,v){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,o,l,p,g,v){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ni(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Ka(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in zo}function Xa(n,t){const o=new un(zo,Ds,[],t?function(p){const g={color:Nn,string:Ye,number:jt,enum:Ye,boolean:We,formatted:et,padding:U,resolvedImage:$,variableAnchorOffsetCollection:X};return p.type==="array"?nt(g[p.value]||Je,p.length):g[p.type]}(t):void 0),l=o.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?gc(new fa(l,t)):Xr(o.errors)}class Ya{constructor(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!ns(o.expression)}evaluateWithoutErrorHandling(t,o,l,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(t,o,l,p,g,v)}evaluate(t,o,l,p,g,v){return this._styleExpression.evaluate(t,o,l,p,g,v)}}class Ja{constructor(t,o,l,p){this.kind=t,this.zoomStops=l,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!ns(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,o,l,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(t,o,l,p,g,v)}evaluate(t,o,l,p,g,v){return this._styleExpression.evaluate(t,o,l,p,g,v)}interpolationFactor(t,o,l){return this.interpolationType?er.interpolationFactor(this.interpolationType,t,o,l):0}}function cr(n,t){const o=Xa(n,t);if(o.result==="error")return o;const l=o.value.expression,p=Wr(l);if(!p&&!Bs(t))return Xr([new zi("","data expressions not supported")]);const g=ko(l,["zoom"]);if(!g&&!Ml(t))return Xr([new zi("","zoom expressions not supported")]);const v=ma(l);return v||g?v instanceof zi?Xr([v]):v instanceof er&&!Ha(t)?Xr([new zi("",'"interpolate" expressions cannot be used with this property')]):gc(v?new Ja(p?"camera":"composite",o.value,v.labels,v instanceof er?v.interpolation:void 0):new Ya(p?"constant":"source",o.value)):Xr([new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yr{constructor(t,o){this._parameters=t,this._specification=o,Xn(this,ai(this._parameters,this._specification))}static deserialize(t){return new Yr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ma(n){let t=null;if(n instanceof da)t=ma(n.result);else if(n instanceof Na){for(const o of n.args)if(t=ma(o),t)break}else(n instanceof tr||n instanceof er)&&n.input instanceof Qn&&n.input.name==="zoom"&&(t=n);return t instanceof zi||n.eachChild(o=>{const l=ma(o);l instanceof zi?t=l:!t&&l?t=new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new zi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ur(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!ur(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const cu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ro(n){if(n==null)return{filter:()=>!0,needGeometry:!1};ur(n)||(n=_a(n));const t=Xa(n,cu);if(t.result==="error")throw new Error(t.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,l,p)=>t.value.evaluate(o,l,{},p),needGeometry:Os(n)}}function uu(n,t){return n<t?-1:n>t?1:0}function Os(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(Os(n[t]))return!0;return!1}function _a(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Fs(n[1],n[2],"=="):t==="!="?Do(Fs(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Fs(n[1],n[2],t):t==="any"?(o=n.slice(1),["any"].concat(o.map(_a))):t==="all"?["all"].concat(n.slice(1).map(_a)):t==="none"?["all"].concat(n.slice(1).map(_a).map(Do)):t==="in"?yc(n[1],n.slice(2)):t==="!in"?Do(yc(n[1],n.slice(2))):t==="has"?uo(n[1]):t==="!has"?Do(uo(n[1])):t!=="within"||n;var o}function Fs(n,t,o){switch(n){case"$type":return[`filter-type-${o}`,t];case"$id":return[`filter-id-${o}`,t];default:return[`filter-${o}`,n,t]}}function yc(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(o=>typeof o!=typeof t[0])?["filter-in-large",n,["literal",t.sort(uu)]]:["filter-in-small",n,["literal",t]]}}function uo(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Do(n){return["!",n]}function Qa(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let p="[";for(const g of n)p+=`${Qa(g)},`;return`${p}]`}const o=Object.keys(n).sort();let l="{";for(let p=0;p<o.length;p++)l+=`${JSON.stringify(o[p])}:${Qa(n[o[p]])},`;return`${l}}`}function Ns(n){let t="";for(const o of Yt)t+=`/${Qa(n[o])}`;return t}function vc(n){const t=n.value;return t?[new Wt(n.key,t,"constants have been deprecated as of v8")]:[]}function Ri(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function as(n){if(Array.isArray(n))return n.map(as);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const o in n)t[o]=as(n[o]);return t}return Ri(n)}function bn(n){const t=n.key,o=n.value,l=n.valueSpec||{},p=n.objectElementValidators||{},g=n.style,v=n.styleSpec,w=n.validateSpec;let A=[];const M=Li(o);if(M!=="object")return[new Wt(t,o,`object expected, ${M} found`)];for(const z in o){const N=z.split(".")[0],V=l[N]||l["*"];let G;if(p[N])G=p[N];else if(l[N])G=w;else if(p["*"])G=p["*"];else{if(!l["*"]){A.push(new Wt(t,o[z],`unknown property "${z}"`));continue}G=w}A=A.concat(G({key:(t&&`${t}.`)+z,value:o[z],valueSpec:V,style:g,styleSpec:v,object:o,objectKey:z,validateSpec:w},o))}for(const z in l)p[z]||l[z].required&&l[z].default===void 0&&o[z]===void 0&&A.push(new Wt(t,o,`missing required property "${z}"`));return A}function Us(n){const t=n.value,o=n.valueSpec,l=n.style,p=n.styleSpec,g=n.key,v=n.arrayElementValidator||n.validateSpec;if(Li(t)!=="array")return[new Wt(g,t,`array expected, ${Li(t)} found`)];if(o.length&&t.length!==o.length)return[new Wt(g,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new Wt(g,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let w={type:o.value,values:o.values};p.$version<7&&(w.function=o.function),Li(o.value)==="object"&&(w=o.value);let A=[];for(let M=0;M<t.length;M++)A=A.concat(v({array:t,arrayIndex:M,value:t[M],valueSpec:w,validateSpec:n.validateSpec,style:l,styleSpec:p,key:`${g}[${M}]`}));return A}function hr(n){const t=n.key,o=n.value,l=n.valueSpec;let p=Li(o);return p==="number"&&o!=o&&(p="NaN"),p!=="number"?[new Wt(t,o,`number expected, ${p} found`)]:"minimum"in l&&o<l.minimum?[new Wt(t,o,`${o} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&o>l.maximum?[new Wt(t,o,`${o} is greater than the maximum value ${l.maximum}`)]:[]}function ls(n){const t=n.valueSpec,o=Ri(n.value.type);let l,p,g,v={};const w=o!=="categorical"&&n.value.property===void 0,A=!w,M=Li(n.value.stops)==="array"&&Li(n.value.stops[0])==="array"&&Li(n.value.stops[0][0])==="object",z=bn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(G){if(o==="identity")return[new Wt(G.key,G.value,'identity function may not have a "stops" property')];let H=[];const J=G.value;return H=H.concat(Us({key:G.key,value:J,valueSpec:G.valueSpec,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:N})),Li(J)==="array"&&J.length===0&&H.push(new Wt(G.key,J,"array must have at least one stop")),H},default:function(G){return G.validateSpec({key:G.key,value:G.value,valueSpec:t,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec})}}});return o==="identity"&&w&&z.push(new Wt(n.key,n.value,'missing required property "property"')),o==="identity"||n.value.stops||z.push(new Wt(n.key,n.value,'missing required property "stops"')),o==="exponential"&&n.valueSpec.expression&&!Ha(n.valueSpec)&&z.push(new Wt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(A&&!Bs(n.valueSpec)?z.push(new Wt(n.key,n.value,"property functions not supported")):w&&!Ml(n.valueSpec)&&z.push(new Wt(n.key,n.value,"zoom functions not supported"))),o!=="categorical"&&!M||n.value.property!==void 0||z.push(new Wt(n.key,n.value,'"property" property is required')),z;function N(G){let H=[];const J=G.value,ot=G.key;if(Li(J)!=="array")return[new Wt(ot,J,`array expected, ${Li(J)} found`)];if(J.length!==2)return[new Wt(ot,J,`array length 2 expected, length ${J.length} found`)];if(M){if(Li(J[0])!=="object")return[new Wt(ot,J,`object expected, ${Li(J[0])} found`)];if(J[0].zoom===void 0)return[new Wt(ot,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new Wt(ot,J,"object stop key must have value")];if(g&&g>Ri(J[0].zoom))return[new Wt(ot,J[0].zoom,"stop zoom values must appear in ascending order")];Ri(J[0].zoom)!==g&&(g=Ri(J[0].zoom),p=void 0,v={}),H=H.concat(bn({key:`${ot}[0]`,value:J[0],valueSpec:{zoom:{}},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:hr,value:V}}))}else H=H.concat(V({key:`${ot}[0]`,value:J[0],valueSpec:{},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec},J));return Ka(as(J[1]))?H.concat([new Wt(`${ot}[1]`,J[1],"expressions are not allowed in function stops.")]):H.concat(G.validateSpec({key:`${ot}[1]`,value:J[1],valueSpec:t,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec}))}function V(G,H){const J=Li(G.value),ot=Ri(G.value),ct=G.value!==null?G.value:H;if(l){if(J!==l)return[new Wt(G.key,ct,`${J} stop domain type must match previous stop domain type ${l}`)]}else l=J;if(J!=="number"&&J!=="string"&&J!=="boolean")return[new Wt(G.key,ct,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&o!=="categorical"){let yt=`number expected, ${J} found`;return Bs(t)&&o===void 0&&(yt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wt(G.key,ct,yt)]}return o!=="categorical"||J!=="number"||isFinite(ot)&&Math.floor(ot)===ot?o!=="categorical"&&J==="number"&&p!==void 0&&ot<p?[new Wt(G.key,ct,"stop domain values must appear in ascending order")]:(p=ot,o==="categorical"&&ot in v?[new Wt(G.key,ct,"stop domain values must be unique")]:(v[ot]=!0,[])):[new Wt(G.key,ct,`integer expected, found ${ot}`)]}}function Bo(n){const t=(n.expressionContext==="property"?cr:Xa)(as(n.value),n.valueSpec);if(t.result==="error")return t.value.map(l=>new Wt(`${n.key}${l.key}`,n.value,l.message));const o=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!o.outputDefined())return[new Wt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ns(o))return[new Wt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ns(o))return[new Wt(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!ko(o,["zoom","feature-state"]))return[new Wt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Wr(o))return[new Wt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cs(n){const t=n.key,o=n.value,l=n.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(Ri(o))===-1&&p.push(new Wt(t,o,`expected one of [${l.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(l.values).indexOf(Ri(o))===-1&&p.push(new Wt(t,o,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(o)} found`)),p}function ho(n){return ur(as(n.value))?Bo(Xn({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):tl(n)}function tl(n){const t=n.value,o=n.key;if(Li(t)!=="array")return[new Wt(o,t,`array expected, ${Li(t)} found`)];const l=n.styleSpec;let p,g=[];if(t.length<1)return[new Wt(o,t,"filter array must have at least 1 element")];switch(g=g.concat(cs({key:`${o}[0]`,value:t[0],valueSpec:l.filter_operator,style:n.style,styleSpec:n.styleSpec})),Ri(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ri(t[1])==="$type"&&g.push(new Wt(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Wt(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=Li(t[1]),p!=="string"&&g.push(new Wt(`${o}[1]`,t[1],`string expected, ${p} found`)));for(let v=2;v<t.length;v++)p=Li(t[v]),Ri(t[1])==="$type"?g=g.concat(cs({key:`${o}[${v}]`,value:t[v],valueSpec:l.geometry_type,style:n.style,styleSpec:n.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new Wt(`${o}[${v}]`,t[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)g=g.concat(tl({key:`${o}[${v}]`,value:t[v],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":p=Li(t[1]),t.length!==2?g.push(new Wt(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new Wt(`${o}[1]`,t[1],`string expected, ${p} found`));break;case"within":p=Li(t[1]),t.length!==2?g.push(new Wt(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="object"&&g.push(new Wt(`${o}[1]`,t[1],`object expected, ${p} found`))}return g}function ga(n,t){const o=n.key,l=n.validateSpec,p=n.style,g=n.styleSpec,v=n.value,w=n.objectKey,A=g[`${t}_${n.layerType}`];if(!A)return[];const M=w.match(/^(.*)-transition$/);if(t==="paint"&&M&&A[M[1]]&&A[M[1]].transition)return l({key:o,value:v,valueSpec:g.transition,style:p,styleSpec:g});const z=n.valueSpec||A[w];if(!z)return[new Wt(o,v,`unknown property "${w}"`)];let N;if(Li(v)==="string"&&Bs(z)&&!z.tokens&&(N=/^{([^}]+)}$/.exec(v)))return[new Wt(o,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const V=[];return n.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&V.push(new Wt(o,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Ui(as(v))&&Ri(v.type)==="identity"&&V.push(new Wt(o,v,'"text-font" does not support identity functions'))),V.concat(l({key:n.key,value:v,valueSpec:z,style:p,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:w}))}function us(n){return ga(n,"paint")}function ya(n){return ga(n,"layout")}function el(n){let t=[];const o=n.value,l=n.key,p=n.style,g=n.styleSpec;o.type||o.ref||t.push(new Wt(l,o,'either "type" or "ref" is required'));let v=Ri(o.type);const w=Ri(o.ref);if(o.id){const A=Ri(o.id);for(let M=0;M<n.arrayIndex;M++){const z=p.layers[M];Ri(z.id)===A&&t.push(new Wt(l,o.id,`duplicate layer id "${o.id}", previously used at line ${z.id.__line__}`))}}if("ref"in o){let A;["type","source","source-layer","filter","layout"].forEach(M=>{M in o&&t.push(new Wt(l,o[M],`"${M}" is prohibited for ref layers`))}),p.layers.forEach(M=>{Ri(M.id)===w&&(A=M)}),A?A.ref?t.push(new Wt(l,o.ref,"ref cannot reference another ref layer")):v=Ri(A.type):t.push(new Wt(l,o.ref,`ref layer "${w}" not found`))}else if(v!=="background")if(o.source){const A=p.sources&&p.sources[o.source],M=A&&Ri(A.type);A?M==="vector"&&v==="raster"?t.push(new Wt(l,o.source,`layer "${o.id}" requires a raster source`)):M!=="raster-dem"&&v==="hillshade"?t.push(new Wt(l,o.source,`layer "${o.id}" requires a raster-dem source`)):M==="raster"&&v!=="raster"?t.push(new Wt(l,o.source,`layer "${o.id}" requires a vector source`)):M!=="vector"||o["source-layer"]?M==="raster-dem"&&v!=="hillshade"?t.push(new Wt(l,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!o.paint||!o.paint["line-gradient"]||M==="geojson"&&A.lineMetrics||t.push(new Wt(l,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Wt(l,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new Wt(l,o.source,`source "${o.source}" not found`))}else t.push(new Wt(l,o,'missing required property "source"'));return t=t.concat(bn({key:l,value:o,valueSpec:g.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${l}.type`,value:o.type,valueSpec:g.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:o,objectKey:"type"}),filter:ho,layout:A=>bn({layer:o,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":M=>ya(Xn({layerType:v},M))}}),paint:A=>bn({layer:o,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":M=>us(Xn({layerType:v},M))}})}})),t}function Br(n){const t=n.value,o=n.key,l=Li(t);return l!=="string"?[new Wt(o,t,`string expected, ${l} found`)]:[]}const va={promoteId:function({key:n,value:t}){if(Li(t)==="string")return Br({key:n,value:t});{const o=[];for(const l in t)o.push(...Br({key:`${n}.${l}`,value:t[l]}));return o}}};function Vn(n){const t=n.value,o=n.key,l=n.styleSpec,p=n.style,g=n.validateSpec;if(!t.type)return[new Wt(o,t,'"type" is required')];const v=Ri(t.type);let w;switch(v){case"vector":case"raster":return w=bn({key:o,value:t,valueSpec:l[`source_${v.replace("-","_")}`],style:n.style,styleSpec:l,objectElementValidators:va,validateSpec:g}),w;case"raster-dem":return w=function(A){var M;const z=(M=A.sourceName)!==null&&M!==void 0?M:"",N=A.value,V=A.styleSpec,G=V.source_raster_dem,H=A.style;let J=[];const ot=Li(N);if(N===void 0)return J;if(ot!=="object")return J.push(new Wt("source_raster_dem",N,`object expected, ${ot} found`)),J;const ct=Ri(N.encoding)==="custom",yt=["redFactor","greenFactor","blueFactor","baseShift"],ht=A.value.encoding?`"${A.value.encoding}"`:"Default";for(const xt in N)!ct&&yt.includes(xt)?J.push(new Wt(xt,N[xt],`In "${z}": "${xt}" is only valid when "encoding" is set to "custom". ${ht} encoding found`)):G[xt]?J=J.concat(A.validateSpec({key:xt,value:N[xt],valueSpec:G[xt],validateSpec:A.validateSpec,style:H,styleSpec:V})):J.push(new Wt(xt,N[xt],`unknown property "${xt}"`));return J}({sourceName:o,value:t,style:n.style,styleSpec:l,validateSpec:g}),w;case"geojson":if(w=bn({key:o,value:t,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:g,objectElementValidators:va}),t.cluster)for(const A in t.clusterProperties){const[M,z]=t.clusterProperties[A],N=typeof M=="string"?[M,["accumulated"],["get",A]]:M;w.push(...Bo({key:`${o}.${A}.map`,value:z,validateSpec:g,expressionContext:"cluster-map"})),w.push(...Bo({key:`${o}.${A}.reduce`,value:N,validateSpec:g,expressionContext:"cluster-reduce"}))}return w;case"video":return bn({key:o,value:t,valueSpec:l.source_video,style:p,validateSpec:g,styleSpec:l});case"image":return bn({key:o,value:t,valueSpec:l.source_image,style:p,validateSpec:g,styleSpec:l});case"canvas":return[new Wt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cs({key:`${o}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,validateSpec:g,styleSpec:l})}}function xa(n){const t=n.value,o=n.styleSpec,l=o.light,p=n.style;let g=[];const v=Li(t);if(t===void 0)return g;if(v!=="object")return g=g.concat([new Wt("light",t,`object expected, ${v} found`)]),g;for(const w in t){const A=w.match(/^(.*)-transition$/);g=g.concat(A&&l[A[1]]&&l[A[1]].transition?n.validateSpec({key:w,value:t[w],valueSpec:o.transition,validateSpec:n.validateSpec,style:p,styleSpec:o}):l[w]?n.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:n.validateSpec,style:p,styleSpec:o}):[new Wt(w,t[w],`unknown property "${w}"`)])}return g}function kl(n){const t=n.value,o=n.styleSpec,l=o.terrain,p=n.style;let g=[];const v=Li(t);if(t===void 0)return g;if(v!=="object")return g=g.concat([new Wt("terrain",t,`object expected, ${v} found`)]),g;for(const w in t)g=g.concat(l[w]?n.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:n.validateSpec,style:p,styleSpec:o}):[new Wt(w,t[w],`unknown property "${w}"`)]);return g}function xc(n){let t=[];const o=n.value,l=n.key;if(Array.isArray(o)){const p=[],g=[];for(const v in o)o[v].id&&p.includes(o[v].id)&&t.push(new Wt(l,o,`all the sprites' ids must be unique, but ${o[v].id} is duplicated`)),p.push(o[v].id),o[v].url&&g.includes(o[v].url)&&t.push(new Wt(l,o,`all the sprites' URLs must be unique, but ${o[v].url} is duplicated`)),g.push(o[v].url),t=t.concat(bn({key:`${l}[${v}]`,value:o[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Br({key:l,value:o})}const zl={"*":()=>[],array:Us,boolean:function(n){const t=n.value,o=n.key,l=Li(t);return l!=="boolean"?[new Wt(o,t,`boolean expected, ${l} found`)]:[]},number:hr,color:function(n){const t=n.key,o=n.value,l=Li(o);return l!=="string"?[new Wt(t,o,`color expected, ${l} found`)]:Ni.parse(String(o))?[]:[new Wt(t,o,`color expected, "${o}" found`)]},constants:vc,enum:cs,filter:ho,function:ls,layer:el,object:bn,source:Vn,light:xa,terrain:kl,string:Br,formatted:function(n){return Br(n).length===0?[]:Bo(n)},resolvedImage:function(n){return Br(n).length===0?[]:Bo(n)},padding:function(n){const t=n.key,o=n.value;if(Li(o)==="array"){if(o.length<1||o.length>4)return[new Wt(t,o,`padding requires 1 to 4 values; ${o.length} values found`)];const l={type:"number"};let p=[];for(let g=0;g<o.length;g++)p=p.concat(n.validateSpec({key:`${t}[${g}]`,value:o[g],validateSpec:n.validateSpec,valueSpec:l}));return p}return hr({key:t,value:o,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,o=n.value,l=Li(o),p=n.styleSpec;if(l!=="array"||o.length<1||o.length%2!=0)return[new Wt(t,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let v=0;v<o.length;v+=2)g=g.concat(cs({key:`${t}[${v}]`,value:o[v],valueSpec:p.layout_symbol["text-anchor"]})),g=g.concat(Us({key:`${t}[${v+1}]`,value:o[v+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:p}));return g},sprite:xc};function po(n){const t=n.value,o=n.valueSpec,l=n.styleSpec;return n.validateSpec=po,o.expression&&Ui(Ri(t))?ls(n):o.expression&&Ka(as(t))?Bo(n):o.type&&zl[o.type]?zl[o.type](n):bn(Xn({},n,{valueSpec:o.type?l[o.type]:o}))}function Or(n){const t=n.value,o=n.key,l=Br(n);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new Wt(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new Wt(o,t,'"glyphs" url must include a "{range}" token'))),l}function jn(n,t=dt){let o=[];return o=o.concat(po({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:po,objectElementValidators:{glyphs:Or,"*":()=>[]}})),n.constants&&(o=o.concat(vc({key:"constants",value:n.constants,style:n,styleSpec:t,validateSpec:po}))),hs(o)}function fo(n){return function(t){return n({...t,validateSpec:po})}}function hs(n){return[].concat(n).sort((t,o)=>t.line-o.line)}function mo(n){return function(...t){return hs(n.apply(this,t))}}jn.source=mo(fo(Vn)),jn.sprite=mo(fo(xc)),jn.glyphs=mo(fo(Or)),jn.light=mo(fo(xa)),jn.terrain=mo(fo(kl)),jn.layer=mo(fo(el)),jn.filter=mo(fo(ho)),jn.paintProperty=mo(fo(us)),jn.layoutProperty=mo(fo(ya));const Jr=jn,hu=Jr.light,ds=Jr.paintProperty,bc=Jr.layoutProperty;function _o(n,t){let o=!1;if(t&&t.length)for(const l of t)n.fire(new Nt(new Error(l.message))),o=!0;return o}class ps{constructor(t,o,l){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(o=v[1])+2*(l=v[2]);for(let A=0;A<this.d*this.d;A++){const M=v[3+A],z=v[3+A+1];p.push(M===z?null:v.subarray(M,z))}const w=v[3+p.length+1];this.keys=v.subarray(v[3+p.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=o+2*l;for(let v=0;v<this.d*this.d;v++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=l,this.scale=o/t,this.uid=0;const g=l/o*t;this.min=-g,this.max=t+g}insert(t,o,l,p,g){this._forEachCell(o,l,p,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,o,l,p,g,v){this.cells[g].push(v)}query(t,o,l,p,g){const v=this.min,w=this.max;if(t<=v&&o<=v&&w<=l&&w<=p&&!g)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(t,o,l,p,this._queryCell,A,{},g),A}}_queryCell(t,o,l,p,g,v,w,A){const M=this.cells[g];if(M!==null){const z=this.keys,N=this.bboxes;for(let V=0;V<M.length;V++){const G=M[V];if(w[G]===void 0){const H=4*G;(A?A(N[H+0],N[H+1],N[H+2],N[H+3]):t<=N[H+2]&&o<=N[H+3]&&l>=N[H+0]&&p>=N[H+1])?(w[G]=!0,v.push(z[G])):w[G]=!1}}}}_forEachCell(t,o,l,p,g,v,w,A){const M=this._convertToCellCoord(t),z=this._convertToCellCoord(o),N=this._convertToCellCoord(l),V=this._convertToCellCoord(p);for(let G=M;G<=N;G++)for(let H=z;H<=V;H++){const J=this.d*H+G;if((!A||A(this._convertFromCellCoord(G),this._convertFromCellCoord(H),this._convertFromCellCoord(G+1),this._convertFromCellCoord(H+1)))&&g.call(this,t,o,l,p,J,v,w,A))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,o=3+this.cells.length+1+1;let l=0;for(let v=0;v<this.cells.length;v++)l+=this.cells[v].length;const p=new Int32Array(o+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let g=o;for(let v=0;v<t.length;v++){const w=t[v];p[3+v]=g,p.set(w,g),g+=w.length}return p[3+t.length]=g,p.set(this.keys,g),g+=this.keys.length,p[3+t.length+1]=g,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer}static serialize(t,o){const l=t.toArrayBuffer();return o&&o.push(l),{buffer:l}}static deserialize(t){return new ps(t.buffer)}}const Qr={};function _e(n,t,o={}){if(Qr[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),Qr[n]={klass:t,omit:o.omit||[],shallow:o.shallow||[]}}_e("Object",Object),_e("TransferableGridIndex",ps),_e("Color",Ni),_e("Error",Error),_e("AJAXError",be),_e("ResolvedImage",mi),_e("StylePropertyFunction",Yr),_e("StyleExpression",fa,{omit:["_evaluator"]}),_e("ZoomDependentExpression",Ja),_e("ZoomConstantExpression",Ya),_e("CompoundExpression",Qn,{omit:["_evaluate"]});for(const n in zo)zo[n]._classRegistryKey||_e(`Expression_${n}`,zo[n]);function br(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function go(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob)return n;if(br(n)||fi(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const o=n;return t&&t.push(o.buffer),o}if(n instanceof ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const o=[];for(const l of n)o.push(go(l,t));return o}if(typeof n=="object"){const o=n.constructor,l=o._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");if(!Qr[l])throw new Error(`${l} is not registered.`);const p=o.serialize?o.serialize(n,t):{};if(o.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in n){if(!n.hasOwnProperty(g)||Qr[l].omit.indexOf(g)>=0)continue;const v=n[g];p[g]=Qr[l].shallow.indexOf(g)>=0?v:go(v,t)}n instanceof Error&&(p.message=n.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(p.$name=l),p}throw new Error("can't serialize object of type "+typeof n)}function fs(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||br(n)||fi(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(fs);if(typeof n=="object"){const t=n.$name||"Object";if(!Qr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:o}=Qr[t];if(!o)throw new Error(`can't deserialize unregistered class ${t}`);if(o.deserialize)return o.deserialize(n);const l=Object.create(o.prototype);for(const p of Object.keys(n)){if(p==="$name")continue;const g=n[p];l[p]=Qr[t].shallow.indexOf(p)>=0?g:fs(g)}return l}throw new Error("can't deserialize object of type "+typeof n)}class Vs{constructor(){this.first=!0}update(t,o){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const le={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function $s(n){for(const t of n)if(il(t.charCodeAt(0)))return!0;return!1}function ms(n){for(const t of n)if(!wc(t.charCodeAt(0)))return!1;return!0}function wc(n){return!(le.Arabic(n)||le["Arabic Supplement"](n)||le["Arabic Extended-A"](n)||le["Arabic Presentation Forms-A"](n)||le["Arabic Presentation Forms-B"](n))}function il(n){return!(n!==746&&n!==747&&(n<4352||!(le["Bopomofo Extended"](n)||le.Bopomofo(n)||le["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||le["CJK Compatibility Ideographs"](n)||le["CJK Compatibility"](n)||le["CJK Radicals Supplement"](n)||le["CJK Strokes"](n)||!(!le["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||le["CJK Unified Ideographs Extension A"](n)||le["CJK Unified Ideographs"](n)||le["Enclosed CJK Letters and Months"](n)||le["Hangul Compatibility Jamo"](n)||le["Hangul Jamo Extended-A"](n)||le["Hangul Jamo Extended-B"](n)||le["Hangul Jamo"](n)||le["Hangul Syllables"](n)||le.Hiragana(n)||le["Ideographic Description Characters"](n)||le.Kanbun(n)||le["Kangxi Radicals"](n)||le["Katakana Phonetic Extensions"](n)||le.Katakana(n)&&n!==12540||!(!le["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!le["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||le["Unified Canadian Aboriginal Syllabics"](n)||le["Unified Canadian Aboriginal Syllabics Extended"](n)||le["Vertical Forms"](n)||le["Yijing Hexagram Symbols"](n)||le["Yi Syllables"](n)||le["Yi Radicals"](n))))}function Tc(n){return!(il(n)||function(t){return!!(le["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||le["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||le["Letterlike Symbols"](t)||le["Number Forms"](t)||le["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||le["Control Pictures"](t)&&t!==9251||le["Optical Character Recognition"](t)||le["Enclosed Alphanumerics"](t)||le["Geometric Shapes"](t)||le["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||le["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||le["CJK Symbols and Punctuation"](t)||le.Katakana(t)||le["Private Use Area"](t)||le["CJK Compatibility Forms"](t)||le["Small Form Variants"](t)||le["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function Rl(n){return n>=1424&&n<=2303||le["Arabic Presentation Forms-A"](n)||le["Arabic Presentation Forms-B"](n)}function Dl(n,t){return!(!t&&Rl(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||le.Khmer(n))}function Sc(n){for(const t of n)if(Rl(t.charCodeAt(0)))return!0;return!1}const nl="deferred",rl="loading",Bl="loaded";let ol=null,Gn="unavailable",Oo=null;const s=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Gn="error"),ol&&ol(n)};function d(){b.fire(new Bt("pluginStateChange",{pluginStatus:Gn,pluginURL:Oo}))}const b=new re,C=function(){return Gn},B=function(){if(Gn!==nl||!Oo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gn=rl,d(),Oo&&ut({url:Oo},n=>{n?s(n):(Gn=Bl,d())})},j={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gn===Bl||j.applyArabicShaping!=null,isLoading:()=>Gn===rl,setState(n){if(!Me())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Gn=n.pluginStatus,Oo=n.pluginURL},isParsed(){if(!Me())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return j.applyArabicShaping!=null&&j.processBidirectionalText!=null&&j.processStyledBidirectionalText!=null},getPluginURL(){if(!Me())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Oo}};class at{constructor(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vs,this.transition={})}isSupportedScript(t){return function(o,l){for(const p of o)if(!Dl(p.charCodeAt(0),l))return!1;return!0}(t,j.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,o=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*o}}}class Tt{constructor(t,o){this.property=t,this.value=o,this.expression=function(l,p){if(Ui(l))return new Yr(l,p);if(Ka(l)){const g=cr(l,p);if(g.result==="error")throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=l;return p.type==="color"&&typeof l=="string"?g=Ni.parse(l):p.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(l)&&(g=ii.parse(l)):g=Yn.parse(l),{kind:"constant",evaluate:()=>g}}}(o===void 0?t.specification.default:o,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,o,l){return this.property.possiblyEvaluate(this,t,o,l)}}class Et{constructor(t){this.property=t,this.value=new Tt(t,void 0)}transitioned(t,o){return new ye(this.property,this.value,o,pe({},t.transition,this.transition),t.now)}untransitioned(){return new ye(this.property,this.value,null,{},0)}}class $t{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return fe(this._values[t].value.value)}setValue(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Et(this._values[t].property)),this._values[t].value=new Tt(this._values[t].property,o===null?void 0:fe(o))}getTransition(t){return fe(this._values[t].transition)}setTransition(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Et(this._values[t].property)),this._values[t].transition=fe(o)||void 0}serialize(){const t={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(t[o]=l);const p=this.getTransition(o);p!==void 0&&(t[`${o}-transition`]=p)}return t}transitioned(t,o){const l=new He(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(t,o._values[p]);return l}untransitioned(){const t=new He(this._properties);for(const o of Object.keys(this._values))t._values[o]=this._values[o].untransitioned();return t}}class ye{constructor(t,o,l,p,g){this.property=t,this.value=o,this.begin=g+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(t,o,l){const p=t.now||0,g=this.value.possiblyEvaluate(t,o,l),v=this.prior;if(v){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return v.possiblyEvaluate(t,o,l);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,o,l),g,function(A){if(A<=0)return 0;if(A>=1)return 1;const M=A*A,z=M*A;return 4*(A<.5?z:3*(A-M)+z-.75)}(w))}}return g}}class He{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,o,l){const p=new mn(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(t,o,l);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class yi{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return fe(this._values[t].value)}setValue(t,o){this._values[t]=new Tt(this._values[t].property,o===null?void 0:fe(o))}serialize(){const t={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(t[o]=l)}return t}possiblyEvaluate(t,o,l){const p=new mn(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(t,o,l);return p}}class $i{constructor(t,o,l){this.property=t,this.value=o,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,o,l,p){return this.property.evaluate(this.value,this.parameters,t,o,l,p)}}class mn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class me{constructor(t){this.specification=t}possiblyEvaluate(t,o){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(o)}interpolate(t,o,l){const p=lr[this.specification.type];return p?p(t,o,l):t}}class xe{constructor(t,o){this.specification=t,this.overrides=o}possiblyEvaluate(t,o,l,p){return new $i(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},l,p)}:t.expression,o)}interpolate(t,o,l){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new $i(this,{kind:"constant",value:void 0},t.parameters);const p=lr[this.specification.type];if(p){const g=p(t.value.value,o.value.value,l);return new $i(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,o,l,p,g,v){return t.kind==="constant"?t.value:t.evaluate(o,l,p,g,v)}}class to extends xe{possiblyEvaluate(t,o,l,p){if(t.value===void 0)return new $i(this,{kind:"constant",value:void 0},o);if(t.expression.kind==="constant"){const g=t.expression.evaluate(o,null,{},l,p),v=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,w=this._calculate(v,v,v,o);return new $i(this,{kind:"constant",value:w},o)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:o.zoom-1}),t.expression.evaluate({zoom:o.zoom}),t.expression.evaluate({zoom:o.zoom+1}),o);return new $i(this,{kind:"constant",value:g},o)}return new $i(this,t.expression,o)}evaluate(t,o,l,p,g,v){if(t.kind==="source"){const w=t.evaluate(o,l,p,g,v);return this._calculate(w,w,w,o)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(o.zoom)-1},l,p),t.evaluate({zoom:Math.floor(o.zoom)},l,p),t.evaluate({zoom:Math.floor(o.zoom)+1},l,p),o):t.value}_calculate(t,o,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:l,to:o}}interpolate(t){return t}}class Ol{constructor(t){this.specification=t}possiblyEvaluate(t,o,l,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(o,null,{},l,p);return this._calculate(g,g,g,o)}return this._calculate(t.expression.evaluate(new at(Math.floor(o.zoom-1),o)),t.expression.evaluate(new at(Math.floor(o.zoom),o)),t.expression.evaluate(new at(Math.floor(o.zoom+1),o)),o)}}_calculate(t,o,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:l,to:o}}interpolate(t){return t}}class Fl{constructor(t){this.specification=t}possiblyEvaluate(t,o,l,p){return!!t.expression.evaluate(o,null,{},l,p)}interpolate(){return!1}}class _n{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in t){const l=t[o];l.specification.overridable&&this.overridableProperties.push(o);const p=this.defaultPropertyValues[o]=new Tt(l,void 0),g=this.defaultTransitionablePropertyValues[o]=new Et(l);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}}}_e("DataDrivenProperty",xe),_e("DataConstantProperty",me),_e("CrossFadedDataDrivenProperty",to),_e("CrossFadedProperty",Ol),_e("ColorRampProperty",Fl);const sl="-transition";class wr extends re{constructor(t,o){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),o.layout&&(this._unevaluatedLayout=new yi(o.layout)),o.paint)){this._transitionablePaint=new $t(o.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mn(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,o,l={}){o!=null&&this._validate(bc,`layers.${this.id}.layout.${t}`,t,o,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,o):this.visibility=o)}getPaintProperty(t){return t.endsWith(sl)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,o,l={}){if(o!=null&&this._validate(ds,`layers.${this.id}.paint.${t}`,t,o,l))return!1;if(t.endsWith(sl))return this._transitionablePaint.setTransition(t.slice(0,-11),o||void 0),!1;{const p=this._transitionablePaint._values[t],g=p.property.specification["property-type"]==="cross-faded-data-driven",v=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(t,o),this._handleSpecialPaintPropertyUpdate(t);const A=this._transitionablePaint._values[t].value;return A.isDataDriven()||v||g||this._handleOverridablePaintPropertyUpdate(t,w,A)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,o,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,o){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,o)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Qt(t,(o,l)=>!(o===void 0||l==="layout"&&!Object.keys(o).length||l==="paint"&&!Object.keys(o).length))}_validate(t,o,l,p,g={}){return(!g||g.validate!==!1)&&_o(this,t.call(Jr,{key:o,layerType:this.type,objectKey:l,value:p,styleSpec:dt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const o=this.paint.get(t);if(o instanceof $i&&Bs(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Nl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xi{constructor(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function on(n,t=1){let o=0,l=0;return{members:n.map(p=>{const g=Nl[p.type].BYTES_PER_ELEMENT,v=o=Zs(o,Math.max(t,g)),w=p.components||1;return l=Math.max(l,g),o+=g*w,{name:p.name,type:p.type,components:w,offset:v}}),size:Zs(o,Math.max(l,t)),alignment:t}}function Zs(n,t){return Math.ceil(n/t)*t}class ba extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.int16[p+0]=o,this.int16[p+1]=l,t}}ba.prototype.bytesPerElement=4,_e("StructArrayLayout2i4",ba);class _s extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const g=3*t;return this.int16[g+0]=o,this.int16[g+1]=l,this.int16[g+2]=p,t}}_s.prototype.bytesPerElement=6,_e("StructArrayLayout3i6",_s);class Fo extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,o,l,p)}emplace(t,o,l,p,g){const v=4*t;return this.int16[v+0]=o,this.int16[v+1]=l,this.int16[v+2]=p,this.int16[v+3]=g,t}}Fo.prototype.bytesPerElement=8,_e("StructArrayLayout4i8",Fo);class Ul extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,o,l,p,g,v)}emplace(t,o,l,p,g,v,w){const A=6*t;return this.int16[A+0]=o,this.int16[A+1]=l,this.int16[A+2]=p,this.int16[A+3]=g,this.int16[A+4]=v,this.int16[A+5]=w,t}}Ul.prototype.bytesPerElement=12,_e("StructArrayLayout2i4i12",Ul);class du extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,o,l,p,g,v)}emplace(t,o,l,p,g,v,w){const A=4*t,M=8*t;return this.int16[A+0]=o,this.int16[A+1]=l,this.uint8[M+4]=p,this.uint8[M+5]=g,this.uint8[M+6]=v,this.uint8[M+7]=w,t}}du.prototype.bytesPerElement=8,_e("StructArrayLayout2i4ub8",du);class al extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.float32[p+0]=o,this.float32[p+1]=l,t}}al.prototype.bytesPerElement=8,_e("StructArrayLayout2f8",al);class pu extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g,v,w,A,M,z){const N=this.length;return this.resize(N+1),this.emplace(N,t,o,l,p,g,v,w,A,M,z)}emplace(t,o,l,p,g,v,w,A,M,z,N){const V=10*t;return this.uint16[V+0]=o,this.uint16[V+1]=l,this.uint16[V+2]=p,this.uint16[V+3]=g,this.uint16[V+4]=v,this.uint16[V+5]=w,this.uint16[V+6]=A,this.uint16[V+7]=M,this.uint16[V+8]=z,this.uint16[V+9]=N,t}}pu.prototype.bytesPerElement=20,_e("StructArrayLayout10ui20",pu);class fu extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g,v,w,A,M,z,N,V){const G=this.length;return this.resize(G+1),this.emplace(G,t,o,l,p,g,v,w,A,M,z,N,V)}emplace(t,o,l,p,g,v,w,A,M,z,N,V,G){const H=12*t;return this.int16[H+0]=o,this.int16[H+1]=l,this.int16[H+2]=p,this.int16[H+3]=g,this.uint16[H+4]=v,this.uint16[H+5]=w,this.uint16[H+6]=A,this.uint16[H+7]=M,this.int16[H+8]=z,this.int16[H+9]=N,this.int16[H+10]=V,this.int16[H+11]=G,t}}fu.prototype.bytesPerElement=24,_e("StructArrayLayout4i4ui4i24",fu);class Di extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const g=3*t;return this.float32[g+0]=o,this.float32[g+1]=l,this.float32[g+2]=p,t}}Di.prototype.bytesPerElement=12,_e("StructArrayLayout3f12",Di);class _ extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint32[1*t+0]=o,t}}_.prototype.bytesPerElement=4,_e("StructArrayLayout1ul4",_);class e extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g,v,w,A,M){const z=this.length;return this.resize(z+1),this.emplace(z,t,o,l,p,g,v,w,A,M)}emplace(t,o,l,p,g,v,w,A,M,z){const N=10*t,V=5*t;return this.int16[N+0]=o,this.int16[N+1]=l,this.int16[N+2]=p,this.int16[N+3]=g,this.int16[N+4]=v,this.int16[N+5]=w,this.uint32[V+3]=A,this.uint16[N+8]=M,this.uint16[N+9]=z,t}}e.prototype.bytesPerElement=20,_e("StructArrayLayout6i1ul2ui20",e);class a extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,o,l,p,g,v)}emplace(t,o,l,p,g,v,w){const A=6*t;return this.int16[A+0]=o,this.int16[A+1]=l,this.int16[A+2]=p,this.int16[A+3]=g,this.int16[A+4]=v,this.int16[A+5]=w,t}}a.prototype.bytesPerElement=12,_e("StructArrayLayout2i2i2i12",a);class h extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,o,l,p,g)}emplace(t,o,l,p,g,v){const w=4*t,A=8*t;return this.float32[w+0]=o,this.float32[w+1]=l,this.float32[w+2]=p,this.int16[A+6]=g,this.int16[A+7]=v,t}}h.prototype.bytesPerElement=16,_e("StructArrayLayout2f1f2i16",h);class f extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,o,l,p)}emplace(t,o,l,p,g){const v=12*t,w=3*t;return this.uint8[v+0]=o,this.uint8[v+1]=l,this.float32[w+1]=p,this.float32[w+2]=g,t}}f.prototype.bytesPerElement=12,_e("StructArrayLayout2ub2f12",f);class y extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const g=3*t;return this.uint16[g+0]=o,this.uint16[g+1]=l,this.uint16[g+2]=p,t}}y.prototype.bytesPerElement=6,_e("StructArrayLayout3ui6",y);class T extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g,v,w,A,M,z,N,V,G,H,J,ot,ct){const yt=this.length;return this.resize(yt+1),this.emplace(yt,t,o,l,p,g,v,w,A,M,z,N,V,G,H,J,ot,ct)}emplace(t,o,l,p,g,v,w,A,M,z,N,V,G,H,J,ot,ct,yt){const ht=24*t,xt=12*t,At=48*t;return this.int16[ht+0]=o,this.int16[ht+1]=l,this.uint16[ht+2]=p,this.uint16[ht+3]=g,this.uint32[xt+2]=v,this.uint32[xt+3]=w,this.uint32[xt+4]=A,this.uint16[ht+10]=M,this.uint16[ht+11]=z,this.uint16[ht+12]=N,this.float32[xt+7]=V,this.float32[xt+8]=G,this.uint8[At+36]=H,this.uint8[At+37]=J,this.uint8[At+38]=ot,this.uint32[xt+10]=ct,this.int16[ht+22]=yt,t}}T.prototype.bytesPerElement=48,_e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",T);class P extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p,g,v,w,A,M,z,N,V,G,H,J,ot,ct,yt,ht,xt,At,Dt,he,Pe,ue,ae,ee,ge){const ne=this.length;return this.resize(ne+1),this.emplace(ne,t,o,l,p,g,v,w,A,M,z,N,V,G,H,J,ot,ct,yt,ht,xt,At,Dt,he,Pe,ue,ae,ee,ge)}emplace(t,o,l,p,g,v,w,A,M,z,N,V,G,H,J,ot,ct,yt,ht,xt,At,Dt,he,Pe,ue,ae,ee,ge,ne){const qt=32*t,Be=16*t;return this.int16[qt+0]=o,this.int16[qt+1]=l,this.int16[qt+2]=p,this.int16[qt+3]=g,this.int16[qt+4]=v,this.int16[qt+5]=w,this.int16[qt+6]=A,this.int16[qt+7]=M,this.uint16[qt+8]=z,this.uint16[qt+9]=N,this.uint16[qt+10]=V,this.uint16[qt+11]=G,this.uint16[qt+12]=H,this.uint16[qt+13]=J,this.uint16[qt+14]=ot,this.uint16[qt+15]=ct,this.uint16[qt+16]=yt,this.uint16[qt+17]=ht,this.uint16[qt+18]=xt,this.uint16[qt+19]=At,this.uint16[qt+20]=Dt,this.uint16[qt+21]=he,this.uint16[qt+22]=Pe,this.uint32[Be+12]=ue,this.float32[Be+13]=ae,this.float32[Be+14]=ee,this.uint16[qt+30]=ge,this.uint16[qt+31]=ne,t}}P.prototype.bytesPerElement=64,_e("StructArrayLayout8i15ui1ul2f2ui64",P);class E extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.float32[1*t+0]=o,t}}E.prototype.bytesPerElement=4,_e("StructArrayLayout1f4",E);class k extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const g=3*t;return this.uint16[6*t+0]=o,this.float32[g+1]=l,this.float32[g+2]=p,t}}k.prototype.bytesPerElement=12,_e("StructArrayLayout1ui2f12",k);class R extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const g=4*t;return this.uint32[2*t+0]=o,this.uint16[g+2]=l,this.uint16[g+3]=p,t}}R.prototype.bytesPerElement=8,_e("StructArrayLayout1ul2ui8",R);class O extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.uint16[p+0]=o,this.uint16[p+1]=l,t}}O.prototype.bytesPerElement=4,_e("StructArrayLayout2ui4",O);class Z extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint16[1*t+0]=o,t}}Z.prototype.bytesPerElement=2,_e("StructArrayLayout1ui2",Z);class tt extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,o,l,p)}emplace(t,o,l,p,g){const v=4*t;return this.float32[v+0]=o,this.float32[v+1]=l,this.float32[v+2]=p,this.float32[v+3]=g,t}}tt.prototype.bytesPerElement=16,_e("StructArrayLayout4f16",tt);class Q extends Xi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new K(this.anchorPointX,this.anchorPointY)}}Q.prototype.size=20;class it extends e{get(t){return new Q(this,t)}}_e("CollisionBoxArray",it);class Y extends Xi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Y.prototype.size=48;class ft extends T{get(t){return new Y(this,t)}}_e("PlacedSymbolArray",ft);class St extends Xi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}St.prototype.size=64;class st extends P{get(t){return new St(this,t)}}_e("SymbolInstanceArray",st);class gt extends E{getoffsetX(t){return this.float32[1*t+0]}}_e("GlyphOffsetArray",gt);class It extends _s{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}_e("SymbolLineVertexArray",It);class Ct extends Xi{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ct.prototype.size=12;class kt extends k{get(t){return new Ct(this,t)}}_e("TextAnchorOffsetArray",kt);class Gt extends Xi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Gt.prototype.size=8;class Ot extends R{get(t){return new Gt(this,t)}}_e("FeatureIndexArray",Ot);class Xt extends ba{}class Se extends ba{}class vi extends ba{}class se extends Ul{}class Ne extends du{}class Ie extends al{}class qi extends pu{}class gi extends fu{}class oi extends Di{}class xi extends _{}class yn extends a{}class rn extends f{}class qn extends y{}class Mn extends O{}const wn=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fr}=wn;class sn{constructor(t=[]){this.segments=t}prepareSegment(t,o,l,p){let g=this.segments[this.segments.length-1];return t>sn.MAX_VERTEX_ARRAY_LENGTH&&Ae(`Max vertices per segment is ${sn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>sn.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:o.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const o in t.vaos)t.vaos[o].destroy()}static simpleSegment(t,o,l,p){return new sn([{vertexOffset:t,primitiveOffset:o,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function No(n,t){return 256*(n=te(Math.floor(n),0,255))+te(Math.floor(t),0,255)}sn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_e("SegmentVector",sn);const Uo=on([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var js={exports:{}},wa={exports:{}};wa.exports=function(n,t){var o,l,p,g,v,w,A,M;for(l=n.length-(o=3&n.length),p=t,v=3432918353,w=461845907,M=0;M<l;)A=255&n.charCodeAt(M)|(255&n.charCodeAt(++M))<<8|(255&n.charCodeAt(++M))<<16|(255&n.charCodeAt(++M))<<24,++M,p=27492+(65535&(g=5*(65535&(p=(p^=A=(65535&(A=(A=(65535&A)*v+(((A>>>16)*v&65535)<<16)&4294967295)<<15|A>>>17))*w+(((A>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(A=0,o){case 3:A^=(255&n.charCodeAt(M+2))<<16;case 2:A^=(255&n.charCodeAt(M+1))<<8;case 1:p^=A=(65535&(A=(A=(65535&(A^=255&n.charCodeAt(M)))*v+(((A>>>16)*v&65535)<<16)&4294967295)<<15|A>>>17))*w+(((A>>>16)*w&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var ll=wa.exports,nr={exports:{}};nr.exports=function(n,t){for(var o,l=n.length,p=t^l,g=0;l>=4;)o=1540483477*(65535&(o=255&n.charCodeAt(g)|(255&n.charCodeAt(++g))<<8|(255&n.charCodeAt(++g))<<16|(255&n.charCodeAt(++g))<<24))+((1540483477*(o>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++g;switch(l){case 3:p^=(255&n.charCodeAt(g+2))<<16;case 2:p^=(255&n.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Hn=ll,dr=nr.exports;js.exports=Hn,js.exports.murmur3=Hn,js.exports.murmur2=dr;var Ta=D(js.exports);class vn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,o,l,p){this.ids.push(kn(t)),this.positions.push(o,l,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=kn(t);let l=0,p=this.ids.length-1;for(;l<p;){const v=l+p>>1;this.ids[v]>=o?p=v:l=v+1}const g=[];for(;this.ids[l]===o;)g.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return g}static serialize(t,o){const l=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Tr(l,p,0,l.length-1),o&&o.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(t){const o=new vn;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o}}function kn(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ta(String(n))}function Tr(n,t,o,l){for(;o<l;){const p=n[o+l>>1];let g=o-1,v=l+1;for(;;){do g++;while(n[g]<p);do v--;while(n[v]>p);if(g>=v)break;xn(n,g,v),xn(t,3*g,3*v),xn(t,3*g+1,3*v+1),xn(t,3*g+2,3*v+2)}v-o<l-v?(Tr(n,t,o,v),o=v+1):(Tr(n,t,v+1,l),l=v)}}function xn(n,t,o){const l=n[t];n[t]=n[o],n[o]=l}_e("FeaturePositionMap",vn);class Sa{constructor(t,o){this.gl=t.gl,this.location=o}}class Pc extends Sa{constructor(t,o){super(t,o),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class dh extends Sa{constructor(t,o){super(t,o),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ph extends Sa{constructor(t,o){super(t,o),this.current=Ni.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Gd=new Float32Array(16);function mu(n){return[No(255*n.r,255*n.g),No(255*n.b,255*n.a)]}class Vo{constructor(t,o,l){this.value=t,this.uniformNames=o.map(p=>`u_${p}`),this.type=l}setUniform(t,o,l){t.set(l.constantOr(this.value))}getBinding(t,o,l){return this.type==="color"?new ph(t,o):new Pc(t,o)}}class Pa{constructor(t,o){this.uniformNames=o.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr}setUniform(t,o,l,p){const g=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,o,l){return l.substr(0,9)==="u_pattern"?new dh(t,o):new Pc(t,o)}}class $o{constructor(t,o,l,p){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(g=>({name:`a_${g}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,o,l,p,g){const v=this.paintVertexArray.length,w=this.expression.evaluate(new at(0),o,{},p,[],g);this.paintVertexArray.resize(t),this._setPaintValue(v,t,w)}updatePaintArray(t,o,l,p){const g=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(t,o,g)}_setPaintValue(t,o,l){if(this.type==="color"){const p=mu(l);for(let g=t;g<o;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=t;p<o;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eo{constructor(t,o,l,p,g,v){this.expression=t,this.uniformNames=o.map(w=>`u_${w}_t`),this.type=l,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,o,l,p,g){const v=this.expression.evaluate(new at(this.zoom),o,{},p,[],g),w=this.expression.evaluate(new at(this.zoom+1),o,{},p,[],g),A=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(A,t,v,w)}updatePaintArray(t,o,l,p){const g=this.expression.evaluate({zoom:this.zoom},l,p),v=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(t,o,g,v)}_setPaintValue(t,o,l,p){if(this.type==="color"){const g=mu(l),v=mu(p);for(let w=t;w<o;w++)this.paintVertexArray.emplace(w,g[0],g[1],v[0],v[1])}else{for(let g=t;g<o;g++)this.paintVertexArray.emplace(g,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,o){const l=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=te(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,o,l){return new Pc(t,o)}}class Zo{constructor(t,o,l,p,g,v){this.expression=t,this.type=o,this.useIntegerZoom=l,this.zoom=p,this.layerId=v,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,o,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(t,o,l,p,g){this._setPaintValues(t,o,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(t,o,l,p){if(!p||!l)return;const{min:g,mid:v,max:w}=l,A=p[g],M=p[v],z=p[w];if(A&&M&&z)for(let N=t;N<o;N++)this.zoomInPaintVertexArray.emplace(N,M.tl[0],M.tl[1],M.br[0],M.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],M.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,M.tl[0],M.tl[1],M.br[0],M.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],M.pixelRatio,z.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Uo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Uo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _u{constructor(t,o,l){this.binders={},this._buffers=[];const p=[];for(const g in t.paint._values){if(!l(g))continue;const v=t.paint.get(g);if(!(v instanceof $i&&Bs(v.property.specification)))continue;const w=Wx(g,t.type),A=v.value,M=v.property.specification.type,z=v.property.useIntegerZoom,N=v.property.specification["property-type"],V=N==="cross-faded"||N==="cross-faded-data-driven";if(A.kind==="constant")this.binders[g]=V?new Pa(A.value,w):new Vo(A.value,w,M),p.push(`/u_${g}`);else if(A.kind==="source"||V){const G=Am(g,M,"source");this.binders[g]=V?new Zo(A,M,z,o,G,t.id):new $o(A,w,M,G),p.push(`/a_${g}`)}else{const G=Am(g,M,"composite");this.binders[g]=new eo(A,w,M,z,o,G),p.push(`/z_${g}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const o=this.binders[t];return o instanceof $o||o instanceof eo?o.maxValue:0}populatePaintArrays(t,o,l,p,g){for(const v in this.binders){const w=this.binders[v];(w instanceof $o||w instanceof eo||w instanceof Zo)&&w.populatePaintArray(t,o,l,p,g)}}setConstantPatternPositions(t,o){for(const l in this.binders){const p=this.binders[l];p instanceof Pa&&p.setConstantPatternPositions(t,o)}}updatePaintArrays(t,o,l,p,g){let v=!1;for(const w in t){const A=o.getPositions(w);for(const M of A){const z=l.feature(M.index);for(const N in this.binders){const V=this.binders[N];if((V instanceof $o||V instanceof eo||V instanceof Zo)&&V.expression.isStateDependent===!0){const G=p.paint.get(N);V.expression=G.value,V.updatePaintArray(M.start,M.end,z,t[w],g),v=!0}}}}return v}defines(){const t=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Vo||l instanceof Pa)&&t.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof $o||l instanceof eo)for(let p=0;p<l.paintVertexAttributes.length;p++)t.push(l.paintVertexAttributes[p].name);else if(l instanceof Zo)for(let p=0;p<Uo.members.length;p++)t.push(Uo.members[p].name)}return t}getBinderUniforms(){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Vo||l instanceof Pa||l instanceof eo)for(const p of l.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,o){const l=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof Vo||g instanceof Pa||g instanceof eo){for(const v of g.uniformNames)if(o[v]){const w=g.getBinding(t,o[v],v);l.push({name:v,property:p,binding:w})}}}return l}setUniforms(t,o,l,p){for(const{name:g,property:v,binding:w}of o)this.binders[v].setUniform(w,p,l.get(v),g)}updatePaintBuffers(t){this._buffers=[];for(const o in this.binders){const l=this.binders[o];if(t&&l instanceof Zo){const p=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof $o||l instanceof eo)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const o in this.binders){const l=this.binders[o];(l instanceof $o||l instanceof eo||l instanceof Zo)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const o=this.binders[t];(o instanceof $o||o instanceof eo||o instanceof Zo)&&o.destroy()}}}class gs{constructor(t,o,l=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new _u(p,o,l);this.needsUpload=!1,this._featureMap=new vn,this._bufferOffset=0}populatePaintArrays(t,o,l,p,g,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,o,p,g,v);o.id!==void 0&&this._featureMap.add(o.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,o,l,p){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,o,g,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Wx(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Am(n,t,o){const l={color:{source:al,composite:tt},number:{source:E,composite:al}},p=function(g){return{"line-pattern":{source:qi,composite:qi},"fill-pattern":{source:qi,composite:qi},"fill-extrusion-pattern":{source:qi,composite:qi}}[g]}(n);return p&&p[o]||l[t][o]}_e("ConstantBinder",Vo),_e("CrossFadedConstantBinder",Pa),_e("SourceExpressionBinder",$o),_e("CrossFadedCompositeBinder",Zo),_e("CompositeExpressionBinder",eo),_e("ProgramConfiguration",_u,{omit:["_buffers"]}),_e("ProgramConfigurationSet",gs);const In=8192,qd=Math.pow(2,14)-1,Im=-qd-1;function Vl(n){const t=In/n.extent,o=n.loadGeometry();for(let l=0;l<o.length;l++){const p=o[l];for(let g=0;g<p.length;g++){const v=p[g],w=Math.round(v.x*t),A=Math.round(v.y*t);v.x=te(w,Im,qd),v.y=te(A,Im,qd),(w<v.x||w>v.x+1||A<v.y||A>v.y+1)&&Ae("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function $l(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Vl(n):[]}}function fh(n,t,o,l,p){n.emplaceBack(2*t+(l+1)/2,2*o+(p+1)/2)}class Hd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Se,this.indexArray=new qn,this.segments=new sn,this.programConfigurations=new gs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){const p=this.layers[0],g=[];let v=null,w=!1;p.type==="circle"&&(v=p.layout.get("circle-sort-key"),w=!v.isConstant());for(const{feature:A,id:M,index:z,sourceLayerIndex:N}of t){const V=this.layers[0]._featureFilter.needGeometry,G=$l(A,V);if(!this.layers[0]._featureFilter.filter(new at(this.zoom),G,l))continue;const H=w?v.evaluate(G,{},l):void 0,J={id:M,properties:A.properties,type:A.type,sourceLayerIndex:N,index:z,geometry:V?G.geometry:Vl(A),patterns:{},sortKey:H};g.push(J)}w&&g.sort((A,M)=>A.sortKey-M.sortKey);for(const A of g){const{geometry:M,index:z,sourceLayerIndex:N}=A,V=t[z].feature;this.addFeature(A,M,z,l),o.featureIndex.insert(V,M,z,N,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,l,p){for(const g of o)for(const v of g){const w=v.x,A=v.y;if(w<0||w>=In||A<0||A>=In)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),z=M.vertexLength;fh(this.layoutVertexArray,w,A,-1,-1),fh(this.layoutVertexArray,w,A,1,-1),fh(this.layoutVertexArray,w,A,1,1),fh(this.layoutVertexArray,w,A,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},p)}}function Cm(n,t){for(let o=0;o<n.length;o++)if(Ac(t,n[o]))return!0;for(let o=0;o<t.length;o++)if(Ac(n,t[o]))return!0;return!!Wd(n,t)}function Kx(n,t,o){return!!Ac(n,t)||!!Kd(t,n,o)}function Em(n,t){if(n.length===1)return Mm(t,n[0]);for(let o=0;o<t.length;o++){const l=t[o];for(let p=0;p<l.length;p++)if(Ac(n,l[p]))return!0}for(let o=0;o<n.length;o++)if(Mm(t,n[o]))return!0;for(let o=0;o<t.length;o++)if(Wd(n,t[o]))return!0;return!1}function Xx(n,t,o){if(n.length>1){if(Wd(n,t))return!0;for(let l=0;l<t.length;l++)if(Kd(t[l],n,o))return!0}for(let l=0;l<n.length;l++)if(Kd(n[l],t,o))return!0;return!1}function Wd(n,t){if(n.length===0||t.length===0)return!1;for(let o=0;o<n.length-1;o++){const l=n[o],p=n[o+1];for(let g=0;g<t.length-1;g++)if(Yx(l,p,t[g],t[g+1]))return!0}return!1}function Yx(n,t,o,l){return Ke(n,o,l)!==Ke(t,o,l)&&Ke(n,t,o)!==Ke(n,t,l)}function Kd(n,t,o){const l=o*o;if(t.length===1)return n.distSqr(t[0])<l;for(let p=1;p<t.length;p++)if(Lm(n,t[p-1],t[p])<l)return!0;return!1}function Lm(n,t,o){const l=t.distSqr(o);if(l===0)return n.distSqr(t);const p=((n.x-t.x)*(o.x-t.x)+(n.y-t.y)*(o.y-t.y))/l;return n.distSqr(p<0?t:p>1?o:o.sub(t)._mult(p)._add(t))}function Mm(n,t){let o,l,p,g=!1;for(let v=0;v<n.length;v++){o=n[v];for(let w=0,A=o.length-1;w<o.length;A=w++)l=o[w],p=o[A],l.y>t.y!=p.y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(g=!g)}return g}function Ac(n,t){let o=!1;for(let l=0,p=n.length-1;l<n.length;p=l++){const g=n[l],v=n[p];g.y>t.y!=v.y>t.y&&t.x<(v.x-g.x)*(t.y-g.y)/(v.y-g.y)+g.x&&(o=!o)}return o}function Jx(n,t,o){const l=o[0],p=o[2];if(n.x<l.x&&t.x<l.x||n.x>p.x&&t.x>p.x||n.y<l.y&&t.y<l.y||n.y>p.y&&t.y>p.y)return!1;const g=Ke(n,t,o[0]);return g!==Ke(n,t,o[1])||g!==Ke(n,t,o[2])||g!==Ke(n,t,o[3])}function gu(n,t,o){const l=t.paint.get(n).value;return l.kind==="constant"?l.value:o.programConfigurations.get(t.id).getMaxValue(n)}function mh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function _h(n,t,o,l,p){if(!t[0]&&!t[1])return n;const g=K.convert(t)._mult(p);o==="viewport"&&g._rotate(-l);const v=[];for(let w=0;w<n.length;w++)v.push(n[w].sub(g));return v}let km,zm;_e("CircleBucket",Hd,{omit:["layers"]});var Qx={get paint(){return zm=zm||new _n({"circle-radius":new xe(dt.paint_circle["circle-radius"]),"circle-color":new xe(dt.paint_circle["circle-color"]),"circle-blur":new xe(dt.paint_circle["circle-blur"]),"circle-opacity":new xe(dt.paint_circle["circle-opacity"]),"circle-translate":new me(dt.paint_circle["circle-translate"]),"circle-translate-anchor":new me(dt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new me(dt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new me(dt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xe(dt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xe(dt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xe(dt.paint_circle["circle-stroke-opacity"])})},get layout(){return km=km||new _n({"circle-sort-key":new xe(dt.layout_circle["circle-sort-key"])})}},Sr=1e-6,Ic=typeof Float32Array<"u"?Float32Array:Array;function Xd(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Rm(n,t,o){var l=t[0],p=t[1],g=t[2],v=t[3],w=t[4],A=t[5],M=t[6],z=t[7],N=t[8],V=t[9],G=t[10],H=t[11],J=t[12],ot=t[13],ct=t[14],yt=t[15],ht=o[0],xt=o[1],At=o[2],Dt=o[3];return n[0]=ht*l+xt*w+At*N+Dt*J,n[1]=ht*p+xt*A+At*V+Dt*ot,n[2]=ht*g+xt*M+At*G+Dt*ct,n[3]=ht*v+xt*z+At*H+Dt*yt,n[4]=(ht=o[4])*l+(xt=o[5])*w+(At=o[6])*N+(Dt=o[7])*J,n[5]=ht*p+xt*A+At*V+Dt*ot,n[6]=ht*g+xt*M+At*G+Dt*ct,n[7]=ht*v+xt*z+At*H+Dt*yt,n[8]=(ht=o[8])*l+(xt=o[9])*w+(At=o[10])*N+(Dt=o[11])*J,n[9]=ht*p+xt*A+At*V+Dt*ot,n[10]=ht*g+xt*M+At*G+Dt*ct,n[11]=ht*v+xt*z+At*H+Dt*yt,n[12]=(ht=o[12])*l+(xt=o[13])*w+(At=o[14])*N+(Dt=o[15])*J,n[13]=ht*p+xt*A+At*V+Dt*ot,n[14]=ht*g+xt*M+At*G+Dt*ct,n[15]=ht*v+xt*z+At*H+Dt*yt,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var yu,t1=Rm;function gh(n,t,o){var l=t[0],p=t[1],g=t[2],v=t[3];return n[0]=o[0]*l+o[4]*p+o[8]*g+o[12]*v,n[1]=o[1]*l+o[5]*p+o[9]*g+o[13]*v,n[2]=o[2]*l+o[6]*p+o[10]*g+o[14]*v,n[3]=o[3]*l+o[7]*p+o[11]*g+o[15]*v,n}yu=new Ic(4),Ic!=Float32Array&&(yu[0]=0,yu[1]=0,yu[2]=0,yu[3]=0);class e1 extends wr{constructor(t){super(t,Qx)}createBucket(t){return new Hd(t)}queryRadius(t){const o=t;return gu("circle-radius",this,o)+gu("circle-stroke-width",this,o)+mh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,o,l,p,g,v,w,A){const M=_h(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,w),z=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l),N=this.paint.get("circle-pitch-alignment")==="map",V=N?M:function(H,J){return H.map(ot=>Dm(ot,J))}(M,A),G=N?z*w:z;for(const H of p)for(const J of H){const ot=N?J:Dm(J,A);let ct=G;const yt=gh([],[J.x,J.y,0,1],A);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ct*=yt[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ct*=v.cameraToCenterDistance/yt[3]),Kx(V,ot,ct))return!0}return!1}}function Dm(n,t){const o=gh([],[n.x,n.y,0,1],t);return new K(o[0]/o[3],o[1]/o[3])}class Bm extends Hd{}let Om;_e("HeatmapBucket",Bm,{omit:["layers"]});var i1={get paint(){return Om=Om||new _n({"heatmap-radius":new xe(dt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xe(dt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new me(dt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fl(dt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new me(dt.paint_heatmap["heatmap-opacity"])})}};function Yd(n,{width:t,height:o},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*o*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*o*l}`)}else p=new Uint8Array(t*o*l);return n.width=t,n.height=o,n.data=p,n}function Fm(n,{width:t,height:o},l){if(t===n.width&&o===n.height)return;const p=Yd({},{width:t,height:o},l);Jd(n,p,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,o)},l),n.width=t,n.height=o,n.data=p.data}function Jd(n,t,o,l,p,g){if(p.width===0||p.height===0)return t;if(p.width>n.width||p.height>n.height||o.x>n.width-p.width||o.y>n.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||l.x>t.width-p.width||l.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=n.data,w=t.data;if(v===w)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<p.height;A++){const M=((o.y+A)*n.width+o.x)*g,z=((l.y+A)*t.width+l.x)*g;for(let N=0;N<p.width*g;N++)w[z+N]=v[M+N]}return t}class vu{constructor(t,o){Yd(this,t,1,o)}resize(t){Fm(this,t,1)}clone(){return new vu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,l,p,g){Jd(t,o,l,p,g,1)}}class yo{constructor(t,o){Yd(this,t,4,o)}resize(t){Fm(this,t,4)}replace(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new yo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,l,p,g){Jd(t,o,l,p,g,4)}}function Nm(n){const t={},o=n.resolution||256,l=n.clips?n.clips.length:1,p=n.image||new yo({width:o,height:l});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const g=(v,w,A)=>{t[n.evaluationKey]=A;const M=n.expression.evaluate(t);p.data[v+w+0]=Math.floor(255*M.r/M.a),p.data[v+w+1]=Math.floor(255*M.g/M.a),p.data[v+w+2]=Math.floor(255*M.b/M.a),p.data[v+w+3]=Math.floor(255*M.a)};if(n.clips)for(let v=0,w=0;v<l;++v,w+=4*o)for(let A=0,M=0;A<o;A++,M+=4){const z=A/(o-1),{start:N,end:V}=n.clips[v];g(w,M,N*(1-z)+V*z)}else for(let v=0,w=0;v<o;v++,w+=4)g(0,w,v/(o-1));return p}_e("AlphaImage",vu),_e("RGBAImage",yo);class n1 extends wr{createBucket(t){return new Bm(t)}constructor(t){super(t,i1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Um;var r1={get paint(){return Um=Um||new _n({"hillshade-illumination-direction":new me(dt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new me(dt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new me(dt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new me(dt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new me(dt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new me(dt.paint_hillshade["hillshade-accent-color"])})}};class o1 extends wr{constructor(t){super(t,r1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const s1=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:a1}=s1;var Qd={exports:{}};function yh(n,t,o){o=o||2;var l,p,g,v,w,A,M,z=t&&t.length,N=z?t[0]*o:n.length,V=Vm(n,0,N,o,!0),G=[];if(!V||V.next===V.prev)return G;if(z&&(V=function(J,ot,ct,yt){var ht,xt,At,Dt=[];for(ht=0,xt=ot.length;ht<xt;ht++)(At=Vm(J,ot[ht]*yt,ht<xt-1?ot[ht+1]*yt:J.length,yt,!1))===At.next&&(At.steiner=!0),Dt.push(m1(At));for(Dt.sort(d1),ht=0;ht<Dt.length;ht++)ct=p1(Dt[ht],ct);return ct}(n,t,V,o)),n.length>80*o){l=g=n[0],p=v=n[1];for(var H=o;H<N;H+=o)(w=n[H])<l&&(l=w),(A=n[H+1])<p&&(p=A),w>g&&(g=w),A>v&&(v=A);M=(M=Math.max(g-l,v-p))!==0?32767/M:0}return xu(V,G,o,l,p,M,0),G}function Vm(n,t,o,l,p){var g,v;if(p===ip(n,t,o,l)>0)for(g=t;g<o;g+=l)v=jm(g,n[g],n[g+1],v);else for(g=o-l;g>=t;g-=l)v=jm(g,n[g],n[g+1],v);return v&&vh(v,v.next)&&(wu(v),v=v.next),v}function Zl(n,t){if(!n)return n;t||(t=n);var o,l=n;do if(o=!1,l.steiner||!vh(l,l.next)&&Tn(l.prev,l,l.next)!==0)l=l.next;else{if(wu(l),(l=t=l.prev)===l.next)break;o=!0}while(o||l!==t);return t}function xu(n,t,o,l,p,g,v){if(n){!v&&g&&function(z,N,V,G){var H=z;do H.z===0&&(H.z=tp(H.x,H.y,N,V,G)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==z);H.prevZ.nextZ=null,H.prevZ=null,function(J){var ot,ct,yt,ht,xt,At,Dt,he,Pe=1;do{for(ct=J,J=null,xt=null,At=0;ct;){for(At++,yt=ct,Dt=0,ot=0;ot<Pe&&(Dt++,yt=yt.nextZ);ot++);for(he=Pe;Dt>0||he>0&&yt;)Dt!==0&&(he===0||!yt||ct.z<=yt.z)?(ht=ct,ct=ct.nextZ,Dt--):(ht=yt,yt=yt.nextZ,he--),xt?xt.nextZ=ht:J=ht,ht.prevZ=xt,xt=ht;ct=yt}xt.nextZ=null,Pe*=2}while(At>1)}(H)}(n,l,p,g);for(var w,A,M=n;n.prev!==n.next;)if(w=n.prev,A=n.next,g?c1(n,l,p,g):l1(n))t.push(w.i/o|0),t.push(n.i/o|0),t.push(A.i/o|0),wu(n),n=A.next,M=A.next;else if((n=A)===M){v?v===1?xu(n=u1(Zl(n),t,o),t,o,l,p,g,2):v===2&&h1(n,t,o,l,p,g):xu(Zl(n),t,o,l,p,g,1);break}}}function l1(n){var t=n.prev,o=n,l=n.next;if(Tn(t,o,l)>=0)return!1;for(var p=t.x,g=o.x,v=l.x,w=t.y,A=o.y,M=l.y,z=p<g?p<v?p:v:g<v?g:v,N=w<A?w<M?w:M:A<M?A:M,V=p>g?p>v?p:v:g>v?g:v,G=w>A?w>M?w:M:A>M?A:M,H=l.next;H!==t;){if(H.x>=z&&H.x<=V&&H.y>=N&&H.y<=G&&Cc(p,w,g,A,v,M,H.x,H.y)&&Tn(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function c1(n,t,o,l){var p=n.prev,g=n,v=n.next;if(Tn(p,g,v)>=0)return!1;for(var w=p.x,A=g.x,M=v.x,z=p.y,N=g.y,V=v.y,G=w<A?w<M?w:M:A<M?A:M,H=z<N?z<V?z:V:N<V?N:V,J=w>A?w>M?w:M:A>M?A:M,ot=z>N?z>V?z:V:N>V?N:V,ct=tp(G,H,t,o,l),yt=tp(J,ot,t,o,l),ht=n.prevZ,xt=n.nextZ;ht&&ht.z>=ct&&xt&&xt.z<=yt;){if(ht.x>=G&&ht.x<=J&&ht.y>=H&&ht.y<=ot&&ht!==p&&ht!==v&&Cc(w,z,A,N,M,V,ht.x,ht.y)&&Tn(ht.prev,ht,ht.next)>=0||(ht=ht.prevZ,xt.x>=G&&xt.x<=J&&xt.y>=H&&xt.y<=ot&&xt!==p&&xt!==v&&Cc(w,z,A,N,M,V,xt.x,xt.y)&&Tn(xt.prev,xt,xt.next)>=0))return!1;xt=xt.nextZ}for(;ht&&ht.z>=ct;){if(ht.x>=G&&ht.x<=J&&ht.y>=H&&ht.y<=ot&&ht!==p&&ht!==v&&Cc(w,z,A,N,M,V,ht.x,ht.y)&&Tn(ht.prev,ht,ht.next)>=0)return!1;ht=ht.prevZ}for(;xt&&xt.z<=yt;){if(xt.x>=G&&xt.x<=J&&xt.y>=H&&xt.y<=ot&&xt!==p&&xt!==v&&Cc(w,z,A,N,M,V,xt.x,xt.y)&&Tn(xt.prev,xt,xt.next)>=0)return!1;xt=xt.nextZ}return!0}function u1(n,t,o){var l=n;do{var p=l.prev,g=l.next.next;!vh(p,g)&&$m(p,l,l.next,g)&&bu(p,g)&&bu(g,p)&&(t.push(p.i/o|0),t.push(l.i/o|0),t.push(g.i/o|0),wu(l),wu(l.next),l=n=g),l=l.next}while(l!==n);return Zl(l)}function h1(n,t,o,l,p,g){var v=n;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&_1(v,w)){var A=Zm(v,w);return v=Zl(v,v.next),A=Zl(A,A.next),xu(v,t,o,l,p,g,0),void xu(A,t,o,l,p,g,0)}w=w.next}v=v.next}while(v!==n)}function d1(n,t){return n.x-t.x}function p1(n,t){var o=function(p,g){var v,w=g,A=p.x,M=p.y,z=-1/0;do{if(M<=w.y&&M>=w.next.y&&w.next.y!==w.y){var N=w.x+(M-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(N<=A&&N>z&&(z=N,v=w.x<w.next.x?w:w.next,N===A))return v}w=w.next}while(w!==g);if(!v)return null;var V,G=v,H=v.x,J=v.y,ot=1/0;w=v;do A>=w.x&&w.x>=H&&A!==w.x&&Cc(M<J?A:z,M,H,J,M<J?z:A,M,w.x,w.y)&&(V=Math.abs(M-w.y)/(A-w.x),bu(w,p)&&(V<ot||V===ot&&(w.x>v.x||w.x===v.x&&f1(v,w)))&&(v=w,ot=V)),w=w.next;while(w!==G);return v}(n,t);if(!o)return t;var l=Zm(o,n);return Zl(l,l.next),Zl(o,o.next)}function f1(n,t){return Tn(n.prev,n,t.prev)<0&&Tn(t.next,n,n.next)<0}function tp(n,t,o,l,p){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-o)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m1(n){var t=n,o=n;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==n);return o}function Cc(n,t,o,l,p,g,v,w){return(p-v)*(t-w)>=(n-v)*(g-w)&&(n-v)*(l-w)>=(o-v)*(t-w)&&(o-v)*(g-w)>=(p-v)*(l-w)}function _1(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(o,l){var p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==l.i&&p.next.i!==l.i&&$m(p,p.next,o,l))return!0;p=p.next}while(p!==o);return!1}(n,t)&&(bu(n,t)&&bu(t,n)&&function(o,l){var p=o,g=!1,v=(o.x+l.x)/2,w=(o.y+l.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&v<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next;while(p!==o);return g}(n,t)&&(Tn(n.prev,n,t.prev)||Tn(n,t.prev,t))||vh(n,t)&&Tn(n.prev,n,n.next)>0&&Tn(t.prev,t,t.next)>0)}function Tn(n,t,o){return(t.y-n.y)*(o.x-t.x)-(t.x-n.x)*(o.y-t.y)}function vh(n,t){return n.x===t.x&&n.y===t.y}function $m(n,t,o,l){var p=bh(Tn(n,t,o)),g=bh(Tn(n,t,l)),v=bh(Tn(o,l,n)),w=bh(Tn(o,l,t));return p!==g&&v!==w||!(p!==0||!xh(n,o,t))||!(g!==0||!xh(n,l,t))||!(v!==0||!xh(o,n,l))||!(w!==0||!xh(o,t,l))}function xh(n,t,o){return t.x<=Math.max(n.x,o.x)&&t.x>=Math.min(n.x,o.x)&&t.y<=Math.max(n.y,o.y)&&t.y>=Math.min(n.y,o.y)}function bh(n){return n>0?1:n<0?-1:0}function bu(n,t){return Tn(n.prev,n,n.next)<0?Tn(n,t,n.next)>=0&&Tn(n,n.prev,t)>=0:Tn(n,t,n.prev)<0||Tn(n,n.next,t)<0}function Zm(n,t){var o=new ep(n.i,n.x,n.y),l=new ep(t.i,t.x,t.y),p=n.next,g=t.prev;return n.next=t,t.prev=n,o.next=p,p.prev=o,l.next=o,o.prev=l,g.next=l,l.prev=g,l}function jm(n,t,o,l){var p=new ep(n,t,o);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function wu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function ep(n,t,o){this.i=n,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ip(n,t,o,l){for(var p=0,g=t,v=o-l;g<o;g+=l)p+=(n[v]-n[g])*(n[g+1]+n[v+1]),v=g;return p}Qd.exports=yh,Qd.exports.default=yh,yh.deviation=function(n,t,o,l){var p=t&&t.length,g=Math.abs(ip(n,0,p?t[0]*o:n.length,o));if(p)for(var v=0,w=t.length;v<w;v++)g-=Math.abs(ip(n,t[v]*o,v<w-1?t[v+1]*o:n.length,o));var A=0;for(v=0;v<l.length;v+=3){var M=l[v]*o,z=l[v+1]*o,N=l[v+2]*o;A+=Math.abs((n[M]-n[N])*(n[z+1]-n[M+1])-(n[M]-n[z])*(n[N+1]-n[M+1]))}return g===0&&A===0?0:Math.abs((A-g)/g)},yh.flatten=function(n){for(var t=n[0][0].length,o={vertices:[],holes:[],dimensions:t},l=0,p=0;p<n.length;p++){for(var g=0;g<n[p].length;g++)for(var v=0;v<t;v++)o.vertices.push(n[p][g][v]);p>0&&o.holes.push(l+=n[p-1].length)}return o};var Gm=D(Qd.exports);function g1(n,t,o,l,p){qm(n,t,o,l||n.length-1,p||y1)}function qm(n,t,o,l,p){for(;l>o;){if(l-o>600){var g=l-o+1,v=t-o+1,w=Math.log(g),A=.5*Math.exp(2*w/3),M=.5*Math.sqrt(w*A*(g-A)/g)*(v-g/2<0?-1:1);qm(n,t,Math.max(o,Math.floor(t-v*A/g+M)),Math.min(l,Math.floor(t+(g-v)*A/g+M)),p)}var z=n[t],N=o,V=l;for(Tu(n,o,t),p(n[l],z)>0&&Tu(n,o,l);N<V;){for(Tu(n,N,V),N++,V--;p(n[N],z)<0;)N++;for(;p(n[V],z)>0;)V--}p(n[o],z)===0?Tu(n,o,V):Tu(n,++V,l),V<=t&&(o=V+1),t<=V&&(l=V-1)}}function Tu(n,t,o){var l=n[t];n[t]=n[o],n[o]=l}function y1(n,t){return n<t?-1:n>t?1:0}function np(n,t){const o=n.length;if(o<=1)return[n];const l=[];let p,g;for(let v=0;v<o;v++){const w=we(n[v]);w!==0&&(n[v].area=Math.abs(w),g===void 0&&(g=w<0),g===w<0?(p&&l.push(p),p=[n[v]]):p.push(n[v]))}if(p&&l.push(p),t>1)for(let v=0;v<l.length;v++)l[v].length<=t||(g1(l[v],t,1,l[v].length-1,v1),l[v]=l[v].slice(0,t));return l}function v1(n,t){return t.area-n.area}function rp(n,t,o){const l=o.patternDependencies;let p=!1;for(const g of t){const v=g.paint.get(`${n}-pattern`);v.isConstant()||(p=!0);const w=v.constantOr(null);w&&(p=!0,l[w.to]=!0,l[w.from]=!0)}return p}function op(n,t,o,l,p){const g=p.patternDependencies;for(const v of t){const w=v.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let A=w.evaluate({zoom:l-1},o,{},p.availableImages),M=w.evaluate({zoom:l},o,{},p.availableImages),z=w.evaluate({zoom:l+1},o,{},p.availableImages);A=A&&A.name?A.name:A,M=M&&M.name?M.name:M,z=z&&z.name?z.name:z,g[A]=!0,g[M]=!0,g[z]=!0,o.patterns[v.id]={min:A,mid:M,max:z}}}return o}class sp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vi,this.indexArray=new qn,this.indexArray2=new Mn,this.programConfigurations=new gs(t.layers,t.zoom),this.segments=new sn,this.segments2=new sn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.hasPattern=rp("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),g=!p.isConstant(),v=[];for(const{feature:w,id:A,index:M,sourceLayerIndex:z}of t){const N=this.layers[0]._featureFilter.needGeometry,V=$l(w,N);if(!this.layers[0]._featureFilter.filter(new at(this.zoom),V,l))continue;const G=g?p.evaluate(V,{},l,o.availableImages):void 0,H={id:A,properties:w.properties,type:w.type,sourceLayerIndex:z,index:M,geometry:N?V.geometry:Vl(w),patterns:{},sortKey:G};v.push(H)}g&&v.sort((w,A)=>w.sortKey-A.sortKey);for(const w of v){const{geometry:A,index:M,sourceLayerIndex:z}=w;if(this.hasPattern){const N=op("fill",this.layers,w,this.zoom,o);this.patternFeatures.push(N)}else this.addFeature(w,A,M,l,{});o.featureIndex.insert(t[M].feature,A,M,z,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}addFeatures(t,o,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,a1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,o,l,p,g){for(const v of np(o,500)){let w=0;for(const G of v)w+=G.length;const A=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),M=A.vertexLength,z=[],N=[];for(const G of v){if(G.length===0)continue;G!==v[0]&&N.push(z.length/2);const H=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),J=H.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(J+G.length-1,J),z.push(G[0].x),z.push(G[0].y);for(let ot=1;ot<G.length;ot++)this.layoutVertexArray.emplaceBack(G[ot].x,G[ot].y),this.indexArray2.emplaceBack(J+ot-1,J+ot),z.push(G[ot].x),z.push(G[ot].y);H.vertexLength+=G.length,H.primitiveLength+=G.length}const V=Gm(z,N);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(M+V[G],M+V[G+1],M+V[G+2]);A.vertexLength+=w,A.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,p)}}let Hm,Wm;_e("FillBucket",sp,{omit:["layers","patternFeatures"]});var x1={get paint(){return Wm=Wm||new _n({"fill-antialias":new me(dt.paint_fill["fill-antialias"]),"fill-opacity":new xe(dt.paint_fill["fill-opacity"]),"fill-color":new xe(dt.paint_fill["fill-color"]),"fill-outline-color":new xe(dt.paint_fill["fill-outline-color"]),"fill-translate":new me(dt.paint_fill["fill-translate"]),"fill-translate-anchor":new me(dt.paint_fill["fill-translate-anchor"]),"fill-pattern":new to(dt.paint_fill["fill-pattern"])})},get layout(){return Hm=Hm||new _n({"fill-sort-key":new xe(dt.layout_fill["fill-sort-key"])})}};class b1 extends wr{constructor(t){super(t,x1)}recalculate(t,o){super.recalculate(t,o);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new sp(t)}queryRadius(){return mh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,o,l,p,g,v,w){return Em(_h(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,w),p)}isTileClipped(){return!0}}const w1=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),T1=on([{name:"a_centroid",components:2,type:"Int16"}],4),{members:S1}=w1;var cl={},P1=q,Km=Ec;function Ec(n,t,o,l,p){this.properties={},this.extent=o,this.type=0,this._pbf=n,this._geometry=-1,this._keys=l,this._values=p,n.readFields(A1,this,t)}function A1(n,t,o){n==1?t.id=o.readVarint():n==2?function(l,p){for(var g=l.readVarint()+l.pos;l.pos<g;){var v=p._keys[l.readVarint()],w=p._values[l.readVarint()];p.properties[v]=w}}(o,t):n==3?t.type=o.readVarint():n==4&&(t._geometry=o.pos)}function I1(n){for(var t,o,l=0,p=0,g=n.length,v=g-1;p<g;v=p++)l+=((o=n[v]).x-(t=n[p]).x)*(t.y+o.y);return l}Ec.types=["Unknown","Point","LineString","Polygon"],Ec.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,o=n.readVarint()+n.pos,l=1,p=0,g=0,v=0,w=[];n.pos<o;){if(p<=0){var A=n.readVarint();l=7&A,p=A>>3}if(p--,l===1||l===2)g+=n.readSVarint(),v+=n.readSVarint(),l===1&&(t&&w.push(t),t=[]),t.push(new P1(g,v));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&w.push(t),w},Ec.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,o=1,l=0,p=0,g=0,v=1/0,w=-1/0,A=1/0,M=-1/0;n.pos<t;){if(l<=0){var z=n.readVarint();o=7&z,l=z>>3}if(l--,o===1||o===2)(p+=n.readSVarint())<v&&(v=p),p>w&&(w=p),(g+=n.readSVarint())<A&&(A=g),g>M&&(M=g);else if(o!==7)throw new Error("unknown command "+o)}return[v,A,w,M]},Ec.prototype.toGeoJSON=function(n,t,o){var l,p,g=this.extent*Math.pow(2,o),v=this.extent*n,w=this.extent*t,A=this.loadGeometry(),M=Ec.types[this.type];function z(G){for(var H=0;H<G.length;H++){var J=G[H];G[H]=[360*(J.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(l=0;l<A.length;l++)N[l]=A[l][0];z(A=N);break;case 2:for(l=0;l<A.length;l++)z(A[l]);break;case 3:for(A=function(G){var H=G.length;if(H<=1)return[G];for(var J,ot,ct=[],yt=0;yt<H;yt++){var ht=I1(G[yt]);ht!==0&&(ot===void 0&&(ot=ht<0),ot===ht<0?(J&&ct.push(J),J=[G[yt]]):J.push(G[yt]))}return J&&ct.push(J),ct}(A),l=0;l<A.length;l++)for(p=0;p<A[l].length;p++)z(A[l][p])}A.length===1?A=A[0]:M="Multi"+M;var V={type:"Feature",geometry:{type:M,coordinates:A},properties:this.properties};return"id"in this&&(V.id=this.id),V};var C1=Km,Xm=Ym;function Ym(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(E1,this,t),this.length=this._features.length}function E1(n,t,o){n===15?t.version=o.readVarint():n===1?t.name=o.readString():n===5?t.extent=o.readVarint():n===2?t._features.push(o.pos):n===3?t._keys.push(o.readString()):n===4&&t._values.push(function(l){for(var p=null,g=l.readVarint()+l.pos;l.pos<g;){var v=l.readVarint()>>3;p=v===1?l.readString():v===2?l.readFloat():v===3?l.readDouble():v===4?l.readVarint64():v===5?l.readVarint():v===6?l.readSVarint():v===7?l.readBoolean():null}return p}(o))}Ym.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new C1(this._pbf,t,this.extent,this._keys,this._values)};var L1=Xm;function M1(n,t,o){if(n===3){var l=new L1(o,o.readVarint()+o.pos);l.length&&(t[l.name]=l)}}cl.VectorTile=function(n,t){this.layers=n.readFields(M1,{},t)},cl.VectorTileFeature=Km,cl.VectorTileLayer=Xm;const k1=cl.VectorTileFeature.types,ap=Math.pow(2,13);function Su(n,t,o,l,p,g,v,w){n.emplaceBack(t,o,2*Math.floor(l*ap)+v,p*ap*2,g*ap*2,Math.round(w))}class lp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new se,this.centroidVertexArray=new Xt,this.indexArray=new qn,this.programConfigurations=new gs(t.layers,t.zoom),this.segments=new sn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.features=[],this.hasPattern=rp("fill-extrusion",this.layers,o);for(const{feature:p,id:g,index:v,sourceLayerIndex:w}of t){const A=this.layers[0]._featureFilter.needGeometry,M=$l(p,A);if(!this.layers[0]._featureFilter.filter(new at(this.zoom),M,l))continue;const z={id:g,sourceLayerIndex:w,index:v,geometry:A?M.geometry:Vl(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(op("fill-extrusion",this.layers,z,this.zoom,o)):this.addFeature(z,z.geometry,v,l,{}),o.featureIndex.insert(p,z.geometry,v,w,this.index,!0)}}addFeatures(t,o,l){for(const p of this.features){const{geometry:g}=p;this.addFeature(p,g,p.index,o,l)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,S1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,T1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,o,l,p,g){const v={x:0,y:0,vertexCount:0};for(const w of np(o,500)){let A=0;for(const H of w)A+=H.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of w){if(H.length===0||R1(H))continue;let J=0;for(let ot=0;ot<H.length;ot++){const ct=H[ot];if(ot>=1){const yt=H[ot-1];if(!z1(ct,yt)){M.vertexLength+4>sn.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ht=ct.sub(yt)._perp()._unit(),xt=yt.dist(ct);J+xt>32768&&(J=0),Su(this.layoutVertexArray,ct.x,ct.y,ht.x,ht.y,0,0,J),Su(this.layoutVertexArray,ct.x,ct.y,ht.x,ht.y,0,1,J),v.x+=2*ct.x,v.y+=2*ct.y,v.vertexCount+=2,J+=xt,Su(this.layoutVertexArray,yt.x,yt.y,ht.x,ht.y,0,0,J),Su(this.layoutVertexArray,yt.x,yt.y,ht.x,ht.y,0,1,J),v.x+=2*yt.x,v.y+=2*yt.y,v.vertexCount+=2;const At=M.vertexLength;this.indexArray.emplaceBack(At,At+2,At+1),this.indexArray.emplaceBack(At+1,At+2,At+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+A>sn.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),k1[t.type]!=="Polygon")continue;const z=[],N=[],V=M.vertexLength;for(const H of w)if(H.length!==0){H!==w[0]&&N.push(z.length/2);for(let J=0;J<H.length;J++){const ot=H[J];Su(this.layoutVertexArray,ot.x,ot.y,0,0,1,1,0),v.x+=ot.x,v.y+=ot.y,v.vertexCount+=1,z.push(ot.x),z.push(ot.y)}}const G=Gm(z,N);for(let H=0;H<G.length;H+=3)this.indexArray.emplaceBack(V+G[H],V+G[H+2],V+G[H+1]);M.primitiveLength+=G.length/3,M.vertexLength+=A}for(let w=0;w<v.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(v.x/v.vertexCount),Math.floor(v.y/v.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,p)}}function z1(n,t){return n.x===t.x&&(n.x<0||n.x>In)||n.y===t.y&&(n.y<0||n.y>In)}function R1(n){return n.every(t=>t.x<0)||n.every(t=>t.x>In)||n.every(t=>t.y<0)||n.every(t=>t.y>In)}let Jm;_e("FillExtrusionBucket",lp,{omit:["layers","features"]});var D1={get paint(){return Jm=Jm||new _n({"fill-extrusion-opacity":new me(dt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xe(dt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new me(dt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new me(dt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new to(dt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xe(dt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xe(dt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new me(dt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class B1 extends wr{constructor(t){super(t,D1)}createBucket(t){return new lp(t)}queryRadius(){return mh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,o,l,p,g,v,w,A){const M=_h(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,w),z=this.paint.get("fill-extrusion-height").evaluate(o,l),N=this.paint.get("fill-extrusion-base").evaluate(o,l),V=function(H,J,ot,ct){const yt=[];for(const ht of H){const xt=[ht.x,ht.y,0,1];gh(xt,xt,J),yt.push(new K(xt[0]/xt[3],xt[1]/xt[3]))}return yt}(M,A),G=function(H,J,ot,ct){const yt=[],ht=[],xt=ct[8]*J,At=ct[9]*J,Dt=ct[10]*J,he=ct[11]*J,Pe=ct[8]*ot,ue=ct[9]*ot,ae=ct[10]*ot,ee=ct[11]*ot;for(const ge of H){const ne=[],qt=[];for(const Be of ge){const Ee=Be.x,di=Be.y,an=ct[0]*Ee+ct[4]*di+ct[12],hn=ct[1]*Ee+ct[5]*di+ct[13],Rn=ct[2]*Ee+ct[6]*di+ct[14],io=ct[3]*Ee+ct[7]*di+ct[15],Pr=Rn+Dt,Cn=io+he,Wn=an+Pe,or=hn+ue,Ar=Rn+ae,Ir=io+ee,Dn=new K((an+xt)/Cn,(hn+At)/Cn);Dn.z=Pr/Cn,ne.push(Dn);const Bn=new K(Wn/Ir,or/Ir);Bn.z=Ar/Ir,qt.push(Bn)}yt.push(ne),ht.push(qt)}return[yt,ht]}(p,N,z,A);return function(H,J,ot){let ct=1/0;Em(ot,J)&&(ct=Qm(ot,J[0]));for(let yt=0;yt<J.length;yt++){const ht=J[yt],xt=H[yt];for(let At=0;At<ht.length-1;At++){const Dt=ht[At],he=[Dt,ht[At+1],xt[At+1],xt[At],Dt];Cm(ot,he)&&(ct=Math.min(ct,Qm(ot,he)))}}return ct!==1/0&&ct}(G[0],G[1],V)}}function Pu(n,t){return n.x*t.x+n.y*t.y}function Qm(n,t){if(n.length===1){let o=0;const l=t[o++];let p;for(;!p||l.equals(p);)if(p=t[o++],!p)return 1/0;for(;o<t.length;o++){const g=t[o],v=n[0],w=p.sub(l),A=g.sub(l),M=v.sub(l),z=Pu(w,w),N=Pu(w,A),V=Pu(A,A),G=Pu(M,w),H=Pu(M,A),J=z*V-N*N,ot=(V*G-N*H)/J,ct=(z*H-N*G)/J,yt=l.z*(1-ot-ct)+p.z*ot+g.z*ct;if(isFinite(yt))return yt}return 1/0}{let o=1/0;for(const l of t)o=Math.min(o,l.z);return o}}const O1=on([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:F1}=O1,N1=on([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:U1}=N1,V1=cl.VectorTileFeature.types,$1=Math.cos(Math.PI/180*37.5),t_=Math.pow(2,14)/.5;class cp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Ne,this.layoutVertexArray2=new Ie,this.indexArray=new qn,this.programConfigurations=new gs(t.layers,t.zoom),this.segments=new sn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.hasPattern=rp("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),g=!p.isConstant(),v=[];for(const{feature:w,id:A,index:M,sourceLayerIndex:z}of t){const N=this.layers[0]._featureFilter.needGeometry,V=$l(w,N);if(!this.layers[0]._featureFilter.filter(new at(this.zoom),V,l))continue;const G=g?p.evaluate(V,{},l):void 0,H={id:A,properties:w.properties,type:w.type,sourceLayerIndex:z,index:M,geometry:N?V.geometry:Vl(w),patterns:{},sortKey:G};v.push(H)}g&&v.sort((w,A)=>w.sortKey-A.sortKey);for(const w of v){const{geometry:A,index:M,sourceLayerIndex:z}=w;if(this.hasPattern){const N=op("line",this.layers,w,this.zoom,o);this.patternFeatures.push(N)}else this.addFeature(w,A,M,l,{});o.featureIndex.insert(t[M].feature,A,M,z,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}addFeatures(t,o,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,U1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,F1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,o,l,p,g){const v=this.layers[0].layout,w=v.get("line-join").evaluate(t,{}),A=v.get("line-cap"),M=v.get("line-miter-limit"),z=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const N of o)this.addLine(N,t,w,A,M,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,p)}addLine(t,o,l,p,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ct=0;ct<t.length-1;ct++)this.totalDistance+=t[ct].dist(t[ct+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=V1[o.type]==="Polygon";let A=t.length;for(;A>=2&&t[A-1].equals(t[A-2]);)A--;let M=0;for(;M<A-1&&t[M].equals(t[M+1]);)M++;if(A<(w?3:2))return;l==="bevel"&&(g=1.05);const z=this.overscaling<=16?15*In/(512*this.overscaling):0,N=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let V,G,H,J,ot;this.e1=this.e2=-1,w&&(V=t[A-2],ot=t[M].sub(V)._unit()._perp());for(let ct=M;ct<A;ct++){if(H=ct===A-1?w?t[M+1]:void 0:t[ct+1],H&&t[ct].equals(H))continue;ot&&(J=ot),V&&(G=V),V=t[ct],ot=H?H.sub(V)._unit()._perp():J,J=J||ot;let yt=J.add(ot);yt.x===0&&yt.y===0||yt._unit();const ht=J.x*ot.x+J.y*ot.y,xt=yt.x*ot.x+yt.y*ot.y,At=xt!==0?1/xt:1/0,Dt=2*Math.sqrt(2-2*xt),he=xt<$1&&G&&H,Pe=J.x*ot.y-J.y*ot.x>0;if(he&&ct>M){const ee=V.dist(G);if(ee>2*z){const ge=V.sub(V.sub(G)._mult(z/ee)._round());this.updateDistance(G,ge),this.addCurrentVertex(ge,J,0,0,N),G=ge}}const ue=G&&H;let ae=ue?l:w?"butt":p;if(ue&&ae==="round"&&(At<v?ae="miter":At<=2&&(ae="fakeround")),ae==="miter"&&At>g&&(ae="bevel"),ae==="bevel"&&(At>2&&(ae="flipbevel"),At<g&&(ae="miter")),G&&this.updateDistance(G,V),ae==="miter")yt._mult(At),this.addCurrentVertex(V,yt,0,0,N);else if(ae==="flipbevel"){if(At>100)yt=ot.mult(-1);else{const ee=At*J.add(ot).mag()/J.sub(ot).mag();yt._perp()._mult(ee*(Pe?-1:1))}this.addCurrentVertex(V,yt,0,0,N),this.addCurrentVertex(V,yt.mult(-1),0,0,N)}else if(ae==="bevel"||ae==="fakeround"){const ee=-Math.sqrt(At*At-1),ge=Pe?ee:0,ne=Pe?0:ee;if(G&&this.addCurrentVertex(V,J,ge,ne,N),ae==="fakeround"){const qt=Math.round(180*Dt/Math.PI/20);for(let Be=1;Be<qt;Be++){let Ee=Be/qt;if(Ee!==.5){const an=Ee-.5;Ee+=Ee*an*(Ee-1)*((1.0904+ht*(ht*(3.55645-1.43519*ht)-3.2452))*an*an+(.848013+ht*(.215638*ht-1.06021)))}const di=ot.sub(J)._mult(Ee)._add(J)._unit()._mult(Pe?-1:1);this.addHalfVertex(V,di.x,di.y,!1,Pe,0,N)}}H&&this.addCurrentVertex(V,ot,-ge,-ne,N)}else if(ae==="butt")this.addCurrentVertex(V,yt,0,0,N);else if(ae==="square"){const ee=G?1:-1;this.addCurrentVertex(V,yt,ee,ee,N)}else ae==="round"&&(G&&(this.addCurrentVertex(V,J,0,0,N),this.addCurrentVertex(V,J,1,1,N,!0)),H&&(this.addCurrentVertex(V,ot,-1,-1,N,!0),this.addCurrentVertex(V,ot,0,0,N)));if(he&&ct<A-1){const ee=V.dist(H);if(ee>2*z){const ge=V.add(H.sub(V)._mult(z/ee)._round());this.updateDistance(V,ge),this.addCurrentVertex(ge,ot,0,0,N),V=ge}}}}addCurrentVertex(t,o,l,p,g,v=!1){const w=o.y*p-o.x,A=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*l,o.y-o.x*l,v,!1,l,g),this.addHalfVertex(t,w,A,v,!0,-p,g),this.distance>t_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,o,l,p,g,v))}addHalfVertex({x:t,y:o},l,p,g,v,w,A){const M=.5*(this.lineClips?this.scaledDistance*(t_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(o<<1)+(v?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),A.primitiveLength++),v?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,o){this.distance+=t.dist(o),this.updateScaledDistance()}}let e_,i_;_e("LineBucket",cp,{omit:["layers","patternFeatures"]});var n_={get paint(){return i_=i_||new _n({"line-opacity":new xe(dt.paint_line["line-opacity"]),"line-color":new xe(dt.paint_line["line-color"]),"line-translate":new me(dt.paint_line["line-translate"]),"line-translate-anchor":new me(dt.paint_line["line-translate-anchor"]),"line-width":new xe(dt.paint_line["line-width"]),"line-gap-width":new xe(dt.paint_line["line-gap-width"]),"line-offset":new xe(dt.paint_line["line-offset"]),"line-blur":new xe(dt.paint_line["line-blur"]),"line-dasharray":new Ol(dt.paint_line["line-dasharray"]),"line-pattern":new to(dt.paint_line["line-pattern"]),"line-gradient":new Fl(dt.paint_line["line-gradient"])})},get layout(){return e_=e_||new _n({"line-cap":new me(dt.layout_line["line-cap"]),"line-join":new xe(dt.layout_line["line-join"]),"line-miter-limit":new me(dt.layout_line["line-miter-limit"]),"line-round-limit":new me(dt.layout_line["line-round-limit"]),"line-sort-key":new xe(dt.layout_line["line-sort-key"])})}};class Z1 extends xe{possiblyEvaluate(t,o){return o=new at(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(t,o)}evaluate(t,o,l,p){return o=pe({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(t,o,l,p)}}let wh;class j1 extends wr{constructor(t){super(t,n_),this.gradientVersion=0,wh||(wh=new Z1(n_.paint.properties["line-width"].specification),wh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof tr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,o){super.recalculate(t,o),this.paint._values["line-floorwidth"]=wh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new cp(t)}queryRadius(t){const o=t,l=r_(gu("line-width",this,o),gu("line-gap-width",this,o)),p=gu("line-offset",this,o);return l/2+Math.abs(p)+mh(this.paint.get("line-translate"))}queryIntersectsFeature(t,o,l,p,g,v,w){const A=_h(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,w),M=w/2*r_(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),z=this.paint.get("line-offset").evaluate(o,l);return z&&(p=function(N,V){const G=[];for(let H=0;H<N.length;H++){const J=N[H],ot=[];for(let ct=0;ct<J.length;ct++){const yt=J[ct-1],ht=J[ct],xt=J[ct+1],At=ct===0?new K(0,0):ht.sub(yt)._unit()._perp(),Dt=ct===J.length-1?new K(0,0):xt.sub(ht)._unit()._perp(),he=At._add(Dt)._unit(),Pe=he.x*Dt.x+he.y*Dt.y;Pe!==0&&he._mult(1/Pe),ot.push(he._mult(V)._add(ht))}G.push(ot)}return G}(p,z*w)),function(N,V,G){for(let H=0;H<V.length;H++){const J=V[H];if(N.length>=3){for(let ot=0;ot<J.length;ot++)if(Ac(N,J[ot]))return!0}if(Xx(N,J,G))return!0}return!1}(A,p,M)}isTileClipped(){return!0}}function r_(n,t){return t>0?t+2*n:n}const G1=on([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),q1=on([{name:"a_projected_pos",components:3,type:"Float32"}],4);on([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const H1=on([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);on([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const o_=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),W1=on([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function K1(n,t,o){return n.sections.forEach(l=>{l.text=function(p,g,v){const w=g.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),j.applyArabicShaping&&(p=j.applyArabicShaping(p)),p}(l.text,t,o)}),n}on([{name:"triangle",components:3,type:"Uint16"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),on([{type:"Float32",name:"offsetX"}]),on([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),on([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Au={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var zn=24,s_=Wi,a_=function(n,t,o,l,p){var g,v,w=8*p-l-1,A=(1<<w)-1,M=A>>1,z=-7,N=p-1,V=-1,G=n[t+N];for(N+=V,g=G&(1<<-z)-1,G>>=-z,z+=w;z>0;g=256*g+n[t+N],N+=V,z-=8);for(v=g&(1<<-z)-1,g>>=-z,z+=l;z>0;v=256*v+n[t+N],N+=V,z-=8);if(g===0)g=1-M;else{if(g===A)return v?NaN:1/0*(G?-1:1);v+=Math.pow(2,l),g-=M}return(G?-1:1)*v*Math.pow(2,g-l)},l_=function(n,t,o,l,p,g){var v,w,A,M=8*g-p-1,z=(1<<M)-1,N=z>>1,V=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=0,H=1,J=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,v=z):(v=Math.floor(Math.log(t)/Math.LN2),t*(A=Math.pow(2,-v))<1&&(v--,A*=2),(t+=v+N>=1?V/A:V*Math.pow(2,1-N))*A>=2&&(v++,A/=2),v+N>=z?(w=0,v=z):v+N>=1?(w=(t*A-1)*Math.pow(2,p),v+=N):(w=t*Math.pow(2,N-1)*Math.pow(2,p),v=0));p>=8;n[o+G]=255&w,G+=H,w/=256,p-=8);for(v=v<<p|w,M+=p;M>0;n[o+G]=255&v,G+=H,v/=256,M-=8);n[o+G-H]|=128*J};function Wi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Wi.Varint=0,Wi.Fixed64=1,Wi.Bytes=2,Wi.Fixed32=5;var up=4294967296,c_=1/up,u_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Aa(n){return n.type===Wi.Bytes?n.readVarint()+n.pos:n.pos+1}function Lc(n,t,o){return o?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function h_(n,t,o){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));o.realloc(l);for(var p=o.pos-1;p>=n;p--)o.buf[p+l]=o.buf[p]}function X1(n,t){for(var o=0;o<n.length;o++)t.writeVarint(n[o])}function Y1(n,t){for(var o=0;o<n.length;o++)t.writeSVarint(n[o])}function J1(n,t){for(var o=0;o<n.length;o++)t.writeFloat(n[o])}function Q1(n,t){for(var o=0;o<n.length;o++)t.writeDouble(n[o])}function tb(n,t){for(var o=0;o<n.length;o++)t.writeBoolean(n[o])}function eb(n,t){for(var o=0;o<n.length;o++)t.writeFixed32(n[o])}function ib(n,t){for(var o=0;o<n.length;o++)t.writeSFixed32(n[o])}function nb(n,t){for(var o=0;o<n.length;o++)t.writeFixed64(n[o])}function rb(n,t){for(var o=0;o<n.length;o++)t.writeSFixed64(n[o])}function Th(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Mc(n,t,o){n[o]=t,n[o+1]=t>>>8,n[o+2]=t>>>16,n[o+3]=t>>>24}function d_(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}Wi.prototype={destroy:function(){this.buf=null},readFields:function(n,t,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),p=l>>3,g=this.pos;this.type=7&l,n(p,t,this),this.pos===g&&this.skip(l)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=Th(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=d_(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Th(this.buf,this.pos)+Th(this.buf,this.pos+4)*up;return this.pos+=8,n},readSFixed64:function(){var n=Th(this.buf,this.pos)+d_(this.buf,this.pos+4)*up;return this.pos+=8,n},readFloat:function(){var n=a_(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=a_(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,o,l=this.buf;return t=127&(o=l[this.pos++]),o<128?t:(t|=(127&(o=l[this.pos++]))<<7,o<128?t:(t|=(127&(o=l[this.pos++]))<<14,o<128?t:(t|=(127&(o=l[this.pos++]))<<21,o<128?t:function(p,g,v){var w,A,M=v.buf;if(w=(112&(A=M[v.pos++]))>>4,A<128||(w|=(127&(A=M[v.pos++]))<<3,A<128)||(w|=(127&(A=M[v.pos++]))<<10,A<128)||(w|=(127&(A=M[v.pos++]))<<17,A<128)||(w|=(127&(A=M[v.pos++]))<<24,A<128)||(w|=(1&(A=M[v.pos++]))<<31,A<128))return Lc(p,w,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(o=l[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&u_?function(o,l,p){return u_.decode(o.subarray(l,p))}(this.buf,t,n):function(o,l,p){for(var g="",v=l;v<p;){var w,A,M,z=o[v],N=null,V=z>239?4:z>223?3:z>191?2:1;if(v+V>p)break;V===1?z<128&&(N=z):V===2?(192&(w=o[v+1]))==128&&(N=(31&z)<<6|63&w)<=127&&(N=null):V===3?(A=o[v+2],(192&(w=o[v+1]))==128&&(192&A)==128&&((N=(15&z)<<12|(63&w)<<6|63&A)<=2047||N>=55296&&N<=57343)&&(N=null)):V===4&&(A=o[v+2],M=o[v+3],(192&(w=o[v+1]))==128&&(192&A)==128&&(192&M)==128&&((N=(15&z)<<18|(63&w)<<12|(63&A)<<6|63&M)<=65535||N>=1114112)&&(N=null)),N===null?(N=65533,V=1):N>65535&&(N-=65536,g+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),g+=String.fromCharCode(N),v+=V}return g}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==Wi.Bytes)return n.push(this.readVarint(t));var o=Aa(this);for(n=n||[];this.pos<o;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==Wi.Bytes)return n.push(this.readSVarint());var t=Aa(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Wi.Bytes)return n.push(this.readBoolean());var t=Aa(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Wi.Bytes)return n.push(this.readFloat());var t=Aa(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Wi.Bytes)return n.push(this.readDouble());var t=Aa(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Wi.Bytes)return n.push(this.readFixed32());var t=Aa(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Wi.Bytes)return n.push(this.readSFixed32());var t=Aa(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Wi.Bytes)return n.push(this.readFixed64());var t=Aa(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Wi.Bytes)return n.push(this.readSFixed64());var t=Aa(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===Wi.Varint)for(;this.buf[this.pos++]>127;);else if(t===Wi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Wi.Fixed32)this.pos+=4;else{if(t!==Wi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf),this.buf=o,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Mc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Mc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Mc(this.buf,-1&n,this.pos),Mc(this.buf,Math.floor(n*c_),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Mc(this.buf,-1&n,this.pos),Mc(this.buf,Math.floor(n*c_),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,o){var l,p;if(t>=0?(l=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(g,v,w){w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7)}(l,0,o),function(g,v){var w=(7&g)<<4;v.buf[v.pos++]|=w|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(p,o)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(l,p,g){for(var v,w,A=0;A<p.length;A++){if((v=p.charCodeAt(A))>55295&&v<57344){if(!w){v>56319||A+1===p.length?(l[g++]=239,l[g++]=191,l[g++]=189):w=v;continue}if(v<56320){l[g++]=239,l[g++]=191,l[g++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(l[g++]=239,l[g++]=191,l[g++]=189,w=null);v<128?l[g++]=v:(v<2048?l[g++]=v>>6|192:(v<65536?l[g++]=v>>12|224:(l[g++]=v>>18|240,l[g++]=v>>12&63|128),l[g++]=v>>6&63|128),l[g++]=63&v|128)}return g}(this.buf,n,this.pos);var o=this.pos-t;o>=128&&h_(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeFloat:function(n){this.realloc(4),l_(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),l_(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=n[o]},writeRawMessage:function(n,t){this.pos++;var o=this.pos;n(t,this);var l=this.pos-o;l>=128&&h_(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(n,t,o){this.writeTag(n,Wi.Bytes),this.writeRawMessage(t,o)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,X1,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,Y1,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,tb,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,J1,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,Q1,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,eb,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,ib,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,nb,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,rb,t)},writeBytesField:function(n,t){this.writeTag(n,Wi.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,Wi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,Wi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,Wi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,Wi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,Wi.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,Wi.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,Wi.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,Wi.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,Wi.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var hp=D(s_);const dp=3;function ob(n,t,o){n===1&&o.readMessage(sb,t)}function sb(n,t,o){if(n===3){const{id:l,bitmap:p,width:g,height:v,left:w,top:A,advance:M}=o.readMessage(ab,{});t.push({id:l,bitmap:new vu({width:g+2*dp,height:v+2*dp},p),metrics:{width:g,height:v,left:w,top:A,advance:M}})}}function ab(n,t,o){n===1?t.id=o.readVarint():n===2?t.bitmap=o.readBytes():n===3?t.width=o.readVarint():n===4?t.height=o.readVarint():n===5?t.left=o.readSVarint():n===6?t.top=o.readSVarint():n===7&&(t.advance=o.readVarint())}const p_=dp;function f_(n){let t=0,o=0;for(const v of n)t+=v.w*v.h,o=Math.max(o,v.w);n.sort((v,w)=>w.h-v.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),o),h:1/0}];let p=0,g=0;for(const v of n)for(let w=l.length-1;w>=0;w--){const A=l[w];if(!(v.w>A.w||v.h>A.h)){if(v.x=A.x,v.y=A.y,g=Math.max(g,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===A.w&&v.h===A.h){const M=l.pop();w<l.length&&(l[w]=M)}else v.h===A.h?(A.x+=v.w,A.w-=v.w):v.w===A.w?(A.y+=v.h,A.h-=v.h):(l.push({x:A.x+v.w,y:A.y,w:A.w-v.w,h:v.h}),A.y+=v.h,A.h-=v.h);break}}return{w:p,h:g,fill:t/(p*g)||0}}const Nr=1;class pp{constructor(t,{pixelRatio:o,version:l,stretchX:p,stretchY:g,content:v}){this.paddedRect=t,this.pixelRatio=o,this.stretchX=p,this.stretchY=g,this.content=v,this.version=l}get tl(){return[this.paddedRect.x+Nr,this.paddedRect.y+Nr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Nr,this.paddedRect.y+this.paddedRect.h-Nr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Nr)/this.pixelRatio,(this.paddedRect.h-2*Nr)/this.pixelRatio]}}class m_{constructor(t,o){const l={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,l,g),this.addImages(o,p,g);const{w:v,h:w}=f_(g),A=new yo({width:v||1,height:w||1});for(const M in t){const z=t[M],N=l[M].paddedRect;yo.copy(z.data,A,{x:0,y:0},{x:N.x+Nr,y:N.y+Nr},z.data)}for(const M in o){const z=o[M],N=p[M].paddedRect,V=N.x+Nr,G=N.y+Nr,H=z.data.width,J=z.data.height;yo.copy(z.data,A,{x:0,y:0},{x:V,y:G},z.data),yo.copy(z.data,A,{x:0,y:J-1},{x:V,y:G-1},{width:H,height:1}),yo.copy(z.data,A,{x:0,y:0},{x:V,y:G+J},{width:H,height:1}),yo.copy(z.data,A,{x:H-1,y:0},{x:V-1,y:G},{width:1,height:J}),yo.copy(z.data,A,{x:0,y:0},{x:V+H,y:G},{width:1,height:J})}this.image=A,this.iconPositions=l,this.patternPositions=p}addImages(t,o,l){for(const p in t){const g=t[p],v={x:0,y:0,w:g.data.width+2*Nr,h:g.data.height+2*Nr};l.push(v),o[p]=new pp(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,o){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),o),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),o)}patchUpdatedImage(t,o,l){if(!t||!o||t.version===o.version)return;t.version=o.version;const[p,g]=t.tl;l.update(o.data,void 0,{x:p,y:g})}}var ul;_e("ImagePosition",pp),_e("ImageAtlas",m_),c.ai=void 0,(ul=c.ai||(c.ai={}))[ul.none=0]="none",ul[ul.horizontal=1]="horizontal",ul[ul.vertical=2]="vertical",ul[ul.horizontalOnly=3]="horizontalOnly";const Iu=-17;class Cu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,o){const l=new Cu;return l.scale=t||1,l.fontStack=o,l}static forImage(t){const o=new Cu;return o.imageName=t,o}}class kc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,o){const l=new kc;for(let p=0;p<t.sections.length;p++){const g=t.sections[p];g.image?l.addImageSection(g):l.addTextSection(g,o)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let o="";for(let l=0;l<t.length;l++){const p=t.charCodeAt(l+1)||null,g=t.charCodeAt(l-1)||null;o+=p&&Tc(p)&&!Au[t[l+1]]||g&&Tc(g)&&!Au[t[l-1]]||!Au[t[l]]?t[l]:Au[t[l]]}return o}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&Ph[this.text.charCodeAt(l)];l++)t++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Ph[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(t,o),this.sectionIndex=this.sectionIndex.slice(t,o)}substring(t,o){const l=new kc;return l.text=this.text.substring(t,o),l.sectionIndex=this.sectionIndex.slice(t,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,o)=>Math.max(t,this.sections[o].scale),0)}addTextSection(t,o){this.text+=t.text,this.sections.push(Cu.forText(t.scale,t.fontStack||o));const l=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(l)}addImageSection(t){const o=t.image?t.image.name:"";if(o.length===0)return void Ae("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Cu.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Ae("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sh(n,t,o,l,p,g,v,w,A,M,z,N,V,G,H,J){const ot=kc.fromFeature(n,p);let ct;N===c.ai.vertical&&ot.verticalizePunctuation();const{processBidirectionalText:yt,processStyledBidirectionalText:ht}=j;if(yt&&ot.sections.length===1){ct=[];const Dt=yt(ot.toString(),fp(ot,M,g,t,l,G,H));for(const he of Dt){const Pe=new kc;Pe.text=he,Pe.sections=ot.sections;for(let ue=0;ue<he.length;ue++)Pe.sectionIndex.push(0);ct.push(Pe)}}else if(ht){ct=[];const Dt=ht(ot.text,ot.sectionIndex,fp(ot,M,g,t,l,G,H));for(const he of Dt){const Pe=new kc;Pe.text=he[0],Pe.sectionIndex=he[1],Pe.sections=ot.sections,ct.push(Pe)}}else ct=function(Dt,he){const Pe=[],ue=Dt.text;let ae=0;for(const ee of he)Pe.push(Dt.substring(ae,ee)),ae=ee;return ae<ue.length&&Pe.push(Dt.substring(ae,ue.length)),Pe}(ot,fp(ot,M,g,t,l,G,H));const xt=[],At={positionedLines:xt,text:ot.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:N,iconsInText:!1,verticalizable:!1};return function(Dt,he,Pe,ue,ae,ee,ge,ne,qt,Be,Ee,di){let an=0,hn=Iu,Rn=0,io=0;const Pr=ne==="right"?1:ne==="left"?0:.5;let Cn=0;for(const Dn of ae){Dn.trim();const Bn=Dn.getMaxScale(),pr=(Bn-1)*zn,Cr={positionedGlyphs:[],lineOffset:0};Dt.positionedLines[Cn]=Cr;const fr=Cr.positionedGlyphs;let Ur=0;if(!Dn.length()){hn+=ee,++Cn;continue}for(let On=0;On<Dn.length();On++){const Ai=Dn.getSection(On),mr=Dn.getSectionIndex(On),sr=Dn.getCharCode(On);let Fn=0,jo=null,ys=null,vs=null,Ia=zn;const Go=!(qt===c.ai.horizontal||!Ee&&!il(sr)||Ee&&(Ph[sr]||(Wn=sr,le.Arabic(Wn)||le["Arabic Supplement"](Wn)||le["Arabic Extended-A"](Wn)||le["Arabic Presentation Forms-A"](Wn)||le["Arabic Presentation Forms-B"](Wn))));if(Ai.imageName){const xo=ue[Ai.imageName];if(!xo)continue;vs=Ai.imageName,Dt.iconsInText=Dt.iconsInText||!0,ys=xo.paddedRect;const $r=xo.displaySize;Ai.scale=Ai.scale*zn/di,jo={width:$r[0],height:$r[1],left:Nr,top:-p_,advance:Go?$r[1]:$r[0]},Fn=pr+(zn-$r[1]*Ai.scale),Ia=jo.advance;const Ca=Go?$r[0]*Ai.scale-zn*Bn:$r[1]*Ai.scale-zn*Bn;Ca>0&&Ca>Ur&&(Ur=Ca)}else{const xo=Pe[Ai.fontStack],$r=xo&&xo[sr];if($r&&$r.rect)ys=$r.rect,jo=$r.metrics;else{const Ca=he[Ai.fontStack],zu=Ca&&Ca[sr];if(!zu)continue;jo=zu.metrics}Fn=(Bn-Ai.scale)*zn}Go?(Dt.verticalizable=!0,fr.push({glyph:sr,imageName:vs,x:an,y:hn+Fn,vertical:Go,scale:Ai.scale,fontStack:Ai.fontStack,sectionIndex:mr,metrics:jo,rect:ys}),an+=Ia*Ai.scale+Be):(fr.push({glyph:sr,imageName:vs,x:an,y:hn+Fn,vertical:Go,scale:Ai.scale,fontStack:Ai.fontStack,sectionIndex:mr,metrics:jo,rect:ys}),an+=jo.advance*Ai.scale+Be)}fr.length!==0&&(Rn=Math.max(an-Be,Rn),ub(fr,0,fr.length-1,Pr,Ur)),an=0;const Vr=ee*Bn+Ur;Cr.lineOffset=Math.max(Ur,pr),hn+=Vr,io=Math.max(Vr,io),++Cn}var Wn;const or=hn-Iu,{horizontalAlign:Ar,verticalAlign:Ir}=mp(ge);(function(Dn,Bn,pr,Cr,fr,Ur,Vr,On,Ai){const mr=(Bn-pr)*fr;let sr=0;sr=Ur!==Vr?-On*Cr-Iu:(-Cr*Ai+.5)*Vr;for(const Fn of Dn)for(const jo of Fn.positionedGlyphs)jo.x+=mr,jo.y+=sr})(Dt.positionedLines,Pr,Ar,Ir,Rn,io,ee,or,ae.length),Dt.top+=-Ir*or,Dt.bottom=Dt.top+or,Dt.left+=-Ar*Rn,Dt.right=Dt.left+Rn}(At,t,o,l,ct,v,w,A,N,M,V,J),!function(Dt){for(const he of Dt)if(he.positionedGlyphs.length!==0)return!1;return!0}(xt)&&At}const Ph={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function __(n,t,o,l,p,g){if(t.imageName){const v=l[t.imageName];return v?v.displaySize[0]*t.scale*zn/g+p:0}{const v=o[t.fontStack],w=v&&v[n];return w?w.metrics.advance*t.scale+p:0}}function g_(n,t,o,l){const p=Math.pow(n-t,2);return l?n<t?p/2:2*p:p+Math.abs(o)*o}function cb(n,t,o){let l=0;return n===10&&(l-=1e4),o&&(l+=150),n!==40&&n!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function y_(n,t,o,l,p,g){let v=null,w=g_(t,o,p,g);for(const A of l){const M=g_(t-A.x,o,p,g)+A.badness;M<=w&&(v=A,w=M)}return{index:n,x:t,priorBreak:v,badness:w}}function v_(n){return n?v_(n.priorBreak).concat(n.index):[]}function fp(n,t,o,l,p,g,v){if(g!=="point")return[];if(!n)return[];const w=[],A=function(V,G,H,J,ot,ct){let yt=0;for(let ht=0;ht<V.length();ht++){const xt=V.getSection(ht);yt+=__(V.getCharCode(ht),xt,J,ot,G,ct)}return yt/Math.max(1,Math.ceil(yt/H))}(n,t,o,l,p,v),M=n.text.indexOf("​")>=0;let z=0;for(let V=0;V<n.length();V++){const G=n.getSection(V),H=n.getCharCode(V);if(Ph[H]||(z+=__(H,G,l,p,t,v)),V<n.length()-1){const J=!((N=H)<11904||!(le["Bopomofo Extended"](N)||le.Bopomofo(N)||le["CJK Compatibility Forms"](N)||le["CJK Compatibility Ideographs"](N)||le["CJK Compatibility"](N)||le["CJK Radicals Supplement"](N)||le["CJK Strokes"](N)||le["CJK Symbols and Punctuation"](N)||le["CJK Unified Ideographs Extension A"](N)||le["CJK Unified Ideographs"](N)||le["Enclosed CJK Letters and Months"](N)||le["Halfwidth and Fullwidth Forms"](N)||le.Hiragana(N)||le["Ideographic Description Characters"](N)||le["Kangxi Radicals"](N)||le["Katakana Phonetic Extensions"](N)||le.Katakana(N)||le["Vertical Forms"](N)||le["Yi Radicals"](N)||le["Yi Syllables"](N)));(lb[H]||J||G.imageName)&&w.push(y_(V+1,z,A,w,cb(H,n.getCharCode(V+1),J&&M),!1))}}var N;return v_(y_(n.length(),z,A,w,0,!0))}function mp(n){let t=.5,o=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:t,verticalAlign:o}}function ub(n,t,o,l,p){if(!l&&!p)return;const g=n[o],v=(n[o].x+g.metrics.advance*g.scale)*l;for(let w=t;w<=o;w++)n[w].x-=v,n[w].y+=p}function hb(n,t,o){const{horizontalAlign:l,verticalAlign:p}=mp(o),g=t[0]-n.displaySize[0]*l,v=t[1]-n.displaySize[1]*p;return{image:n,top:v,bottom:v+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function x_(n,t,o,l,p,g){const v=n.image;let w;if(v.content){const ot=v.content,ct=v.pixelRatio||1;w=[ot[0]/ct,ot[1]/ct,v.displaySize[0]-ot[2]/ct,v.displaySize[1]-ot[3]/ct]}const A=t.left*g,M=t.right*g;let z,N,V,G;o==="width"||o==="both"?(G=p[0]+A-l[3],N=p[0]+M+l[1]):(G=p[0]+(A+M-v.displaySize[0])/2,N=G+v.displaySize[0]);const H=t.top*g,J=t.bottom*g;return o==="height"||o==="both"?(z=p[1]+H-l[0],V=p[1]+J+l[2]):(z=p[1]+(H+J-v.displaySize[1])/2,V=z+v.displaySize[1]),{image:v,top:z,right:N,bottom:V,left:G,collisionPadding:w}}const Eu=255,Gs=128,hl=Eu*Gs;function b_(n,t){const{expression:o}=t;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new at(n+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=o;let g=0;for(;g<l.length&&l[g]<=n;)g++;g=Math.max(0,g-1);let v=g;for(;v<l.length&&l[v]<n+1;)v++;v=Math.min(l.length-1,v);const w=l[g],A=l[v];return o.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:A,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:A,minSize:o.evaluate(new at(w)),maxSize:o.evaluate(new at(A)),interpolationType:p}}}function _p(n,t,o){let l="never";const p=n.get(t);return p?l=p:n.get(o)&&(l="always"),l}const db=cl.VectorTileFeature.types,pb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ah(n,t,o,l,p,g,v,w,A,M,z,N,V){const G=w?Math.min(hl,Math.round(w[0])):0,H=w?Math.min(hl,Math.round(w[1])):0;n.emplaceBack(t,o,Math.round(32*l),Math.round(32*p),g,v,(G<<1)+(A?1:0),H,16*M,16*z,256*N,256*V)}function gp(n,t,o){n.emplaceBack(t.x,t.y,o),n.emplaceBack(t.x,t.y,o),n.emplaceBack(t.x,t.y,o),n.emplaceBack(t.x,t.y,o)}function fb(n){for(const t of n.sections)if(Sc(t.text))return!0;return!1}class yp{constructor(t){this.layoutVertexArray=new gi,this.indexArray=new qn,this.programConfigurations=t,this.segments=new sn,this.dynamicLayoutVertexArray=new oi,this.opacityVertexArray=new xi,this.hasVisibleVertices=!1,this.placedSymbolArray=new ft}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,o,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,G1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,q1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,pb,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_e("SymbolBuffers",yp);class vp{constructor(t,o,l){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new l,this.segments=new sn,this.collisionVertexArray=new rn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,H1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}_e("CollisionBuffers",vp);class zc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xd([]),this.placementViewportMatrix=Xd([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=b_(this.zoom,o["text-size"]),this.iconSizeData=b_(this.zoom,o["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),g=l.get("symbol-z-order");this.canOverlap=_p(l,"text-overlap","text-allow-overlap")!=="never"||_p(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(v=>c.ai[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new yp(new gs(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new yp(new gs(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new gt,this.lineVertexArray=new It,this.symbolInstances=new st,this.textAnchorOffsets=new kt}calculateGlyphDependencies(t,o,l,p,g){for(let v=0;v<t.length;v++)if(o[t.charCodeAt(v)]=!0,(l||p)&&g){const w=Au[t.charAt(v)];w&&(o[w.charCodeAt(0)]=!0)}}populate(t,o,l){const p=this.layers[0],g=p.layout,v=g.get("text-font"),w=g.get("text-field"),A=g.get("icon-image"),M=(w.value.kind!=="constant"||w.value.value instanceof Ln&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,N=g.get("symbol-sort-key");if(this.features=[],!M&&!z)return;const V=o.iconDependencies,G=o.glyphDependencies,H=o.availableImages,J=new at(this.zoom);for(const{feature:ot,id:ct,index:yt,sourceLayerIndex:ht}of t){const xt=p._featureFilter.needGeometry,At=$l(ot,xt);if(!p._featureFilter.filter(J,At,l))continue;let Dt,he;if(xt||(At.geometry=Vl(ot)),M){const ue=p.getValueAndResolveTokens("text-field",At,l,H),ae=Ln.factory(ue);fb(ae)&&(this.hasRTLText=!0),(!this.hasRTLText||C()==="unavailable"||this.hasRTLText&&j.isParsed())&&(Dt=K1(ae,p,At))}if(z){const ue=p.getValueAndResolveTokens("icon-image",At,l,H);he=ue instanceof mi?ue:mi.fromString(ue)}if(!Dt&&!he)continue;const Pe=this.sortFeaturesByKey?N.evaluate(At,{},l):void 0;if(this.features.push({id:ct,text:Dt,icon:he,index:yt,sourceLayerIndex:ht,geometry:At.geometry,properties:ot.properties,type:db[ot.type],sortKey:Pe}),he&&(V[he.name]=!0),Dt){const ue=v.evaluate(At,{},l).join(","),ae=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ai.vertical)>=0;for(const ee of Dt.sections)if(ee.image)V[ee.image.name]=!0;else{const ge=$s(Dt.toString()),ne=ee.fontStack||ue,qt=G[ne]=G[ne]||{};this.calculateGlyphDependencies(ee.text,qt,ae,this.allowVerticalPlacement,ge)}}}g.get("symbol-placement")==="line"&&(this.features=function(ot){const ct={},yt={},ht=[];let xt=0;function At(ue){ht.push(ot[ue]),xt++}function Dt(ue,ae,ee){const ge=yt[ue];return delete yt[ue],yt[ae]=ge,ht[ge].geometry[0].pop(),ht[ge].geometry[0]=ht[ge].geometry[0].concat(ee[0]),ge}function he(ue,ae,ee){const ge=ct[ae];return delete ct[ae],ct[ue]=ge,ht[ge].geometry[0].shift(),ht[ge].geometry[0]=ee[0].concat(ht[ge].geometry[0]),ge}function Pe(ue,ae,ee){const ge=ee?ae[0][ae[0].length-1]:ae[0][0];return`${ue}:${ge.x}:${ge.y}`}for(let ue=0;ue<ot.length;ue++){const ae=ot[ue],ee=ae.geometry,ge=ae.text?ae.text.toString():null;if(!ge){At(ue);continue}const ne=Pe(ge,ee),qt=Pe(ge,ee,!0);if(ne in yt&&qt in ct&&yt[ne]!==ct[qt]){const Be=he(ne,qt,ee),Ee=Dt(ne,qt,ht[Be].geometry);delete ct[ne],delete yt[qt],yt[Pe(ge,ht[Ee].geometry,!0)]=Ee,ht[Be].geometry=null}else ne in yt?Dt(ne,qt,ee):qt in ct?he(ne,qt,ee):(At(ue),ct[ne]=xt-1,yt[qt]=xt-1)}return ht.filter(ue=>ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ot,ct)=>ot.sortKey-ct.sortKey)}update(t,o,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,o){const l=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(o[t.segment+1]),g=t.dist(o[t.segment]);const v={};for(let w=t.segment+1;w<o.length;w++)v[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:p},w<o.length-1&&(p+=o[w+1].dist(o[w]));for(let w=t.segment||0;w>=0;w--)v[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:g},w>0&&(g+=o[w-1].dist(o[w]));for(let w=0;w<o.length;w++){const A=v[w];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,o,l,p,g,v,w,A,M,z,N,V){const G=t.indexArray,H=t.layoutVertexArray,J=t.segments.prepareSegment(4*o.length,H,G,this.canOverlap?v.sortKey:void 0),ot=this.glyphOffsetArray.length,ct=J.vertexLength,yt=this.allowVerticalPlacement&&w===c.ai.vertical?Math.PI/2:0,ht=v.text&&v.text.sections;for(let xt=0;xt<o.length;xt++){const{tl:At,tr:Dt,bl:he,br:Pe,tex:ue,pixelOffsetTL:ae,pixelOffsetBR:ee,minFontScaleX:ge,minFontScaleY:ne,glyphOffset:qt,isSDF:Be,sectionIndex:Ee}=o[xt],di=J.vertexLength,an=qt[1];Ah(H,A.x,A.y,At.x,an+At.y,ue.x,ue.y,l,Be,ae.x,ae.y,ge,ne),Ah(H,A.x,A.y,Dt.x,an+Dt.y,ue.x+ue.w,ue.y,l,Be,ee.x,ae.y,ge,ne),Ah(H,A.x,A.y,he.x,an+he.y,ue.x,ue.y+ue.h,l,Be,ae.x,ee.y,ge,ne),Ah(H,A.x,A.y,Pe.x,an+Pe.y,ue.x+ue.w,ue.y+ue.h,l,Be,ee.x,ee.y,ge,ne),gp(t.dynamicLayoutVertexArray,A,yt),G.emplaceBack(di,di+1,di+2),G.emplaceBack(di+1,di+2,di+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qt[0]),xt!==o.length-1&&Ee===o[xt+1].sectionIndex||t.programConfigurations.populatePaintArrays(H.length,v,v.index,{},V,ht&&ht[Ee])}t.placedSymbolArray.emplaceBack(A.x,A.y,ot,this.glyphOffsetArray.length-ot,ct,M,z,A.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],w,0,!1,0,N)}_addCollisionDebugVertex(t,o,l,p,g,v){return o.emplaceBack(0,0),t.emplaceBack(l.x,l.y,p,g,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,o,l,p,g,v,w){const A=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),M=A.vertexLength,z=g.layoutVertexArray,N=g.collisionVertexArray,V=w.anchorX,G=w.anchorY;this._addCollisionDebugVertex(z,N,v,V,G,new K(t,o)),this._addCollisionDebugVertex(z,N,v,V,G,new K(l,o)),this._addCollisionDebugVertex(z,N,v,V,G,new K(l,p)),this._addCollisionDebugVertex(z,N,v,V,G,new K(t,p)),A.vertexLength+=4;const H=g.indexArray;H.emplaceBack(M,M+1),H.emplaceBack(M+1,M+2),H.emplaceBack(M+2,M+3),H.emplaceBack(M+3,M),A.primitiveLength+=4}addDebugCollisionBoxes(t,o,l,p){for(let g=t;g<o;g++){const v=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,p?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vp(yn,o_.members,Mn),this.iconCollisionBox=new vp(yn,o_.members,Mn);for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(t,o,l,p,g,v,w,A,M){const z={};for(let N=o;N<l;N++){const V=t.get(N);z.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.textFeatureIndex=V.featureIndex;break}for(let N=p;N<g;N++){const V=t.get(N);z.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.verticalTextFeatureIndex=V.featureIndex;break}for(let N=v;N<w;N++){const V=t.get(N);z.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.iconFeatureIndex=V.featureIndex;break}for(let N=A;N<M;N++){const V=t.get(N);z.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.verticalIconFeatureIndex=V.featureIndex;break}return z}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,o){const l=t.placedSymbolArray.get(o),p=l.vertexStartIndex+4*l.numGlyphs;for(let g=l.vertexStartIndex;g<p;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(t),l=Math.cos(t),p=[],g=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const A=this.symbolInstances.get(w);p.push(0|Math.round(o*A.anchorX+l*A.anchorY)),g.push(A.featureIndex)}return v.sort((w,A)=>p[w]-p[A]||g[A]-g[w]),v}addToSortKeyRanges(t,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((p,g,v)=>{p>=0&&v.indexOf(p)===g&&this.addIndicesForPlacedSymbol(this.text,p)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let w_,T_;_e("SymbolBucket",zc,{omit:["layers","collisionBoxArray","features","compareText"]}),zc.MAX_GLYPHS=65535,zc.addDynamicAttributes=gp;var xp={get paint(){return T_=T_||new _n({"icon-opacity":new xe(dt.paint_symbol["icon-opacity"]),"icon-color":new xe(dt.paint_symbol["icon-color"]),"icon-halo-color":new xe(dt.paint_symbol["icon-halo-color"]),"icon-halo-width":new xe(dt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xe(dt.paint_symbol["icon-halo-blur"]),"icon-translate":new me(dt.paint_symbol["icon-translate"]),"icon-translate-anchor":new me(dt.paint_symbol["icon-translate-anchor"]),"text-opacity":new xe(dt.paint_symbol["text-opacity"]),"text-color":new xe(dt.paint_symbol["text-color"],{runtimeType:Nn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new xe(dt.paint_symbol["text-halo-color"]),"text-halo-width":new xe(dt.paint_symbol["text-halo-width"]),"text-halo-blur":new xe(dt.paint_symbol["text-halo-blur"]),"text-translate":new me(dt.paint_symbol["text-translate"]),"text-translate-anchor":new me(dt.paint_symbol["text-translate-anchor"])})},get layout(){return w_=w_||new _n({"symbol-placement":new me(dt.layout_symbol["symbol-placement"]),"symbol-spacing":new me(dt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new me(dt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xe(dt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new me(dt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new me(dt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new me(dt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new me(dt.layout_symbol["icon-ignore-placement"]),"icon-optional":new me(dt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new me(dt.layout_symbol["icon-rotation-alignment"]),"icon-size":new xe(dt.layout_symbol["icon-size"]),"icon-text-fit":new me(dt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new me(dt.layout_symbol["icon-text-fit-padding"]),"icon-image":new xe(dt.layout_symbol["icon-image"]),"icon-rotate":new xe(dt.layout_symbol["icon-rotate"]),"icon-padding":new xe(dt.layout_symbol["icon-padding"]),"icon-keep-upright":new me(dt.layout_symbol["icon-keep-upright"]),"icon-offset":new xe(dt.layout_symbol["icon-offset"]),"icon-anchor":new xe(dt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new me(dt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new me(dt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new me(dt.layout_symbol["text-rotation-alignment"]),"text-field":new xe(dt.layout_symbol["text-field"]),"text-font":new xe(dt.layout_symbol["text-font"]),"text-size":new xe(dt.layout_symbol["text-size"]),"text-max-width":new xe(dt.layout_symbol["text-max-width"]),"text-line-height":new me(dt.layout_symbol["text-line-height"]),"text-letter-spacing":new xe(dt.layout_symbol["text-letter-spacing"]),"text-justify":new xe(dt.layout_symbol["text-justify"]),"text-radial-offset":new xe(dt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new me(dt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xe(dt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xe(dt.layout_symbol["text-anchor"]),"text-max-angle":new me(dt.layout_symbol["text-max-angle"]),"text-writing-mode":new me(dt.layout_symbol["text-writing-mode"]),"text-rotate":new xe(dt.layout_symbol["text-rotate"]),"text-padding":new me(dt.layout_symbol["text-padding"]),"text-keep-upright":new me(dt.layout_symbol["text-keep-upright"]),"text-transform":new xe(dt.layout_symbol["text-transform"]),"text-offset":new xe(dt.layout_symbol["text-offset"]),"text-allow-overlap":new me(dt.layout_symbol["text-allow-overlap"]),"text-overlap":new me(dt.layout_symbol["text-overlap"]),"text-ignore-placement":new me(dt.layout_symbol["text-ignore-placement"]),"text-optional":new me(dt.layout_symbol["text-optional"])})}};class S_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:cn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_e("FormatSectionOverride",S_,{omit:["defaultValue"]});class Ih extends wr{constructor(t){super(t,xp)}recalculate(t,o){if(super.recalculate(t,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const g of l)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,o,l,p){const g=this.layout.get(t).evaluate(o,{},l,p),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||Ka(v.value)||!g?g:function(w,A){return A.replace(/{([^{}]+)}/g,(M,z)=>w&&z in w?String(w[z]):"")}(o.properties,g)}createBucket(t){return new zc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of xp.paint.overridableProperties){if(!Ih.hasPaintOverride(this.layout,t))continue;const o=this.paint.get(t),l=new S_(o),p=new fa(l,o.property.specification);let g=null;g=o.value.kind==="constant"||o.value.kind==="source"?new Ya("source",p):new Ja("composite",p,o.value.zoomStops),this.paint._values[t]=new $i(o.property,g,o.parameters)}}_handleOverridablePaintPropertyUpdate(t,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&Ih.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,o){const l=t.get("text-field"),p=xp.paint.properties[o];let g=!1;const v=w=>{for(const A of w)if(p.overrides&&p.overrides.hasOverride(A))return void(g=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Ln)v(l.value.value.sections);else if(l.value.kind==="source"){const w=M=>{g||(M instanceof Qe&&Vi(M.value)===et?v(M.value.sections):M instanceof Dr?v(M.sections):M.eachChild(w))},A=l.value;A._styleExpression&&w(A._styleExpression.expression)}return g}}let P_;var mb={get paint(){return P_=P_||new _n({"background-color":new me(dt.paint_background["background-color"]),"background-pattern":new Ol(dt.paint_background["background-pattern"]),"background-opacity":new me(dt.paint_background["background-opacity"])})}};class _b extends wr{constructor(t){super(t,mb)}}let A_;var gb={get paint(){return A_=A_||new _n({"raster-opacity":new me(dt.paint_raster["raster-opacity"]),"raster-hue-rotate":new me(dt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new me(dt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new me(dt.paint_raster["raster-brightness-max"]),"raster-saturation":new me(dt.paint_raster["raster-saturation"]),"raster-contrast":new me(dt.paint_raster["raster-contrast"]),"raster-resampling":new me(dt.paint_raster["raster-resampling"]),"raster-fade-duration":new me(dt.paint_raster["raster-fade-duration"])})}};class yb extends wr{constructor(t){super(t,gb)}}class vb extends wr{constructor(t){super(t,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class xb{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const bp=63710088e-1;class dl{constructor(t,o){if(isNaN(t)||isNaN(o))throw new Error(`Invalid LngLat object: (${t}, ${o})`);if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dl(Ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const o=Math.PI/180,l=this.lat*o,p=t.lat*o,g=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return bp*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof dl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new dl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new dl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const I_=2*Math.PI*bp;function C_(n){return I_*Math.cos(n*Math.PI/180)}function E_(n){return(180+n)/360}function L_(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function M_(n,t){return n/C_(t)}function k_(n){return 360*n-180}function wp(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class Ch{constructor(t,o,l=0){this.x=+t,this.y=+o,this.z=+l}static fromLngLat(t,o=0){const l=dl.convert(t);return new Ch(E_(l.lng),L_(l.lat),M_(o,l.lat))}toLngLat(){return new dl(k_(this.x),wp(this.y))}toAltitude(){return this.z*C_(wp(this.y))}meterInMercatorCoordinateUnits(){return 1/I_*(t=wp(this.y),1/Math.cos(t*Math.PI/180));var t}}function z_(n,t,o){var l=2*Math.PI*6378137/256/Math.pow(2,o);return[n*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Tp{constructor(t,o,l){if(t<0||t>25||l<0||l>=Math.pow(2,t)||o<0||o>=Math.pow(2,t))throw new Error(`x=${o}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=o,this.y=l,this.key=Lu(0,t,t,o,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,o,l){const p=(v=this.y,w=this.z,A=z_(256*(g=this.x),256*(v=Math.pow(2,w)-v-1),w),M=z_(256*(g+1),256*(v+1),w),A[0]+","+A[1]+","+M[0]+","+M[1]);var g,v,w,A,M;const z=function(N,V,G){let H,J="";for(let ot=N;ot>0;ot--)H=1<<ot-1,J+=(V&H?1:0)+(G&H?2:0);return J}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const o=this.z-t.z;return o>0&&t.x===this.x>>o&&t.y===this.y>>o}getTilePoint(t){const o=Math.pow(2,this.z);return new K((t.x*o-this.x)*In,(t.y*o-this.y)*In)}toString(){return`${this.z}/${this.x}/${this.y}`}}class R_{constructor(t,o){this.wrap=t,this.canonical=o,this.key=Lu(t,o.z,o.z,o.x,o.y)}}class vo{constructor(t,o,l,p,g){if(t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=o,this.canonical=new Tp(l,+p,+g),this.key=Lu(o,t,l,p,g)}clone(){return new vo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?new vo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(t,o){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?Lu(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Lu(this.wrap*+o,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o}children(t){if(this.overscaledZ>=t)return[new vo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new vo(o,this.wrap,o,l,p),new vo(o,this.wrap,o,l+1,p),new vo(o,this.wrap,o,l,p+1),new vo(o,this.wrap,o,l+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new vo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new vo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new R_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ch(t.x-this.wrap,t.y))}}function Lu(n,t,o,l,p){(n*=2)<0&&(n=-1*n-1);const g=1<<o;return(g*g*n+g*p+l).toString(36)+o.toString(36)+t.toString(36)}_e("CanonicalTileID",Tp),_e("OverscaledTileID",vo,{omit:["posMatrix"]});class D_{constructor(t,o,l,p=1,g=1,v=1,w=0){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Ae(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const A=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=g,this.blueFactor=v,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<A;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(A,M)]=this.data[this._idx(A-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,A)]=this.data[this._idx(M,A-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(A,-1)]=this.data[this._idx(A-1,0)],this.data[this._idx(-1,A)]=this.data[this._idx(0,A-1)],this.data[this._idx(A,A)]=this.data[this._idx(A-1,A-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<A;M++)for(let z=0;z<A;z++){const N=this.get(M,z);N>this.max&&(this.max=N),N<this.min&&(this.min=N)}}get(t,o){const l=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return this.unpack(l[p],l[p+1],l[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)}unpack(t,o,l){return t*this.redFactor+o*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new yo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,o,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,g=o*this.dim+this.dim,v=l*this.dim,w=l*this.dim+this.dim;switch(o){case-1:p=g-1;break;case 1:g=p+1}switch(l){case-1:v=w-1;break;case 1:w=v+1}const A=-o*this.dim,M=-l*this.dim;for(let z=v;z<w;z++)for(let N=p;N<g;N++)this.data[this._idx(N,z)]=t.data[this._idx(N+A,z+M)]}}_e("DEMData",D_);class B_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let o=0;o<t.length;o++){const l=t[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class O_{constructor(t,o,l,p,g){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=l,t._y=p,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t}}class F_{constructor(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ps(In,16,0),this.grid3D=new ps(In,16,0),this.featureIndexArray=new Ot,this.promoteId=o}insert(t,o,l,p,g,v){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,g);const A=v?this.grid3D:this.grid;for(let M=0;M<o.length;M++){const z=o[M],N=[1/0,1/0,-1/0,-1/0];for(let V=0;V<z.length;V++){const G=z[V];N[0]=Math.min(N[0],G.x),N[1]=Math.min(N[1],G.y),N[2]=Math.max(N[2],G.x),N[3]=Math.max(N[3],G.y)}N[0]<In&&N[1]<In&&N[2]>=0&&N[3]>=0&&A.insert(w,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new cl.VectorTile(new hp(this.rawTileData)).layers,this.sourceLayerCoder=new B_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,o,l,p){this.loadVTLayers();const g=t.params||{},v=In/t.tileSize/t.scale,w=Ro(g.filter),A=t.queryGeometry,M=t.queryPadding*v,z=U_(A),N=this.grid.query(z.minX-M,z.minY-M,z.maxX+M,z.maxY+M),V=U_(t.cameraQueryGeometry),G=this.grid3D.query(V.minX-M,V.minY-M,V.maxX+M,V.maxY+M,(ot,ct,yt,ht)=>function(xt,At,Dt,he,Pe){for(const ae of xt)if(At<=ae.x&&Dt<=ae.y&&he>=ae.x&&Pe>=ae.y)return!0;const ue=[new K(At,Dt),new K(At,Pe),new K(he,Pe),new K(he,Dt)];if(xt.length>2){for(const ae of ue)if(Ac(xt,ae))return!0}for(let ae=0;ae<xt.length-1;ae++)if(Jx(xt[ae],xt[ae+1],ue))return!0;return!1}(t.cameraQueryGeometry,ot-M,ct-M,yt+M,ht+M));for(const ot of G)N.push(ot);N.sort(bb);const H={};let J;for(let ot=0;ot<N.length;ot++){const ct=N[ot];if(ct===J)continue;J=ct;const yt=this.featureIndexArray.get(ct);let ht=null;this.loadMatchingFeature(H,yt.bucketIndex,yt.sourceLayerIndex,yt.featureIndex,w,g.layers,g.availableImages,o,l,p,(xt,At,Dt)=>(ht||(ht=Vl(xt)),At.queryIntersectsFeature(A,xt,Dt,ht,this.z,t.transform,v,t.pixelPosMatrix)))}return H}loadMatchingFeature(t,o,l,p,g,v,w,A,M,z,N){const V=this.bucketLayerIDs[o];if(v&&!function(ot,ct){for(let yt=0;yt<ot.length;yt++)if(ct.indexOf(ot[yt])>=0)return!0;return!1}(v,V))return;const G=this.sourceLayerCoder.decode(l),H=this.vtLayers[G].feature(p);if(g.needGeometry){const ot=$l(H,!0);if(!g.filter(new at(this.tileID.overscaledZ),ot,this.tileID.canonical))return}else if(!g.filter(new at(this.tileID.overscaledZ),H))return;const J=this.getId(H,G);for(let ot=0;ot<V.length;ot++){const ct=V[ot];if(v&&v.indexOf(ct)<0)continue;const yt=A[ct];if(!yt)continue;let ht={};J&&z&&(ht=z.getState(yt.sourceLayer||"_geojsonTileLayer",J));const xt=pe({},M[ct]);xt.paint=N_(xt.paint,yt.paint,H,ht,w),xt.layout=N_(xt.layout,yt.layout,H,ht,w);const At=!N||N(H,yt,ht);if(!At)continue;const Dt=new O_(H,this.z,this.x,this.y,J);Dt.layer=xt;let he=t[ct];he===void 0&&(he=t[ct]=[]),he.push({featureIndex:p,feature:Dt,intersectionZ:At})}}lookupSymbolFeatures(t,o,l,p,g,v,w,A){const M={};this.loadVTLayers();const z=Ro(g);for(const N of t)this.loadMatchingFeature(M,l,p,N,z,v,w,A,o);return M}hasLayer(t){for(const o of this.bucketLayerIDs)for(const l of o)if(t===l)return!0;return!1}getId(t,o){let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof l=="boolean"&&(l=Number(l))),l}}function N_(n,t,o,l,p){return ce(n,(g,v)=>{const w=t instanceof mn?t.get(v):null;return w&&w.evaluate?w.evaluate(o,l,p):w})}function U_(n){let t=1/0,o=1/0,l=-1/0,p=-1/0;for(const g of n)t=Math.min(t,g.x),o=Math.min(o,g.y),l=Math.max(l,g.x),p=Math.max(p,g.y);return{minX:t,minY:o,maxX:l,maxY:p}}function bb(n,t){return t-n}function V_(n,t,o,l,p){const g=[];for(let v=0;v<n.length;v++){const w=n[v];let A;for(let M=0;M<w.length-1;M++){let z=w[M],N=w[M+1];z.x<t&&N.x<t||(z.x<t?z=new K(t,z.y+(t-z.x)/(N.x-z.x)*(N.y-z.y))._round():N.x<t&&(N=new K(t,z.y+(t-z.x)/(N.x-z.x)*(N.y-z.y))._round()),z.y<o&&N.y<o||(z.y<o?z=new K(z.x+(o-z.y)/(N.y-z.y)*(N.x-z.x),o)._round():N.y<o&&(N=new K(z.x+(o-z.y)/(N.y-z.y)*(N.x-z.x),o)._round()),z.x>=l&&N.x>=l||(z.x>=l?z=new K(l,z.y+(l-z.x)/(N.x-z.x)*(N.y-z.y))._round():N.x>=l&&(N=new K(l,z.y+(l-z.x)/(N.x-z.x)*(N.y-z.y))._round()),z.y>=p&&N.y>=p||(z.y>=p?z=new K(z.x+(p-z.y)/(N.y-z.y)*(N.x-z.x),p)._round():N.y>=p&&(N=new K(z.x+(p-z.y)/(N.y-z.y)*(N.x-z.x),p)._round()),A&&z.equals(A[A.length-1])||(A=[z],g.push(A)),A.push(N)))))}}return g}_e("FeatureIndex",F_,{omit:["rawTileData","sourceLayerCoder"]});class pl extends K{constructor(t,o,l,p){super(t,o),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new pl(this.x,this.y,this.angle,this.segment)}}function $_(n,t,o,l,p){if(t.segment===void 0||o===0)return!0;let g=t,v=t.segment+1,w=0;for(;w>-o/2;){if(v--,v<0)return!1;w-=n[v].dist(g),g=n[v]}w+=n[v].dist(n[v+1]),v++;const A=[];let M=0;for(;w<o/2;){const z=n[v],N=n[v+1];if(!N)return!1;let V=n[v-1].angleTo(z)-z.angleTo(N);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:w,angleDelta:V}),M+=V;w-A[0].distance>l;)M-=A.shift().angleDelta;if(M>p)return!1;v++,w+=z.dist(N)}return!0}function Z_(n){let t=0;for(let o=0;o<n.length-1;o++)t+=n[o].dist(n[o+1]);return t}function j_(n,t,o){return n?.6*t*o:0}function G_(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function wb(n,t,o,l,p,g){const v=j_(o,p,g),w=G_(o,l)*g;let A=0;const M=Z_(n)/2;for(let z=0;z<n.length-1;z++){const N=n[z],V=n[z+1],G=N.dist(V);if(A+G>M){const H=(M-A)/G,J=lr.number(N.x,V.x,H),ot=lr.number(N.y,V.y,H),ct=new pl(J,ot,V.angleTo(N),z);return ct._round(),!v||$_(n,ct,w,v,t)?ct:void 0}A+=G}}function Tb(n,t,o,l,p,g,v,w,A){const M=j_(l,g,v),z=G_(l,p),N=z*v,V=n[0].x===0||n[0].x===A||n[0].y===0||n[0].y===A;return t-N<t/4&&(t=N+t/4),q_(n,V?t/2*w%t:(z/2+2*g)*v*w%t,t,M,o,N,V,!1,A)}function q_(n,t,o,l,p,g,v,w,A){const M=g/2,z=Z_(n);let N=0,V=t-o,G=[];for(let H=0;H<n.length-1;H++){const J=n[H],ot=n[H+1],ct=J.dist(ot),yt=ot.angleTo(J);for(;V+o<N+ct;){V+=o;const ht=(V-N)/ct,xt=lr.number(J.x,ot.x,ht),At=lr.number(J.y,ot.y,ht);if(xt>=0&&xt<A&&At>=0&&At<A&&V-M>=0&&V+M<=z){const Dt=new pl(xt,At,yt,H);Dt._round(),l&&!$_(n,Dt,g,l,p)||G.push(Dt)}}N+=ct}return w||G.length||v||(G=q_(n,N/2,o,l,p,g,v,!0,A)),G}_e("Anchor",pl);const Rc=Nr;function H_(n,t,o,l){const p=[],g=n.image,v=g.pixelRatio,w=g.paddedRect.w-2*Rc,A=g.paddedRect.h-2*Rc,M=n.right-n.left,z=n.bottom-n.top,N=g.stretchX||[[0,w]],V=g.stretchY||[[0,A]],G=(ee,ge)=>ee+ge[1]-ge[0],H=N.reduce(G,0),J=V.reduce(G,0),ot=w-H,ct=A-J;let yt=0,ht=H,xt=0,At=J,Dt=0,he=ot,Pe=0,ue=ct;if(g.content&&l){const ee=g.content;yt=Eh(N,0,ee[0]),xt=Eh(V,0,ee[1]),ht=Eh(N,ee[0],ee[2]),At=Eh(V,ee[1],ee[3]),Dt=ee[0]-yt,Pe=ee[1]-xt,he=ee[2]-ee[0]-ht,ue=ee[3]-ee[1]-At}const ae=(ee,ge,ne,qt)=>{const Be=Lh(ee.stretch-yt,ht,M,n.left),Ee=Mh(ee.fixed-Dt,he,ee.stretch,H),di=Lh(ge.stretch-xt,At,z,n.top),an=Mh(ge.fixed-Pe,ue,ge.stretch,J),hn=Lh(ne.stretch-yt,ht,M,n.left),Rn=Mh(ne.fixed-Dt,he,ne.stretch,H),io=Lh(qt.stretch-xt,At,z,n.top),Pr=Mh(qt.fixed-Pe,ue,qt.stretch,J),Cn=new K(Be,di),Wn=new K(hn,di),or=new K(hn,io),Ar=new K(Be,io),Ir=new K(Ee/v,an/v),Dn=new K(Rn/v,Pr/v),Bn=t*Math.PI/180;if(Bn){const fr=Math.sin(Bn),Ur=Math.cos(Bn),Vr=[Ur,-fr,fr,Ur];Cn._matMult(Vr),Wn._matMult(Vr),Ar._matMult(Vr),or._matMult(Vr)}const pr=ee.stretch+ee.fixed,Cr=ge.stretch+ge.fixed;return{tl:Cn,tr:Wn,bl:Ar,br:or,tex:{x:g.paddedRect.x+Rc+pr,y:g.paddedRect.y+Rc+Cr,w:ne.stretch+ne.fixed-pr,h:qt.stretch+qt.fixed-Cr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ir,pixelOffsetBR:Dn,minFontScaleX:he/v/M,minFontScaleY:ue/v/z,isSDF:o}};if(l&&(g.stretchX||g.stretchY)){const ee=W_(N,ot,H),ge=W_(V,ct,J);for(let ne=0;ne<ee.length-1;ne++){const qt=ee[ne],Be=ee[ne+1];for(let Ee=0;Ee<ge.length-1;Ee++)p.push(ae(qt,ge[Ee],Be,ge[Ee+1]))}}else p.push(ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:A+1}));return p}function Eh(n,t,o){let l=0;for(const p of n)l+=Math.max(t,Math.min(o,p[1]))-Math.max(t,Math.min(o,p[0]));return l}function W_(n,t,o){const l=[{fixed:-Rc,stretch:0}];for(const[p,g]of n){const v=l[l.length-1];l.push({fixed:p-v.stretch,stretch:v.stretch}),l.push({fixed:p-v.stretch,stretch:v.stretch+(g-p)})}return l.push({fixed:t+Rc,stretch:o}),l}function Lh(n,t,o,l){return n/t*o+l}function Mh(n,t,o,l){return n-t*o/l}class kh{constructor(t,o,l,p,g,v,w,A,M,z){if(this.boxStartIndex=t.length,M){let N=v.top,V=v.bottom;const G=v.collisionPadding;G&&(N-=G[1],V+=G[3]);let H=V-N;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let N=v.top*w-A[0],V=v.bottom*w+A[2],G=v.left*w-A[3],H=v.right*w+A[1];const J=v.collisionPadding;if(J&&(G-=J[0]*w,N-=J[1]*w,H+=J[2]*w,V+=J[3]*w),z){const ot=new K(G,N),ct=new K(H,N),yt=new K(G,V),ht=new K(H,V),xt=z*Math.PI/180;ot._rotate(xt),ct._rotate(xt),yt._rotate(xt),ht._rotate(xt),G=Math.min(ot.x,ct.x,yt.x,ht.x),H=Math.max(ot.x,ct.x,yt.x,ht.x),N=Math.min(ot.y,ct.y,yt.y,ht.y),V=Math.max(ot.y,ct.y,yt.y,ht.y)}t.emplaceBack(o.x,o.y,G,N,H,V,l,p,g)}this.boxEndIndex=t.length}}class Sb{constructor(t=[],o=Pb){if(this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:o,compare:l}=this,p=o[t];for(;t>0;){const g=t-1>>1,v=o[g];if(l(p,v)>=0)break;o[t]=v,t=g}o[t]=p}_down(t){const{data:o,compare:l}=this,p=this.length>>1,g=o[t];for(;t<p;){let v=1+(t<<1),w=o[v];const A=v+1;if(A<this.length&&l(o[A],w)<0&&(v=A,w=o[A]),l(w,g)>=0)break;o[t]=w,t=v}o[t]=g}}function Pb(n,t){return n<t?-1:n>t?1:0}function Ab(n,t=1,o=!1){let l=1/0,p=1/0,g=-1/0,v=-1/0;const w=n[0];for(let G=0;G<w.length;G++){const H=w[G];(!G||H.x<l)&&(l=H.x),(!G||H.y<p)&&(p=H.y),(!G||H.x>g)&&(g=H.x),(!G||H.y>v)&&(v=H.y)}const A=Math.min(g-l,v-p);let M=A/2;const z=new Sb([],Ib);if(A===0)return new K(l,p);for(let G=l;G<g;G+=A)for(let H=p;H<v;H+=A)z.push(new Dc(G+M,H+M,M,n));let N=function(G){let H=0,J=0,ot=0;const ct=G[0];for(let yt=0,ht=ct.length,xt=ht-1;yt<ht;xt=yt++){const At=ct[yt],Dt=ct[xt],he=At.x*Dt.y-Dt.x*At.y;J+=(At.x+Dt.x)*he,ot+=(At.y+Dt.y)*he,H+=3*he}return new Dc(J/H,ot/H,0,G)}(n),V=z.length;for(;z.length;){const G=z.pop();(G.d>N.d||!N.d)&&(N=G,o&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,V)),G.max-N.d<=t||(M=G.h/2,z.push(new Dc(G.p.x-M,G.p.y-M,M,n)),z.push(new Dc(G.p.x+M,G.p.y-M,M,n)),z.push(new Dc(G.p.x-M,G.p.y+M,M,n)),z.push(new Dc(G.p.x+M,G.p.y+M,M,n)),V+=4)}return o&&(console.log(`num probes: ${V}`),console.log(`best distance: ${N.d}`)),N.p}function Ib(n,t){return t.max-n.max}function Dc(n,t,o,l){this.p=new K(n,t),this.h=o,this.d=function(p,g){let v=!1,w=1/0;for(let A=0;A<g.length;A++){const M=g[A];for(let z=0,N=M.length,V=N-1;z<N;V=z++){const G=M[z],H=M[V];G.y>p.y!=H.y>p.y&&p.x<(H.x-G.x)*(p.y-G.y)/(H.y-G.y)+G.x&&(v=!v),w=Math.min(w,Lm(p,G,H))}}return(v?1:-1)*Math.sqrt(w)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var rr;c.aq=void 0,(rr=c.aq||(c.aq={}))[rr.center=1]="center",rr[rr.left=2]="left",rr[rr.right=3]="right",rr[rr.top=4]="top",rr[rr.bottom=5]="bottom",rr[rr["top-left"]=6]="top-left",rr[rr["top-right"]=7]="top-right",rr[rr["bottom-left"]=8]="bottom-left",rr[rr["bottom-right"]=9]="bottom-right";const fl=7,Sp=Number.POSITIVE_INFINITY;function K_(n,t){return t[1]!==Sp?function(o,l,p){let g=0,v=0;switch(l=Math.abs(l),p=Math.abs(p),o){case"top-right":case"top-left":case"top":v=p-fl;break;case"bottom-right":case"bottom-left":case"bottom":v=-p+fl}switch(o){case"top-right":case"bottom-right":case"right":g=-l;break;case"top-left":case"bottom-left":case"left":g=l}return[g,v]}(n,t[0],t[1]):function(o,l){let p=0,g=0;l<0&&(l=0);const v=l/Math.SQRT2;switch(o){case"top-right":case"top-left":g=v-fl;break;case"bottom-right":case"bottom-left":g=-v+fl;break;case"bottom":g=-l+fl;break;case"top":g=l-fl}switch(o){case"top-right":case"bottom-right":p=-v;break;case"top-left":case"bottom-left":p=v;break;case"left":p=l;break;case"right":p=-l}return[p,g]}(n,t[0])}function X_(n,t,o){var l;const p=n.layout,g=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},o);if(g){const w=g.values,A=[];for(let M=0;M<w.length;M+=2){const z=A[M]=w[M],N=w[M+1].map(V=>V*zn);z.startsWith("top")?N[1]-=fl:z.startsWith("bottom")&&(N[1]+=fl),A[M+1]=N}return new ii(A)}const v=p.get("text-variable-anchor");if(v){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},o)*zn,Sp]:p.get("text-offset").evaluate(t,{},o).map(M=>M*zn);const A=[];for(const M of v)A.push(M,K_(M,w));return new ii(A)}return null}function Pp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cb(n,t,o,l,p,g,v,w,A,M,z){let N=g.textMaxSize.evaluate(t,{});N===void 0&&(N=v);const V=n.layers[0].layout,G=V.get("icon-offset").evaluate(t,{},z),H=J_(o.horizontal),J=v/24,ot=n.tilePixelRatio*J,ct=n.tilePixelRatio*N/24,yt=n.tilePixelRatio*w,ht=n.tilePixelRatio*V.get("symbol-spacing"),xt=V.get("text-padding")*n.tilePixelRatio,At=function(qt,Be,Ee,di=1){const an=qt.get("icon-padding").evaluate(Be,{},Ee),hn=an&&an.values;return[hn[0]*di,hn[1]*di,hn[2]*di,hn[3]*di]}(V,t,z,n.tilePixelRatio),Dt=V.get("text-max-angle")/180*Math.PI,he=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",Pe=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",ue=V.get("symbol-placement"),ae=ht/2,ee=V.get("icon-text-fit");let ge;l&&ee!=="none"&&(n.allowVerticalPlacement&&o.vertical&&(ge=x_(l,o.vertical,ee,V.get("icon-text-fit-padding"),G,J)),H&&(l=x_(l,H,ee,V.get("icon-text-fit-padding"),G,J)));const ne=(qt,Be)=>{Be.x<0||Be.x>=In||Be.y<0||Be.y>=In||function(Ee,di,an,hn,Rn,io,Pr,Cn,Wn,or,Ar,Ir,Dn,Bn,pr,Cr,fr,Ur,Vr,On,Ai,mr,sr,Fn,jo){const ys=Ee.addToLineVertexArray(di,an);let vs,Ia,Go,xo,$r=0,Ca=0,zu=0,ig=0,zp=-1,Rp=-1;const Ea={};let ng=Ta("");if(Ee.allowVerticalPlacement&&hn.vertical){const _r=Cn.layout.get("text-rotate").evaluate(Ai,{},Fn)+90;Go=new kh(Wn,di,or,Ar,Ir,hn.vertical,Dn,Bn,pr,_r),Pr&&(xo=new kh(Wn,di,or,Ar,Ir,Pr,fr,Ur,pr,_r))}if(Rn){const _r=Cn.layout.get("icon-rotate").evaluate(Ai,{}),bo=Cn.layout.get("icon-text-fit")!=="none",jl=H_(Rn,_r,sr,bo),bs=Pr?H_(Pr,_r,sr,bo):void 0;Ia=new kh(Wn,di,or,Ar,Ir,Rn,fr,Ur,!1,_r),$r=4*jl.length;const Gl=Ee.iconSizeData;let qs=null;Gl.kind==="source"?(qs=[Gs*Cn.layout.get("icon-size").evaluate(Ai,{})],qs[0]>hl&&Ae(`${Ee.layerIds[0]}: Value for "icon-size" is >= ${Eu}. Reduce your "icon-size".`)):Gl.kind==="composite"&&(qs=[Gs*mr.compositeIconSizes[0].evaluate(Ai,{},Fn),Gs*mr.compositeIconSizes[1].evaluate(Ai,{},Fn)],(qs[0]>hl||qs[1]>hl)&&Ae(`${Ee.layerIds[0]}: Value for "icon-size" is >= ${Eu}. Reduce your "icon-size".`)),Ee.addSymbols(Ee.icon,jl,qs,On,Vr,Ai,c.ai.none,di,ys.lineStartIndex,ys.lineLength,-1,Fn),zp=Ee.icon.placedSymbolArray.length-1,bs&&(Ca=4*bs.length,Ee.addSymbols(Ee.icon,bs,qs,On,Vr,Ai,c.ai.vertical,di,ys.lineStartIndex,ys.lineLength,-1,Fn),Rp=Ee.icon.placedSymbolArray.length-1)}const rg=Object.keys(hn.horizontal);for(const _r of rg){const bo=hn.horizontal[_r];if(!vs){ng=Ta(bo.text);const bs=Cn.layout.get("text-rotate").evaluate(Ai,{},Fn);vs=new kh(Wn,di,or,Ar,Ir,bo,Dn,Bn,pr,bs)}const jl=bo.positionedLines.length===1;if(zu+=Y_(Ee,di,bo,io,Cn,pr,Ai,Cr,ys,hn.vertical?c.ai.horizontal:c.ai.horizontalOnly,jl?rg:[_r],Ea,zp,mr,Fn),jl)break}hn.vertical&&(ig+=Y_(Ee,di,hn.vertical,io,Cn,pr,Ai,Cr,ys,c.ai.vertical,["vertical"],Ea,Rp,mr,Fn));const Mb=vs?vs.boxStartIndex:Ee.collisionBoxArray.length,kb=vs?vs.boxEndIndex:Ee.collisionBoxArray.length,zb=Go?Go.boxStartIndex:Ee.collisionBoxArray.length,Rb=Go?Go.boxEndIndex:Ee.collisionBoxArray.length,Db=Ia?Ia.boxStartIndex:Ee.collisionBoxArray.length,Bb=Ia?Ia.boxEndIndex:Ee.collisionBoxArray.length,Ob=xo?xo.boxStartIndex:Ee.collisionBoxArray.length,Fb=xo?xo.boxEndIndex:Ee.collisionBoxArray.length;let xs=-1;const Rh=(_r,bo)=>_r&&_r.circleDiameter?Math.max(_r.circleDiameter,bo):bo;xs=Rh(vs,xs),xs=Rh(Go,xs),xs=Rh(Ia,xs),xs=Rh(xo,xs);const og=xs>-1?1:0;og&&(xs*=jo/zn),Ee.glyphOffsetArray.length>=zc.MAX_GLYPHS&&Ae("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ai.sortKey!==void 0&&Ee.addToSortKeyRanges(Ee.symbolInstances.length,Ai.sortKey);const Nb=X_(Cn,Ai,Fn),[Ub,Vb]=function(_r,bo){const jl=_r.length,bs=bo==null?void 0:bo.values;if((bs==null?void 0:bs.length)>0)for(let Gl=0;Gl<bs.length;Gl+=2){const qs=bs[Gl+1];_r.emplaceBack(c.aq[bs[Gl]],qs[0],qs[1])}return[jl,_r.length]}(Ee.textAnchorOffsets,Nb);Ee.symbolInstances.emplaceBack(di.x,di.y,Ea.right>=0?Ea.right:-1,Ea.center>=0?Ea.center:-1,Ea.left>=0?Ea.left:-1,Ea.vertical||-1,zp,Rp,ng,Mb,kb,zb,Rb,Db,Bb,Ob,Fb,or,zu,ig,$r,Ca,og,0,Dn,xs,Ub,Vb)}(n,Be,qt,o,l,p,ge,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ot,[xt,xt,xt,xt],he,A,yt,At,Pe,G,t,g,M,z,v)};if(ue==="line")for(const qt of V_(t.geometry,0,0,In,In)){const Be=Tb(qt,ht,Dt,o.vertical||H,l,24,ct,n.overscaling,In);for(const Ee of Be)H&&Eb(n,H.text,ae,Ee)||ne(qt,Ee)}else if(ue==="line-center"){for(const qt of t.geometry)if(qt.length>1){const Be=wb(qt,Dt,o.vertical||H,l,24,ct);Be&&ne(qt,Be)}}else if(t.type==="Polygon")for(const qt of np(t.geometry,0)){const Be=Ab(qt,16);ne(qt[0],new pl(Be.x,Be.y,0))}else if(t.type==="LineString")for(const qt of t.geometry)ne(qt,new pl(qt[0].x,qt[0].y,0));else if(t.type==="Point")for(const qt of t.geometry)for(const Be of qt)ne([Be],new pl(Be.x,Be.y,0))}function Y_(n,t,o,l,p,g,v,w,A,M,z,N,V,G,H){const J=function(yt,ht,xt,At,Dt,he,Pe,ue){const ae=At.layout.get("text-rotate").evaluate(he,{})*Math.PI/180,ee=[];for(const ge of ht.positionedLines)for(const ne of ge.positionedGlyphs){if(!ne.rect)continue;const qt=ne.rect||{};let Be=p_+1,Ee=!0,di=1,an=0;const hn=(Dt||ue)&&ne.vertical,Rn=ne.metrics.advance*ne.scale/2;if(ue&&ht.verticalizable&&(an=ge.lineOffset/2-(ne.imageName?-(zn-ne.metrics.width*ne.scale)/2:(ne.scale-1)*zn)),ne.imageName){const On=Pe[ne.imageName];Ee=On.sdf,di=On.pixelRatio,Be=Nr/di}const io=Dt?[ne.x+Rn,ne.y]:[0,0];let Pr=Dt?[0,0]:[ne.x+Rn+xt[0],ne.y+xt[1]-an],Cn=[0,0];hn&&(Cn=Pr,Pr=[0,0]);const Wn=ne.metrics.isDoubleResolution?2:1,or=(ne.metrics.left-Be)*ne.scale-Rn+Pr[0],Ar=(-ne.metrics.top-Be)*ne.scale+Pr[1],Ir=or+qt.w/Wn*ne.scale/di,Dn=Ar+qt.h/Wn*ne.scale/di,Bn=new K(or,Ar),pr=new K(Ir,Ar),Cr=new K(or,Dn),fr=new K(Ir,Dn);if(hn){const On=new K(-Rn,Rn-Iu),Ai=-Math.PI/2,mr=zn/2-Rn,sr=new K(5-Iu-mr,-(ne.imageName?mr:0)),Fn=new K(...Cn);Bn._rotateAround(Ai,On)._add(sr)._add(Fn),pr._rotateAround(Ai,On)._add(sr)._add(Fn),Cr._rotateAround(Ai,On)._add(sr)._add(Fn),fr._rotateAround(Ai,On)._add(sr)._add(Fn)}if(ae){const On=Math.sin(ae),Ai=Math.cos(ae),mr=[Ai,-On,On,Ai];Bn._matMult(mr),pr._matMult(mr),Cr._matMult(mr),fr._matMult(mr)}const Ur=new K(0,0),Vr=new K(0,0);ee.push({tl:Bn,tr:pr,bl:Cr,br:fr,tex:qt,writingMode:ht.writingMode,glyphOffset:io,sectionIndex:ne.sectionIndex,isSDF:Ee,pixelOffsetTL:Ur,pixelOffsetBR:Vr,minFontScaleX:0,minFontScaleY:0})}return ee}(0,o,w,p,g,v,l,n.allowVerticalPlacement),ot=n.textSizeData;let ct=null;ot.kind==="source"?(ct=[Gs*p.layout.get("text-size").evaluate(v,{})],ct[0]>hl&&Ae(`${n.layerIds[0]}: Value for "text-size" is >= ${Eu}. Reduce your "text-size".`)):ot.kind==="composite"&&(ct=[Gs*G.compositeTextSizes[0].evaluate(v,{},H),Gs*G.compositeTextSizes[1].evaluate(v,{},H)],(ct[0]>hl||ct[1]>hl)&&Ae(`${n.layerIds[0]}: Value for "text-size" is >= ${Eu}. Reduce your "text-size".`)),n.addSymbols(n.text,J,ct,w,g,v,M,t,A.lineStartIndex,A.lineLength,V,H);for(const yt of z)N[yt]=n.text.placedSymbolArray.length-1;return 4*J.length}function J_(n){for(const t in n)return n[t];return null}function Eb(n,t,o,l){const p=n.compareText;if(t in p){const g=p[t];for(let v=g.length-1;v>=0;v--)if(l.dist(g[v])<o)return!0}else p[t]=[];return p[t].push(l),!1}const Q_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ap{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,l]=new Uint8Array(t,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const g=Q_[15&l];if(!g)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new Ap(w,v,g,t)}constructor(t,o=64,l=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Q_.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+A,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+A),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+A,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=t)}add(t,o){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=o,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ip(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,o,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:w}=this,A=[0,g.length-1,0],M=[];for(;A.length;){const z=A.pop()||0,N=A.pop()||0,V=A.pop()||0;if(N-V<=w){for(let ot=V;ot<=N;ot++){const ct=v[2*ot],yt=v[2*ot+1];ct>=t&&ct<=l&&yt>=o&&yt<=p&&M.push(g[ot])}continue}const G=V+N>>1,H=v[2*G],J=v[2*G+1];H>=t&&H<=l&&J>=o&&J<=p&&M.push(g[G]),(z===0?t<=H:o<=J)&&(A.push(V),A.push(G-1),A.push(1-z)),(z===0?l>=H:p>=J)&&(A.push(G+1),A.push(N),A.push(1-z))}return M}within(t,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,w=[0,p.length-1,0],A=[],M=l*l;for(;w.length;){const z=w.pop()||0,N=w.pop()||0,V=w.pop()||0;if(N-V<=v){for(let ot=V;ot<=N;ot++)eg(g[2*ot],g[2*ot+1],t,o)<=M&&A.push(p[ot]);continue}const G=V+N>>1,H=g[2*G],J=g[2*G+1];eg(H,J,t,o)<=M&&A.push(p[G]),(z===0?t-l<=H:o-l<=J)&&(w.push(V),w.push(G-1),w.push(1-z)),(z===0?t+l>=H:o+l>=J)&&(w.push(G+1),w.push(N),w.push(1-z))}return A}}function Ip(n,t,o,l,p,g){if(p-l<=o)return;const v=l+p>>1;tg(n,t,v,l,p,g),Ip(n,t,o,l,v-1,1-g),Ip(n,t,o,v+1,p,1-g)}function tg(n,t,o,l,p,g){for(;p>l;){if(p-l>600){const M=p-l+1,z=o-l+1,N=Math.log(M),V=.5*Math.exp(2*N/3),G=.5*Math.sqrt(N*V*(M-V)/M)*(z-M/2<0?-1:1);tg(n,t,o,Math.max(l,Math.floor(o-z*V/M+G)),Math.min(p,Math.floor(o+(M-z)*V/M+G)),g)}const v=t[2*o+g];let w=l,A=p;for(Mu(n,t,l,o),t[2*p+g]>v&&Mu(n,t,l,p);w<A;){for(Mu(n,t,w,A),w++,A--;t[2*w+g]<v;)w++;for(;t[2*A+g]>v;)A--}t[2*l+g]===v?Mu(n,t,l,A):(A++,Mu(n,t,A,p)),A<=o&&(l=A+1),o<=A&&(p=A-1)}}function Mu(n,t,o,l){Cp(n,o,l),Cp(t,2*o,2*l),Cp(t,2*o+1,2*l+1)}function Cp(n,t,o){const l=n[t];n[t]=n[o],n[o]=l}function eg(n,t,o,l){const p=n-o,g=t-l;return p*p+g*g}var Ep;c.bh=void 0,(Ep=c.bh||(c.bh={})).create="create",Ep.load="load",Ep.fullLoad="fullLoad";let zh=null,ku=[];const Lp=1e3/60,Mp="loadTime",kp="fullLoadTime",Lb={mark(n){performance.mark(n)},frame(n){const t=n;zh!=null&&ku.push(t-zh),zh=t},clearMetrics(){zh=null,ku=[],performance.clearMeasures(Mp),performance.clearMeasures(kp);for(const n in c.bh)performance.clearMarks(c.bh[n])},getPerformanceMetrics(){performance.measure(Mp,c.bh.create,c.bh.load),performance.measure(kp,c.bh.create,c.bh.fullLoad);const n=performance.getEntriesByName(Mp)[0].duration,t=performance.getEntriesByName(kp)[0].duration,o=ku.length,l=1/(ku.reduce((g,v)=>g+v,0)/o/1e3),p=ku.filter(g=>g>Lp).reduce((g,v)=>g+(v-Lp)/Lp,0);return{loadTime:n,fullLoadTime:t,fps:l,percentDroppedFrames:p/(o+p)*100,totalFrames:o}}};c.$=function(n,t,o){var l,p,g,v,w,A,M,z,N,V,G,H,J=o[0],ot=o[1],ct=o[2];return t===n?(n[12]=t[0]*J+t[4]*ot+t[8]*ct+t[12],n[13]=t[1]*J+t[5]*ot+t[9]*ct+t[13],n[14]=t[2]*J+t[6]*ot+t[10]*ct+t[14],n[15]=t[3]*J+t[7]*ot+t[11]*ct+t[15]):(p=t[1],g=t[2],v=t[3],w=t[4],A=t[5],M=t[6],z=t[7],N=t[8],V=t[9],G=t[10],H=t[11],n[0]=l=t[0],n[1]=p,n[2]=g,n[3]=v,n[4]=w,n[5]=A,n[6]=M,n[7]=z,n[8]=N,n[9]=V,n[10]=G,n[11]=H,n[12]=l*J+w*ot+N*ct+t[12],n[13]=p*J+A*ot+V*ct+t[13],n[14]=g*J+M*ot+G*ct+t[14],n[15]=v*J+z*ot+H*ct+t[15]),n},c.A=Ic,c.B=lr,c.C=class{constructor(n,t,o){this.receive=l=>{const p=l.data,g=p.id;if(g&&(!p.targetMapId||this.mapId===p.targetMapId))if(p.type==="<cancel>"){delete this.tasks[g];const v=this.cancelCallbacks[g];delete this.cancelCallbacks[g],v&&v()}else Me()||p.mustQueue?(this.tasks[g]=p,this.taskQueue.push(g),this.invoker.trigger()):this.processTask(g,p)},this.process=()=>{if(!this.taskQueue.length)return;const l=this.taskQueue.shift(),p=this.tasks[l];delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),p&&this.processTask(l,p)},this.target=n,this.parent=t,this.mapId=o,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new xb(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Me()?n:window}send(n,t,o,l,p=!1){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(this.callbacks[g]=o);const v=[],w={id:g,type:n,hasCallback:!!o,targetMapId:l,mustQueue:p,sourceMapId:this.mapId,data:go(t,v)};return this.target.postMessage(w,{transfer:v}),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}processTask(n,t){if(t.type==="<response>"){const o=this.callbacks[n];delete this.callbacks[n],o&&(t.error?o(fs(t.error)):o(null,fs(t.data)))}else{let o=!1;const l=[],p=t.hasCallback?(w,A)=>{o=!0,delete this.cancelCallbacks[n];const M={id:n,type:"<response>",sourceMapId:this.mapId,error:w?go(w):null,data:go(A,l)};this.target.postMessage(M,{transfer:l})}:w=>{o=!0};let g=null;const v=fs(t.data);if(this.parent[t.type])g=this.parent[t.type](t.sourceMapId,v,p);else if("getWorkerSource"in this.parent){const w=t.type.split(".");g=this.parent.getWorkerSource(t.sourceMapId,w[0],v.source)[w[1]](v,p)}else p(new Error(`Could not find function ${t.type}`));!o&&g&&g.cancel&&(this.cancelCallbacks[n]=g.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.D=me,c.E=re,c.F=function(n,t){const o={};for(let l=0;l<t.length;l++){const p=t[l];p in n&&(o[p]=n[p])}return o},c.G=E_,c.H=L_,c.I=pp,c.J=Ut,c.K=Zt,c.L=dl,c.M=Ue,c.N=In,c.O=vo,c.P=K,c.Q=on,c.R=yo,c.S=sn,c.T=$t,c.U=Ch,c.V=class extends Fo{},c.W=Tp,c.X=function(n,t){const o=window.document.createElement("video");o.muted=!0,o.onloadstart=function(){t(null,o)};for(let l=0;l<n.length;l++){const p=window.document.createElement("source");mt(n[l])||(o.crossOrigin="Anonymous"),p.src=n[l],o.appendChild(p)}return{cancel:()=>{}}},c.Y=Wt,c.Z=function(){var n=new Ic(16);return Ic!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},c._=F,c.a=fi,c.a$=class extends Z{},c.a0=function(n,t,o){var l=o[0],p=o[1],g=o[2];return n[0]=t[0]*l,n[1]=t[1]*l,n[2]=t[2]*l,n[3]=t[3]*l,n[4]=t[4]*p,n[5]=t[5]*p,n[6]=t[6]*p,n[7]=t[7]*p,n[8]=t[8]*g,n[9]=t[9]*g,n[10]=t[10]*g,n[11]=t[11]*g,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},c.a1=Rm,c.a2=function(){return Fe++},c.a3=it,c.a4=zc,c.a5=function(){j.isLoading()||j.isLoaded()||C()!=="deferred"||B()},c.a6=Ro,c.a7=$l,c.a8=at,c.a9=O_,c.aA=s,c.aB=function(n){n=n.slice();const t=Object.create(null);for(let o=0;o<n.length;o++)t[n[o].id]=n[o];for(let o=0;o<n.length;o++)"ref"in n[o]&&(n[o]=Ft(n[o],t[n[o].ref]));return n},c.aC=function(n){if(n.type==="custom")return new vb(n);switch(n.type){case"background":return new _b(n);case"circle":return new e1(n);case"fill":return new b1(n);case"fill-extrusion":return new B1(n);case"heatmap":return new n1(n);case"hillshade":return new o1(n);case"line":return new j1(n);case"raster":return new yb(n);case"symbol":return new Ih(n)}},c.aD=fe,c.aE=function(n,t){if(!n)return[{command:ie.setStyle,args:[t]}];let o=[];try{if(!Kt(n.version,t.version))return[{command:ie.setStyle,args:[t]}];Kt(n.center,t.center)||o.push({command:ie.setCenter,args:[t.center]}),Kt(n.zoom,t.zoom)||o.push({command:ie.setZoom,args:[t.zoom]}),Kt(n.bearing,t.bearing)||o.push({command:ie.setBearing,args:[t.bearing]}),Kt(n.pitch,t.pitch)||o.push({command:ie.setPitch,args:[t.pitch]}),Kt(n.sprite,t.sprite)||o.push({command:ie.setSprite,args:[t.sprite]}),Kt(n.glyphs,t.glyphs)||o.push({command:ie.setGlyphs,args:[t.glyphs]}),Kt(n.transition,t.transition)||o.push({command:ie.setTransition,args:[t.transition]}),Kt(n.light,t.light)||o.push({command:ie.setLight,args:[t.light]});const l={},p=[];(function(v,w,A,M){let z;for(z in w=w||{},v=v||{})Object.prototype.hasOwnProperty.call(v,z)&&(Object.prototype.hasOwnProperty.call(w,z)||$e(z,A,M));for(z in w)Object.prototype.hasOwnProperty.call(w,z)&&(Object.prototype.hasOwnProperty.call(v,z)?Kt(v[z],w[z])||(v[z].type==="geojson"&&w[z].type==="geojson"&&ki(v,w,z)?A.push({command:ie.setGeoJSONSourceData,args:[z,w[z].data]}):Xe(z,w,A,M)):Te(z,w,A))})(n.sources,t.sources,p,l);const g=[];n.layers&&n.layers.forEach(v=>{l[v.source]?o.push({command:ie.removeLayer,args:[v.id]}):g.push(v)}),o=o.concat(p),function(v,w,A){w=w||[];const M=(v=v||[]).map(ji),z=w.map(ji),N=v.reduce(gn,{}),V=w.reduce(gn,{}),G=M.slice(),H=Object.create(null);let J,ot,ct,yt,ht,xt,At;for(J=0,ot=0;J<M.length;J++)ct=M[J],Object.prototype.hasOwnProperty.call(V,ct)?ot++:(A.push({command:ie.removeLayer,args:[ct]}),G.splice(G.indexOf(ct,ot),1));for(J=0,ot=0;J<z.length;J++)ct=z[z.length-1-J],G[G.length-1-J]!==ct&&(Object.prototype.hasOwnProperty.call(N,ct)?(A.push({command:ie.removeLayer,args:[ct]}),G.splice(G.lastIndexOf(ct,G.length-ot),1)):ot++,xt=G[G.length-J],A.push({command:ie.addLayer,args:[V[ct],xt]}),G.splice(G.length-J,0,ct),H[ct]=!0);for(J=0;J<z.length;J++)if(ct=z[J],yt=N[ct],ht=V[ct],!H[ct]&&!Kt(yt,ht))if(Kt(yt.source,ht.source)&&Kt(yt["source-layer"],ht["source-layer"])&&Kt(yt.type,ht.type)){for(At in Ti(yt.layout,ht.layout,A,ct,null,ie.setLayoutProperty),Ti(yt.paint,ht.paint,A,ct,null,ie.setPaintProperty),Kt(yt.filter,ht.filter)||A.push({command:ie.setFilter,args:[ct,ht.filter]}),Kt(yt.minzoom,ht.minzoom)&&Kt(yt.maxzoom,ht.maxzoom)||A.push({command:ie.setLayerZoomRange,args:[ct,ht.minzoom,ht.maxzoom]}),yt)Object.prototype.hasOwnProperty.call(yt,At)&&At!=="layout"&&At!=="paint"&&At!=="filter"&&At!=="metadata"&&At!=="minzoom"&&At!=="maxzoom"&&(At.indexOf("paint.")===0?Ti(yt[At],ht[At],A,ct,At.slice(6),ie.setPaintProperty):Kt(yt[At],ht[At])||A.push({command:ie.setLayerProperty,args:[ct,At,ht[At]]}));for(At in ht)Object.prototype.hasOwnProperty.call(ht,At)&&!Object.prototype.hasOwnProperty.call(yt,At)&&At!=="layout"&&At!=="paint"&&At!=="filter"&&At!=="metadata"&&At!=="minzoom"&&At!=="maxzoom"&&(At.indexOf("paint.")===0?Ti(yt[At],ht[At],A,ct,At.slice(6),ie.setPaintProperty):Kt(yt[At],ht[At])||A.push({command:ie.setLayerProperty,args:[ct,At,ht[At]]}))}else A.push({command:ie.removeLayer,args:[ct]}),xt=G[G.lastIndexOf(ct)+1],A.push({command:ie.addLayer,args:[ht,xt]})}(g,t.layers,o)}catch(l){console.warn("Unable to compute style diff:",l),o=[{command:ie.setStyle,args:[t]}]}return o},c.aF=function(n){const t=[],o=n.id;return o===void 0&&t.push({message:`layers.${o}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${o}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),t},c.aG=function n(t,o){if(Array.isArray(t)){if(!Array.isArray(o)||t.length!==o.length)return!1;for(let l=0;l<t.length;l++)if(!n(t[l],o[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&o!==null){if(typeof o!="object"||Object.keys(t).length!==Object.keys(o).length)return!1;for(const l in t)if(!n(t[l],o[l]))return!1;return!0}return t===o},c.aH=ce,c.aI=Qt,c.aJ=b,c.aK=function(n){return n({pluginStatus:Gn,pluginURL:Oo}),b.on("pluginStateChange",n),n},c.aL=class extends Sa{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.aM=Pc,c.aN=class extends Sa{constructor(n,t){super(n,t),this.current=Gd}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},c.aO=dh,c.aP=class extends Sa{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},c.aQ=class extends Sa{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},c.aR=ph,c.aS=function(n,t,o,l,p,g,v){var w=1/(t-o),A=1/(l-p),M=1/(g-v);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*A,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*M,n[11]=0,n[12]=(t+o)*w,n[13]=(p+l)*A,n[14]=(v+g)*M,n[15]=1,n},c.aT=Ni,c.aU=t1,c.aV=class extends h{},c.aW=W1,c.aX=class extends y{},c.aY=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},c.aZ=Nm,c.a_=Xt,c.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,p,g)=>{const v=p||g;return t[l]=!v||v.toLowerCase(),""}),t["max-age"]){const o=parseInt(t["max-age"],10);isNaN(o)?delete t["max-age"]:t["max-age"]=o}return t},c.ab=function(n,t){const o=[];for(const l in n)l in t||o.push(l);return o},c.ac=function(n){if(Ht==null){const t=n.navigator?n.navigator.userAgent:null;Ht=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ht},c.ad=te,c.ae=function(n,t,o){var l=Math.sin(o),p=Math.cos(o),g=t[0],v=t[1],w=t[2],A=t[3],M=t[4],z=t[5],N=t[6],V=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=g*p+M*l,n[1]=v*p+z*l,n[2]=w*p+N*l,n[3]=A*p+V*l,n[4]=M*p-g*l,n[5]=z*p-v*l,n[6]=N*p-w*l,n[7]=V*p-A*l,n},c.af=function(n){var t=new Ic(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},c.ag=gh,c.ah=function(n,t){let o=0,l=0;if(n.kind==="constant")l=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:v}=n,w=p?te(er.interpolationFactor(p,t,g,v),0,1):0;n.kind==="camera"?l=lr.number(n.minSize,n.maxSize,w):o=w}return{uSizeT:o,uSize:l}},c.aj=function(n,{uSize:t,uSizeT:o},{lowerSize:l,upperSize:p}){return n.kind==="source"?l/Gs:n.kind==="composite"?lr.number(l/Gs,p/Gs,o):t},c.ak=gp,c.al=function(n,t,o,l){const p=t.y-n.y,g=t.x-n.x,v=l.y-o.y,w=l.x-o.x,A=v*g-w*p;if(A===0)return null;const M=(w*(n.y-o.y)-v*(n.x-o.x))/A;return new K(n.x+M*g,n.y+M*p)},c.am=V_,c.an=Cm,c.ao=Xd,c.ap=zn,c.ar=_p,c.as=function(n,t){var o=t[0],l=t[1],p=t[2],g=t[3],v=t[4],w=t[5],A=t[6],M=t[7],z=t[8],N=t[9],V=t[10],G=t[11],H=t[12],J=t[13],ot=t[14],ct=t[15],yt=o*w-l*v,ht=o*A-p*v,xt=o*M-g*v,At=l*A-p*w,Dt=l*M-g*w,he=p*M-g*A,Pe=z*J-N*H,ue=z*ot-V*H,ae=z*ct-G*H,ee=N*ot-V*J,ge=N*ct-G*J,ne=V*ct-G*ot,qt=yt*ne-ht*ge+xt*ee+At*ae-Dt*ue+he*Pe;return qt?(n[0]=(w*ne-A*ge+M*ee)*(qt=1/qt),n[1]=(p*ge-l*ne-g*ee)*qt,n[2]=(J*he-ot*Dt+ct*At)*qt,n[3]=(V*Dt-N*he-G*At)*qt,n[4]=(A*ae-v*ne-M*ue)*qt,n[5]=(o*ne-p*ae+g*ue)*qt,n[6]=(ot*xt-H*he-ct*ht)*qt,n[7]=(z*he-V*xt+G*ht)*qt,n[8]=(v*ge-w*ae+M*Pe)*qt,n[9]=(l*ae-o*ge-g*Pe)*qt,n[10]=(H*Dt-J*xt+ct*yt)*qt,n[11]=(N*xt-z*Dt-G*yt)*qt,n[12]=(w*ue-v*ee-A*Pe)*qt,n[13]=(o*ee-l*ue+p*Pe)*qt,n[14]=(J*ht-H*At-ot*yt)*qt,n[15]=(z*At-N*ht+V*yt)*qt,n):null},c.at=Pp,c.au=mp,c.av=Ap,c.aw=function(){const n={},t=dt.$version;for(const o in dt.$root){const l=dt.$root[o];if(l.required){let p=null;p=o==="version"?t:l.type==="array"?[]:{},p!=null&&(n[o]=p)}}return n},c.ax=ie,c.ay=Vs,c.az=Ge,c.b=function(n,t){const o=new Blob([new Uint8Array(n)],{type:"image/png"});createImageBitmap(o).then(l=>{t(null,l)}).catch(l=>{t(new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},c.b0=qn,c.b1=function(n,t){var o=n[0],l=n[1],p=n[2],g=n[3],v=n[4],w=n[5],A=n[6],M=n[7],z=n[8],N=n[9],V=n[10],G=n[11],H=n[12],J=n[13],ot=n[14],ct=n[15],yt=t[0],ht=t[1],xt=t[2],At=t[3],Dt=t[4],he=t[5],Pe=t[6],ue=t[7],ae=t[8],ee=t[9],ge=t[10],ne=t[11],qt=t[12],Be=t[13],Ee=t[14],di=t[15];return Math.abs(o-yt)<=Sr*Math.max(1,Math.abs(o),Math.abs(yt))&&Math.abs(l-ht)<=Sr*Math.max(1,Math.abs(l),Math.abs(ht))&&Math.abs(p-xt)<=Sr*Math.max(1,Math.abs(p),Math.abs(xt))&&Math.abs(g-At)<=Sr*Math.max(1,Math.abs(g),Math.abs(At))&&Math.abs(v-Dt)<=Sr*Math.max(1,Math.abs(v),Math.abs(Dt))&&Math.abs(w-he)<=Sr*Math.max(1,Math.abs(w),Math.abs(he))&&Math.abs(A-Pe)<=Sr*Math.max(1,Math.abs(A),Math.abs(Pe))&&Math.abs(M-ue)<=Sr*Math.max(1,Math.abs(M),Math.abs(ue))&&Math.abs(z-ae)<=Sr*Math.max(1,Math.abs(z),Math.abs(ae))&&Math.abs(N-ee)<=Sr*Math.max(1,Math.abs(N),Math.abs(ee))&&Math.abs(V-ge)<=Sr*Math.max(1,Math.abs(V),Math.abs(ge))&&Math.abs(G-ne)<=Sr*Math.max(1,Math.abs(G),Math.abs(ne))&&Math.abs(H-qt)<=Sr*Math.max(1,Math.abs(H),Math.abs(qt))&&Math.abs(J-Be)<=Sr*Math.max(1,Math.abs(J),Math.abs(Be))&&Math.abs(ot-Ee)<=Sr*Math.max(1,Math.abs(ot),Math.abs(Ee))&&Math.abs(ct-di)<=Sr*Math.max(1,Math.abs(ct),Math.abs(di))},c.b2=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},c.b3=function(n,t,o){return n[0]=t[0]*o[0],n[1]=t[1]*o[1],n[2]=t[2]*o[2],n[3]=t[3]*o[3],n},c.b4=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},c.b5=Ce,c.b6=R_,c.b7=M_,c.b8=function(n,t,o,l,p){var g,v=1/Math.tan(t/2);return n[0]=v/o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,p!=null&&p!==1/0?(n[10]=(p+l)*(g=1/(l-p)),n[14]=2*p*l*g):(n[10]=-1,n[14]=-2*l),n},c.b9=function(n,t,o){var l=Math.sin(o),p=Math.cos(o),g=t[4],v=t[5],w=t[6],A=t[7],M=t[8],z=t[9],N=t[10],V=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=g*p+M*l,n[5]=v*p+z*l,n[6]=w*p+N*l,n[7]=A*p+V*l,n[8]=M*p-g*l,n[9]=z*p-v*l,n[10]=N*p-w*l,n[11]=V*p-A*l,n},c.bA=q,c.bB=s_,c.bC=Xa,c.bD=j,c.ba=Le,c.bb=de,c.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},c.bd=class extends _s{},c.be=bp,c.bf=k_,c.bg=Lb,c.bi=be,c.bj=function(n,t,o=!1){if(Gn===nl||Gn===rl||Gn===Bl)throw new Error("setRTLTextPlugin cannot be called multiple times.");Oo=Oe.resolveURL(n),Gn=nl,ol=t,d(),o||B()},c.bk=C,c.bl=function(n,t){const o={};for(let p=0;p<n.length;p++){const g=t&&t[n[p].id]||Ns(n[p]);t&&(t[n[p].id]=g);let v=o[g];v||(v=o[g]=[]),v.push(n[p])}const l=[];for(const p in o)l.push(o[p]);return l},c.bm=_e,c.bn=B_,c.bo=F_,c.bp=m_,c.bq=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=In/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],o=t.layout,l=t._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new at(n.bucket.zoom+1),n.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new at(n.bucket.zoom+1),n.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new at(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:z}=n.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new at(M),n.canonical),l["text-size"].possiblyEvaluate(new at(z),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:z}=n.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new at(M),n.canonical),l["icon-size"].possiblyEvaluate(new at(z),n.canonical)]}const g=o.get("text-line-height")*zn,v=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",w=o.get("text-keep-upright"),A=o.get("text-size");for(const M of n.bucket.features){const z=o.get("text-font").evaluate(M,{},n.canonical).join(","),N=A.evaluate(M,{},n.canonical),V=p.layoutTextSize.evaluate(M,{},n.canonical),G=p.layoutIconSize.evaluate(M,{},n.canonical),H={horizontal:{},vertical:void 0},J=M.text;let ot,ct=[0,0];if(J){const xt=J.toString(),At=o.get("text-letter-spacing").evaluate(M,{},n.canonical)*zn,Dt=ms(xt)?At:0,he=o.get("text-anchor").evaluate(M,{},n.canonical),Pe=X_(t,M,n.canonical);if(!Pe){const ne=o.get("text-radial-offset").evaluate(M,{},n.canonical);ct=ne?K_(he,[ne*zn,Sp]):o.get("text-offset").evaluate(M,{},n.canonical).map(qt=>qt*zn)}let ue=v?"center":o.get("text-justify").evaluate(M,{},n.canonical);const ae=o.get("symbol-placement"),ee=ae==="point"?o.get("text-max-width").evaluate(M,{},n.canonical)*zn:0,ge=()=>{n.bucket.allowVerticalPlacement&&$s(xt)&&(H.vertical=Sh(J,n.glyphMap,n.glyphPositions,n.imagePositions,z,ee,g,he,"left",Dt,ct,c.ai.vertical,!0,ae,V,N))};if(!v&&Pe){const ne=new Set;if(ue==="auto")for(let Be=0;Be<Pe.values.length;Be+=2)ne.add(Pp(Pe.values[Be]));else ne.add(ue);let qt=!1;for(const Be of ne)if(!H.horizontal[Be])if(qt)H.horizontal[Be]=H.horizontal[0];else{const Ee=Sh(J,n.glyphMap,n.glyphPositions,n.imagePositions,z,ee,g,"center",Be,Dt,ct,c.ai.horizontal,!1,ae,V,N);Ee&&(H.horizontal[Be]=Ee,qt=Ee.positionedLines.length===1)}ge()}else{ue==="auto"&&(ue=Pp(he));const ne=Sh(J,n.glyphMap,n.glyphPositions,n.imagePositions,z,ee,g,he,ue,Dt,ct,c.ai.horizontal,!1,ae,V,N);ne&&(H.horizontal[ue]=ne),ge(),$s(xt)&&v&&w&&(H.vertical=Sh(J,n.glyphMap,n.glyphPositions,n.imagePositions,z,ee,g,he,ue,Dt,ct,c.ai.vertical,!1,ae,V,N))}}let yt=!1;if(M.icon&&M.icon.name){const xt=n.imageMap[M.icon.name];xt&&(ot=hb(n.imagePositions[M.icon.name],o.get("icon-offset").evaluate(M,{},n.canonical),o.get("icon-anchor").evaluate(M,{},n.canonical)),yt=!!xt.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=yt:n.bucket.sdfIcons!==yt&&Ae("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xt.pixelRatio!==n.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const ht=J_(H.horizontal)||H.vertical;n.bucket.iconsInText=!!ht&&ht.iconsInText,(ht||ot)&&Cb(n.bucket,M,H,ot,n.imageMap,p,V,G,ct,yt,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},c.br=cp,c.bs=sp,c.bt=lp,c.bu=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},c.bv=hp,c.bw=cl,c.bx=function(n,t,o,l,p){return F(this,void 0,void 0,function*(){if(Zt())try{return yield Ue(n,t,o,l,p)}catch{}return function(g,v,w,A,M){const z=g.width,N=g.height;si&&je||(si=new OffscreenCanvas(z,N),je=si.getContext("2d",{willReadFrequently:!0})),si.width=z,si.height=N,je.drawImage(g,0,0,z,N);const V=je.getImageData(v,w,A,M);return je.clearRect(0,0,z,N),V.data}(n,t,o,l,p)})},c.by=D_,c.bz=D,c.c=pn,c.d=function(n,t){const o=new Image;o.onload=()=>{t(null,o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=ze})},o.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(l):ze},c.e=pe,c.f=function(n,t){return ei(pe(n,{type:"json"}),t)},c.g=ti,c.h=Oe,c.i=Me,c.j=Nt,c.k=Bt,c.l=ut,c.m=ei,c.n=function(n){return new hp(n).readFields(ob,[])},c.o=function(n,t,o){if(!n.length)return o(null,[]);let l=n.length;const p=new Array(n.length);let g=null;n.forEach((v,w)=>{t(v,(A,M)=>{A&&(g=A),p[w]=M,--l==0&&o(g,p)})})},c.p=f_,c.q=vu,c.r=_n,c.s=mt,c.t=hu,c.u=le,c.v=dt,c.w=Ae,c.x=_o,c.y=Jr,c.z=function([n,t,o]){return t+=90,t*=Math.PI/180,o*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(o),y:n*Math.sin(t)*Math.sin(o),z:n*Math.cos(o)}}}),S(["./shared"],function(c){class F{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,$){for(const nt of U){this._layerConfigs[nt.id]=nt;const rt=this._layers[nt.id]=c.aC(nt);rt._featureFilter=c.a6(rt.filter),this.keyCache[nt.id]&&delete this.keyCache[nt.id]}for(const nt of $)delete this.keyCache[nt],delete this._layerConfigs[nt],delete this._layers[nt];this.familiesBySource={};const X=c.bl(Object.values(this._layerConfigs),this.keyCache);for(const nt of X){const rt=nt.map(wt=>this._layers[wt.id]),vt=rt[0];if(vt.visibility==="none")continue;const pt=vt.source||"";let lt=this.familiesBySource[pt];lt||(lt=this.familiesBySource[pt]={});const _t=vt.sourceLayer||"_geojsonTileLayer";let Lt=lt[_t];Lt||(Lt=lt[_t]=[]),Lt.push(rt)}}}class D{constructor(U){const $={},X=[];for(const pt in U){const lt=U[pt],_t=$[pt]={};for(const Lt in lt){const wt=lt[+Lt];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;const Rt={x:0,y:0,w:wt.bitmap.width+2,h:wt.bitmap.height+2};X.push(Rt),_t[Lt]={rect:Rt,metrics:wt.metrics}}}const{w:nt,h:rt}=c.p(X),vt=new c.q({width:nt||1,height:rt||1});for(const pt in U){const lt=U[pt];for(const _t in lt){const Lt=lt[+_t];if(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)continue;const wt=$[pt][_t].rect;c.q.copy(Lt.bitmap,vt,{x:0,y:0},{x:wt.x+1,y:wt.y+1},Lt.bitmap)}}this.image=vt,this.positions=$}}c.bm("GlyphAtlas",D);class q{constructor(U){this.tileID=new c.O(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.uid=U.uid,this.zoom=U.zoom,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.returnDependencies=!!U.returnDependencies,this.promoteId=U.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(U,$,X,nt,rt){this.status="parsing",this.data=U,this.collisionBoxArray=new c.a3;const vt=new c.bn(Object.keys(U.layers).sort()),pt=new c.bo(this.tileID,this.promoteId);pt.bucketLayerIDs=[];const lt={},_t={featureIndex:pt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:X},Lt=$.familiesBySource[this.source];for(const Ci in Lt){const Pi=U.layers[Ci];if(!Pi)continue;Pi.version===1&&c.w(`Vector tile source "${this.source}" layer "${Ci}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Un=vt.encode(Ci),Hi=[];for(let fn=0;fn<Pi.length;fn++){const En=Pi.feature(fn),$n=pt.getId(En,Ci);Hi.push({feature:En,id:$n,index:fn,sourceLayerIndex:Un})}for(const fn of Lt[Ci]){const En=fn[0];En.source!==this.source&&c.w(`layer.source = ${En.source} does not equal this.source = ${this.source}`),En.minzoom&&this.zoom<Math.floor(En.minzoom)||En.maxzoom&&this.zoom>=En.maxzoom||En.visibility!=="none"&&(W(fn,this.zoom,X),(lt[En.id]=En.createBucket({index:pt.bucketLayerIDs.length,layers:fn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Un,sourceID:this.source})).populate(Hi,_t,this.tileID.canonical),pt.bucketLayerIDs.push(fn.map($n=>$n.id)))}}let wt,Rt,Re,Ve;const ve=c.aH(_t.glyphDependencies,Ci=>Object.keys(Ci).map(Number));this.inFlightDependencies.forEach(Ci=>Ci==null?void 0:Ci.cancel()),this.inFlightDependencies=[];const De=++this.dependencySentinel;Object.keys(ve).length?this.inFlightDependencies.push(nt.send("getGlyphs",{uid:this.uid,stacks:ve,source:this.source,tileID:this.tileID,type:"glyphs"},(Ci,Pi)=>{De===this.dependencySentinel&&(wt||(wt=Ci,Rt=Pi,Fi.call(this)))})):Rt={};const qe=Object.keys(_t.iconDependencies);qe.length?this.inFlightDependencies.push(nt.send("getImages",{icons:qe,source:this.source,tileID:this.tileID,type:"icons"},(Ci,Pi)=>{De===this.dependencySentinel&&(wt||(wt=Ci,Re=Pi,Fi.call(this)))})):Re={};const Si=Object.keys(_t.patternDependencies);function Fi(){if(wt)return rt(wt);if(Rt&&Re&&Ve){const Ci=new D(Rt),Pi=new c.bp(Re,Ve);for(const Un in lt){const Hi=lt[Un];Hi instanceof c.a4?(W(Hi.layers,this.zoom,X),c.bq({bucket:Hi,glyphMap:Rt,glyphPositions:Ci.positions,imageMap:Re,imagePositions:Pi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Hi.hasPattern&&(Hi instanceof c.br||Hi instanceof c.bs||Hi instanceof c.bt)&&(W(Hi.layers,this.zoom,X),Hi.addFeatures(_t,this.tileID.canonical,Pi.patternPositions))}this.status="done",rt(null,{buckets:Object.values(lt).filter(Un=>!Un.isEmpty()),featureIndex:pt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:Pi,glyphMap:this.returnDependencies?Rt:null,iconMap:this.returnDependencies?Re:null,glyphPositions:this.returnDependencies?Ci.positions:null})}}Si.length?this.inFlightDependencies.push(nt.send("getImages",{icons:Si,source:this.source,tileID:this.tileID,type:"patterns"},(Ci,Pi)=>{De===this.dependencySentinel&&(wt||(wt=Ci,Ve=Pi,Fi.call(this)))})):Ve={},Fi.call(this)}}function W(et,U,$){const X=new c.a8(U);for(const nt of et)nt.recalculate(X,$)}function K(et,U){const $=c.l(et.request,(X,nt,rt,vt)=>{if(X)U(X);else if(nt)try{const pt=new c.bw.VectorTile(new c.bv(nt));U(null,{vectorTile:pt,rawData:nt,cacheControl:rt,expires:vt})}catch(pt){const lt=new Uint8Array(nt);let _t=`Unable to parse the tile at ${et.request.url}, `;_t+=lt[0]===31&&lt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${pt.messge}`,U(new Error(_t))}});return()=>{$.cancel(),U()}}class bt{constructor(U,$,X,nt){this.actor=U,this.layerIndex=$,this.availableImages=X,this.loadVectorData=nt||K,this.fetching={},this.loading={},this.loaded={}}loadTile(U,$){const X=U.uid;this.loading||(this.loading={});const nt=!!(U&&U.request&&U.request.collectResourceTiming)&&new c.bu(U.request),rt=this.loading[X]=new q(U);rt.abort=this.loadVectorData(U,(vt,pt)=>{if(delete this.loading[X],vt||!pt)return rt.status="done",this.loaded[X]=rt,$(vt);const lt=pt.rawData,_t={};pt.expires&&(_t.expires=pt.expires),pt.cacheControl&&(_t.cacheControl=pt.cacheControl);const Lt={};if(nt){const wt=nt.finish();wt&&(Lt.resourceTiming=JSON.parse(JSON.stringify(wt)))}rt.vectorTile=pt.vectorTile,rt.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,(wt,Rt)=>{if(delete this.fetching[X],wt||!Rt)return $(wt);$(null,c.e({rawTileData:lt.slice(0)},Rt,_t,Lt))}),this.loaded=this.loaded||{},this.loaded[X]=rt,this.fetching[X]={rawTileData:lt,cacheControl:_t,resourceTiming:Lt}})}reloadTile(U,$){const X=this.loaded,nt=U.uid;if(X&&X[nt]){const rt=X[nt];rt.showCollisionBoxes=U.showCollisionBoxes,rt.status==="parsing"?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,(vt,pt)=>{if(vt||!pt)return $(vt,pt);let lt;if(this.fetching[nt]){const{rawTileData:_t,cacheControl:Lt,resourceTiming:wt}=this.fetching[nt];delete this.fetching[nt],lt=c.e({rawTileData:_t.slice(0)},pt,Lt,wt)}else lt=pt;$(null,lt)}):rt.status==="done"&&(rt.vectorTile?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,$):$())}}abortTile(U,$){const X=this.loading,nt=U.uid;X&&X[nt]&&X[nt].abort&&(X[nt].abort(),delete X[nt]),$()}removeTile(U,$){const X=this.loaded,nt=U.uid;X&&X[nt]&&delete X[nt],$()}}class zt{constructor(){this.loaded={}}loadTile(U,$){return c._(this,void 0,void 0,function*(){const{uid:X,encoding:nt,rawImageData:rt,redFactor:vt,greenFactor:pt,blueFactor:lt,baseShift:_t}=U,Lt=rt.width+2,wt=rt.height+2,Rt=c.a(rt)?new c.R({width:Lt,height:wt},yield c.bx(rt,-1,-1,Lt,wt)):rt,Re=new c.by(X,Rt,nt,vt,pt,lt,_t);this.loaded=this.loaded||{},this.loaded[X]=Re,$(null,Re)})}removeTile(U){const $=this.loaded,X=U.uid;$&&$[X]&&delete $[X]}}function Pt(et,U){if(et.length!==0){oe(et[0],U);for(var $=1;$<et.length;$++)oe(et[$],!U)}}function oe(et,U){for(var $=0,X=0,nt=0,rt=et.length,vt=rt-1;nt<rt;vt=nt++){var pt=(et[nt][0]-et[vt][0])*(et[vt][1]+et[nt][1]),lt=$+pt;X+=Math.abs($)>=Math.abs(pt)?$-lt+pt:pt-lt+$,$=lt}$+X>=0!=!!U&&et.reverse()}var Jt=c.bz(function et(U,$){var X,nt=U&&U.type;if(nt==="FeatureCollection")for(X=0;X<U.features.length;X++)et(U.features[X],$);else if(nt==="GeometryCollection")for(X=0;X<U.geometries.length;X++)et(U.geometries[X],$);else if(nt==="Feature")et(U.geometry,$);else if(nt==="Polygon")Pt(U.coordinates,$);else if(nt==="MultiPolygon")for(X=0;X<U.coordinates.length;X++)Pt(U.coordinates[X],$);return U});const Ut=c.bw.VectorTileFeature.prototype.toGeoJSON;var Zt={exports:{}},Le=c.bA,de=c.bw.VectorTileFeature,te=Ce;function Ce(et,U){this.options=U||{},this.features=et,this.length=et.length}function pe(et,U){this.id=typeof et.id=="number"?et.id:void 0,this.type=et.type,this.rawGeometry=et.type===1?[et.geometry]:et.geometry,this.properties=et.tags,this.extent=U||4096}Ce.prototype.feature=function(et){return new pe(this.features[et],this.options.extent)},pe.prototype.loadGeometry=function(){var et=this.rawGeometry;this.geometry=[];for(var U=0;U<et.length;U++){for(var $=et[U],X=[],nt=0;nt<$.length;nt++)X.push(new Le($[nt][0],$[nt][1]));this.geometry.push(X)}return this.geometry},pe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var et=this.geometry,U=1/0,$=-1/0,X=1/0,nt=-1/0,rt=0;rt<et.length;rt++)for(var vt=et[rt],pt=0;pt<vt.length;pt++){var lt=vt[pt];U=Math.min(U,lt.x),$=Math.max($,lt.x),X=Math.min(X,lt.y),nt=Math.max(nt,lt.y)}return[U,X,$,nt]},pe.prototype.toGeoJSON=de.prototype.toGeoJSON;var Fe=c.bB,ce=te;function Qt(et){var U=new Fe;return function($,X){for(var nt in $.layers)X.writeMessage(3,fe,$.layers[nt])}(et,U),U.finish()}function fe(et,U){var $;U.writeVarintField(15,et.version||1),U.writeStringField(1,et.name||""),U.writeVarintField(5,et.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<et.length;$++)X.feature=et.feature($),U.writeMessage(2,ke,X);var nt=X.keys;for($=0;$<nt.length;$++)U.writeStringField(3,nt[$]);var rt=X.values;for($=0;$<rt.length;$++)U.writeMessage(4,Ht,rt[$])}function ke(et,U){var $=et.feature;$.id!==void 0&&U.writeVarintField(1,$.id),U.writeMessage(2,Ae,et),U.writeVarintField(3,$.type),U.writeMessage(4,Me,$)}function Ae(et,U){var $=et.feature,X=et.keys,nt=et.values,rt=et.keycache,vt=et.valuecache;for(var pt in $.properties){var lt=$.properties[pt],_t=rt[pt];if(lt!==null){_t===void 0&&(X.push(pt),rt[pt]=_t=X.length-1),U.writeVarint(_t);var Lt=typeof lt;Lt!=="string"&&Lt!=="boolean"&&Lt!=="number"&&(lt=JSON.stringify(lt));var wt=Lt+":"+lt,Rt=vt[wt];Rt===void 0&&(nt.push(lt),vt[wt]=Rt=nt.length-1),U.writeVarint(Rt)}}}function Ke(et,U){return(U<<3)+(7&et)}function we(et){return et<<1^et>>31}function Me(et,U){for(var $=et.loadGeometry(),X=et.type,nt=0,rt=0,vt=$.length,pt=0;pt<vt;pt++){var lt=$[pt],_t=1;X===1&&(_t=lt.length),U.writeVarint(Ke(1,_t));for(var Lt=X===3?lt.length-1:lt.length,wt=0;wt<Lt;wt++){wt===1&&X!==1&&U.writeVarint(Ke(2,Lt-1));var Rt=lt[wt].x-nt,Re=lt[wt].y-rt;U.writeVarint(we(Rt)),U.writeVarint(we(Re)),nt+=Rt,rt+=Re}X===3&&U.writeVarint(Ke(7,1))}}function Ht(et,U){var $=typeof et;$==="string"?U.writeStringField(1,et):$==="boolean"?U.writeBooleanField(7,et):$==="number"&&(et%1!=0?U.writeDoubleField(3,et):et<0?U.writeSVarintField(6,et):U.writeVarintField(5,et))}Zt.exports=Qt,Zt.exports.fromVectorTileJs=Qt,Zt.exports.fromGeojsonVt=function(et,U){U=U||{};var $={};for(var X in et)$[X]=new ce(et[X].features,U),$[X].name=X,$[X].version=U.version,$[X].extent=U.extent;return Qt({layers:$})},Zt.exports.GeoJSONWrapper=ce;var fi=c.bz(Zt.exports);const ze={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:et=>et},Ue=Math.fround||(si=new Float32Array(1),et=>(si[0]=+et,si[0]));var si;const je=3,ui=5,hi=6;class Oe{constructor(U){this.options=Object.assign(Object.create(ze),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:$,minZoom:X,maxZoom:nt}=this.options;$&&console.time("total time");const rt=`prepare ${U.length} points`;$&&console.time(rt),this.points=U;const vt=[];for(let lt=0;lt<U.length;lt++){const _t=U[lt];if(!_t.geometry)continue;const[Lt,wt]=_t.geometry.coordinates,Rt=Ue(Ge(Lt)),Re=Ue(ti(wt));vt.push(Rt,Re,1/0,lt,-1,1),this.options.reduce&&vt.push(0)}let pt=this.trees[nt+1]=this._createTree(vt);$&&console.timeEnd(rt);for(let lt=nt;lt>=X;lt--){const _t=+Date.now();pt=this.trees[lt]=this._createTree(this._cluster(pt,lt)),$&&console.log("z%d: %d clusters in %dms",lt,pt.numItems,+Date.now()-_t)}return $&&console.timeEnd("total time"),this}getClusters(U,$){let X=((U[0]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,U[1]));let rt=U[2]===180?180:((U[2]+180)%360+360)%360-180;const vt=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)X=-180,rt=180;else if(X>rt){const wt=this.getClusters([X,nt,180,vt],$),Rt=this.getClusters([-180,nt,rt,vt],$);return wt.concat(Rt)}const pt=this.trees[this._limitZoom($)],lt=pt.range(Ge(X),ti(vt),Ge(rt),ti(nt)),_t=pt.data,Lt=[];for(const wt of lt){const Rt=this.stride*wt;Lt.push(_t[Rt+ui]>1?pn(_t,Rt,this.clusterProps):this.points[_t[Rt+je]])}return Lt}getChildren(U){const $=this._getOriginId(U),X=this._getOriginZoom(U),nt="No cluster with the specified id.",rt=this.trees[X];if(!rt)throw new Error(nt);const vt=rt.data;if($*this.stride>=vt.length)throw new Error(nt);const pt=this.options.radius/(this.options.extent*Math.pow(2,X-1)),lt=rt.within(vt[$*this.stride],vt[$*this.stride+1],pt),_t=[];for(const Lt of lt){const wt=Lt*this.stride;vt[wt+4]===U&&_t.push(vt[wt+ui]>1?pn(vt,wt,this.clusterProps):this.points[vt[wt+je]])}if(_t.length===0)throw new Error(nt);return _t}getLeaves(U,$,X){const nt=[];return this._appendLeaves(nt,U,$=$||10,X=X||0,0),nt}getTile(U,$,X){const nt=this.trees[this._limitZoom(U)],rt=Math.pow(2,U),{extent:vt,radius:pt}=this.options,lt=pt/vt,_t=(X-lt)/rt,Lt=(X+1+lt)/rt,wt={features:[]};return this._addTileFeatures(nt.range(($-lt)/rt,_t,($+1+lt)/rt,Lt),nt.data,$,X,rt,wt),$===0&&this._addTileFeatures(nt.range(1-lt/rt,_t,1,Lt),nt.data,rt,X,rt,wt),$===rt-1&&this._addTileFeatures(nt.range(0,_t,lt/rt,Lt),nt.data,-1,X,rt,wt),wt.features.length?wt:null}getClusterExpansionZoom(U){let $=this._getOriginZoom(U)-1;for(;$<=this.options.maxZoom;){const X=this.getChildren(U);if($++,X.length!==1)break;U=X[0].properties.cluster_id}return $}_appendLeaves(U,$,X,nt,rt){const vt=this.getChildren($);for(const pt of vt){const lt=pt.properties;if(lt&&lt.cluster?rt+lt.point_count<=nt?rt+=lt.point_count:rt=this._appendLeaves(U,lt.cluster_id,X,nt,rt):rt<nt?rt++:U.push(pt),U.length===X)break}return rt}_createTree(U){const $=new c.av(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<U.length;X+=this.stride)$.add(U[X],U[X+1]);return $.finish(),$.data=U,$}_addTileFeatures(U,$,X,nt,rt,vt){for(const pt of U){const lt=pt*this.stride,_t=$[lt+ui]>1;let Lt,wt,Rt;if(_t)Lt=be($,lt,this.clusterProps),wt=$[lt],Rt=$[lt+1];else{const ve=this.points[$[lt+je]];Lt=ve.properties;const[De,qe]=ve.geometry.coordinates;wt=Ge(De),Rt=ti(qe)}const Re={type:1,geometry:[[Math.round(this.options.extent*(wt*rt-X)),Math.round(this.options.extent*(Rt*rt-nt))]],tags:Lt};let Ve;Ve=_t||this.options.generateId?$[lt+je]:this.points[$[lt+je]].id,Ve!==void 0&&(Re.id=Ve),vt.features.push(Re)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,$){const{radius:X,extent:nt,reduce:rt,minPoints:vt}=this.options,pt=X/(nt*Math.pow(2,$)),lt=U.data,_t=[],Lt=this.stride;for(let wt=0;wt<lt.length;wt+=Lt){if(lt[wt+2]<=$)continue;lt[wt+2]=$;const Rt=lt[wt],Re=lt[wt+1],Ve=U.within(lt[wt],lt[wt+1],pt),ve=lt[wt+ui];let De=ve;for(const qe of Ve){const Si=qe*Lt;lt[Si+2]>$&&(De+=lt[Si+ui])}if(De>ve&&De>=vt){let qe,Si=Rt*ve,Fi=Re*ve,Ci=-1;const Pi=((wt/Lt|0)<<5)+($+1)+this.points.length;for(const Un of Ve){const Hi=Un*Lt;if(lt[Hi+2]<=$)continue;lt[Hi+2]=$;const fn=lt[Hi+ui];Si+=lt[Hi]*fn,Fi+=lt[Hi+1]*fn,lt[Hi+4]=Pi,rt&&(qe||(qe=this._map(lt,wt,!0),Ci=this.clusterProps.length,this.clusterProps.push(qe)),rt(qe,this._map(lt,Hi)))}lt[wt+4]=Pi,_t.push(Si/De,Fi/De,1/0,Pi,-1,De),rt&&_t.push(Ci)}else{for(let qe=0;qe<Lt;qe++)_t.push(lt[wt+qe]);if(De>1)for(const qe of Ve){const Si=qe*Lt;if(!(lt[Si+2]<=$)){lt[Si+2]=$;for(let Fi=0;Fi<Lt;Fi++)_t.push(lt[Si+Fi])}}}}return _t}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,$,X){if(U[$+ui]>1){const vt=this.clusterProps[U[$+hi]];return X?Object.assign({},vt):vt}const nt=this.points[U[$+je]].properties,rt=this.options.map(nt);return X&&rt===nt?Object.assign({},rt):rt}}function pn(et,U,$){return{type:"Feature",id:et[U+je],properties:be(et,U,$),geometry:{type:"Point",coordinates:[(X=et[U],360*(X-.5)),en(et[U+1])]}};var X}function be(et,U,$){const X=et[U+ui],nt=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,rt=et[U+hi],vt=rt===-1?{}:Object.assign({},$[rt]);return Object.assign(vt,{cluster:!0,cluster_id:et[U+je],point_count:X,point_count_abbreviated:nt})}function Ge(et){return et/360+.5}function ti(et){const U=Math.sin(et*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function en(et){const U=(180-360*et)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function ei(et,U,$,X){for(var nt,rt=X,vt=$-U>>1,pt=$-U,lt=et[U],_t=et[U+1],Lt=et[$],wt=et[$+1],Rt=U+3;Rt<$;Rt+=3){var Re=ut(et[Rt],et[Rt+1],lt,_t,Lt,wt);if(Re>rt)nt=Rt,rt=Re;else if(Re===rt){var Ve=Math.abs(Rt-vt);Ve<pt&&(nt=Rt,pt=Ve)}}rt>X&&(nt-U>3&&ei(et,U,nt,X),et[nt+2]=rt,$-nt>3&&ei(et,nt,$,X))}function ut(et,U,$,X,nt,rt){var vt=nt-$,pt=rt-X;if(vt!==0||pt!==0){var lt=((et-$)*vt+(U-X)*pt)/(vt*vt+pt*pt);lt>1?($=nt,X=rt):lt>0&&($+=vt*lt,X+=pt*lt)}return(vt=et-$)*vt+(pt=U-X)*pt}function mt(et,U,$,X){var nt={id:et===void 0?null:et,type:U,geometry:$,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(rt){var vt=rt.geometry,pt=rt.type;if(pt==="Point"||pt==="MultiPoint"||pt==="LineString")Mt(rt,vt);else if(pt==="Polygon"||pt==="MultiLineString")for(var lt=0;lt<vt.length;lt++)Mt(rt,vt[lt]);else if(pt==="MultiPolygon")for(lt=0;lt<vt.length;lt++)for(var _t=0;_t<vt[lt].length;_t++)Mt(rt,vt[lt][_t])}(nt),nt}function Mt(et,U){for(var $=0;$<U.length;$+=3)et.minX=Math.min(et.minX,U[$]),et.minY=Math.min(et.minY,U[$+1]),et.maxX=Math.max(et.maxX,U[$]),et.maxY=Math.max(et.maxY,U[$+1])}function Vt(et,U,$,X){if(U.geometry){var nt=U.geometry.coordinates,rt=U.geometry.type,vt=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),pt=[],lt=U.id;if($.promoteId?lt=U.properties[$.promoteId]:$.generateId&&(lt=X||0),rt==="Point")Bt(nt,pt);else if(rt==="MultiPoint")for(var _t=0;_t<nt.length;_t++)Bt(nt[_t],pt);else if(rt==="LineString")Nt(nt,pt,vt,!1);else if(rt==="MultiLineString"){if($.lineMetrics){for(_t=0;_t<nt.length;_t++)Nt(nt[_t],pt=[],vt,!1),et.push(mt(lt,"LineString",pt,U.properties));return}re(nt,pt,vt,!1)}else if(rt==="Polygon")re(nt,pt,vt,!0);else{if(rt!=="MultiPolygon"){if(rt==="GeometryCollection"){for(_t=0;_t<U.geometry.geometries.length;_t++)Vt(et,{id:lt,geometry:U.geometry.geometries[_t],properties:U.properties},$,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_t=0;_t<nt.length;_t++){var Lt=[];re(nt[_t],Lt,vt,!0),pt.push(Lt)}}et.push(mt(lt,rt,pt,U.properties))}}function Bt(et,U){U.push(dt(et[0])),U.push(Yt(et[1])),U.push(0)}function Nt(et,U,$,X){for(var nt,rt,vt=0,pt=0;pt<et.length;pt++){var lt=dt(et[pt][0]),_t=Yt(et[pt][1]);U.push(lt),U.push(_t),U.push(0),pt>0&&(vt+=X?(nt*_t-lt*rt)/2:Math.sqrt(Math.pow(lt-nt,2)+Math.pow(_t-rt,2))),nt=lt,rt=_t}var Lt=U.length-3;U[2]=1,ei(U,0,Lt,$),U[Lt+2]=1,U.size=Math.abs(vt),U.start=0,U.end=U.size}function re(et,U,$,X){for(var nt=0;nt<et.length;nt++){var rt=[];Nt(et[nt],rt,$,X),U.push(rt)}}function dt(et){return et/360+.5}function Yt(et){var U=Math.sin(et*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function Ft(et,U,$,X,nt,rt,vt,pt){if(X/=U,rt>=($/=U)&&vt<X)return et;if(vt<$||rt>=X)return null;for(var lt=[],_t=0;_t<et.length;_t++){var Lt=et[_t],wt=Lt.geometry,Rt=Lt.type,Re=nt===0?Lt.minX:Lt.minY,Ve=nt===0?Lt.maxX:Lt.maxY;if(Re>=$&&Ve<X)lt.push(Lt);else if(!(Ve<$||Re>=X)){var ve=[];if(Rt==="Point"||Rt==="MultiPoint")Kt(wt,ve,$,X,nt);else if(Rt==="LineString")ie(wt,ve,$,X,nt,!1,pt.lineMetrics);else if(Rt==="MultiLineString")$e(wt,ve,$,X,nt,!1);else if(Rt==="Polygon")$e(wt,ve,$,X,nt,!0);else if(Rt==="MultiPolygon")for(var De=0;De<wt.length;De++){var qe=[];$e(wt[De],qe,$,X,nt,!0),qe.length&&ve.push(qe)}if(ve.length){if(pt.lineMetrics&&Rt==="LineString"){for(De=0;De<ve.length;De++)lt.push(mt(Lt.id,Rt,ve[De],Lt.tags));continue}Rt!=="LineString"&&Rt!=="MultiLineString"||(ve.length===1?(Rt="LineString",ve=ve[0]):Rt="MultiLineString"),Rt!=="Point"&&Rt!=="MultiPoint"||(Rt=ve.length===3?"Point":"MultiPoint"),lt.push(mt(Lt.id,Rt,ve,Lt.tags))}}}return lt.length?lt:null}function Kt(et,U,$,X,nt){for(var rt=0;rt<et.length;rt+=3){var vt=et[rt+nt];vt>=$&&vt<=X&&(U.push(et[rt]),U.push(et[rt+1]),U.push(et[rt+2]))}}function ie(et,U,$,X,nt,rt,vt){for(var pt,lt,_t=Te(et),Lt=nt===0?ki:Ti,wt=et.start,Rt=0;Rt<et.length-3;Rt+=3){var Re=et[Rt],Ve=et[Rt+1],ve=et[Rt+2],De=et[Rt+3],qe=et[Rt+4],Si=nt===0?Re:Ve,Fi=nt===0?De:qe,Ci=!1;vt&&(pt=Math.sqrt(Math.pow(Re-De,2)+Math.pow(Ve-qe,2))),Si<$?Fi>$&&(lt=Lt(_t,Re,Ve,De,qe,$),vt&&(_t.start=wt+pt*lt)):Si>X?Fi<X&&(lt=Lt(_t,Re,Ve,De,qe,X),vt&&(_t.start=wt+pt*lt)):Xe(_t,Re,Ve,ve),Fi<$&&Si>=$&&(lt=Lt(_t,Re,Ve,De,qe,$),Ci=!0),Fi>X&&Si<=X&&(lt=Lt(_t,Re,Ve,De,qe,X),Ci=!0),!rt&&Ci&&(vt&&(_t.end=wt+pt*lt),U.push(_t),_t=Te(et)),vt&&(wt+=pt)}var Pi=et.length-3;Re=et[Pi],Ve=et[Pi+1],ve=et[Pi+2],(Si=nt===0?Re:Ve)>=$&&Si<=X&&Xe(_t,Re,Ve,ve),Pi=_t.length-3,rt&&Pi>=3&&(_t[Pi]!==_t[0]||_t[Pi+1]!==_t[1])&&Xe(_t,_t[0],_t[1],_t[2]),_t.length&&U.push(_t)}function Te(et){var U=[];return U.size=et.size,U.start=et.start,U.end=et.end,U}function $e(et,U,$,X,nt,rt){for(var vt=0;vt<et.length;vt++)ie(et[vt],U,$,X,nt,rt,!1)}function Xe(et,U,$,X){et.push(U),et.push($),et.push(X)}function ki(et,U,$,X,nt,rt){var vt=(rt-U)/(X-U);return et.push(rt),et.push($+(nt-$)*vt),et.push(1),vt}function Ti(et,U,$,X,nt,rt){var vt=(rt-$)/(nt-$);return et.push(U+(X-U)*vt),et.push(rt),et.push(1),vt}function ji(et,U){for(var $=[],X=0;X<et.length;X++){var nt,rt=et[X],vt=rt.type;if(vt==="Point"||vt==="MultiPoint"||vt==="LineString")nt=gn(rt.geometry,U);else if(vt==="MultiLineString"||vt==="Polygon"){nt=[];for(var pt=0;pt<rt.geometry.length;pt++)nt.push(gn(rt.geometry[pt],U))}else if(vt==="MultiPolygon")for(nt=[],pt=0;pt<rt.geometry.length;pt++){for(var lt=[],_t=0;_t<rt.geometry[pt].length;_t++)lt.push(gn(rt.geometry[pt][_t],U));nt.push(lt)}$.push(mt(rt.id,vt,nt,rt.tags))}return $}function gn(et,U){var $=[];$.size=et.size,et.start!==void 0&&($.start=et.start,$.end=et.end);for(var X=0;X<et.length;X+=3)$.push(et[X]+U,et[X+1],et[X+2]);return $}function Wt(et,U){if(et.transformed)return et;var $,X,nt,rt=1<<et.z,vt=et.x,pt=et.y;for($=0;$<et.features.length;$++){var lt=et.features[$],_t=lt.geometry,Lt=lt.type;if(lt.geometry=[],Lt===1)for(X=0;X<_t.length;X+=2)lt.geometry.push(Xn(_t[X],_t[X+1],U,rt,vt,pt));else for(X=0;X<_t.length;X++){var wt=[];for(nt=0;nt<_t[X].length;nt+=2)wt.push(Xn(_t[X][nt],_t[X][nt+1],U,rt,vt,pt));lt.geometry.push(wt)}}return et.transformed=!0,et}function Xn(et,U,$,X,nt,rt){return[Math.round($*(et*X-nt)),Math.round($*(U*X-rt))]}function zi(et,U,$,X,nt){for(var rt=U===nt.maxZoom?0:nt.tolerance/((1<<U)*nt.extent),vt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:X,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pt=0;pt<et.length;pt++){vt.numFeatures++,kr(vt,et[pt],rt,nt);var lt=et[pt].minX,_t=et[pt].minY,Lt=et[pt].maxX,wt=et[pt].maxY;lt<vt.minX&&(vt.minX=lt),_t<vt.minY&&(vt.minY=_t),Lt>vt.maxX&&(vt.maxX=Lt),wt>vt.maxY&&(vt.maxY=wt)}return vt}function kr(et,U,$,X){var nt=U.geometry,rt=U.type,vt=[];if(rt==="Point"||rt==="MultiPoint")for(var pt=0;pt<nt.length;pt+=3)vt.push(nt[pt]),vt.push(nt[pt+1]),et.numPoints++,et.numSimplified++;else if(rt==="LineString")cn(vt,nt,et,$,!1,!1);else if(rt==="MultiLineString"||rt==="Polygon")for(pt=0;pt<nt.length;pt++)cn(vt,nt[pt],et,$,rt==="Polygon",pt===0);else if(rt==="MultiPolygon")for(var lt=0;lt<nt.length;lt++){var _t=nt[lt];for(pt=0;pt<_t.length;pt++)cn(vt,_t[pt],et,$,!0,pt===0)}if(vt.length){var Lt=U.tags||null;if(rt==="LineString"&&X.lineMetrics){for(var wt in Lt={},U.tags)Lt[wt]=U.tags[wt];Lt.mapbox_clip_start=nt.start/nt.size,Lt.mapbox_clip_end=nt.end/nt.size}var Rt={geometry:vt,type:rt==="Polygon"||rt==="MultiPolygon"?3:rt==="LineString"||rt==="MultiLineString"?2:1,tags:Lt};U.id!==null&&(Rt.id=U.id),et.features.push(Rt)}}function cn(et,U,$,X,nt,rt){var vt=X*X;if(X>0&&U.size<(nt?vt:X))$.numPoints+=U.length/3;else{for(var pt=[],lt=0;lt<U.length;lt+=3)(X===0||U[lt+2]>vt)&&($.numSimplified++,pt.push(U[lt]),pt.push(U[lt+1])),$.numPoints++;nt&&function(_t,Lt){for(var wt=0,Rt=0,Re=_t.length,Ve=Re-2;Rt<Re;Ve=Rt,Rt+=2)wt+=(_t[Rt]-_t[Ve])*(_t[Rt+1]+_t[Ve+1]);if(wt>0===Lt)for(Rt=0,Re=_t.length;Rt<Re/2;Rt+=2){var ve=_t[Rt],De=_t[Rt+1];_t[Rt]=_t[Re-2-Rt],_t[Rt+1]=_t[Re-1-Rt],_t[Re-2-Rt]=ve,_t[Re-1-Rt]=De}}(pt,rt),et.push(pt)}}function jt(et,U){var $=(U=this.options=function(nt,rt){for(var vt in rt)nt[vt]=rt[vt];return nt}(Object.create(this.options),U)).debug;if($&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var X=function(nt,rt){var vt=[];if(nt.type==="FeatureCollection")for(var pt=0;pt<nt.features.length;pt++)Vt(vt,nt.features[pt],rt,pt);else Vt(vt,nt.type==="Feature"?nt:{geometry:nt},rt);return vt}(et,U);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=function(nt,rt){var vt=rt.buffer/rt.extent,pt=nt,lt=Ft(nt,1,-1-vt,vt,0,-1,2,rt),_t=Ft(nt,1,1-vt,2+vt,0,-1,2,rt);return(lt||_t)&&(pt=Ft(nt,1,-vt,1+vt,0,-1,2,rt)||[],lt&&(pt=ji(lt,1).concat(pt)),_t&&(pt=pt.concat(ji(_t,-1)))),pt}(X,U),X.length&&this.splitTile(X,0,0,0),$&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ye(et,U,$){return 32*((1<<et)*$+U)+et}function We(et,U){return U?et.properties[U]:et.id}function Nn(et,U){if(et==null)return!0;if(et.type==="Feature")return We(et,U)!=null;if(et.type==="FeatureCollection"){const $=new Set;for(const X of et.features){const nt=We(X,U);if(nt==null||$.has(nt))return!1;$.add(nt)}return!0}return!1}function zr(et,U){const $=new Map;if(et!=null)if(et.type==="Feature")$.set(We(et,U),et);else for(const X of et.features)$.set(We(X,U),X);return $}jt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jt.prototype.splitTile=function(et,U,$,X,nt,rt,vt){for(var pt=[et,U,$,X],lt=this.options,_t=lt.debug;pt.length;){X=pt.pop(),$=pt.pop(),U=pt.pop(),et=pt.pop();var Lt=1<<U,wt=Ye(U,$,X),Rt=this.tiles[wt];if(!Rt&&(_t>1&&console.time("creation"),Rt=this.tiles[wt]=zi(et,U,$,X,lt),this.tileCoords.push({z:U,x:$,y:X}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,$,X,Rt.numFeatures,Rt.numPoints,Rt.numSimplified),console.timeEnd("creation"));var Re="z"+U;this.stats[Re]=(this.stats[Re]||0)+1,this.total++}if(Rt.source=et,nt){if(U===lt.maxZoom||U===nt)continue;var Ve=1<<nt-U;if($!==Math.floor(rt/Ve)||X!==Math.floor(vt/Ve))continue}else if(U===lt.indexMaxZoom||Rt.numPoints<=lt.indexMaxPoints)continue;if(Rt.source=null,et.length!==0){_t>1&&console.time("clipping");var ve,De,qe,Si,Fi,Ci,Pi=.5*lt.buffer/lt.extent,Un=.5-Pi,Hi=.5+Pi,fn=1+Pi;ve=De=qe=Si=null,Fi=Ft(et,Lt,$-Pi,$+Hi,0,Rt.minX,Rt.maxX,lt),Ci=Ft(et,Lt,$+Un,$+fn,0,Rt.minX,Rt.maxX,lt),et=null,Fi&&(ve=Ft(Fi,Lt,X-Pi,X+Hi,1,Rt.minY,Rt.maxY,lt),De=Ft(Fi,Lt,X+Un,X+fn,1,Rt.minY,Rt.maxY,lt),Fi=null),Ci&&(qe=Ft(Ci,Lt,X-Pi,X+Hi,1,Rt.minY,Rt.maxY,lt),Si=Ft(Ci,Lt,X+Un,X+fn,1,Rt.minY,Rt.maxY,lt),Ci=null),_t>1&&console.timeEnd("clipping"),pt.push(ve||[],U+1,2*$,2*X),pt.push(De||[],U+1,2*$,2*X+1),pt.push(qe||[],U+1,2*$+1,2*X),pt.push(Si||[],U+1,2*$+1,2*X+1)}}},jt.prototype.getTile=function(et,U,$){var X=this.options,nt=X.extent,rt=X.debug;if(et<0||et>24)return null;var vt=1<<et,pt=Ye(et,U=(U%vt+vt)%vt,$);if(this.tiles[pt])return Wt(this.tiles[pt],nt);rt>1&&console.log("drilling down to z%d-%d-%d",et,U,$);for(var lt,_t=et,Lt=U,wt=$;!lt&&_t>0;)_t--,Lt=Math.floor(Lt/2),wt=Math.floor(wt/2),lt=this.tiles[Ye(_t,Lt,wt)];return lt&&lt.source?(rt>1&&console.log("found parent tile z%d-%d-%d",_t,Lt,wt),rt>1&&console.time("drilling down"),this.splitTile(lt.source,_t,Lt,wt,et,U,$),rt>1&&console.timeEnd("drilling down"),this.tiles[pt]?Wt(this.tiles[pt],nt):null):null};class Je extends bt{constructor(U,$,X,nt){super(U,$,X),this._dataUpdateable=new Map,this.loadGeoJSON=(rt,vt)=>{const{promoteId:pt}=rt;if(rt.request)return c.f(rt.request,(lt,_t,Lt,wt)=>{this._dataUpdateable=Nn(_t,pt)?zr(_t,pt):void 0,vt(lt,_t,Lt,wt)});if(typeof rt.data=="string")try{const lt=JSON.parse(rt.data);this._dataUpdateable=Nn(lt,pt)?zr(lt,pt):void 0,vt(null,lt)}catch{vt(new Error(`Input data given to '${rt.source}' is not a valid GeoJSON object.`))}else rt.dataDiff?this._dataUpdateable?(function(lt,_t,Lt){var wt,Rt,Re,Ve;if(_t.removeAll&&lt.clear(),_t.remove)for(const ve of _t.remove)lt.delete(ve);if(_t.add)for(const ve of _t.add){const De=We(ve,Lt);De!=null&&lt.set(De,ve)}if(_t.update)for(const ve of _t.update){let De=lt.get(ve.id);if(De==null)continue;const qe=!ve.removeAllProperties&&(((wt=ve.removeProperties)===null||wt===void 0?void 0:wt.length)>0||((Rt=ve.addOrUpdateProperties)===null||Rt===void 0?void 0:Rt.length)>0);if((ve.newGeometry||ve.removeAllProperties||qe)&&(De=Object.assign({},De),lt.set(ve.id,De),qe&&(De.properties=Object.assign({},De.properties))),ve.newGeometry&&(De.geometry=ve.newGeometry),ve.removeAllProperties)De.properties={};else if(((Re=ve.removeProperties)===null||Re===void 0?void 0:Re.length)>0)for(const Si of ve.removeProperties)Object.prototype.hasOwnProperty.call(De.properties,Si)&&delete De.properties[Si];if(((Ve=ve.addOrUpdateProperties)===null||Ve===void 0?void 0:Ve.length)>0)for(const{key:Si,value:Fi}of ve.addOrUpdateProperties)De.properties[Si]=Fi}}(this._dataUpdateable,rt.dataDiff,pt),vt(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):vt(new Error(`Cannot update existing geojson data in ${rt.source}`)):vt(new Error(`Input data given to '${rt.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,nt&&(this.loadGeoJSON=nt)}loadGeoJSONTile(U,$){const X=U.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const nt=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!nt)return $(null,null);const rt=new class{constructor(pt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.N,this.length=pt.length,this._features=pt}feature(pt){return new class{constructor(lt){this._feature=lt,this.extent=c.N,this.type=lt.type,this.properties=lt.tags,"id"in lt&&!isNaN(lt.id)&&(this.id=parseInt(lt.id,10))}loadGeometry(){if(this._feature.type===1){const lt=[];for(const _t of this._feature.geometry)lt.push([new c.P(_t[0],_t[1])]);return lt}{const lt=[];for(const _t of this._feature.geometry){const Lt=[];for(const wt of _t)Lt.push(new c.P(wt[0],wt[1]));lt.push(Lt)}return lt}}toGeoJSON(lt,_t,Lt){return Ut.call(this,lt,_t,Lt)}}(this._features[pt])}}(nt.features);let vt=fi(rt);vt.byteOffset===0&&vt.byteLength===vt.buffer.byteLength||(vt=new Uint8Array(vt)),$(null,{vectorTile:rt,rawData:vt.buffer})}loadData(U,$){var X;(X=this._pendingRequest)===null||X===void 0||X.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const nt=!!(U&&U.request&&U.request.collectResourceTiming)&&new c.bu(U.request);this._pendingCallback=$,this._pendingRequest=this.loadGeoJSON(U,(rt,vt)=>{if(delete this._pendingCallback,delete this._pendingRequest,rt||!vt)return $(rt);if(typeof vt!="object")return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{Jt(vt,!0);try{if(U.filter){const lt=c.bC(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(lt.result==="error")throw new Error(lt.value.map(Lt=>`${Lt.key}: ${Lt.message}`).join(", "));vt={type:"FeatureCollection",features:vt.features.filter(Lt=>lt.value.evaluate({zoom:0},Lt))}}this._geoJSONIndex=U.cluster?new Oe(function({superclusterOptions:lt,clusterProperties:_t}){if(!_t||!lt)return lt;const Lt={},wt={},Rt={accumulated:null,zoom:0},Re={properties:null},Ve=Object.keys(_t);for(const ve of Ve){const[De,qe]=_t[ve],Si=c.bC(qe),Fi=c.bC(typeof De=="string"?[De,["accumulated"],["get",ve]]:De);Lt[ve]=Si.value,wt[ve]=Fi.value}return lt.map=ve=>{Re.properties=ve;const De={};for(const qe of Ve)De[qe]=Lt[qe].evaluate(Rt,Re);return De},lt.reduce=(ve,De)=>{Re.properties=De;for(const qe of Ve)Rt.accumulated=ve[qe],ve[qe]=wt[qe].evaluate(Rt,Re)},lt}(U)).load(vt.features):function(lt,_t){return new jt(lt,_t)}(vt,U.geojsonVtOptions)}catch(lt){return $(lt)}this.loaded={};const pt={};if(nt){const lt=nt.finish();lt&&(pt.resourceTiming={},pt.resourceTiming[U.source]=JSON.parse(JSON.stringify(lt)))}$(null,pt)}})}reloadTile(U,$){const X=this.loaded;return X&&X[U.uid]?super.reloadTile(U,$):this.loadTile(U,$)}removeSource(U,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),$()}getClusterExpansionZoom(U,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(X){$(X)}}getClusterChildren(U,$){try{$(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(X){$(X)}}getClusterLeaves(U,$){try{$(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(X){$(X)}}}class lo{constructor(U){this.self=U,this.actor=new c.C(U,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:bt,geojson:Je},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,X)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=X},this.self.registerRTLTextPlugin=$=>{if(c.bD.isParsed())throw new Error("RTL text plugin already registered.");c.bD.applyArabicShaping=$.applyArabicShaping,c.bD.processBidirectionalText=$.processBidirectionalText,c.bD.processStyledBidirectionalText=$.processStyledBidirectionalText}}setReferrer(U,$){this.referrer=$}setImages(U,$,X){this.availableImages[U]=$;for(const nt in this.workerSources[U]){const rt=this.workerSources[U][nt];for(const vt in rt)rt[vt].availableImages=$}X()}setLayers(U,$,X){this.getLayerIndex(U).replace($),X()}updateLayers(U,$,X){this.getLayerIndex(U).update($.layers,$.removedIds),X()}loadTile(U,$,X){this.getWorkerSource(U,$.type,$.source).loadTile($,X)}loadDEMTile(U,$,X){this.getDEMWorkerSource(U,$.source).loadTile($,X)}reloadTile(U,$,X){this.getWorkerSource(U,$.type,$.source).reloadTile($,X)}abortTile(U,$,X){this.getWorkerSource(U,$.type,$.source).abortTile($,X)}removeTile(U,$,X){this.getWorkerSource(U,$.type,$.source).removeTile($,X)}removeDEMTile(U,$){this.getDEMWorkerSource(U,$.source).removeTile($)}removeSource(U,$,X){if(!this.workerSources[U]||!this.workerSources[U][$.type]||!this.workerSources[U][$.type][$.source])return;const nt=this.workerSources[U][$.type][$.source];delete this.workerSources[U][$.type][$.source],nt.removeSource!==void 0?nt.removeSource($,X):X()}loadWorkerSource(U,$,X){try{this.self.importScripts($.url),X()}catch(nt){X(nt.toString())}}syncRTLPluginState(U,$,X){try{c.bD.setState($);const nt=c.bD.getPluginURL();if(c.bD.isLoaded()&&!c.bD.isParsed()&&nt!=null){this.self.importScripts(nt);const rt=c.bD.isParsed();X(rt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${nt}`),rt)}}catch(nt){X(nt.toString())}}getAvailableImages(U){let $=this.availableImages[U];return $||($=[]),$}getLayerIndex(U){let $=this.layerIndexes[U];return $||($=this.layerIndexes[U]=new F),$}getWorkerSource(U,$,X){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][$]||(this.workerSources[U][$]={}),this.workerSources[U][$][X]||(this.workerSources[U][$][X]=new this.workerSourceTypes[$]({send:(nt,rt,vt)=>{this.actor.send(nt,rt,vt,U)}},this.getLayerIndex(U),this.getAvailableImages(U))),this.workerSources[U][$][X]}getDEMWorkerSource(U,$){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][$]||(this.demWorkerSources[U][$]=new zt),this.demWorkerSources[U][$]}}return c.i()&&(self.worker=new lo(self)),lo}),S(["./shared"],function(c){var F="3.6.2";class D{static testProp(e){if(!D.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in D.docStyle)return e[a];return e[0]}static create(e,a,h){const f=window.document.createElement(e);return a!==void 0&&(f.className=a),h&&h.appendChild(f),f}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){D.docStyle&&D.selectProp&&(D.userSelect=D.docStyle[D.selectProp],D.docStyle[D.selectProp]="none")}static enableDrag(){D.docStyle&&D.selectProp&&(D.docStyle[D.selectProp]=D.userSelect)}static setTransform(e,a){e.style[D.transformProp]=a}static addEventListener(e,a,h,f={}){e.addEventListener(a,h,"passive"in f?f:f.capture)}static removeEventListener(e,a,h,f={}){e.removeEventListener(a,h,"passive"in f?f:f.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",D.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",D.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",D.suppressClickInternal,!0)},0)}static mousePos(e,a){const h=e.getBoundingClientRect();return new c.P(a.clientX-h.left-e.clientLeft,a.clientY-h.top-e.clientTop)}static touchPos(e,a){const h=e.getBoundingClientRect(),f=[];for(let y=0;y<a.length;y++)f.push(new c.P(a[y].clientX-h.left-e.clientLeft,a[y].clientY-h.top-e.clientTop));return f}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}D.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,D.selectProp=D.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),D.transformProp=D.testProp(["transform","WebkitTransform"]);const q={supported:!1,testSupport:function(_){!bt&&K&&(zt?Pt(_):W=_)}};let W,K,bt=!1,zt=!1;function Pt(_){const e=_.createTexture();_.bindTexture(_.TEXTURE_2D,e);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,K),_.isContextLost())return;q.supported=!0}catch{}_.deleteTexture(e),bt=!0}var oe,Jt;typeof document<"u"&&(K=document.createElement("img"),K.onload=function(){W&&Pt(W),W=null,zt=!0},K.onerror=function(){bt=!0,W=null},K.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let e,a,h,f;_.resetRequestQueue=()=>{e=[],a=0,h=0,f={}},_.addThrottleControl=k=>{const R=h++;return f[R]=k,R},_.removeThrottleControl=k=>{delete f[k],P()},_.getImage=(k,R,O=!0)=>{q.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*");const Z={requestParameters:k,supportImageRefresh:O,callback:R,cancelled:!1,completed:!1,cancel:()=>{Z.completed||Z.cancelled||(Z.cancelled=!0,Z.innerRequest&&(Z.innerRequest.cancel(),a--),P())}};return e.push(Z),P(),Z};const y=k=>{const{requestParameters:R,supportImageRefresh:O,callback:Z}=k;return c.e(R,{type:"image"}),(O!==!1||c.i()||c.g(R.url)||R.headers&&!Object.keys(R.headers).reduce((tt,Q)=>tt&&Q==="accept",!0)?c.m:E)(R,(tt,Q,it,Y)=>{T(k,Z,tt,Q,it,Y)})},T=(k,R,O,Z,tt,Q)=>{O?R(O):Z instanceof HTMLImageElement||c.a(Z)?R(null,Z):Z&&((it,Y)=>{typeof createImageBitmap=="function"?c.b(it,Y):c.d(it,Y)})(Z,(it,Y)=>{it!=null?R(it):Y!=null&&R(null,Y,{cacheControl:tt,expires:Q})}),k.cancelled||(k.completed=!0,a--,P())},P=()=>{const k=(()=>{const R=Object.keys(f);let O=!1;if(R.length>0){for(const Z of R)if(O=f[Z](),O)break}return O})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=a;R<k&&e.length>0;R++){const O=e.shift();if(O.cancelled){R--;continue}const Z=y(O);a++,O.innerRequest=Z}},E=(k,R)=>{const O=new Image,Z=k.url;let tt=!1;const Q=k.credentials;return Q&&Q==="include"?O.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!c.s(Z))&&(O.crossOrigin="anonymous"),O.fetchPriority="high",O.onload=()=>{R(null,O),O.onerror=O.onload=null},O.onerror=()=>{tt||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),O.onerror=O.onload=null},O.src=Z,{cancel:()=>{tt=!0,O.src=""}}}}(oe||(oe={})),oe.resetRequestQueue(),function(_){_.Glyphs="Glyphs",_.Image="Image",_.Source="Source",_.SpriteImage="SpriteImage",_.SpriteJSON="SpriteJSON",_.Style="Style",_.Tile="Tile",_.Unknown="Unknown"}(Jt||(Jt={}));class Ut{constructor(e){this._transformRequestFn=e}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}normalizeSpriteURL(e,a,h){const f=function(y){const T=y.match(Zt);if(!T)throw new Error(`Unable to parse URL "${y}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(e);return f.path+=`${a}${h}`,function(y){const T=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${T}`}(f)}setTransformRequest(e){this._transformRequestFn=e}}const Zt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Le(_){var e=new c.A(3);return e[0]=_[0],e[1]=_[1],e[2]=_[2],e}var de,te=function(_,e,a){return _[0]=e[0]-a[0],_[1]=e[1]-a[1],_[2]=e[2]-a[2],_};de=new c.A(3),c.A!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0);var Ce=function(_){var e=_[0],a=_[1];return e*e+a*a};function pe(_){const e=[];if(typeof _=="string")e.push({id:"default",url:_});else if(_&&_.length>0){const a=[];for(const{id:h,url:f}of _){const y=`${h}${f}`;a.indexOf(y)===-1&&(a.push(y),e.push({id:h,url:f}))}}return e}function Fe(_,e,a,h,f){if(h)return void _(h);if(f!==Object.values(e).length||f!==Object.values(a).length)return;const y={};for(const T in e){y[T]={};const P=c.h.getImageCanvasContext(a[T]),E=e[T];for(const k in E){const{width:R,height:O,x:Z,y:tt,sdf:Q,pixelRatio:it,stretchX:Y,stretchY:ft,content:St}=E[k];y[T][k]={data:null,pixelRatio:it,sdf:Q,stretchX:Y,stretchY:ft,content:St,spriteData:{width:R,height:O,x:Z,y:tt,context:P}}}}_(null,y)}(function(){var _=new c.A(2);c.A!=Float32Array&&(_[0]=0,_[1]=0)})();class ce{constructor(e,a,h,f){this.context=e,this.format=h,this.texture=e.gl.createTexture(),this.update(a,f)}update(e,a,h){const{width:f,height:y}=e,T=!(this.size&&this.size[0]===f&&this.size[1]===y||h),{context:P}=this,{gl:E}=P;if(this.useMipmap=!!(a&&a.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!a||a.premultiply!==!1)),T)this.size=[f,y],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.a(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,f,y,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:k,y:R}=h||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.a(e)?E.texSubImage2D(E.TEXTURE_2D,0,k,R,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,k,R,f,y,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,a,h){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),h!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=y.LINEAR),e!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,h||e),this.filter=e),a!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,a),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Qt(_){const{userImage:e}=_;return!!(e&&e.render&&e.render())&&(_.data.replace(new Uint8Array(e.data.buffer)),!0)}class fe extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,callback:h}of this.requestors)this._notify(a,h);this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const h=a.spriteData;a.data=new c.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let h=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),h=!1),h}_validateStretch(e,a){if(!e)return!0;let h=0;for(const f of e){if(f[0]<h||f[1]<f[0]||a<f[1])return!1;h=f[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const h=a.spriteData,f=h&&h.width||a.data.width,y=h&&h.height||a.data.height;return!(e[0]<0||f<e[0]||e[1]<0||y<e[1]||e[2]<0||f<e[2]||e[3]<0||y<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,h=!0){const f=this.getImage(e);if(h&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,a){let h=!0;if(!this.isLoaded())for(const f of e)this.images[f]||(h=!1);this.isLoaded()||h?this._notify(e,a):this.requestors.push({ids:e,callback:a})}_notify(e,a){const h={};for(const f of e){let y=this.getImage(f);y||(this.fire(new c.k("styleimagemissing",{id:f})),y=this.getImage(f)),y?h[f]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:c.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,h)}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],h=this.getImage(e);if(!h)return null;if(a&&a.position.version===h.version)return a.position;if(a)a.position.version=h.version;else{const f={w:h.data.width+2,h:h.data.height+2,x:0,y:0},y=new c.I(f,h);this.patterns[e]={bin:f,position:y}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ce(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const y in this.patterns)e.push(this.patterns[y].bin);const{w:a,h}=c.p(e),f=this.atlasImage;f.resize({width:a||1,height:h||1});for(const y in this.patterns){const{bin:T}=this.patterns[y],P=T.x+1,E=T.y+1,k=this.getImage(y).data,R=k.width,O=k.height;c.R.copy(k,f,{x:0,y:0},{x:P,y:E},{width:R,height:O}),c.R.copy(k,f,{x:0,y:O-1},{x:P,y:E-1},{width:R,height:1}),c.R.copy(k,f,{x:0,y:0},{x:P,y:E+O},{width:R,height:1}),c.R.copy(k,f,{x:R-1,y:0},{x:P-1,y:E},{width:1,height:O}),c.R.copy(k,f,{x:0,y:0},{x:P+R,y:E},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const h=this.getImage(a);h||c.w(`Image with ID: "${a}" was not found`),Qt(h)&&this.updateImage(a,h)}}}const ke=1e20;function Ae(_,e,a,h,f,y,T,P,E){for(let k=e;k<e+h;k++)Ke(_,a*y+k,y,f,T,P,E);for(let k=a;k<a+f;k++)Ke(_,k*y+e,1,h,T,P,E)}function Ke(_,e,a,h,f,y,T){y[0]=0,T[0]=-ke,T[1]=ke,f[0]=_[e];for(let P=1,E=0,k=0;P<h;P++){f[P]=_[e+P*a];const R=P*P;do{const O=y[E];k=(f[P]-f[O]+R-O*O)/(P-O)/2}while(k<=T[E]&&--E>-1);E++,y[E]=P,T[E]=k,T[E+1]=ke}for(let P=0,E=0;P<h;P++){for(;T[E+1]<P;)E++;const k=y[E],R=P-k;_[e+P*a]=f[k]+R*R}}class we{constructor(e,a){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={}}setURL(e){this.url=e}getGlyphs(e,a){const h=[];for(const f in e)for(const y of e[f])h.push({stack:f,id:y});c.o(h,({stack:f,id:y},T)=>{let P=this.entries[f];P||(P=this.entries[f]={glyphs:{},requests:{},ranges:{}});let E=P.glyphs[y];if(E!==void 0)return void T(null,{stack:f,id:y,glyph:E});if(E=this._tinySDF(P,f,y),E)return P.glyphs[y]=E,void T(null,{stack:f,id:y,glyph:E});const k=Math.floor(y/256);if(256*k>65535)return void T(new Error("glyphs > 65535 not supported"));if(P.ranges[k])return void T(null,{stack:f,id:y,glyph:E});if(!this.url)return void T(new Error("glyphsUrl is not set"));let R=P.requests[k];R||(R=P.requests[k]=[],we.loadGlyphRange(f,k,this.url,this.requestManager,(O,Z)=>{if(Z){for(const tt in Z)this._doesCharSupportLocalGlyph(+tt)||(P.glyphs[+tt]=Z[+tt]);P.ranges[k]=!0}for(const tt of R)tt(O,Z);delete P.requests[k]})),R.push((O,Z)=>{O?T(O):Z&&T(null,{stack:f,id:y,glyph:Z[y]||null})})},(f,y)=>{if(f)a(f);else if(y){const T={};for(const{stack:P,id:E,glyph:k}of y)(T[P]||(T[P]={}))[E]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};a(null,T)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(c.u["CJK Unified Ideographs"](e)||c.u["Hangul Syllables"](e)||c.u.Hiragana(e)||c.u.Katakana(e))}_tinySDF(e,a,h){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let y=e.tinySDF;if(!y){let P="400";/bold/i.test(a)?P="900":/medium/i.test(a)?P="500":/light/i.test(a)&&(P="200"),y=e.tinySDF=new we.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:P})}const T=y.draw(String.fromCharCode(h));return{id:h,bitmap:new c.q({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}we.loadGlyphRange=function(_,e,a,h,f){const y=256*e,T=y+255,P=h.transformRequest(a.replace("{fontstack}",_).replace("{range}",`${y}-${T}`),Jt.Glyphs);c.l(P,(E,k)=>{if(E)f(E);else if(k){const R={};for(const O of c.n(k))R[O.id]=O;f(null,R)}})},we.TinySDF=class{constructor({fontSize:_=24,buffer:e=3,radius:a=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:y="normal",fontStyle:T="normal"}={}){this.buffer=e,this.cutoff=h,this.radius=a;const P=this.size=_+4*e,E=this._createCanvas(P),k=this.ctx=E.getContext("2d",{willReadFrequently:!0});k.font=`${T} ${y} ${_}px ${f}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(_){const e=document.createElement("canvas");return e.width=e.height=_,e}draw(_){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:y}=this.ctx.measureText(_),T=Math.ceil(a),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-f))),E=Math.min(this.size-this.buffer,T+Math.ceil(h)),k=P+2*this.buffer,R=E+2*this.buffer,O=Math.max(k*R,0),Z=new Uint8ClampedArray(O),tt={data:Z,width:k,height:R,glyphWidth:P,glyphHeight:E,glyphTop:T,glyphLeft:0,glyphAdvance:e};if(P===0||E===0)return tt;const{ctx:Q,buffer:it,gridInner:Y,gridOuter:ft}=this;Q.clearRect(it,it,P,E),Q.fillText(_,it,it+T);const St=Q.getImageData(it,it,P,E);ft.fill(ke,0,O),Y.fill(0,0,O);for(let st=0;st<E;st++)for(let gt=0;gt<P;gt++){const It=St.data[4*(st*P+gt)+3]/255;if(It===0)continue;const Ct=(st+it)*k+gt+it;if(It===1)ft[Ct]=0,Y[Ct]=ke;else{const kt=.5-It;ft[Ct]=kt>0?kt*kt:0,Y[Ct]=kt<0?kt*kt:0}}Ae(ft,0,0,k,R,k,this.f,this.v,this.z),Ae(Y,it,it,P,E,k,this.f,this.v,this.z);for(let st=0;st<O;st++){const gt=Math.sqrt(ft[st])-Math.sqrt(Y[st]);Z[st]=Math.round(255-255*(gt/this.radius+this.cutoff))}return tt}};class Me{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,a){return c.z(e.expression.evaluate(a))}interpolate(e,a,h){return{x:c.B.number(e.x,a.x,h),y:c.B.number(e.y,a.y,h),z:c.B.number(e.z,a.z,h)}}}let Ht;class fi extends c.E{constructor(e){super(),Ht=Ht||new c.r({anchor:new c.D(c.v.light.anchor),position:new Me,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Ht),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(c.t,e,a))for(const h in e){const f=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),f):this._transitionable.setValue(h,f)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,h){return(!h||h.validate!==!1)&&c.x(this,e.call(c.y,c.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}}class ze{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const h=e.join(",")+String(a);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(e,a)),this.dashEntry[h]}getDashRanges(e,a,h){const f=[];let y=e.length%2==1?-e[e.length-1]*h:0,T=e[0]*h,P=!0;f.push({left:y,right:T,isDash:P,zeroLength:e[0]===0});let E=e[0];for(let k=1;k<e.length;k++){P=!P;const R=e[k];y=E*h,E+=R,T=E*h,f.push({left:y,right:T,isDash:P,zeroLength:R===0})}return f}addRoundDash(e,a,h){const f=a/2;for(let y=-h;y<=h;y++){const T=this.width*(this.nextRow+h+y);let P=0,E=e[P];for(let k=0;k<this.width;k++){k/E.right>1&&(E=e[++P]);const R=Math.abs(k-E.left),O=Math.abs(k-E.right),Z=Math.min(R,O);let tt;const Q=y/h*(f+1);if(E.isDash){const it=f-Math.abs(Q);tt=Math.sqrt(Z*Z+it*it)}else tt=f-Math.sqrt(Z*Z+Q*Q);this.data[T+k]=Math.max(0,Math.min(255,tt+128))}}}addRegularDash(e){for(let P=e.length-1;P>=0;--P){const E=e[P],k=e[P+1];E.zeroLength?e.splice(P,1):k&&k.isDash===E.isDash&&(k.left=E.left,e.splice(P,1))}const a=e[0],h=e[e.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const f=this.width*this.nextRow;let y=0,T=e[y];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++y]);const E=Math.abs(P-T.left),k=Math.abs(P-T.right),R=Math.min(E,k);this.data[f+P]=Math.max(0,Math.min(255,(T.isDash?R:-R)+128))}}addDash(e,a){const h=a?7:0,f=2*h+1;if(this.nextRow+f>this.height)return c.w("LineAtlas out of space"),null;let y=0;for(let P=0;P<e.length;P++)y+=e[P];if(y!==0){const P=this.width/y,E=this.getDashRanges(e,this.width,P);a?this.addRoundDash(E,P,h):this.addRegularDash(E)}const T={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:y};return this.nextRow+=f,this.dirty=!0,T}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class Ue{constructor(e,a,h){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=h;const f=this.workerPool.acquire(h);for(let y=0;y<f.length;y++){const T=new c.C(f[y],a,h);T.name=`Worker ${y}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a,h){c.o(this.actors,(f,y)=>{f.send(e,a,y)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}}function si(_,e,a){const h=function(f,y){if(f)return a(f);if(y){const T=c.F(c.e(y,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(T.vectorLayers=y.vector_layers,T.vectorLayerIds=T.vectorLayers.map(P=>P.id)),a(null,T)}};return _.url?c.f(e.transformRequest(_.url,Jt.Source),h):c.h.frame(()=>h(null,_))}class je{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.L?new c.L(e.lng,e.lat):c.L.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.L?new c.L(e.lng,e.lat):c.L.convert(e),this}extend(e){const a=this._sw,h=this._ne;let f,y;if(e instanceof c.L)f=e,y=e;else{if(!(e instanceof je))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(je.convert(e)):this.extend(c.L.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.L.convert(e)):this;if(f=e._sw,y=e._ne,!f||!y)return this}return a||h?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),h.lng=Math.max(y.lng,h.lng),h.lat=Math.max(y.lat,h.lat)):(this._sw=new c.L(f.lng,f.lat),this._ne=new c.L(y.lng,y.lat)),this}getCenter(){return new c.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.L(this.getWest(),this.getNorth())}getSouthEast(){return new c.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:h}=c.L.convert(e);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(e){return e instanceof je?e:e&&new je(e)}static fromLngLat(e,a=0){const h=360*a/40075017,f=h/Math.cos(Math.PI/180*e.lat);return new je(new c.L(e.lng-f,e.lat-h),new c.L(e.lng+f,e.lat+h))}}class ui{constructor(e,a,h){this.bounds=je.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=h||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),h=Math.floor(c.G(this.bounds.getWest())*a),f=Math.floor(c.H(this.bounds.getNorth())*a),y=Math.ceil(c.G(this.bounds.getEast())*a),T=Math.ceil(c.H(this.bounds.getSouth())*a);return e.x>=h&&e.x<y&&e.y>=f&&e.y<T}}class hi extends c.E{constructor(e,a,h,f){if(super(),this.load=()=>{this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=si(this._options,this.map._requestManager,(y,T)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new c.j(y)):T&&(c.e(this,T),T.bounds&&(this.tileBounds=new ui(T.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>c.e({},this._options),this.id=e,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.F(a,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(e,a){const h=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(h,Jt.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(T,P){return delete e.request,e.aborted?a(null):T&&T.status!==404?a(T):(P&&P.resourceTiming&&(e.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&e.setExpiryData(P),e.loadVectorData(P,this.map.painter),a(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}f.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired"?e.state==="loading"?e.reloadCallback=a:e.request=e.actor.send("reloadTile",f,y.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",f,y.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Oe extends c.E{constructor(e,a,h,f){super(),this.id=e,this.dispatcher=h,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},a),c.e(this,c.F(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=si(this._options,this.map._requestManager,(e,a)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new c.j(e)):a&&(c.e(this,a),a.bounds&&(this.tileBounds=new ui(a.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,a){const h=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=oe.getImage(this.map._requestManager.transformRequest(h,Jt.Tile),(f,y,T)=>{if(delete e.request,e.aborted)e.state="unloaded",a(null);else if(f)e.state="errored",a(f);else if(y){this.map._refreshExpiredTiles&&T&&e.setExpiryData(T);const P=this.map.painter.context,E=P.gl;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new ce(P,y,E.RGBA,{useMipmap:!0}),e.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),P.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax)),e.state="loaded",a(null)}},this.map._refreshExpiredTiles)}abortTile(e,a){e.request&&(e.request.cancel(),delete e.request),a()}unloadTile(e,a){e.texture&&this.map.painter.saveTileTexture(e.texture),a()}hasTransition(){return!1}}class pn extends Oe{constructor(e,a,h,f){super(e,a,h,f),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e,a){const h=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(h,Jt.Tile);function y(T,P){T&&(e.state="errored",a(T)),P&&(e.dem=P,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",a(null))}e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.request=oe.getImage(f,(T,P,E)=>c._(this,void 0,void 0,function*(){if(delete e.request,e.aborted)e.state="unloaded",a(null);else if(T)e.state="errored",a(T);else if(P){this.map._refreshExpiredTiles&&e.setExpiryData(E);const k=c.a(P)&&c.J()?P:yield function(O){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.K()){const Z=O.width+2,tt=O.height+2;try{return new c.R({width:Z,height:tt},yield c.M(O,-1,-1,Z,tt))}catch{}}return c.h.getImageData(O,1)})}(P),R={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:k,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",R,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(e){const a=e.canonical,h=Math.pow(2,a.z),f=(a.x-1+h)%h,y=a.x===0?e.wrap-1:e.wrap,T=(a.x+1+h)%h,P=a.x+1===h?e.wrap+1:e.wrap,E={};return E[new c.O(e.overscaledZ,y,a.z,f,a.y).key]={backfilled:!1},E[new c.O(e.overscaledZ,P,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(E[new c.O(e.overscaledZ,y,a.z,f,a.y-1).key]={backfilled:!1},E[new c.O(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},E[new c.O(e.overscaledZ,P,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<h&&(E[new c.O(e.overscaledZ,y,a.z,f,a.y+1).key]={backfilled:!1},E[new c.O(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},E[new c.O(e.overscaledZ,P,a.z,T,a.y+1).key]={backfilled:!1}),E}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class be extends c.E{constructor(e,a,h,f){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>c.e({},this._options,{type:this.type,data:this._data}),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(f),this._data=a.data,this._options=c.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const y=c.N/this.tileSize;this.workerOptions=c.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*y,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*y,extent:c.N,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:c.N,radius:(a.clusterRadius||50)*y,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},a),this}getClusterChildren(e,a){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},a),this}getClusterLeaves(e,a,h,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:a,offset:h},f),this}_updateWorkerData(e){const a=c.e({},this.workerOptions);e?a.dataDiff=e:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(c.h.resolveURL(this._data),Jt.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(h,f)=>{if(this._pendingLoads--,this._removed||f&&f.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let y=null;if(f&&f.resourceTiming&&f.resourceTiming[this.id]&&(y=f.resourceTiming[this.id].slice(0)),h)return void this.fire(new c.j(h));const T={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&c.e(T,{resourceTiming:y}),this.fire(new c.k("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(e,a){const h=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const f={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(h,f,(y,T)=>(delete e.request,e.unloadVectorData(),e.aborted?a(null):y?a(y):(e.loadVectorData(T,this.map.painter,h==="reloadTile"),a(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Ge=c.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ti extends c.E{constructor(e,a,h,f){super(),this.load=(y,T)=>{this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=oe.getImage(this.map._requestManager.transformRequest(this.url,Jt.Image),(P,E)=>{this._request=null,this._loaded=!0,P?this.fire(new c.j(P)):E&&(this.image=E,y&&(this.coordinates=y),T&&T(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,T=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Ge.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ce(y,this.image,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let P=!1;for(const E in this.tiles){const k=this.tiles[E];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,P=!0)}P&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=e,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(c.U.fromLngLat);this.tileID=function(f){let y=1/0,T=1/0,P=-1/0,E=-1/0;for(const Z of f)y=Math.min(y,Z.x),T=Math.min(T,Z.y),P=Math.max(P,Z.x),E=Math.max(E,Z.y);const k=Math.max(P-y,E-T),R=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),O=Math.pow(2,R);return new c.W(R,Math.floor((y+P)/2*O),Math.floor((T+E)/2*O))}(a),this.minzoom=this.maxzoom=this.tileID.z;const h=a.map(f=>this.tileID.getTilePoint(f)._round());return this._boundsArray=new c.V,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,c.N,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,c.N),this._boundsArray.emplaceBack(h[2].x,h[2].y,c.N,c.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(e,a){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},a(null)):(e.state="errored",a(null))}hasTransition(){return!1}}class en extends ti{constructor(e,a,h,f){super(e,a,h,f),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const T of y.urls)this.urls.push(this.map._requestManager.transformRequest(T,Jt.Source).url);c.X(this.urls,(T,P)=>{this._loaded=!0,T?this.fire(new c.j(T)):P&&(this.video=P,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,T=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Ge.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.texSubImage2D(T.TEXTURE_2D,0,0,0,T.RGBA,T.UNSIGNED_BYTE,this.video)):(this.texture=new ce(y,this.video,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let P=!1;for(const E in this.tiles){const k=this.tiles[E];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,P=!0)}P&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=a}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new c.j(new c.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class ei extends ti{constructor(e,a,h,f){super(e,a,h,f),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const T=this.map.painter.context,P=T.gl;this.boundsBuffer||(this.boundsBuffer=T.createVertexBuffer(this._boundsArray,Ge.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ce(T,this.canvas,P.RGBA,{premultiply:!0});let E=!1;for(const k in this.tiles){const R=this.tiles[k];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,E=!0)}E&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(T=>typeof T!="number"))||this.fire(new c.j(new c.Y(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.Y(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new c.j(new c.Y(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.Y(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.Y(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ut={},mt=_=>{switch(_){case"geojson":return be;case"image":return ti;case"raster":return Oe;case"raster-dem":return pn;case"vector":return hi;case"video":return en;case"canvas":return ei}return ut[_]};function Mt(_,e){const a=c.Z();return c.$(a,a,[1,1,0]),c.a0(a,a,[.5*_.width,.5*_.height,1]),c.a1(a,a,_.calculatePosMatrix(e.toUnwrapped()))}function Vt(_,e,a,h,f,y){const T=function(O,Z,tt){if(O)for(const Q of O){const it=Z[Q];if(it&&it.source===tt&&it.type==="fill-extrusion")return!0}else for(const Q in Z){const it=Z[Q];if(it.source===tt&&it.type==="fill-extrusion")return!0}return!1}(f&&f.layers,e,_.id),P=y.maxPitchScaleFactor(),E=_.tilesIn(h,P,T);E.sort(Bt);const k=[];for(const O of E)k.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(e,a,_._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,f,y,P,Mt(_.transform,O.tileID))});const R=function(O){const Z={},tt={};for(const Q of O){const it=Q.queryResults,Y=Q.wrappedTileID,ft=tt[Y]=tt[Y]||{};for(const St in it){const st=it[St],gt=ft[St]=ft[St]||{},It=Z[St]=Z[St]||[];for(const Ct of st)gt[Ct.featureIndex]||(gt[Ct.featureIndex]=!0,It.push(Ct))}}return Z}(k);for(const O in R)R[O].forEach(Z=>{const tt=Z.feature,Q=_.getFeatureState(tt.layer["source-layer"],tt.id);tt.source=tt.layer.source,tt.layer["source-layer"]&&(tt.sourceLayer=tt.layer["source-layer"]),tt.state=Q});return R}function Bt(_,e){const a=_.tileID,h=e.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}class Nt{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a2(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const a=e+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(f,y){const T={};if(!y)return T;for(const P of f){const E=P.layerIds.map(k=>y.getLayer(k)).filter(Boolean);if(E.length!==0){P.layers=E,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(k=>E.filter(R=>R.id===k)[0]));for(const k of E)T[k.id]=P}}return T}(e.buckets,a.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const y=this.buckets[f];if(y instanceof c.a4){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const y=this.buckets[f];if(y instanceof c.a4&&y.hasRTLText){this.hasRTLText=!0,c.a5();break}}this.queryPadding=0;for(const f in this.buckets){const y=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a3}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ce(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ce(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,h,f,y,T,P,E,k,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:y,scale:T,tileSize:this.tileSize,pixelPosMatrix:R,transform:E,params:P,queryPadding:this.queryPadding*k},e,a,h):{}}querySourceFeatures(e,a){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),y=a&&a.sourceLayer?a.sourceLayer:"",T=f._geojsonTileLayer||f[y];if(!T)return;const P=c.a6(a&&a.filter),{z:E,x:k,y:R}=this.tileID.canonical,O={z:E,x:k,y:R};for(let Z=0;Z<T.length;Z++){const tt=T.feature(Z);if(P.needGeometry){const Y=c.a7(tt,!0);if(!P.filter(new c.a8(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!P.filter(new c.a8(this.tileID.overscaledZ),tt))continue;const Q=h.getId(tt,y),it=new c.a9(tt,E,k,R,Q);it.tile=O,e.push(it)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const h=c.aa(e.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const y=this.expirationTime-a;y?this.expirationTime=h+Math.max(y,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const y=this.buckets[f],T=y.layers[0].sourceLayer||"_geojsonTileLayer",P=h[T],E=e[T];if(!P||!E||Object.keys(E).length===0)continue;y.update(E,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=a&&a.style&&a.style.getLayer(f);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=c.h.now()+e}setDependencies(e,a){const h={};for(const f of a)h[f]=!0;this.dependencies[e]=h}hasDependency(e,a){for(const h of e){const f=this.dependencies[h];if(f){for(const y of a)if(f[y])return!0}}return!1}}class re{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(const e in this.data)for(const a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,h){const f=e.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const y={value:a,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout(()=>{this.remove(e,y)},h)),this.data[f].push(y),this.order.push(f),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){const a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;const h=e.wrapped().key,f=a===void 0?0:this.data[h].indexOf(a),y=this.data[h][f];return this.data[h].splice(f,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){const a=[];for(const h in this.data)for(const f of this.data[h])e(f.value)||a.push(f);for(const h of a)this.remove(h.value.tileID,h)}}class dt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,h){const f=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},c.e(this.stateChanges[e][f],h),this.deletedStates[e]===null){this.deletedStates[e]={};for(const y in this.state[e])y!==f&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(const y in this.state[e][f])h[y]||(this.deletedStates[e][f][y]=null)}else for(const y in h)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][y]===null&&delete this.deletedStates[e][f][y]}removeFeatureState(e,a,h){if(this.deletedStates[e]===null)return;const f=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},h&&a!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][h]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(h in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][h]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,a){const h=String(a),f=c.e({},(this.state[e]||{})[h],(this.stateChanges[e]||{})[h]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const y=this.deletedStates[e][a];if(y===null)return{};for(const T in y)delete f[T]}return f}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const y={};for(const T in this.stateChanges[f])this.state[f][T]||(this.state[f][T]={}),c.e(this.state[f][T],this.stateChanges[f][T]),y[T]=this.state[f][T];h[f]=y}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const y={};if(this.deletedStates[f]===null)for(const T in this.state[f])y[T]={},this.state[f][T]={};else for(const T in this.deletedStates[f]){if(this.deletedStates[f][T]===null)this.state[f][T]={};else for(const P of Object.keys(this.deletedStates[f][T]))delete this.state[f][T][P];y[T]=this.state[f][T]}h[f]=h[f]||{},c.e(h[f],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const f in e)e[f].setFeatureState(h,a)}}class Yt extends c.E{constructor(e,a,h){super(),this.id=e,this.dispatcher=h,this.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((f,y,T,P)=>{const E=new(mt(y.type))(f,y,T,P);if(E.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${E.id}`);return E})(e,a,h,this),this._tiles={},this._cache=new re(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new dt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a){return this._source.loadTile(e,a)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,()=>{}),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const h=this._tiles[a];h.upload(e),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ft).map(e=>e.key)}getRenderableIds(e){const a=[];for(const h in this._tiles)this._isIdRenderable(h,e)&&a.push(this._tiles[h]);return e?a.sort((h,f)=>{const y=h.tileID,T=f.tileID,P=new c.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),E=new c.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-T.overscaledZ||E.y-P.y||E.x-P.x}).map(h=>h.tileID.key):a.map(h=>h.tileID).sort(Ft).map(h=>h.key)}hasRenderableParent(e){const a=this.findLoadedParent(e,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(e,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(a||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,a){const h=this._tiles[e];h&&(h.state!=="loading"&&(h.state=a),this._loadTile(h,this._tileLoaded.bind(this,h,e,a)))}_tileLoaded(e,a,h,f){if(f)return e.state="errored",void(f.status!==404?this._source.fire(new c.j(f,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=c.h.now(),h==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let f=0;f<a.length;f++){const y=a[f];if(e.neighboringTiles&&e.neighboringTiles[y]){const T=this.getTileByID(y);h(e,T),h(T,e)}}function h(f,y){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let T=y.tileID.canonical.x-f.tileID.canonical.x;const P=y.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),k=y.tileID.key;T===0&&P===0||Math.abs(P)>1||(Math.abs(T)>1&&(Math.abs(T+E)===1?T+=E:Math.abs(T-E)===1&&(T-=E)),y.dem&&f.dem&&(f.dem.backfillBorder(y.dem,T,P),f.neighboringTiles&&f.neighboringTiles[k]&&(f.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a,h,f){for(const y in this._tiles){let T=this._tiles[y];if(f[y]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>h)continue;let P=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const k=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[k.key],T&&T.hasData()&&(P=k)}let E=P;for(;E.overscaledZ>a;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){f[P.key]=P;break}}}findLoadedParent(e,a){if(e.key in this._loadedParentTiles){const h=this._loadedParentTiles[e.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=e.overscaledZ-1;h>=a;h--){const f=e.scaledTo(h),y=this._getLoadedTile(f);if(y)return y}}_getLoadedTile(e){const a=this._tiles[e.key];return a&&a.hasData()?a:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,h=Math.ceil(e.height/this._source.tileSize)+1,f=Math.floor(a*h*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(y)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const h={};for(const f in this._tiles){const y=this._tiles[f];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),h[y.tileID.key]=y}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(e,a){if(this.transform=e,this.terrain=a,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new c.O(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(h=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(h=h.filter(R=>this._source.hasTile(R)))):h=[];const f=e.coveringZoomLevel(this._source),y=Math.max(f-Yt.maxOverzooming,this._source.minzoom),T=Math.max(f+Yt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const O of h)if(O.canonical.z>this._source.minzoom){const Z=O.scaledTo(O.canonical.z-1);R[Z.key]=Z;const tt=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));R[tt.key]=tt}h=h.concat(Object.values(R))}const P=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(h,f);if(Kt(this._source.type)){const R={},O={},Z=Object.keys(E),tt=c.h.now();for(const Q of Z){const it=E[Q],Y=this._tiles[Q];if(!Y||Y.fadeEndTime!==0&&Y.fadeEndTime<=tt)continue;const ft=this.findLoadedParent(it,y);ft&&(this._addTile(ft.tileID),R[ft.tileID.key]=ft.tileID),O[Q]=it}this._retainLoadedChildren(O,f,T,E);for(const Q in R)E[Q]||(this._coveredTiles[Q]=!0,E[Q]=R[Q]);if(a){const Q={},it={};for(const Y of h)this._tiles[Y.key].hasData()?Q[Y.key]=Y:it[Y.key]=Y;for(const Y in it){const ft=it[Y].children(this._source.maxzoom);this._tiles[ft[0].key]&&this._tiles[ft[1].key]&&this._tiles[ft[2].key]&&this._tiles[ft[3].key]&&(Q[ft[0].key]=E[ft[0].key]=ft[0],Q[ft[1].key]=E[ft[1].key]=ft[1],Q[ft[2].key]=E[ft[2].key]=ft[2],Q[ft[3].key]=E[ft[3].key]=ft[3],delete it[Y])}for(const Y in it){const ft=this.findLoadedParent(it[Y],this._source.minzoom);if(ft){Q[ft.tileID.key]=E[ft.tileID.key]=ft.tileID;for(const St in Q)Q[St].isChildOf(ft.tileID)&&delete Q[St]}}for(const Y in this._tiles)Q[Y]||(this._coveredTiles[Y]=!0)}}for(const R in E)this._tiles[R].clearFadeHold();const k=c.ab(this._tiles,E);for(const R of k){const O=this._tiles[R];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){const h={},f={},y=Math.max(a-Yt.maxOverzooming,this._source.minzoom),T=Math.max(a+Yt.maxUnderzooming,this._source.minzoom),P={};for(const E of e){const k=this._addTile(E);h[E.key]=E,k.hasData()||a<this._source.maxzoom&&(P[E.key]=E)}this._retainLoadedChildren(P,a,T,h);for(const E of e){let k=this._tiles[E.key];if(k.hasData())continue;if(a+1>this._source.maxzoom){const O=E.children(this._source.maxzoom)[0],Z=this.getTile(O);if(Z&&Z.hasData()){h[O.key]=O;continue}}else{const O=E.children(this._source.maxzoom);if(h[O[0].key]&&h[O[1].key]&&h[O[2].key]&&h[O[3].key])continue}let R=k.wasRequested();for(let O=E.overscaledZ-1;O>=y;--O){const Z=E.scaledTo(O);if(f[Z.key])break;if(f[Z.key]=!0,k=this.getTile(Z),!k&&R&&(k=this._addTile(Z)),k){const tt=k.hasData();if((R||tt)&&(h[Z.key]=Z),R=k.wasRequested(),tt)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const a=[];let h,f=this._tiles[e].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}a.push(f.key);const y=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;f=y}for(const y of a)this._loadedParentTiles[y]=h}}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,a)));const h=a;return a||(a=new Nt(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,e.key,a.state))),a.uses++,this._tiles[e.key]=a,h||this._source.fire(new c.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const h=a.getExpiryTimeout();h&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},h))}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,h){const f=[],y=this.transform;if(!y)return f;const T=h?y.getCameraQueryGeometry(e):e,P=e.map(Q=>y.pointCoordinate(Q,this.terrain)),E=T.map(Q=>y.pointCoordinate(Q,this.terrain)),k=this.getIds();let R=1/0,O=1/0,Z=-1/0,tt=-1/0;for(const Q of E)R=Math.min(R,Q.x),O=Math.min(O,Q.y),Z=Math.max(Z,Q.x),tt=Math.max(tt,Q.y);for(let Q=0;Q<k.length;Q++){const it=this._tiles[k[Q]];if(it.holdingForFade())continue;const Y=it.tileID,ft=Math.pow(2,y.zoom-it.tileID.overscaledZ),St=a*it.queryPadding*c.N/it.tileSize/ft,st=[Y.getTilePoint(new c.U(R,O)),Y.getTilePoint(new c.U(Z,tt))];if(st[0].x-St<c.N&&st[0].y-St<c.N&&st[1].x+St>=0&&st[1].y+St>=0){const gt=P.map(Ct=>Y.getTilePoint(Ct)),It=E.map(Ct=>Y.getTilePoint(Ct));f.push({tile:it,tileID:Y,queryGeometry:gt,cameraQueryGeometry:It,scale:ft})}}return f}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map(h=>this._tiles[h].tileID);for(const h of a)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Kt(this._source.type)){const e=c.h.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setFeatureState(e,a,h){this._state.updateState(e=e||"_geojsonTileLayer",a,h)}removeFeatureState(e,a,h){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,h)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,h){const f=this._tiles[e];f&&f.setDependencies(a,h)}reloadTilesForDependencies(e,a){for(const h in this._tiles)this._tiles[h].hasDependency(e,a)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(e,a))}}function Ft(_,e){const a=Math.abs(2*_.wrap)-+(_.wrap<0),h=Math.abs(2*e.wrap)-+(e.wrap<0);return _.overscaledZ-e.overscaledZ||h-a||e.canonical.y-_.canonical.y||e.canonical.x-_.canonical.x}function Kt(_){return _==="raster"||_==="image"||_==="video"}Yt.maxOverzooming=10,Yt.maxUnderzooming=3;const ie="mapboxgl_preloaded_worker_pool";class Te{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Te.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ie]}numActive(){return Object.keys(this.active).length}}const $e=Math.floor(c.h.hardwareConcurrency/2);let Xe;function ki(){return Xe||(Xe=new Te),Xe}Te.workerCount=c.ac(globalThis)?Math.max(Math.min($e,3),1):1;class Ti{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ad(e,0,1);let a=1,h=this._distances[a];const f=e*this.paddedLength+this.padding;for(;h<f&&a<this._distances.length;)h=this._distances[++a];const y=a-1,T=this._distances[y],P=h-T,E=P>0?(f-T)/P:0;return this.points[y].mult(1-E).add(this.points[a].mult(E))}}function ji(_,e){let a=!0;return _==="always"||_!=="never"&&e!=="never"||(a=!1),a}class gn{constructor(e,a,h){const f=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(e/h),this.yCellCount=Math.ceil(a/h);for(let T=0;T<this.xCellCount*this.yCellCount;T++)f.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,h,f,y){this._forEachCell(a,h,f,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(y)}insertCircle(e,a,h,f){this._forEachCell(a-f,h-f,a+f,h+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(h),this.circles.push(f)}_insertBoxCell(e,a,h,f,y,T){this.boxCells[y].push(T)}_insertCircleCell(e,a,h,f,y,T){this.circleCells[y].push(T)}_query(e,a,h,f,y,T,P){if(h<0||e>this.width||f<0||a>this.height)return[];const E=[];if(e<=0&&a<=0&&this.width<=h&&this.height<=f){if(y)return[{key:null,x1:e,y1:a,x2:h,y2:f}];for(let k=0;k<this.boxKeys.length;k++)E.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const R=this.circles[3*k],O=this.circles[3*k+1],Z=this.circles[3*k+2];E.push({key:this.circleKeys[k],x1:R-Z,y1:O-Z,x2:R+Z,y2:O+Z})}}else this._forEachCell(e,a,h,f,this._queryCell,E,{hitTest:y,overlapMode:T,seenUids:{box:{},circle:{}}},P);return E}query(e,a,h,f){return this._query(e,a,h,f,!1,null)}hitTest(e,a,h,f,y,T){return this._query(e,a,h,f,!0,y,T).length>0}hitTestCircle(e,a,h,f,y){const T=e-h,P=e+h,E=a-h,k=a+h;if(P<0||T>this.width||k<0||E>this.height)return!1;const R=[];return this._forEachCell(T,E,P,k,this._queryCellCircle,R,{hitTest:!0,overlapMode:f,circle:{x:e,y:a,radius:h},seenUids:{box:{},circle:{}}},y),R.length>0}_queryCell(e,a,h,f,y,T,P,E){const{seenUids:k,hitTest:R,overlapMode:O}=P,Z=this.boxCells[y];if(Z!==null){const Q=this.bboxes;for(const it of Z)if(!k.box[it]){k.box[it]=!0;const Y=4*it,ft=this.boxKeys[it];if(e<=Q[Y+2]&&a<=Q[Y+3]&&h>=Q[Y+0]&&f>=Q[Y+1]&&(!E||E(ft))&&(!R||!ji(O,ft.overlapMode))&&(T.push({key:ft,x1:Q[Y],y1:Q[Y+1],x2:Q[Y+2],y2:Q[Y+3]}),R))return!0}}const tt=this.circleCells[y];if(tt!==null){const Q=this.circles;for(const it of tt)if(!k.circle[it]){k.circle[it]=!0;const Y=3*it,ft=this.circleKeys[it];if(this._circleAndRectCollide(Q[Y],Q[Y+1],Q[Y+2],e,a,h,f)&&(!E||E(ft))&&(!R||!ji(O,ft.overlapMode))){const St=Q[Y],st=Q[Y+1],gt=Q[Y+2];if(T.push({key:ft,x1:St-gt,y1:st-gt,x2:St+gt,y2:st+gt}),R)return!0}}}return!1}_queryCellCircle(e,a,h,f,y,T,P,E){const{circle:k,seenUids:R,overlapMode:O}=P,Z=this.boxCells[y];if(Z!==null){const Q=this.bboxes;for(const it of Z)if(!R.box[it]){R.box[it]=!0;const Y=4*it,ft=this.boxKeys[it];if(this._circleAndRectCollide(k.x,k.y,k.radius,Q[Y+0],Q[Y+1],Q[Y+2],Q[Y+3])&&(!E||E(ft))&&!ji(O,ft.overlapMode))return T.push(!0),!0}}const tt=this.circleCells[y];if(tt!==null){const Q=this.circles;for(const it of tt)if(!R.circle[it]){R.circle[it]=!0;const Y=3*it,ft=this.circleKeys[it];if(this._circlesCollide(Q[Y],Q[Y+1],Q[Y+2],k.x,k.y,k.radius)&&(!E||E(ft))&&!ji(O,ft.overlapMode))return T.push(!0),!0}}}_forEachCell(e,a,h,f,y,T,P,E){const k=this._convertToXCellCoord(e),R=this._convertToYCellCoord(a),O=this._convertToXCellCoord(h),Z=this._convertToYCellCoord(f);for(let tt=k;tt<=O;tt++)for(let Q=R;Q<=Z;Q++)if(y.call(this,e,a,h,f,this.xCellCount*Q+tt,T,P,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,h,f,y,T){const P=f-e,E=y-a,k=h+T;return k*k>P*P+E*E}_circleAndRectCollide(e,a,h,f,y,T,P){const E=(T-f)/2,k=Math.abs(e-(f+E));if(k>E+h)return!1;const R=(P-y)/2,O=Math.abs(a-(y+R));if(O>R+h)return!1;if(k<=E||O<=R)return!0;const Z=k-E,tt=O-R;return Z*Z+tt*tt<=h*h}}function Wt(_,e,a,h,f){const y=c.Z();return e?(c.a0(y,y,[1/f,1/f,1]),a||c.ae(y,y,h.angle)):c.a1(y,h.labelPlaneMatrix,_),y}function Xn(_,e,a,h,f){if(e){const y=c.af(_);return c.a0(y,y,[f,f,1]),a||c.ae(y,y,-h.angle),y}return h.glCoordMatrix}function zi(_,e,a){let h;a?(h=[_.x,_.y,a(_.x,_.y),1],c.ag(h,h,e)):(h=[_.x,_.y,0,1],nt(h,h,e));const f=h[3];return{point:new c.P(h[0]/f,h[1]/f),signedDistanceFromCamera:f}}function kr(_,e){return .5+_/e*.5}function cn(_,e){const a=_[0]/_[3],h=_[1]/_[3];return a>=-e[0]&&a<=e[0]&&h>=-e[1]&&h<=e[1]}function jt(_,e,a,h,f,y,T,P,E,k){const R=h?_.textSizeData:_.iconSizeData,O=c.ah(R,a.transform.zoom),Z=[256/a.width*2+1,256/a.height*2+1],tt=h?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;tt.clear();const Q=_.lineVertexArray,it=h?_.text.placedSymbolArray:_.icon.placedSymbolArray,Y=a.transform.width/a.transform.height;let ft=!1;for(let St=0;St<it.length;St++){const st=it.get(St);if(st.hidden||st.writingMode===c.ai.vertical&&!ft){X(st.numGlyphs,tt);continue}let gt;if(ft=!1,k?(gt=[st.anchorX,st.anchorY,k(st.anchorX,st.anchorY),1],c.ag(gt,gt,e)):(gt=[st.anchorX,st.anchorY,0,1],nt(gt,gt,e)),!cn(gt,Z)){X(st.numGlyphs,tt);continue}const It=kr(a.transform.cameraToCenterDistance,gt[3]),Ct=c.aj(R,O,st),kt=T?Ct/It:Ct*It,Gt=new c.P(st.anchorX,st.anchorY),Ot=zi(Gt,f,k).point,Xt={projections:{},offsets:{}},Se=Nn(st,kt,!1,P,e,f,y,_.glyphOffsetArray,Q,tt,Ot,Gt,Xt,Y,E,k);ft=Se.useVertical,(Se.notEnoughRoom||ft||Se.needsFlipping&&Nn(st,kt,!0,P,e,f,y,_.glyphOffsetArray,Q,tt,Ot,Gt,Xt,Y,E,k).notEnoughRoom)&&X(st.numGlyphs,tt)}h?_.text.dynamicLayoutVertexBuffer.updateData(tt):_.icon.dynamicLayoutVertexBuffer.updateData(tt)}function Ye(_,e,a,h,f,y,T,P,E,k,R,O,Z){const tt=P.glyphStartIndex+P.numGlyphs,Q=P.lineStartIndex,it=P.lineStartIndex+P.lineLength,Y=e.getoffsetX(P.glyphStartIndex),ft=e.getoffsetX(tt-1),St=U(_*Y,a,h,f,y,T,P.segment,Q,it,E,k,R,O,Z);if(!St)return null;const st=U(_*ft,a,h,f,y,T,P.segment,Q,it,E,k,R,O,Z);return st?{first:St,last:st}:null}function We(_,e,a,h){return _===c.ai.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*h?{useVertical:!0}:(_===c.ai.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function Nn(_,e,a,h,f,y,T,P,E,k,R,O,Z,tt,Q,it){const Y=e/24,ft=_.lineOffsetX*Y,St=_.lineOffsetY*Y;let st;if(_.numGlyphs>1){const gt=_.glyphStartIndex+_.numGlyphs,It=_.lineStartIndex,Ct=_.lineStartIndex+_.lineLength,kt=Ye(Y,P,ft,St,a,R,O,_,E,y,Z,Q,it);if(!kt)return{notEnoughRoom:!0};const Gt=zi(kt.first.point,T,it).point,Ot=zi(kt.last.point,T,it).point;if(h&&!a){const Xt=We(_.writingMode,Gt,Ot,tt);if(Xt)return Xt}st=[kt.first];for(let Xt=_.glyphStartIndex+1;Xt<gt-1;Xt++)st.push(U(Y*P.getoffsetX(Xt),ft,St,a,R,O,_.segment,It,Ct,E,y,Z,Q,it));st.push(kt.last)}else{if(h&&!a){const It=zi(O,f,it).point,Ct=_.lineStartIndex+_.segment+1,kt=new c.P(E.getx(Ct),E.gety(Ct)),Gt=zi(kt,f,it),Ot=Gt.signedDistanceFromCamera>0?Gt.point:zr(O,kt,It,1,f,it),Xt=We(_.writingMode,It,Ot,tt);if(Xt)return Xt}const gt=U(Y*P.getoffsetX(_.glyphStartIndex),ft,St,a,R,O,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,E,y,Z,Q,it);if(!gt)return{notEnoughRoom:!0};st=[gt]}for(const gt of st)c.ak(k,gt.point,gt.angle);return{}}function zr(_,e,a,h,f,y){const T=zi(_.add(_.sub(e)._unit()),f,y).point,P=a.sub(T);return a.add(P._mult(h/P.mag()))}function Je(_,e){const{projectionCache:a,lineVertexArray:h,labelPlaneMatrix:f,tileAnchorPoint:y,distanceFromAnchor:T,getElevation:P,previousVertex:E,direction:k,absOffsetX:R}=e;if(a.projections[_])return a.projections[_];const O=new c.P(h.getx(_),h.gety(_)),Z=zi(O,f,P);if(Z.signedDistanceFromCamera>0)return a.projections[_]=Z.point,Z.point;const tt=_-k;return zr(T===0?y:new c.P(h.getx(tt),h.gety(tt)),O,E,R-T+1,f,P)}function lo(_,e,a){return _._unit()._perp()._mult(e*a)}function et(_,e,a,h,f,y,T,P){const{projectionCache:E,direction:k}=P;if(E.offsets[_])return E.offsets[_];const R=a.add(e);if(_+k<h||_+k>=f)return E.offsets[_]=R,R;const O=Je(_+k,P),Z=lo(O.sub(a),T,k),tt=a.add(Z),Q=O.add(Z);return E.offsets[_]=c.al(y,R,tt,Q)||R,E.offsets[_]}function U(_,e,a,h,f,y,T,P,E,k,R,O,Z,tt){const Q=h?_-e:_+e;let it=Q>0?1:-1,Y=0;h&&(it*=-1,Y=Math.PI),it<0&&(Y+=Math.PI);let ft,St,st=it>0?P+T:P+T+1,gt=f,It=f,Ct=0,kt=0;const Gt=Math.abs(Q),Ot=[];let Xt;for(;Ct+kt<=Gt;){if(st+=it,st<P||st>=E)return null;Ct+=kt,It=gt,St=ft;const se={projectionCache:O,lineVertexArray:k,labelPlaneMatrix:R,tileAnchorPoint:y,distanceFromAnchor:Ct,getElevation:tt,previousVertex:It,direction:it,absOffsetX:Gt};if(gt=Je(st,se),a===0)Ot.push(It),Xt=gt.sub(It);else{let Ne;const Ie=gt.sub(It);Ne=Ie.mag()===0?lo(Je(st+it,se).sub(gt),a,it):lo(Ie,a,it),St||(St=It.add(Ne)),ft=et(st,Ne,gt,P,E,St,a,se),Ot.push(St),Xt=ft.sub(St)}kt=Xt.mag()}const Se=Xt._mult((Gt-Ct)/kt)._add(St||It),vi=Y+Math.atan2(gt.y-It.y,gt.x-It.x);return Ot.push(Se),{point:Se,angle:Z?vi:0,path:Ot}}const $=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function X(_,e){for(let a=0;a<_;a++){const h=e.length;e.resize(h+4),e.float32.set($,3*h)}}function nt(_,e,a){const h=e[0],f=e[1];return _[0]=a[0]*h+a[4]*f+a[12],_[1]=a[1]*h+a[5]*f+a[13],_[3]=a[3]*h+a[7]*f+a[15],_}const rt=100;class vt{constructor(e,a=new gn(e.width+200,e.height+200,25),h=new gn(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=h,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+rt,this.screenBottomBoundary=e.height+rt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,h,f,y,T){const P=this.projectAndGetPerspectiveRatio(f,e.anchorPointX,e.anchorPointY,T),E=h*P.perspectiveRatio,k=e.x1*E+P.point.x,R=e.y1*E+P.point.y,O=e.x2*E+P.point.x,Z=e.y2*E+P.point.y;return!this.isInsideGrid(k,R,O,Z)||a!=="always"&&this.grid.hitTest(k,R,O,Z,a,y)||P.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,R,O,Z],offscreen:this.isOffscreen(k,R,O,Z)}}placeCollisionCircles(e,a,h,f,y,T,P,E,k,R,O,Z,tt,Q){const it=[],Y=new c.P(a.anchorX,a.anchorY),ft=zi(Y,T,Q),St=kr(this.transform.cameraToCenterDistance,ft.signedDistanceFromCamera),st=(R?y/St:y*St)/c.ap,gt=zi(Y,P,Q).point,It=Ye(st,f,a.lineOffsetX*st,a.lineOffsetY*st,!1,gt,Y,a,h,P,{projections:{},offsets:{}},!1,Q);let Ct=!1,kt=!1,Gt=!0;if(It){const Ot=.5*Z*St+tt,Xt=new c.P(-100,-100),Se=new c.P(this.screenRightBoundary,this.screenBottomBoundary),vi=new Ti,se=It.first,Ne=It.last;let Ie=[];for(let oi=se.path.length-1;oi>=1;oi--)Ie.push(se.path[oi]);for(let oi=1;oi<Ne.path.length;oi++)Ie.push(Ne.path[oi]);const qi=2.5*Ot;if(E){const oi=Ie.map(xi=>zi(xi,E,Q));Ie=oi.some(xi=>xi.signedDistanceFromCamera<=0)?[]:oi.map(xi=>xi.point)}let gi=[];if(Ie.length>0){const oi=Ie[0].clone(),xi=Ie[0].clone();for(let yn=1;yn<Ie.length;yn++)oi.x=Math.min(oi.x,Ie[yn].x),oi.y=Math.min(oi.y,Ie[yn].y),xi.x=Math.max(xi.x,Ie[yn].x),xi.y=Math.max(xi.y,Ie[yn].y);gi=oi.x>=Xt.x&&xi.x<=Se.x&&oi.y>=Xt.y&&xi.y<=Se.y?[Ie]:xi.x<Xt.x||oi.x>Se.x||xi.y<Xt.y||oi.y>Se.y?[]:c.am([Ie],Xt.x,Xt.y,Se.x,Se.y)}for(const oi of gi){vi.reset(oi,.25*Ot);let xi=0;xi=vi.length<=.5*Ot?1:Math.ceil(vi.paddedLength/qi)+1;for(let yn=0;yn<xi;yn++){const rn=yn/Math.max(xi-1,1),qn=vi.lerp(rn),Mn=qn.x+rt,wn=qn.y+rt;it.push(Mn,wn,Ot,0);const Fr=Mn-Ot,sn=wn-Ot,No=Mn+Ot,Uo=wn+Ot;if(Gt=Gt&&this.isOffscreen(Fr,sn,No,Uo),kt=kt||this.isInsideGrid(Fr,sn,No,Uo),e!=="always"&&this.grid.hitTestCircle(Mn,wn,Ot,e,O)&&(Ct=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ct}}}}return{circles:!k&&Ct||!kt||St<this.perspectiveRatioCutoff?[]:it,offscreen:Gt,collisionDetected:Ct}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let h=1/0,f=1/0,y=-1/0,T=-1/0;for(const R of e){const O=new c.P(R.x+rt,R.y+rt);h=Math.min(h,O.x),f=Math.min(f,O.y),y=Math.max(y,O.x),T=Math.max(T,O.y),a.push(O)}const P=this.grid.query(h,f,y,T).concat(this.ignoredGrid.query(h,f,y,T)),E={},k={};for(const R of P){const O=R.key;if(E[O.bucketInstanceId]===void 0&&(E[O.bucketInstanceId]={}),E[O.bucketInstanceId][O.featureIndex])continue;const Z=[new c.P(R.x1,R.y1),new c.P(R.x2,R.y1),new c.P(R.x2,R.y2),new c.P(R.x1,R.y2)];c.an(a,Z)&&(E[O.bucketInstanceId][O.featureIndex]=!0,k[O.bucketInstanceId]===void 0&&(k[O.bucketInstanceId]=[]),k[O.bucketInstanceId].push(O.featureIndex))}return k}insertCollisionBox(e,a,h,f,y,T){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:T,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,h,f,y,T){const P=h?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:y,collisionGroupID:T,overlapMode:a};for(let k=0;k<e.length;k+=4)P.insertCircle(E,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,a,h,f){let y;return f?(y=[a,h,f(a,h),1],c.ag(y,y,e)):(y=[a,h,0,1],nt(y,y,e)),{point:new c.P((y[0]/y[3]+1)/2*this.transform.width+rt,(-y[1]/y[3]+1)/2*this.transform.height+rt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(e,a,h,f){return h<rt||e>=this.screenRightBoundary||f<rt||a>this.screenBottomBoundary}isInsideGrid(e,a,h,f){return h>=0&&e<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=c.ao([]);return c.$(e,e,[-100,-100,0]),e}}function pt(_,e,a){return e*(c.N/(_.tileSize*Math.pow(2,a-_.tileID.overscaledZ)))}class lt{constructor(e,a,h,f){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):f&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class _t{constructor(e,a,h,f,y){this.text=new lt(e?e.text:null,a,h,y),this.icon=new lt(e?e.icon:null,a,f,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Lt{constructor(e,a,h){this.text=e,this.icon=a,this.skipFade=h}}class wt{constructor(){this.invProjMatrix=c.Z(),this.viewportMatrix=c.Z(),this.circles=[]}}class Rt{constructor(e,a,h,f,y){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=f,this.tileID=y}}class Re{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[e]}}function Ve(_,e,a,h,f){const{horizontalAlign:y,verticalAlign:T}=c.au(_);return new c.P(-(y-.5)*e+h[0]*f,-(T-.5)*a+h[1]*f)}function ve(_,e,a,h,f,y){const{x1:T,x2:P,y1:E,y2:k,anchorPointX:R,anchorPointY:O}=_,Z=new c.P(e,a);return h&&Z._rotate(f?y:-y),{x1:T+Z.x,y1:E+Z.y,x2:P+Z.x,y2:k+Z.y,anchorPointX:R,anchorPointY:O}}class De{constructor(e,a,h,f,y){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new vt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Re(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,a,h,f){const y=h.getBucket(a),T=h.latestFeatureIndex;if(!y||!T||a.id!==y.layerIds[0])return;const P=h.collisionBoxArray,E=y.layers[0].layout,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),R=h.tileSize/c.N,O=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),Z=E.get("text-pitch-alignment")==="map",tt=E.get("text-rotation-alignment")==="map",Q=pt(h,1,this.transform.zoom),it=Wt(O,Z,tt,this.transform,Q);let Y=null;if(Z){const St=Xn(O,Z,tt,this.transform,Q);Y=c.a1([],this.transform.labelPlaneMatrix,St)}this.retainedQueryData[y.bucketInstanceId]=new Rt(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,h.tileID);const ft={bucket:y,layout:E,posMatrix:O,textLabelPlaneMatrix:it,labelToScreenMatrix:Y,scale:k,textPixelRatio:R,holdingForFade:h.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:c.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(f)for(const St of y.sortKeyRanges){const{sortKey:st,symbolInstanceStart:gt,symbolInstanceEnd:It}=St;e.push({sortKey:st,symbolInstanceStart:gt,symbolInstanceEnd:It,parameters:ft})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ft})}attemptAnchorPlacement(e,a,h,f,y,T,P,E,k,R,O,Z,tt,Q,it,Y){const ft=c.aq[e.textAnchor],St=[e.textOffset0,e.textOffset1],st=Ve(ft,h,f,St,y),gt=this.collisionIndex.placeCollisionBox(ve(a,st.x,st.y,T,P,this.transform.angle),O,E,k,R.predicate,Y);if((!it||this.collisionIndex.placeCollisionBox(ve(it,st.x,st.y,T,P,this.transform.angle),O,E,k,R.predicate,Y).box.length!==0)&&gt.box.length>0){let It;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(It=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:St,width:h,height:f,anchor:ft,textBoxScale:y,prevAnchor:It},this.markUsedJustification(tt,ft,Z,Q),tt.allowVerticalPlacement&&(this.markUsedOrientation(tt,Q,Z),this.placedOrientations[Z.crossTileID]=Q),{shift:st,placedGlyphBoxes:gt}}}placeLayerBucketPart(e,a,h){const{bucket:f,layout:y,posMatrix:T,textLabelPlaneMatrix:P,labelToScreenMatrix:E,textPixelRatio:k,holdingForFade:R,collisionBoxArray:O,partiallyEvaluatedTextSize:Z,collisionGroup:tt}=e.parameters,Q=y.get("text-optional"),it=y.get("icon-optional"),Y=c.ar(y,"text-overlap","text-allow-overlap"),ft=Y==="always",St=c.ar(y,"icon-overlap","icon-allow-overlap"),st=St==="always",gt=y.get("text-rotation-alignment")==="map",It=y.get("text-pitch-alignment")==="map",Ct=y.get("icon-text-fit")!=="none",kt=y.get("symbol-z-order")==="viewport-y",Gt=ft&&(st||!f.hasIconData()||it),Ot=st&&(ft||!f.hasTextData()||Q);!f.collisionArrays&&O&&f.deserializeCollisionBoxes(O);const Xt=this.retainedQueryData[f.bucketInstanceId].tileID,Se=this.terrain?(se,Ne)=>this.terrain.getElevation(Xt,se,Ne):null,vi=(se,Ne)=>{var Ie,qi;if(a[se.crossTileID])return;if(R)return void(this.placements[se.crossTileID]=new Lt(!1,!1,!1));let gi=!1,oi=!1,xi=!0,yn=null,rn={box:null,offscreen:null},qn={box:null,offscreen:null},Mn=null,wn=null,Fr=null,sn=0,No=0,Uo=0;Ne.textFeatureIndex?sn=Ne.textFeatureIndex:se.useRuntimeCollisionCircles&&(sn=se.featureIndex),Ne.verticalTextFeatureIndex&&(No=Ne.verticalTextFeatureIndex);const js=Ne.textBox;if(js){const nr=vn=>{let kn=c.ai.horizontal;if(f.allowVerticalPlacement&&!vn&&this.prevPlacement){const Tr=this.prevPlacement.placedOrientations[se.crossTileID];Tr&&(this.placedOrientations[se.crossTileID]=Tr,kn=Tr,this.markUsedOrientation(f,kn,se))}return kn},Hn=(vn,kn)=>{if(f.allowVerticalPlacement&&se.numVerticalGlyphVertices>0&&Ne.verticalTextBox){for(const Tr of f.writingModes)if(Tr===c.ai.vertical?(rn=kn(),qn=rn):rn=vn(),rn&&rn.box&&rn.box.length)break}else rn=vn()},dr=se.textAnchorOffsetStartIndex,Ta=se.textAnchorOffsetEndIndex;if(Ta===dr){const vn=(kn,Tr)=>{const xn=this.collisionIndex.placeCollisionBox(kn,Y,k,T,tt.predicate,Se);return xn&&xn.box&&xn.box.length&&(this.markUsedOrientation(f,Tr,se),this.placedOrientations[se.crossTileID]=Tr),xn};Hn(()=>vn(js,c.ai.horizontal),()=>{const kn=Ne.verticalTextBox;return f.allowVerticalPlacement&&se.numVerticalGlyphVertices>0&&kn?vn(kn,c.ai.vertical):{box:null,offscreen:null}}),nr(rn&&rn.box&&rn.box.length)}else{let vn=c.aq[(qi=(Ie=this.prevPlacement)===null||Ie===void 0?void 0:Ie.variableOffsets[se.crossTileID])===null||qi===void 0?void 0:qi.anchor];const kn=(xn,Sa,Pc)=>{const dh=xn.x2-xn.x1,ph=xn.y2-xn.y1,Gd=se.textBoxScale,mu=Ct&&St==="never"?Sa:null;let Vo={box:[],offscreen:!1},Pa=Y==="never"?1:2,$o="never";vn&&Pa++;for(let eo=0;eo<Pa;eo++){for(let Zo=dr;Zo<Ta;Zo++){const _u=f.textAnchorOffsets.get(Zo);if(vn&&_u.textAnchor!==vn)continue;const gs=this.attemptAnchorPlacement(_u,xn,dh,ph,Gd,gt,It,k,T,tt,$o,se,f,Pc,mu,Se);if(gs&&(Vo=gs.placedGlyphBoxes,Vo&&Vo.box&&Vo.box.length))return gi=!0,yn=gs.shift,Vo}vn?vn=null:$o=Y}return Vo};Hn(()=>kn(js,Ne.iconBox,c.ai.horizontal),()=>{const xn=Ne.verticalTextBox;return f.allowVerticalPlacement&&!(rn&&rn.box&&rn.box.length)&&se.numVerticalGlyphVertices>0&&xn?kn(xn,Ne.verticalIconBox,c.ai.vertical):{box:null,offscreen:null}}),rn&&(gi=rn.box,xi=rn.offscreen);const Tr=nr(rn&&rn.box);if(!gi&&this.prevPlacement){const xn=this.prevPlacement.variableOffsets[se.crossTileID];xn&&(this.variableOffsets[se.crossTileID]=xn,this.markUsedJustification(f,xn.anchor,se,Tr))}}}if(Mn=rn,gi=Mn&&Mn.box&&Mn.box.length>0,xi=Mn&&Mn.offscreen,se.useRuntimeCollisionCircles){const nr=f.text.placedSymbolArray.get(se.centerJustifiedTextSymbolIndex),Hn=c.aj(f.textSizeData,Z,nr),dr=y.get("text-padding");wn=this.collisionIndex.placeCollisionCircles(Y,nr,f.lineVertexArray,f.glyphOffsetArray,Hn,T,P,E,h,It,tt.predicate,se.collisionCircleDiameter,dr,Se),wn.circles.length&&wn.collisionDetected&&!h&&c.w("Collisions detected, but collision boxes are not shown"),gi=ft||wn.circles.length>0&&!wn.collisionDetected,xi=xi&&wn.offscreen}if(Ne.iconFeatureIndex&&(Uo=Ne.iconFeatureIndex),Ne.iconBox){const nr=Hn=>{const dr=Ct&&yn?ve(Hn,yn.x,yn.y,gt,It,this.transform.angle):Hn;return this.collisionIndex.placeCollisionBox(dr,St,k,T,tt.predicate,Se)};qn&&qn.box&&qn.box.length&&Ne.verticalIconBox?(Fr=nr(Ne.verticalIconBox),oi=Fr.box.length>0):(Fr=nr(Ne.iconBox),oi=Fr.box.length>0),xi=xi&&Fr.offscreen}const wa=Q||se.numHorizontalGlyphVertices===0&&se.numVerticalGlyphVertices===0,ll=it||se.numIconVertices===0;if(wa||ll?ll?wa||(oi=oi&&gi):gi=oi&&gi:oi=gi=oi&&gi,gi&&Mn&&Mn.box&&this.collisionIndex.insertCollisionBox(Mn.box,Y,y.get("text-ignore-placement"),f.bucketInstanceId,qn&&qn.box&&No?No:sn,tt.ID),oi&&Fr&&this.collisionIndex.insertCollisionBox(Fr.box,St,y.get("icon-ignore-placement"),f.bucketInstanceId,Uo,tt.ID),wn&&(gi&&this.collisionIndex.insertCollisionCircles(wn.circles,Y,y.get("text-ignore-placement"),f.bucketInstanceId,sn,tt.ID),h)){const nr=f.bucketInstanceId;let Hn=this.collisionCircleArrays[nr];Hn===void 0&&(Hn=this.collisionCircleArrays[nr]=new wt);for(let dr=0;dr<wn.circles.length;dr+=4)Hn.circles.push(wn.circles[dr+0]),Hn.circles.push(wn.circles[dr+1]),Hn.circles.push(wn.circles[dr+2]),Hn.circles.push(wn.collisionDetected?1:0)}if(se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[se.crossTileID]=new Lt(gi||Gt,oi||Ot,xi||f.justReloaded),a[se.crossTileID]=!0};if(kt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const se=f.getSortedSymbolIndexes(this.transform.angle);for(let Ne=se.length-1;Ne>=0;--Ne){const Ie=se[Ne];vi(f.symbolInstances.get(Ie),f.collisionArrays[Ie])}}else for(let se=e.symbolInstanceStart;se<e.symbolInstanceEnd;se++)vi(f.symbolInstances.get(se),f.collisionArrays[se]);if(h&&f.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[f.bucketInstanceId];c.as(se.invProjMatrix,T),se.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(e,a,h,f){let y;y=f===c.ai.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[c.at(a)];const T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const P of T)P>=0&&(e.text.placedSymbolArray.get(P).crossTileID=y>=0&&P!==y?0:h.crossTileID)}markUsedOrientation(e,a,h){const f=a===c.ai.horizontal||a===c.ai.horizontalOnly?a:0,y=a===c.ai.vertical?a:0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const P of T)e.text.placedSymbolArray.get(P).placedOrientation=f;h.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(e):1,y=a?a.opacities:{},T=a?a.variableOffsets:{},P=a?a.placedOrientations:{};for(const E in this.placements){const k=this.placements[E],R=y[E];R?(this.opacities[E]=new _t(R,f,k.text,k.icon),h=h||k.text!==R.text.placed||k.icon!==R.icon.placed):(this.opacities[E]=new _t(null,f,k.text,k.icon,k.skipFade),h=h||k.text||k.icon)}for(const E in y){const k=y[E];if(!this.opacities[E]){const R=new _t(k,f,!1,!1);R.isHidden()||(this.opacities[E]=R,h=h||k.text.placed||k.icon.placed)}}for(const E in T)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=T[E]);for(const E in P)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=P[E]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const h={};for(const f of a){const y=f.getBucket(e);y&&f.latestFeatureIndex&&e.id===y.layerIds[0]&&this.updateBucketOpacities(y,h,f.collisionBoxArray)}}updateBucketOpacities(e,a,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],y=f.layout,T=new _t(null,0,!1,!1,!0),P=y.get("text-allow-overlap"),E=y.get("icon-allow-overlap"),k=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=y.get("text-rotation-alignment")==="map",O=y.get("text-pitch-alignment")==="map",Z=y.get("icon-text-fit")!=="none",tt=new _t(null,0,P&&(E||!e.hasIconData()||y.get("icon-optional")),E&&(P||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const Q=(it,Y,ft)=>{for(let St=0;St<Y/4;St++)it.opacityVertexArray.emplaceBack(ft);it.hasVisibleVertices=it.hasVisibleVertices||ft!==$n};for(let it=0;it<e.symbolInstances.length;it++){const Y=e.symbolInstances.get(it),{numHorizontalGlyphVertices:ft,numVerticalGlyphVertices:St,crossTileID:st}=Y;let gt=this.opacities[st];a[st]?gt=T:gt||(gt=tt,this.opacities[st]=gt),a[st]=!0;const It=Y.numIconVertices>0,Ct=this.placedOrientations[Y.crossTileID],kt=Ct===c.ai.vertical,Gt=Ct===c.ai.horizontal||Ct===c.ai.horizontalOnly;if(ft>0||St>0){const Ot=En(gt.text);Q(e.text,ft,kt?$n:Ot),Q(e.text,St,Gt?$n:Ot);const Xt=gt.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(se=>{se>=0&&(e.text.placedSymbolArray.get(se).hidden=Xt||kt?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=Xt||Gt?1:0);const Se=this.variableOffsets[Y.crossTileID];Se&&this.markUsedJustification(e,Se.anchor,Y,Ct);const vi=this.placedOrientations[Y.crossTileID];vi&&(this.markUsedJustification(e,"left",Y,vi),this.markUsedOrientation(e,vi,Y))}if(It){const Ot=En(gt.icon),Xt=!(Z&&Y.verticalPlacedIconSymbolIndex&&kt);Y.placedIconSymbolIndex>=0&&(Q(e.icon,Y.numIconVertices,Xt?Ot:$n),e.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=gt.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(Q(e.icon,Y.numVerticalIconVertices,Xt?$n:Ot),e.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=gt.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ot=e.collisionArrays[it];if(Ot){let Xt=new c.P(0,0);if(Ot.textBox||Ot.verticalTextBox){let vi=!0;if(k){const se=this.variableOffsets[st];se?(Xt=Ve(se.anchor,se.width,se.height,se.textOffset,se.textBoxScale),R&&Xt._rotate(O?this.transform.angle:-this.transform.angle)):vi=!1}Ot.textBox&&qe(e.textCollisionBox.collisionVertexArray,gt.text.placed,!vi||kt,Xt.x,Xt.y),Ot.verticalTextBox&&qe(e.textCollisionBox.collisionVertexArray,gt.text.placed,!vi||Gt,Xt.x,Xt.y)}const Se=!!(!Gt&&Ot.verticalIconBox);Ot.iconBox&&qe(e.iconCollisionBox.collisionVertexArray,gt.icon.placed,Se,Z?Xt.x:0,Z?Xt.y:0),Ot.verticalIconBox&&qe(e.iconCollisionBox.collisionVertexArray,gt.icon.placed,!Se,Z?Xt.x:0,Z?Xt.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=it.invProjMatrix,e.placementViewportMatrix=it.viewportMatrix,e.collisionCircleArray=it.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>e}setStale(){this.stale=!0}}function qe(_,e,a,h,f){_.emplaceBack(e?1:0,a?1:0,h||0,f||0),_.emplaceBack(e?1:0,a?1:0,h||0,f||0),_.emplaceBack(e?1:0,a?1:0,h||0,f||0),_.emplaceBack(e?1:0,a?1:0,h||0,f||0)}const Si=Math.pow(2,25),Fi=Math.pow(2,24),Ci=Math.pow(2,17),Pi=Math.pow(2,16),Un=Math.pow(2,9),Hi=Math.pow(2,8),fn=Math.pow(2,1);function En(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const e=_.placed?1:0,a=Math.floor(127*_.opacity);return a*Si+e*Fi+a*Ci+e*Pi+a*Un+e*Hi+a*fn+e}const $n=0;class pc{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,h,f,y){const T=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(T,f,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((P,E)=>P.sortKey-E.sortKey));this._currentPartIndex<T.length;)if(a.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,y())return!0;return!1}}class Cs{constructor(e,a,h,f,y,T,P,E){this.placement=new De(e,a,T,P,E),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,a,h){const f=c.h.now(),y=()=>!this._forceFullPlacement&&c.h.now()-f>2;for(;this._currentPlacementIndex>=0;){const T=a[e[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=P)&&(!T.maxzoom||T.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new pc(T)),this._inProgressLayer.continuePlacement(h[T.source],this.placement,this._showCollisionBoxes,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Es=512/c.N/2;class nu{constructor(e,a,h){this.tileID=e,this.bucketInstanceId=h,this._symbolsByKey={};const f=new Map;for(let y=0;y<a.length;y++){const T=a.get(y),P=T.key,E=f.get(P);E?E.push(T):f.set(P,[T])}for(const[y,T]of f){const P={positions:T.map(E=>({x:Math.floor(E.anchorX*Es),y:Math.floor(E.anchorY*Es)})),crossTileIDs:T.map(E=>E.crossTileID)};if(P.positions.length>128){const E=new c.av(P.positions.length,16,Uint16Array);for(const{x:k,y:R}of P.positions)E.add(k,R);E.finish(),delete P.positions,P.index=E}this._symbolsByKey[y]=P}}getScaledCoordinates(e,a){const{x:h,y:f,z:y}=this.tileID.canonical,{x:T,y:P,z:E}=a.canonical,k=Es/Math.pow(2,E-y),R=(P*c.N+e.anchorY)*k,O=f*c.N*Es;return{x:Math.floor((T*c.N+e.anchorX)*k-h*c.N*Es),y:Math.floor(R-O)}}findMatches(e,a,h){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let y=0;y<e.length;y++){const T=e.get(y);if(T.crossTileID)continue;const P=this._symbolsByKey[T.key];if(!P)continue;const E=this.getScaledCoordinates(T,a);if(P.index){const k=P.index.range(E.x-f,E.y-f,E.x+f,E.y+f).sort();for(const R of k){const O=P.crossTileIDs[R];if(!h[O]){h[O]=!0,T.crossTileID=O;break}}}else if(P.positions)for(let k=0;k<P.positions.length;k++){const R=P.positions[k],O=P.crossTileIDs[k];if(Math.abs(R.x-E.x)<=f&&Math.abs(R.y-E.y)<=f&&!h[O]){h[O]=!0,T.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ni{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const h in this.indexes){const f=this.indexes[h],y={};for(const T in f){const P=f[T];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+a),y[P.tileID.key]=P}this.indexes[h]=y}this.lng=e}addBucket(e,a,h){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const f=this.usedCrossTileIDs[e.overscaledZ];for(const y in this.indexes){const T=this.indexes[y];if(Number(y)>e.overscaledZ)for(const P in T){const E=T[P];E.tileID.isChildOf(e)&&E.findMatches(a.symbolInstances,e,f)}else{const P=T[e.scaledTo(Number(y)).key];P&&P.findMatches(a.symbolInstances,e,f)}}for(let y=0;y<a.symbolInstances.length;y++){const T=a.symbolInstances.get(y);T.crossTileID||(T.crossTileID=h.generate(),f[T.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new nu(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const h of a.getCrossTileIDsLists())for(const f of h)delete this.usedCrossTileIDs[e][f]}removeStaleBuckets(e){let a=!1;for(const h in this.indexes){const f=this.indexes[h];for(const y in f)e[f[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,f[y]),delete f[y],a=!0)}return a}}class Eo{constructor(){this.layerIndexes={},this.crossTileIDs=new Ni,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,h){let f=this.layerIndexes[e.id];f===void 0&&(f=this.layerIndexes[e.id]=new oa);let y=!1;const T={};f.handleWrapJump(h);for(const P of a){const E=P.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(P.tileID,E,this.crossTileIDs)&&(y=!0),T[E.bucketInstanceId]=!0)}return f.removeStaleBuckets(T)&&(y=!0),y}pruneUnusedLayers(e){const a={};e.forEach(h=>{a[h]=!0});for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}const Ln=(_,e)=>c.x(_,e&&e.filter(a=>a.identifier!=="source.canvas")),Yn=c.F(c.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),sa=c.F(c.ax,["setCenter","setZoom","setBearing","setPitch"]),ii=c.aw();class mi extends c.E{constructor(e,a={}){super(),this.map=e,this.dispatcher=new Ue(ki(),this,e._getMapId()),this.imageManager=new fe,this.imageManager.setEventedParent(this),this.glyphManager=new we(e._requestManager,a.localIdeographFontFamily),this.lineAtlas=new ze(256,512),this.crossTileSymbolIndex=new Eo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.az());const h=this;this._rtlTextPluginCallback=mi.registerForPluginStateChange(f=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(y,T)=>{if(c.aA(y),T&&T.every(P=>P))for(const P in h.sourceCaches){const E=h.sourceCaches[P].getSource().type;E!=="vector"&&E!=="geojson"||h.sourceCaches[P].reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const y=this.sourceCaches[f.sourceId];if(!y)return;const T=y.getSource();if(T&&T.vectorLayerIds)for(const P in this._layers){const E=this._layers[P];E.source===T.id&&this._validateLayer(E)}})}loadURL(e,a={},h){this.fire(new c.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(e,Jt.Style);this._request=c.f(f,(y,T)=>{this._request=null,y?this.fire(new c.j(y)):T&&this._load(T,a,h)})}loadJSON(e,a={},h){this.fire(new c.k("dataloading",{dataType:"style"})),this._request=c.h.frame(()=>{this._request=null,a.validate=a.validate!==!1,this._load(e,a,h)})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(ii,{validate:!1})}_load(e,a,h){var f;const y=a.transformStyle?a.transformStyle(h,e):e;if(!a.validate||!Ln(this,c.y(y))){this._loaded=!0,this.stylesheet=y;for(const T in y.sources)this.addSource(T,y.sources[T],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new fi(this.stylesheet.light),this.map.setTerrain((f=this.stylesheet.terrain)!==null&&f!==void 0?f:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",e),this._order=e.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of e){const h=c.aC(a);h.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=h}}_loadSprite(e,a=!1,h=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(f,y,T,P){const E=pe(f),k=E.length,R=T>1?"@2x":"",O={},Z={},tt={};for(const{id:Q,url:it}of E){const Y=y.transformRequest(y.normalizeSpriteURL(it,R,".json"),Jt.SpriteJSON),ft=`${Q}_${Y.url}`;O[ft]=c.f(Y,(gt,It)=>{delete O[ft],Z[Q]=It,Fe(P,Z,tt,gt,k)});const St=y.transformRequest(y.normalizeSpriteURL(it,R,".png"),Jt.SpriteImage),st=`${Q}_${St.url}`;O[st]=oe.getImage(St,(gt,It)=>{delete O[st],tt[Q]=It,Fe(P,Z,tt,gt,k)})}return{cancel(){for(const Q of Object.values(O))Q.cancel()}}}(e,this.map._requestManager,this.map.getPixelRatio(),(f,y)=>{if(this._spriteRequest=null,f)this.fire(new c.j(f));else if(y)for(const T in y){this._spritesImagesIds[T]=[];const P=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(E=>!(E in y)):[];for(const E of P)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in y[T]){const k=T==="default"?E:`${T}:${E}`;this._spritesImagesIds[T].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,y[T][E],!1):this.imageManager.addImage(k,y[T][E]),a&&(this._changedImages[k]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),h&&h(f)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const a=this.sourceCaches[e.source];if(!a)return;const h=e.sourceLayer;if(!h)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(h)===-1)&&this.fire(new c.j(new Error(`Source layer "${h}" does not exist on source "${f.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a);const h=[];for(const f of e)a[f]&&h.push(a[f]);return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const h of a){const f=this._layers[h];f.type!=="custom"&&(e[h]=f.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(f.length||y.length)&&this._updateWorkerLayers(f,y);for(const T in this._updatedSources){const P=this._updatedSources[T];if(P==="reload")this._reloadSource(T);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const h={};for(const f in this.sourceCaches){const y=this.sourceCaches[f];h[f]=y.used,y.used=!1}for(const f of this._order){const y=this._layers[f];y.recalculate(e,this._availableImages),!y.isHidden(e.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const f in h){const y=this.sourceCaches[f];h[f]!==y.used&&y.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(e),this.z=e.zoom,a&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(e),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){this._checkLoaded();const h=this.serialize();if(e=a.transformStyle?a.transformStyle(h,e):e,Ln(this,c.y(e)))return!1;(e=c.aD(e)).layers=c.aB(e.layers);const f=c.aE(h,e).filter(T=>!(T.command in sa));if(f.length===0)return!1;const y=f.filter(T=>!(T.command in Yn));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);for(const T of f)T.command!=="setTransition"&&this[T.command].apply(this,T.args);return this.stylesheet=e,this._serializedLayers=null,!0}addImage(e,a){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,h={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(c.y.source,`sources.${e}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.sourceCaches[e]=new Yt(e,a,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:e})),f.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${h}" is using it.`)));const a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const h=this.sourceCaches[e].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,h={}){this._checkLoaded();const f=e.id;if(this.getLayer(f))return void this.fire(new c.j(new Error(`Layer "${f}" already exists on this map.`)));let y;if(e.type==="custom"){if(Ln(this,c.aF(e)))return;y=c.aC(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(f,e.source),e=c.aD(e),e=c.e(e,{source:f})),this._validate(c.y.layer,`layers.${f}`,e,{arrayIndex:-1},h))return;y=c.aC(e),this._validateLayer(y),y.setEventedParent(this,{layer:{id:f}})}const T=a?this._order.indexOf(a):this._order.length;if(a&&T===-1)this.fire(new c.j(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(T,0,f),this._layerOrderChanged=!0,this._layers[f]=y,this._removedLayers[f]&&y.source&&y.type!=="custom"){const P=this._removedLayers[f];delete this._removedLayers[f],P.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const h=this._order.indexOf(e);this._order.splice(h,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(f,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const h=this._order.indexOf(e);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,h){this._checkLoaded();const f=this.getLayer(e);f?f.minzoom===a&&f.maxzoom===h||(a!=null&&(f.minzoom=a),h!=null&&(f.maxzoom=h),this._updateLayer(f)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,h={}){this._checkLoaded();const f=this.getLayer(e);if(f){if(!c.aG(f.filter,a))return a==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(c.y.filter,`layers.${f.id}.filter`,a,null,h)||(f.filter=c.aD(a),this._updateLayer(f)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aD(this.getLayer(e).filter)}setLayoutProperty(e,a,h,f={}){this._checkLoaded();const y=this.getLayer(e);y?c.aG(y.getLayoutProperty(a),h)||(y.setLayoutProperty(a,h,f),this._updateLayer(y)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const h=this.getLayer(e);if(h)return h.getLayoutProperty(a);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,h,f={}){this._checkLoaded();const y=this.getLayer(e);y?c.aG(y.getPaintProperty(a),h)||(y.setPaintProperty(a,h,f)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const h=e.source,f=e.sourceLayer,y=this.sourceCaches[h];if(y===void 0)return void this.fire(new c.j(new Error(`The source '${h}' does not exist in the map's style.`)));const T=y.getSource().type;T==="geojson"&&f?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||f?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(f,e.id,a)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const h=e.source,f=this.sourceCaches[h];if(f===void 0)return void this.fire(new c.j(new Error(`The source '${h}' does not exist in the map's style.`)));const y=f.getSource().type,T=y==="vector"?e.sourceLayer:void 0;y!=="vector"||T?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(T,e.id,a):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,h=e.sourceLayer,f=this.sourceCaches[a];if(f!==void 0)return f.getSource().type!=="vector"||h?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),f.getFeatureState(h,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aH(this.sourceCaches,y=>y.serialize()),a=this._serializeByIds(this._order),h=this.map.getTerrain()||void 0,f=this.stylesheet;return c.aI({version:f.version,name:f.name,metadata:f.metadata,light:f.light,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,sources:e,layers:a,terrain:h},y=>y!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=T=>this._layers[T].type==="fill-extrusion",h={},f=[];for(let T=this._order.length-1;T>=0;T--){const P=this._order[T];if(a(P)){h[P]=T;for(const E of e){const k=E[P];if(k)for(const R of k)f.push(R)}}}f.sort((T,P)=>P.intersectionZ-T.intersectionZ);const y=[];for(let T=this._order.length-1;T>=0;T--){const P=this._order[T];if(a(P))for(let E=f.length-1;E>=0;E--){const k=f[E].feature;if(h[k.layer.id]<T)break;y.push(k),f.pop()}else for(const E of e){const k=E[P];if(k)for(const R of k)y.push(R.feature)}}return y}queryRenderedFeatures(e,a,h){a&&a.filter&&this._validate(c.y.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const P of a.layers){const E=this._layers[P];if(!E)return this.fire(new c.j(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];f[E.source]=!0}}const y=[];a.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const P in this.sourceCaches)a.layers&&!f[P]||y.push(Vt(this.sourceCaches[P],this._layers,T,e,a,h));return this.placement&&y.push(function(P,E,k,R,O,Z,tt){const Q={},it=Z.queryRenderedSymbols(R),Y=[];for(const ft of Object.keys(it).map(Number))Y.push(tt[ft]);Y.sort(Bt);for(const ft of Y){const St=ft.featureIndex.lookupSymbolFeatures(it[ft.bucketInstanceId],E,ft.bucketIndex,ft.sourceLayerIndex,O.filter,O.layers,O.availableImages,P);for(const st in St){const gt=Q[st]=Q[st]||[],It=St[st];It.sort((Ct,kt)=>{const Gt=ft.featureSortOrder;if(Gt){const Ot=Gt.indexOf(Ct.featureIndex);return Gt.indexOf(kt.featureIndex)-Ot}return kt.featureIndex-Ct.featureIndex});for(const Ct of It)gt.push(Ct)}}for(const ft in Q)Q[ft].forEach(St=>{const st=St.feature,gt=k[P[ft].source].getFeatureState(st.layer["source-layer"],st.id);st.source=st.layer.source,st.layer["source-layer"]&&(st.sourceLayer=st.layer["source-layer"]),st.state=gt});return Q}(this._layers,T,this.sourceCaches,e,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(e,a){a&&a.filter&&this._validate(c.y.filter,"querySourceFeatures.filter",a.filter,null,a);const h=this.sourceCaches[e];return h?function(f,y){const T=f.getRenderableIds().map(k=>f.getTileByID(k)),P=[],E={};for(let k=0;k<T.length;k++){const R=T[k],O=R.tileID.canonical.key;E[O]||(E[O]=!0,R.querySourceFeatures(P,y))}return P}(h,a):[]}addSourceType(e,a,h){return mt(e)?h(new Error(`A source type called "${e}" already exists.`)):(((f,y)=>{ut[f]=y})(e,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:a.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const h=this.light.getLight();let f=!1;for(const T in e)if(!c.aG(e[T],h[T])){f=!0;break}if(!f)return;const y={now:c.h.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(y)}_validate(e,a,h,f,y={}){return(!y||y.validate!==!1)&&Ln(this,e.call(c.y,c.e({key:a,style:this.serialize(),value:h,styleSpec:c.v},f)))}_remove(e=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const h=this.sourceCaches[a];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,h,f,y=!1){let T=!1,P=!1;const E={};for(const k of this._order){const R=this._layers[k];if(R.type!=="symbol")continue;if(!E[R.source]){const Z=this.sourceCaches[R.source];E[R.source]=Z.getRenderableIds(!0).map(tt=>Z.getTileByID(tt)).sort((tt,Q)=>Q.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan(Q.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(R,E[R.source],e.center.lng);T=T||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.h.now(),e.zoom))&&(this.pauseablePlacement=new Cs(e,this.map.terrain,this._order,y,a,h,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.h.now()),P=!0),T&&this.pauseablePlacement.placement.setStale()),P||T)for(const k of this._order){const R=this._layers[k];R.type==="symbol"&&this.placement.updateLayerOpacities(R,E[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.h.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a,h){this.imageManager.getImages(a.icons,h),this._updateTilesForChangedImages();const f=this.sourceCaches[a.source];f&&f.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(e,a,h){this.glyphManager.getGlyphs(a.stacks,h);const f=this.sourceCaches[a.source];f&&f.setDependencies(a.tileID.key,a.type,[""])}getResource(e,a,h){return c.m(a,h)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(c.y.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,a,h={},f){this._checkLoaded();const y=[{id:e,url:a}],T=[...pe(this.stylesheet.sprite),...y];this._validate(c.y.sprite,"sprite",T,null,h)||(this.stylesheet.sprite=T,this._loadSprite(y,!0,f))}removeSprite(e){this._checkLoaded();const a=pe(this.stylesheet.sprite);if(a.find(h=>h.id===e)){if(this._spritesImagesIds[e])for(const h of this._spritesImagesIds[e])this.imageManager.removeImage(h),this._changedImages[h]=!0;a.splice(a.findIndex(h=>h.id===e),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return pe(this.stylesheet.sprite)}setSprite(e,a={},h){this._checkLoaded(),e&&this._validate(c.y.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,h):(this._unloadSprite(),h&&h(null)))}}mi.registerForPluginStateChange=c.aK;var ts=c.Q([{name:"a_pos",type:"Int16",components:2}]),Rr="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Vi={prelude:Mi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Mi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Mi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Mi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Mi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Mi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Mi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Mi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Rr),terrainDepth:Mi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Rr),terrainCoords:Mi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Rr)};function Mi(_,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=e.match(/attribute ([\w]+) ([\w]+)/g),f=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=y?y.concat(f):f,P={};return{fragmentSource:_=_.replace(a,(E,k,R,O,Z)=>(P[Z]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
varying ${R} ${O} ${Z};
#else
uniform ${R} ${O} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${R} ${O} ${Z} = u_${Z};
#endif
`)),vertexSource:e=e.replace(a,(E,k,R,O,Z)=>{const tt=O==="float"?"vec2":"vec4",Q=Z.match(/color/)?"color":tt;return P[Z]?k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${R} ${tt} a_${Z};
varying ${R} ${O} ${Z};
#else
uniform ${R} ${O} u_${Z};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${R} ${O} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${Q}(a_${Z}, u_${Z}_t);
#else
    ${R} ${O} ${Z} = u_${Z};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${R} ${tt} a_${Z};
#else
uniform ${R} ${O} u_${Z};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${R} ${O} ${Z} = a_${Z};
#else
    ${R} ${O} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${R} ${O} ${Z} = unpack_mix_${Q}(a_${Z}, u_${Z}_t);
#else
    ${R} ${O} ${Z} = u_${Z};
#endif
`}),staticAttributes:h,staticUniforms:T}}class Qe{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,h,f,y,T,P,E,k){this.context=e;let R=this.boundPaintVertexBuffers.length!==f.length;for(let O=0;!R&&O<f.length;O++)this.boundPaintVertexBuffers[O]!==f[O]&&(R=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||R||this.boundIndexBuffer!==y||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==k?this.freshBind(a,h,f,y,T,P,E,k):(e.bindVertexArray.set(this.vao),P&&P.bind(),y&&y.dynamicDraw&&y.bind(),E&&E.bind(),k&&k.bind())}freshBind(e,a,h,f,y,T,P,E){const k=e.numAttributes,R=this.context,O=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=f,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=E,a.enableAttributes(O,e);for(const Z of h)Z.enableAttributes(O,e);T&&T.enableAttributes(O,e),P&&P.enableAttributes(O,e),E&&E.enableAttributes(O,e),a.bind(),a.setVertexAttribPointers(O,e,y);for(const Z of h)Z.bind(),Z.setVertexAttribPointers(O,e,y);T&&(T.bind(),T.setVertexAttribPointers(O,e,y)),f&&f.bind(),P&&(P.bind(),P.setVertexAttribPointers(O,e,y)),E&&(E.bind(),E.setVertexAttribPointers(O,e,y)),R.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ni(_){const e=[];for(let a=0;a<_.length;a++){if(_[a]===null)continue;const h=_[a].split(" ");e.push(h.pop())}return e}class Ls{constructor(e,a,h,f,y,T){const P=e.gl;this.program=P.createProgram();const E=ni(a.staticAttributes),k=h?h.getBinderAttributes():[],R=E.concat(k),O=Vi.prelude.staticUniforms?ni(Vi.prelude.staticUniforms):[],Z=a.staticUniforms?ni(a.staticUniforms):[],tt=h?h.getBinderUniforms():[],Q=O.concat(Z).concat(tt),it=[];for(const Ct of Q)it.indexOf(Ct)<0&&it.push(Ct);const Y=h?h.defines():[];y&&Y.push("#define OVERDRAW_INSPECTOR;"),T&&Y.push("#define TERRAIN3D;");const ft=Y.concat(Vi.prelude.fragmentSource,a.fragmentSource).join(`
`),St=Y.concat(Vi.prelude.vertexSource,a.vertexSource).join(`
`),st=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(st,ft),P.compileShader(st),!P.getShaderParameter(st,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(st)}`);P.attachShader(this.program,st);const gt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(gt,St),P.compileShader(gt),!P.getShaderParameter(gt,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(gt)}`);P.attachShader(this.program,gt),this.attributes={};const It={};this.numAttributes=R.length;for(let Ct=0;Ct<this.numAttributes;Ct++)R[Ct]&&(P.bindAttribLocation(this.program,Ct,R[Ct]),this.attributes[R[Ct]]=Ct);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(gt),P.deleteShader(st);for(let Ct=0;Ct<it.length;Ct++){const kt=it[Ct];if(kt&&!It[kt]){const Gt=P.getUniformLocation(this.program,kt);Gt&&(It[kt]=Gt)}}this.fixedUniforms=f(e,It),this.terrainUniforms=((Ct,kt)=>({u_depth:new c.aL(Ct,kt.u_depth),u_terrain:new c.aL(Ct,kt.u_terrain),u_terrain_dim:new c.aM(Ct,kt.u_terrain_dim),u_terrain_matrix:new c.aN(Ct,kt.u_terrain_matrix),u_terrain_unpack:new c.aO(Ct,kt.u_terrain_unpack),u_terrain_exaggeration:new c.aM(Ct,kt.u_terrain_exaggeration)}))(e,It),this.binderUniforms=h?h.getUniforms(e,It):[]}draw(e,a,h,f,y,T,P,E,k,R,O,Z,tt,Q,it,Y,ft,St){const st=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(h),e.setStencilMode(f),e.setColorMode(y),e.setCullFace(T),E){e.activeTexture.set(st.TEXTURE2),st.bindTexture(st.TEXTURE_2D,E.depthTexture),e.activeTexture.set(st.TEXTURE3),st.bindTexture(st.TEXTURE_2D,E.texture);for(const It in this.terrainUniforms)this.terrainUniforms[It].set(E[It])}for(const It in this.fixedUniforms)this.fixedUniforms[It].set(P[It]);it&&it.setUniforms(e,this.binderUniforms,tt,{zoom:Q});let gt=0;switch(a){case st.LINES:gt=2;break;case st.TRIANGLES:gt=3;break;case st.LINE_STRIP:gt=1}for(const It of Z.get()){const Ct=It.vaos||(It.vaos={});(Ct[k]||(Ct[k]=new Qe)).bind(e,this,R,it?it.getPaintVertexBuffers():[],O,It.vertexOffset,Y,ft,St),st.drawElements(a,It.primitiveLength*gt,st.UNSIGNED_SHORT,It.primitiveOffset*gt*2)}}}function Zn(_,e,a){const h=1/pt(a,1,e.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),y=a.tileSize*Math.pow(2,e.transform.tileZoom)/f,T=y*(a.tileID.canonical.x+a.tileID.wrap*f),P=y*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[T>>16,P>>16],u_pixel_coord_lower:[65535&T,65535&P]}}const Jn=(_,e,a,h)=>{const f=e.style.light,y=f.properties.get("position"),T=[y.x,y.y,y.z],P=function(){var k=new c.A(9);return c.A!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1,k}();f.properties.get("anchor")==="viewport"&&function(k,R){var O=Math.sin(R),Z=Math.cos(R);k[0]=Z,k[1]=O,k[2]=0,k[3]=-O,k[4]=Z,k[5]=0,k[6]=0,k[7]=0,k[8]=1}(P,-e.transform.angle),function(k,R,O){var Z=R[0],tt=R[1],Q=R[2];k[0]=Z*O[0]+tt*O[3]+Q*O[6],k[1]=Z*O[1]+tt*O[4]+Q*O[7],k[2]=Z*O[2]+tt*O[5]+Q*O[8]}(T,T,P);const E=f.properties.get("color");return{u_matrix:_,u_lightpos:T,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+a,u_opacity:h}},Lo=(_,e,a,h,f,y,T)=>c.e(Jn(_,e,a,h),Zn(y,e,T),{u_height_factor:-Math.pow(2,f.overscaledZ)/T.tileSize/8}),aa=_=>({u_matrix:_}),co=(_,e,a,h)=>c.e(aa(_),Zn(a,e,h)),un=(_,e)=>({u_matrix:_,u_world:e}),Hr=(_,e,a,h,f)=>c.e(co(_,e,a,h),{u_world:f}),vr=(_,e,a,h)=>{const f=_.transform;let y,T;if(h.paint.get("circle-pitch-alignment")==="map"){const P=pt(a,1,f.zoom);y=!0,T=[P,P]}else y=!1,T=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(e.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:T}},es=(_,e,a)=>{const h=pt(a,1,e.zoom),f=Math.pow(2,e.zoom-a.tileID.overscaledZ),y=a.tileID.overscaleFactor();return{u_matrix:_,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[e.pixelsToGLUnits[0]/(h*f),e.pixelsToGLUnits[1]/(h*f)],u_overscale_factor:y}},is=(_,e,a=1)=>({u_matrix:_,u_color:e,u_overlay:0,u_overlay_scale:a}),Ms=_=>({u_matrix:_}),Pl=(_,e,a,h)=>({u_matrix:_,u_extrude_scale:pt(e,1,a),u_intensity:h});function la(_,e){const a=Math.pow(2,e.canonical.z),h=e.canonical.y;return[new c.U(0,h/a).toLngLat().lat,new c.U(0,(h+1)/a).toLngLat().lat]}const ks=(_,e,a,h)=>{const f=_.transform;return{u_matrix:zs(_,e,a,h),u_ratio:1/pt(e,1,f.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Fa=(_,e,a,h,f)=>c.e(ks(_,e,a,f),{u_image:0,u_image_height:h}),Al=(_,e,a,h,f)=>{const y=_.transform,T=Il(e,y);return{u_matrix:zs(_,e,a,f),u_texsize:e.imageAtlasTexture.size,u_ratio:1/pt(e,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[T,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ca=(_,e,a,h,f,y)=>{const T=_.lineAtlas,P=Il(e,_.transform),E=a.layout.get("line-cap")==="round",k=T.getDash(h.from,E),R=T.getDash(h.to,E),O=k.width*f.fromScale,Z=R.width*f.toScale;return c.e(ks(_,e,a,y),{u_patternscale_a:[P/O,-k.height/2],u_patternscale_b:[P/Z,-R.height/2],u_sdfgamma:T.width/(256*Math.min(O,Z)*_.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:R.y,u_mix:f.t})};function Il(_,e){return 1/pt(_,1,e.tileZoom)}function zs(_,e,a,h){return _.translatePosMatrix(h?h.posMatrix:e.tileID.posMatrix,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const fc=(_,e,a,h,f)=>{return{u_matrix:_,u_tl_parent:e,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(T=f.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(y=f.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:ri(f.paint.get("raster-hue-rotate"))};var y,T};function ri(_){_*=Math.PI/180;const e=Math.sin(_),a=Math.cos(_);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const xr=(_,e,a,h,f,y,T,P,E,k)=>{const R=f.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:R.width/R.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+E,u_pitch_with_map:+h,u_texsize:k,u_texture:0}},Gi=(_,e,a,h,f,y,T,P,E,k,R)=>{const O=f.transform;return c.e(xr(_,e,a,h,f,y,T,P,E,k),{u_gamma_scale:h?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+R})},Mo=(_,e,a,h,f,y,T,P,E,k)=>c.e(Gi(_,e,a,h,f,y,T,P,!0,E,!0),{u_texsize_icon:k,u_texture_icon:1}),Rs=(_,e,a)=>({u_matrix:_,u_opacity:e,u_color:a}),Qn=(_,e,a,h,f,y)=>c.e(function(T,P,E,k){const R=E.imageManager.getPattern(T.from.toString()),O=E.imageManager.getPattern(T.to.toString()),{width:Z,height:tt}=E.imageManager.getPixelSize(),Q=Math.pow(2,k.tileID.overscaledZ),it=k.tileSize*Math.pow(2,E.transform.tileZoom)/Q,Y=it*(k.tileID.canonical.x+k.tileID.wrap*Q),ft=it*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[Z,tt],u_mix:P.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/pt(k,1,E.transform.tileZoom),u_pixel_coord_upper:[Y>>16,ft>>16],u_pixel_coord_lower:[65535&Y,65535&ft]}}(h,y,a,f),{u_matrix:_,u_opacity:e}),Ds={fillExtrusion:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_lightpos:new c.aP(_,e.u_lightpos),u_lightintensity:new c.aM(_,e.u_lightintensity),u_lightcolor:new c.aP(_,e.u_lightcolor),u_vertical_gradient:new c.aM(_,e.u_vertical_gradient),u_opacity:new c.aM(_,e.u_opacity)}),fillExtrusionPattern:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_lightpos:new c.aP(_,e.u_lightpos),u_lightintensity:new c.aM(_,e.u_lightintensity),u_lightcolor:new c.aP(_,e.u_lightcolor),u_vertical_gradient:new c.aM(_,e.u_vertical_gradient),u_height_factor:new c.aM(_,e.u_height_factor),u_image:new c.aL(_,e.u_image),u_texsize:new c.aQ(_,e.u_texsize),u_pixel_coord_upper:new c.aQ(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(_,e.u_pixel_coord_lower),u_scale:new c.aP(_,e.u_scale),u_fade:new c.aM(_,e.u_fade),u_opacity:new c.aM(_,e.u_opacity)}),fill:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix)}),fillPattern:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_image:new c.aL(_,e.u_image),u_texsize:new c.aQ(_,e.u_texsize),u_pixel_coord_upper:new c.aQ(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(_,e.u_pixel_coord_lower),u_scale:new c.aP(_,e.u_scale),u_fade:new c.aM(_,e.u_fade)}),fillOutline:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_world:new c.aQ(_,e.u_world)}),fillOutlinePattern:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_world:new c.aQ(_,e.u_world),u_image:new c.aL(_,e.u_image),u_texsize:new c.aQ(_,e.u_texsize),u_pixel_coord_upper:new c.aQ(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(_,e.u_pixel_coord_lower),u_scale:new c.aP(_,e.u_scale),u_fade:new c.aM(_,e.u_fade)}),circle:(_,e)=>({u_camera_to_center_distance:new c.aM(_,e.u_camera_to_center_distance),u_scale_with_map:new c.aL(_,e.u_scale_with_map),u_pitch_with_map:new c.aL(_,e.u_pitch_with_map),u_extrude_scale:new c.aQ(_,e.u_extrude_scale),u_device_pixel_ratio:new c.aM(_,e.u_device_pixel_ratio),u_matrix:new c.aN(_,e.u_matrix)}),collisionBox:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_camera_to_center_distance:new c.aM(_,e.u_camera_to_center_distance),u_pixels_to_tile_units:new c.aM(_,e.u_pixels_to_tile_units),u_extrude_scale:new c.aQ(_,e.u_extrude_scale),u_overscale_factor:new c.aM(_,e.u_overscale_factor)}),collisionCircle:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_inv_matrix:new c.aN(_,e.u_inv_matrix),u_camera_to_center_distance:new c.aM(_,e.u_camera_to_center_distance),u_viewport_size:new c.aQ(_,e.u_viewport_size)}),debug:(_,e)=>({u_color:new c.aR(_,e.u_color),u_matrix:new c.aN(_,e.u_matrix),u_overlay:new c.aL(_,e.u_overlay),u_overlay_scale:new c.aM(_,e.u_overlay_scale)}),clippingMask:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix)}),heatmap:(_,e)=>({u_extrude_scale:new c.aM(_,e.u_extrude_scale),u_intensity:new c.aM(_,e.u_intensity),u_matrix:new c.aN(_,e.u_matrix)}),heatmapTexture:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_world:new c.aQ(_,e.u_world),u_image:new c.aL(_,e.u_image),u_color_ramp:new c.aL(_,e.u_color_ramp),u_opacity:new c.aM(_,e.u_opacity)}),hillshade:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_image:new c.aL(_,e.u_image),u_latrange:new c.aQ(_,e.u_latrange),u_light:new c.aQ(_,e.u_light),u_shadow:new c.aR(_,e.u_shadow),u_highlight:new c.aR(_,e.u_highlight),u_accent:new c.aR(_,e.u_accent)}),hillshadePrepare:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_image:new c.aL(_,e.u_image),u_dimension:new c.aQ(_,e.u_dimension),u_zoom:new c.aM(_,e.u_zoom),u_unpack:new c.aO(_,e.u_unpack)}),line:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_ratio:new c.aM(_,e.u_ratio),u_device_pixel_ratio:new c.aM(_,e.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(_,e.u_units_to_pixels)}),lineGradient:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_ratio:new c.aM(_,e.u_ratio),u_device_pixel_ratio:new c.aM(_,e.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(_,e.u_units_to_pixels),u_image:new c.aL(_,e.u_image),u_image_height:new c.aM(_,e.u_image_height)}),linePattern:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_texsize:new c.aQ(_,e.u_texsize),u_ratio:new c.aM(_,e.u_ratio),u_device_pixel_ratio:new c.aM(_,e.u_device_pixel_ratio),u_image:new c.aL(_,e.u_image),u_units_to_pixels:new c.aQ(_,e.u_units_to_pixels),u_scale:new c.aP(_,e.u_scale),u_fade:new c.aM(_,e.u_fade)}),lineSDF:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_ratio:new c.aM(_,e.u_ratio),u_device_pixel_ratio:new c.aM(_,e.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(_,e.u_units_to_pixels),u_patternscale_a:new c.aQ(_,e.u_patternscale_a),u_patternscale_b:new c.aQ(_,e.u_patternscale_b),u_sdfgamma:new c.aM(_,e.u_sdfgamma),u_image:new c.aL(_,e.u_image),u_tex_y_a:new c.aM(_,e.u_tex_y_a),u_tex_y_b:new c.aM(_,e.u_tex_y_b),u_mix:new c.aM(_,e.u_mix)}),raster:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_tl_parent:new c.aQ(_,e.u_tl_parent),u_scale_parent:new c.aM(_,e.u_scale_parent),u_buffer_scale:new c.aM(_,e.u_buffer_scale),u_fade_t:new c.aM(_,e.u_fade_t),u_opacity:new c.aM(_,e.u_opacity),u_image0:new c.aL(_,e.u_image0),u_image1:new c.aL(_,e.u_image1),u_brightness_low:new c.aM(_,e.u_brightness_low),u_brightness_high:new c.aM(_,e.u_brightness_high),u_saturation_factor:new c.aM(_,e.u_saturation_factor),u_contrast_factor:new c.aM(_,e.u_contrast_factor),u_spin_weights:new c.aP(_,e.u_spin_weights)}),symbolIcon:(_,e)=>({u_is_size_zoom_constant:new c.aL(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(_,e.u_is_size_feature_constant),u_size_t:new c.aM(_,e.u_size_t),u_size:new c.aM(_,e.u_size),u_camera_to_center_distance:new c.aM(_,e.u_camera_to_center_distance),u_pitch:new c.aM(_,e.u_pitch),u_rotate_symbol:new c.aL(_,e.u_rotate_symbol),u_aspect_ratio:new c.aM(_,e.u_aspect_ratio),u_fade_change:new c.aM(_,e.u_fade_change),u_matrix:new c.aN(_,e.u_matrix),u_label_plane_matrix:new c.aN(_,e.u_label_plane_matrix),u_coord_matrix:new c.aN(_,e.u_coord_matrix),u_is_text:new c.aL(_,e.u_is_text),u_pitch_with_map:new c.aL(_,e.u_pitch_with_map),u_texsize:new c.aQ(_,e.u_texsize),u_texture:new c.aL(_,e.u_texture)}),symbolSDF:(_,e)=>({u_is_size_zoom_constant:new c.aL(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(_,e.u_is_size_feature_constant),u_size_t:new c.aM(_,e.u_size_t),u_size:new c.aM(_,e.u_size),u_camera_to_center_distance:new c.aM(_,e.u_camera_to_center_distance),u_pitch:new c.aM(_,e.u_pitch),u_rotate_symbol:new c.aL(_,e.u_rotate_symbol),u_aspect_ratio:new c.aM(_,e.u_aspect_ratio),u_fade_change:new c.aM(_,e.u_fade_change),u_matrix:new c.aN(_,e.u_matrix),u_label_plane_matrix:new c.aN(_,e.u_label_plane_matrix),u_coord_matrix:new c.aN(_,e.u_coord_matrix),u_is_text:new c.aL(_,e.u_is_text),u_pitch_with_map:new c.aL(_,e.u_pitch_with_map),u_texsize:new c.aQ(_,e.u_texsize),u_texture:new c.aL(_,e.u_texture),u_gamma_scale:new c.aM(_,e.u_gamma_scale),u_device_pixel_ratio:new c.aM(_,e.u_device_pixel_ratio),u_is_halo:new c.aL(_,e.u_is_halo)}),symbolTextAndIcon:(_,e)=>({u_is_size_zoom_constant:new c.aL(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(_,e.u_is_size_feature_constant),u_size_t:new c.aM(_,e.u_size_t),u_size:new c.aM(_,e.u_size),u_camera_to_center_distance:new c.aM(_,e.u_camera_to_center_distance),u_pitch:new c.aM(_,e.u_pitch),u_rotate_symbol:new c.aL(_,e.u_rotate_symbol),u_aspect_ratio:new c.aM(_,e.u_aspect_ratio),u_fade_change:new c.aM(_,e.u_fade_change),u_matrix:new c.aN(_,e.u_matrix),u_label_plane_matrix:new c.aN(_,e.u_label_plane_matrix),u_coord_matrix:new c.aN(_,e.u_coord_matrix),u_is_text:new c.aL(_,e.u_is_text),u_pitch_with_map:new c.aL(_,e.u_pitch_with_map),u_texsize:new c.aQ(_,e.u_texsize),u_texsize_icon:new c.aQ(_,e.u_texsize_icon),u_texture:new c.aL(_,e.u_texture),u_texture_icon:new c.aL(_,e.u_texture_icon),u_gamma_scale:new c.aM(_,e.u_gamma_scale),u_device_pixel_ratio:new c.aM(_,e.u_device_pixel_ratio),u_is_halo:new c.aL(_,e.u_is_halo)}),background:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_opacity:new c.aM(_,e.u_opacity),u_color:new c.aR(_,e.u_color)}),backgroundPattern:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_opacity:new c.aM(_,e.u_opacity),u_image:new c.aL(_,e.u_image),u_pattern_tl_a:new c.aQ(_,e.u_pattern_tl_a),u_pattern_br_a:new c.aQ(_,e.u_pattern_br_a),u_pattern_tl_b:new c.aQ(_,e.u_pattern_tl_b),u_pattern_br_b:new c.aQ(_,e.u_pattern_br_b),u_texsize:new c.aQ(_,e.u_texsize),u_mix:new c.aM(_,e.u_mix),u_pattern_size_a:new c.aQ(_,e.u_pattern_size_a),u_pattern_size_b:new c.aQ(_,e.u_pattern_size_b),u_scale_a:new c.aM(_,e.u_scale_a),u_scale_b:new c.aM(_,e.u_scale_b),u_pixel_coord_upper:new c.aQ(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(_,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aM(_,e.u_tile_units_to_pixels)}),terrain:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_texture:new c.aL(_,e.u_texture),u_ele_delta:new c.aM(_,e.u_ele_delta)}),terrainDepth:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_ele_delta:new c.aM(_,e.u_ele_delta)}),terrainCoords:(_,e)=>({u_matrix:new c.aN(_,e.u_matrix),u_texture:new c.aL(_,e.u_texture),u_terrain_coords_id:new c.aM(_,e.u_terrain_coords_id),u_ele_delta:new c.aM(_,e.u_ele_delta)})};class Wr{constructor(e,a,h){this.context=e;const f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ns={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ko{constructor(e,a,h,f){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=e;const y=e.gl;this.buffer=y.createBuffer(),e.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let h=0;h<this.attributes.length;h++){const f=a.attributes[this.attributes[h].name];f!==void 0&&e.enableVertexAttribArray(f)}}setVertexAttribPointers(e,a,h){for(let f=0;f<this.attributes.length;f++){const y=this.attributes[f],T=a.attributes[y.name];T!==void 0&&e.vertexAttribPointer(T,y.components,e[ns[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dn=new WeakMap;function tr(_){var e;if(dn.has(_))return dn.get(_);{const a=(e=_.getParameter(_.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return dn.set(_,a),a}}class _i{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ua extends _i{getDefault(){return c.aT.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class lr extends _i{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class er extends _i{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ha extends _i{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Na extends _i{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class da extends _i{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ei extends _i{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Cl extends _i{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ir extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class rs extends _i{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ua extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class Va extends _i{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class $a extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class mc extends _i{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class os extends _i{getDefault(){return c.aT.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ru extends _i{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ou extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class El extends _i{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class su extends _i{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Kr extends _i{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class au extends _i{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Za extends _i{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Dr extends _i{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ja extends _i{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ga extends _i{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class zo extends _i{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _c extends _i{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ll extends _i{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const h=this.gl;tr(h)?h.bindVertexArray(e):(a=h.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class qa extends _i{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ss extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class gc extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Xr extends _i{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class Bs extends Xr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Ml extends Xr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ha extends Xr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Li{constructor(e,a,h,f,y){this.context=e,this.width=a,this.height=h;const T=e.gl,P=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new Bs(e,P),f)this.depthAttachment=y?new Ha(e,P):new Ml(e,P);else if(y)throw new Error("Stencil cannot be setted without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const h=this.depthAttachment.get();h&&e.deleteRenderbuffer(h)}e.deleteFramebuffer(this.framebuffer)}}class Ui{constructor(e,a,h){this.blendFunction=e,this.blendColor=a,this.mask=h}}Ui.Replace=[1,0],Ui.disabled=new Ui(Ui.Replace,c.aT.transparent,[!1,!1,!1,!1]),Ui.unblended=new Ui(Ui.Replace,c.aT.transparent,[!0,!0,!0,!0]),Ui.alphaBlended=new Ui([1,771],c.aT.transparent,[!0,!0,!0,!0]);class lu{constructor(e){var a,h;if(this.gl=e,this.clearColor=new ua(this),this.clearDepth=new lr(this),this.clearStencil=new er(this),this.colorMask=new ha(this),this.depthMask=new Na(this),this.stencilMask=new da(this),this.stencilFunc=new Ei(this),this.stencilOp=new Cl(this),this.stencilTest=new ir(this),this.depthRange=new rs(this),this.depthTest=new Ua(this),this.depthFunc=new Va(this),this.blend=new $a(this),this.blendFunc=new mc(this),this.blendColor=new os(this),this.blendEquation=new ru(this),this.cullFace=new ou(this),this.cullFaceSide=new El(this),this.frontFace=new su(this),this.program=new Kr(this),this.activeTexture=new au(this),this.viewport=new Za(this),this.bindFramebuffer=new Dr(this),this.bindRenderbuffer=new ja(this),this.bindTexture=new Ga(this),this.bindVertexBuffer=new zo(this),this.bindElementBuffer=new _c(this),this.bindVertexArray=new Ll(this),this.pixelStoreUnpack=new qa(this),this.pixelStoreUnpackPremultiplyAlpha=new ss(this),this.pixelStoreUnpackFlipY=new gc(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),tr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const f=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:f==null?void 0:f.RGBA16F_EXT,this.RGB16F=(h=e.RGB16F)!==null&&h!==void 0?h:f==null?void 0:f.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const f=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=f==null?void 0:f.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new Wr(this,e,a)}createVertexBuffer(e,a,h){return new ko(this,e,a,h)}createRenderbuffer(e,a,h){const f=this.gl,y=f.createRenderbuffer();return this.bindRenderbuffer.set(y),f.renderbufferStorage(f.RENDERBUFFER,e,a,h),this.bindRenderbuffer.set(null),y}createFramebuffer(e,a,h,f){return new Li(this,e,a,h,f)}clear({color:e,depth:a,stencil:h}){const f=this.gl;let y=0;e&&(y|=f.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(y|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(y|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),f.clear(y)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aG(e.blendFunction,Ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return tr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return tr(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ai{constructor(e,a,h){this.func=e,this.mask=a,this.range=h}}ai.ReadOnly=!1,ai.ReadWrite=!0,ai.disabled=new ai(519,ai.ReadOnly,[0,1]);const An=7680;class nn{constructor(e,a,h,f,y,T){this.test=e,this.ref=a,this.mask=h,this.fail=f,this.depthFail=y,this.pass=T}}nn.disabled=new nn({func:519,mask:0},0,0,An,An,An);class Ki{constructor(e,a,h){this.enable=e,this.mode=a,this.frontFace=h}}let pa;function Wa(_,e,a,h,f,y,T){const P=_.context,E=P.gl,k=_.useProgram("collisionBox"),R=[];let O=0,Z=0;for(let st=0;st<h.length;st++){const gt=h[st],It=e.getTile(gt),Ct=It.getBucket(a);if(!Ct)continue;let kt=gt.posMatrix;f[0]===0&&f[1]===0||(kt=_.translatePosMatrix(gt.posMatrix,It,f,y));const Gt=T?Ct.textCollisionBox:Ct.iconCollisionBox,Ot=Ct.collisionCircleArray;if(Ot.length>0){const Xt=c.Z(),Se=kt;c.aU(Xt,Ct.placementInvProjMatrix,_.transform.glCoordMatrix),c.aU(Xt,Xt,Ct.placementViewportMatrix),R.push({circleArray:Ot,circleOffset:Z,transform:Se,invTransform:Xt,coord:gt}),O+=Ot.length/4,Z=O}Gt&&k.draw(P,E.LINES,ai.disabled,nn.disabled,_.colorModeForRenderPass(),Ki.disabled,es(kt,_.transform,It),_.style.map.terrain&&_.style.map.terrain.getTerrainData(gt),a.id,Gt.layoutVertexBuffer,Gt.indexBuffer,Gt.segments,null,_.transform.zoom,null,null,Gt.collisionVertexBuffer)}if(!T||!R.length)return;const tt=_.useProgram("collisionCircle"),Q=new c.aV;Q.resize(4*O),Q._trim();let it=0;for(const st of R)for(let gt=0;gt<st.circleArray.length/4;gt++){const It=4*gt,Ct=st.circleArray[It+0],kt=st.circleArray[It+1],Gt=st.circleArray[It+2],Ot=st.circleArray[It+3];Q.emplace(it++,Ct,kt,Gt,Ot,0),Q.emplace(it++,Ct,kt,Gt,Ot,1),Q.emplace(it++,Ct,kt,Gt,Ot,2),Q.emplace(it++,Ct,kt,Gt,Ot,3)}(!pa||pa.length<2*O)&&(pa=function(st){const gt=2*st,It=new c.aX;It.resize(gt),It._trim();for(let Ct=0;Ct<gt;Ct++){const kt=6*Ct;It.uint16[kt+0]=4*Ct+0,It.uint16[kt+1]=4*Ct+1,It.uint16[kt+2]=4*Ct+2,It.uint16[kt+3]=4*Ct+2,It.uint16[kt+4]=4*Ct+3,It.uint16[kt+5]=4*Ct+0}return It}(O));const Y=P.createIndexBuffer(pa,!0),ft=P.createVertexBuffer(Q,c.aW.members,!0);for(const st of R){const gt={u_matrix:st.transform,u_inv_matrix:st.invTransform,u_camera_to_center_distance:(St=_.transform).cameraToCenterDistance,u_viewport_size:[St.width,St.height]};tt.draw(P,E.TRIANGLES,ai.disabled,nn.disabled,_.colorModeForRenderPass(),Ki.disabled,gt,_.style.map.terrain&&_.style.map.terrain.getTerrainData(st.coord),a.id,ft,Y,c.S.simpleSegment(0,2*st.circleOffset,st.circleArray.length,st.circleArray.length/2),null,_.transform.zoom,null,null,null)}var St;ft.destroy(),Y.destroy()}Ki.disabled=new Ki(!1,1029,2305),Ki.backCCW=new Ki(!0,1029,2305);const fa=c.ao(new Float32Array(16));function Ka(_,e,a,h,f,y){const{horizontalAlign:T,verticalAlign:P}=c.au(_);return new c.P((-(T-.5)*e/f+h[0])*y,(-(P-.5)*a/f+h[1])*y)}function Xa(_,e,a,h,f,y,T,P,E,k,R){const O=_.text.placedSymbolArray,Z=_.text.dynamicLayoutVertexArray,tt=_.icon.dynamicLayoutVertexArray,Q={};Z.clear();for(let it=0;it<O.length;it++){const Y=O.get(it),ft=Y.hidden||!Y.crossTileID||_.allowVerticalPlacement&&!Y.placedOrientation?null:h[Y.crossTileID];if(ft){const St=new c.P(Y.anchorX,Y.anchorY),st=zi(St,a?T:y,R),gt=kr(f.cameraToCenterDistance,st.signedDistanceFromCamera);let It=c.aj(_.textSizeData,E,Y)*gt/c.ap;a&&(It*=_.tilePixelRatio/P);const{width:Ct,height:kt,anchor:Gt,textOffset:Ot,textBoxScale:Xt}=ft,Se=Ka(Gt,Ct,kt,Ot,Xt,It),vi=a?zi(St.add(Se),y,R).point:st.point.add(e?Se.rotate(-f.angle):Se),se=_.allowVerticalPlacement&&Y.placedOrientation===c.ai.vertical?Math.PI/2:0;for(let Ne=0;Ne<Y.numGlyphs;Ne++)c.ak(Z,vi,se);k&&Y.associatedIconIndex>=0&&(Q[Y.associatedIconIndex]={shiftedAnchor:vi,angle:se})}else X(Y.numGlyphs,Z)}if(k){tt.clear();const it=_.icon.placedSymbolArray;for(let Y=0;Y<it.length;Y++){const ft=it.get(Y);if(ft.hidden)X(ft.numGlyphs,tt);else{const St=Q[Y];if(St)for(let st=0;st<ft.numGlyphs;st++)c.ak(tt,St.shiftedAnchor,St.angle);else X(ft.numGlyphs,tt)}}_.icon.dynamicLayoutVertexBuffer.updateData(tt)}_.text.dynamicLayoutVertexBuffer.updateData(Z)}function Ya(_,e,a){return a.iconsInText&&e?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Ja(_,e,a,h,f,y,T,P,E,k,R,O){const Z=_.context,tt=Z.gl,Q=_.transform,it=P==="map",Y=E==="map",ft=P!=="viewport"&&a.layout.get("symbol-placement")!=="point",St=it&&!Y&&!ft,st=!a.layout.get("symbol-sort-key").isConstant();let gt=!1;const It=_.depthModeForSublayer(0,ai.ReadOnly),Ct=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),kt=[];for(const Gt of h){const Ot=e.getTile(Gt),Xt=Ot.getBucket(a);if(!Xt)continue;const Se=f?Xt.text:Xt.icon;if(!Se||!Se.segments.get().length||!Se.hasVisibleVertices)continue;const vi=Se.programConfigurations.get(a.id),se=f||Xt.sdfIcons,Ne=f?Xt.textSizeData:Xt.iconSizeData,Ie=Y||Q.pitch!==0,qi=_.useProgram(Ya(se,f,Xt),vi),gi=c.ah(Ne,Q.zoom),oi=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Gt);let xi,yn,rn,qn,Mn=[0,0],wn=null;if(f)yn=Ot.glyphAtlasTexture,rn=tt.LINEAR,xi=Ot.glyphAtlasTexture.size,Xt.iconsInText&&(Mn=Ot.imageAtlasTexture.size,wn=Ot.imageAtlasTexture,qn=Ie||_.options.rotating||_.options.zooming||Ne.kind==="composite"||Ne.kind==="camera"?tt.LINEAR:tt.NEAREST);else{const vn=a.layout.get("icon-size").constantOr(0)!==1||Xt.iconsNeedLinear;yn=Ot.imageAtlasTexture,rn=se||_.options.rotating||_.options.zooming||vn||Ie?tt.LINEAR:tt.NEAREST,xi=Ot.imageAtlasTexture.size}const Fr=pt(Ot,1,_.transform.zoom),sn=Wt(Gt.posMatrix,Y,it,_.transform,Fr),No=Xn(Gt.posMatrix,Y,it,_.transform,Fr),Uo=Ct&&Xt.hasTextData(),js=a.layout.get("icon-text-fit")!=="none"&&Uo&&Xt.hasIconData();if(ft){const vn=_.style.map.terrain?(Tr,xn)=>_.style.map.terrain.getElevation(Gt,Tr,xn):null,kn=a.layout.get("text-rotation-alignment")==="map";jt(Xt,Gt.posMatrix,_,f,sn,No,Y,k,kn,vn)}const wa=_.translatePosMatrix(Gt.posMatrix,Ot,y,T),ll=ft||f&&Ct||js?fa:sn,nr=_.translatePosMatrix(No,Ot,y,T,!0),Hn=se&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let dr;dr=se?Xt.iconsInText?Mo(Ne.kind,gi,St,Y,_,wa,ll,nr,xi,Mn):Gi(Ne.kind,gi,St,Y,_,wa,ll,nr,f,xi,!0):xr(Ne.kind,gi,St,Y,_,wa,ll,nr,f,xi);const Ta={program:qi,buffers:Se,uniformValues:dr,atlasTexture:yn,atlasTextureIcon:wn,atlasInterpolation:rn,atlasInterpolationIcon:qn,isSDF:se,hasHalo:Hn};if(st&&Xt.canOverlap){gt=!0;const vn=Se.segments.get();for(const kn of vn)kt.push({segments:new c.S([kn]),sortKey:kn.sortKey,state:Ta,terrainData:oi})}else kt.push({segments:Se.segments,sortKey:0,state:Ta,terrainData:oi})}gt&&kt.sort((Gt,Ot)=>Gt.sortKey-Ot.sortKey);for(const Gt of kt){const Ot=Gt.state;if(Z.activeTexture.set(tt.TEXTURE0),Ot.atlasTexture.bind(Ot.atlasInterpolation,tt.CLAMP_TO_EDGE),Ot.atlasTextureIcon&&(Z.activeTexture.set(tt.TEXTURE1),Ot.atlasTextureIcon&&Ot.atlasTextureIcon.bind(Ot.atlasInterpolationIcon,tt.CLAMP_TO_EDGE)),Ot.isSDF){const Xt=Ot.uniformValues;Ot.hasHalo&&(Xt.u_is_halo=1,cr(Ot.buffers,Gt.segments,a,_,Ot.program,It,R,O,Xt,Gt.terrainData)),Xt.u_is_halo=0}cr(Ot.buffers,Gt.segments,a,_,Ot.program,It,R,O,Ot.uniformValues,Gt.terrainData)}}function cr(_,e,a,h,f,y,T,P,E,k){const R=h.context;f.draw(R,R.gl.TRIANGLES,y,T,P,Ki.disabled,E,k,a.id,_.layoutVertexBuffer,_.indexBuffer,e,a.paint,h.transform.zoom,_.programConfigurations.get(a.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Yr(_,e,a,h,f){if(!a||!h||!h.imageAtlas)return;const y=h.imageAtlas.patternPositions;let T=y[a.to.toString()],P=y[a.from.toString()];if(!T&&P&&(T=P),!P&&T&&(P=T),!T||!P){const E=f.getPaintProperty(e);T=y[E],P=y[E]}T&&P&&_.setConstantPatternPositions(T,P)}function ma(_,e,a,h,f,y,T){const P=_.context.gl,E="fill-pattern",k=a.paint.get(E),R=k&&k.constantOr(1),O=a.getCrossfadeParameters();let Z,tt,Q,it,Y;T?(tt=R&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=P.LINES):(tt=R?"fillPattern":"fill",Z=P.TRIANGLES);const ft=k.constantOr(null);for(const St of h){const st=e.getTile(St);if(R&&!st.patternsLoaded())continue;const gt=st.getBucket(a);if(!gt)continue;const It=gt.programConfigurations.get(a.id),Ct=_.useProgram(tt,It),kt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(St);R&&(_.context.activeTexture.set(P.TEXTURE0),st.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),It.updatePaintBuffers(O)),Yr(It,E,ft,st,a);const Gt=kt?St:null,Ot=_.translatePosMatrix(Gt?Gt.posMatrix:St.posMatrix,st,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(T){it=gt.indexBuffer2,Y=gt.segments2;const Xt=[P.drawingBufferWidth,P.drawingBufferHeight];Q=tt==="fillOutlinePattern"&&R?Hr(Ot,_,O,st,Xt):un(Ot,Xt)}else it=gt.indexBuffer,Y=gt.segments,Q=R?co(Ot,_,O,st):aa(Ot);Ct.draw(_.context,Z,f,_.stencilModeForClipping(St),y,Ki.disabled,Q,kt,a.id,gt.layoutVertexBuffer,it,Y,a.paint,_.transform.zoom,It)}}function ur(_,e,a,h,f,y,T){const P=_.context,E=P.gl,k="fill-extrusion-pattern",R=a.paint.get(k),O=R.constantOr(1),Z=a.getCrossfadeParameters(),tt=a.paint.get("fill-extrusion-opacity"),Q=R.constantOr(null);for(const it of h){const Y=e.getTile(it),ft=Y.getBucket(a);if(!ft)continue;const St=_.style.map.terrain&&_.style.map.terrain.getTerrainData(it),st=ft.programConfigurations.get(a.id),gt=_.useProgram(O?"fillExtrusionPattern":"fillExtrusion",st);O&&(_.context.activeTexture.set(E.TEXTURE0),Y.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),st.updatePaintBuffers(Z)),Yr(st,k,Q,Y,a);const It=_.translatePosMatrix(it.posMatrix,Y,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ct=a.paint.get("fill-extrusion-vertical-gradient"),kt=O?Lo(It,_,Ct,tt,it,Z,Y):Jn(It,_,Ct,tt);gt.draw(P,P.gl.TRIANGLES,f,y,T,Ki.backCCW,kt,St,a.id,ft.layoutVertexBuffer,ft.indexBuffer,ft.segments,a.paint,_.transform.zoom,st,_.style.map.terrain&&ft.centroidVertexBuffer)}}function cu(_,e,a,h,f,y,T){const P=_.context,E=P.gl,k=a.fbo;if(!k)return;const R=_.useProgram("hillshade"),O=_.style.map.terrain&&_.style.map.terrain.getTerrainData(e);P.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,k.colorAttachment.get()),R.draw(P,E.TRIANGLES,f,y,T,Ki.disabled,((Z,tt,Q,it)=>{const Y=Q.paint.get("hillshade-shadow-color"),ft=Q.paint.get("hillshade-highlight-color"),St=Q.paint.get("hillshade-accent-color");let st=Q.paint.get("hillshade-illumination-direction")*(Math.PI/180);Q.paint.get("hillshade-illumination-anchor")==="viewport"&&(st-=Z.transform.angle);const gt=!Z.options.moving;return{u_matrix:it?it.posMatrix:Z.transform.calculatePosMatrix(tt.tileID.toUnwrapped(),gt),u_image:0,u_latrange:la(0,tt.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),st],u_shadow:Y,u_highlight:ft,u_accent:St}})(_,a,h,O?e:null),O,h.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function Ro(_,e,a,h,f,y){const T=_.context,P=T.gl,E=e.dem;if(E&&E.data){const k=E.dim,R=E.stride,O=E.getPixels();if(T.activeTexture.set(P.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||_.getTileTexture(R),e.demTexture){const tt=e.demTexture;tt.update(O,{premultiply:!1}),tt.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else e.demTexture=new ce(T,O,P.RGBA,{premultiply:!1}),e.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);T.activeTexture.set(P.TEXTURE0);let Z=e.fbo;if(!Z){const tt=new ce(T,{width:k,height:k,data:null},P.RGBA);tt.bind(P.LINEAR,P.CLAMP_TO_EDGE),Z=e.fbo=T.createFramebuffer(k,k,!0,!1),Z.colorAttachment.set(tt.texture)}T.bindFramebuffer.set(Z.framebuffer),T.viewport.set([0,0,k,k]),_.useProgram("hillshadePrepare").draw(T,P.TRIANGLES,h,f,y,Ki.disabled,((tt,Q)=>{const it=Q.stride,Y=c.Z();return c.aS(Y,0,c.N,-c.N,0,0,1),c.$(Y,Y,[0,-c.N,0]),{u_matrix:Y,u_image:1,u_dimension:[it,it],u_zoom:tt.overscaledZ,u_unpack:Q.getUnpackVector()}})(e.tileID,E),null,a.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function uu(_,e,a,h,f,y){const T=h.paint.get("raster-fade-duration");if(!y&&T>0){const P=c.h.now(),E=(P-_.timeAdded)/T,k=e?(P-e.timeAdded)/T:-1,R=a.getSource(),O=f.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),Z=!e||Math.abs(e.tileID.overscaledZ-O)>Math.abs(_.tileID.overscaledZ-O),tt=Z&&_.refreshedUponExpiration?1:c.ad(Z?E:1-k,0,1);return _.refreshedUponExpiration&&E>=1&&(_.refreshedUponExpiration=!1),e?{opacity:1,mix:1-tt}:{opacity:tt,mix:0}}return{opacity:1,mix:0}}const Os=new c.aT(1,0,0,1),_a=new c.aT(0,1,0,1),Fs=new c.aT(0,0,1,1),yc=new c.aT(1,0,1,1),uo=new c.aT(0,1,1,1);function Do(_,e,a,h){Ns(_,0,e+a/2,_.transform.width,a,h)}function Qa(_,e,a,h){Ns(_,e-a/2,0,a,_.transform.height,h)}function Ns(_,e,a,h,f,y){const T=_.context,P=T.gl;P.enable(P.SCISSOR_TEST),P.scissor(e*_.pixelRatio,a*_.pixelRatio,h*_.pixelRatio,f*_.pixelRatio),T.clear({color:y}),P.disable(P.SCISSOR_TEST)}function vc(_,e,a){const h=_.context,f=h.gl,y=a.posMatrix,T=_.useProgram("debug"),P=ai.disabled,E=nn.disabled,k=_.colorModeForRenderPass(),R="$debug",O=_.style.map.terrain&&_.style.map.terrain.getTerrainData(a);h.activeTexture.set(f.TEXTURE0);const Z=e.getTileByID(a.key).latestRawTileData,tt=Math.floor((Z&&Z.byteLength||0)/1024),Q=e.getTile(a).tileSize,it=512/Math.min(Q,512)*(a.overscaledZ/_.transform.zoom)*.5;let Y=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Y+=` => ${a.overscaledZ}`),function(ft,St){ft.initDebugOverlayCanvas();const st=ft.debugOverlayCanvas,gt=ft.context.gl,It=ft.debugOverlayCanvas.getContext("2d");It.clearRect(0,0,st.width,st.height),It.shadowColor="white",It.shadowBlur=2,It.lineWidth=1.5,It.strokeStyle="white",It.textBaseline="top",It.font="bold 36px Open Sans, sans-serif",It.fillText(St,5,5),It.strokeText(St,5,5),ft.debugOverlayTexture.update(st),ft.debugOverlayTexture.bind(gt.LINEAR,gt.CLAMP_TO_EDGE)}(_,`${Y} ${tt}kB`),T.draw(h,f.TRIANGLES,P,E,Ui.alphaBlended,Ki.disabled,is(y,c.aT.transparent,it),null,R,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),T.draw(h,f.LINE_STRIP,P,E,k,Ki.disabled,is(y,c.aT.red),O,R,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function Ri(_,e,a){const h=_.context,f=h.gl,y=_.colorModeForRenderPass(),T=new ai(f.LEQUAL,ai.ReadWrite,_.depthRangeFor3D),P=_.useProgram("terrain"),E=e.getTerrainMesh();h.bindFramebuffer.set(null),h.viewport.set([0,0,_.width,_.height]);for(const k of a){const R=_.renderToTexture.getTexture(k),O=e.getTerrainData(k.tileID);h.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,R.texture);const Z={u_matrix:_.transform.calculatePosMatrix(k.tileID.toUnwrapped()),u_texture:0,u_ele_delta:e.getMeshFrameDelta(_.transform.zoom)};P.draw(h,f.TRIANGLES,T,nn.disabled,y,Ki.backCCW,Z,O,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class as{constructor(e,a){this.context=new lu(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.Z(),renderTime:0},this.setup(),this.numSublayers=Yt.maxUnderzooming+Yt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Eo}resize(e,a,h){if(this.width=Math.floor(e*h),this.height=Math.floor(a*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const e=this.context,a=new c.a_;a.emplaceBack(0,0),a.emplaceBack(c.N,0),a.emplaceBack(0,c.N),a.emplaceBack(c.N,c.N),this.tileExtentBuffer=e.createVertexBuffer(a,ts.members),this.tileExtentSegments=c.S.simpleSegment(0,0,4,2);const h=new c.a_;h.emplaceBack(0,0),h.emplaceBack(c.N,0),h.emplaceBack(0,c.N),h.emplaceBack(c.N,c.N),this.debugBuffer=e.createVertexBuffer(h,ts.members),this.debugSegments=c.S.simpleSegment(0,0,4,5);const f=new c.V;f.emplaceBack(0,0,0,0),f.emplaceBack(c.N,0,c.N,0),f.emplaceBack(0,c.N,0,c.N),f.emplaceBack(c.N,c.N,c.N,c.N),this.rasterBoundsBuffer=e.createVertexBuffer(f,Ge.members),this.rasterBoundsSegments=c.S.simpleSegment(0,0,4,2);const y=new c.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,ts.members),this.viewportSegments=c.S.simpleSegment(0,0,4,2);const T=new c.a$;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(T);const P=new c.b0;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(P);const E=this.context.gl;this.stencilClearMode=new nn({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=c.Z();c.aS(h,0,this.width,this.height,0,0,1),c.a0(h,h,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,a.TRIANGLES,ai.disabled,this.stencilClearMode,Ui.disabled,Ki.disabled,Ms(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source;const h=this.context,f=h.gl;this.nextStencilID+a.length>256&&this.clearStencil(),h.setColorMode(Ui.disabled),h.setDepthMode(ai.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of a){const P=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);y.draw(h,f.TRIANGLES,ai.disabled,new nn({func:f.ALWAYS,mask:0},P,255,f.KEEP,f.KEEP,f.REPLACE),Ui.disabled,Ki.disabled,Ms(T.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new nn({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new nn({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(e){const a=this.context.gl,h=e.sort((T,P)=>P.overscaledZ-T.overscaledZ),f=h[h.length-1].overscaledZ,y=h[0].overscaledZ-f+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const T={};for(let P=0;P<y;P++)T[P+f]=new nn({func:a.GEQUAL,mask:255},P+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[T,h]}return[{[f]:nn.disabled},h]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ui([e.CONSTANT_COLOR,e.ONE],new c.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ui.unblended:Ui.alphaBlended}depthModeForSublayer(e,a,h){if(!this.opaquePassEnabledForLayer())return ai.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ai(h||this.context.gl.LEQUAL,a,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(c.h.now()),this.imageManager.beginFrame();const h=this.style._order,f=this.style.sourceCaches,y={},T={},P={};for(const E in f){const k=f[E];k.used&&k.prepare(this.context),y[E]=k.getVisibleCoordinates(),T[E]=y[E].slice().reverse(),P[E]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<h.length;E++)if(this.style._layers[h[E]].is3D()){this.opaquePassCutoff=E;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const E=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!c.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||E.length)&&(c.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(k,R){const O=k.context,Z=O.gl,tt=Ui.unblended,Q=new ai(Z.LEQUAL,ai.ReadWrite,[0,1]),it=R.getTerrainMesh(),Y=R.sourceCache.getRenderableTiles(),ft=k.useProgram("terrainDepth");O.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),O.clear({color:c.aT.transparent,depth:1});for(const St of Y){const st=R.getTerrainData(St.tileID),gt={u_matrix:k.transform.calculatePosMatrix(St.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(k.transform.zoom)};ft.draw(O,Z.TRIANGLES,Q,nn.disabled,tt,Ki.backCCW,gt,st,"terrain",it.vertexBuffer,it.indexBuffer,it.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain),function(k,R){const O=k.context,Z=O.gl,tt=Ui.unblended,Q=new ai(Z.LEQUAL,ai.ReadWrite,[0,1]),it=R.getTerrainMesh(),Y=R.getCoordsTexture(),ft=R.sourceCache.getRenderableTiles(),St=k.useProgram("terrainCoords");O.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),O.clear({color:c.aT.transparent,depth:1}),R.coordsIndex=[];for(const st of ft){const gt=R.getTerrainData(st.tileID);O.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,Y.texture);const It={u_matrix:k.transform.calculatePosMatrix(st.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(k.transform.zoom)};St.draw(O,Z.TRIANGLES,Q,nn.disabled,tt,Ki.backCCW,It,gt,"terrain",it.vertexBuffer,it.indexBuffer,it.segments),R.coordsIndex.push(st.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const E of h){const k=this.style._layers[E];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const R=T[k.source];(k.type==="custom"||R.length)&&this.renderLayer(this,f[k.source],k,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?c.aT.black:c.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[h[this.currentLayer]],k=f[E.source],R=y[E.source];this._renderTileClippingMasks(E,R),this.renderLayer(this,k,E,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const E=this.style._layers[h[this.currentLayer]],k=f[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const R=(E.type==="symbol"?P:T)[E.source];this._renderTileClippingMasks(E,y[E.source]),this.renderLayer(this,k,E,R)}if(this.options.showTileBoundaries){const E=function(k,R){let O=null;const Z=Object.values(k._layers).flatMap(Y=>Y.source&&!Y.isHidden(R)?[k.sourceCaches[Y.source]]:[]),tt=Z.filter(Y=>Y.getSource().type==="vector"),Q=Z.filter(Y=>Y.getSource().type!=="vector"),it=Y=>{(!O||O.getSource().maxzoom<Y.getSource().maxzoom)&&(O=Y)};return tt.forEach(Y=>it(Y)),O||Q.forEach(Y=>it(Y)),O}(this.style,this.transform.zoom);E&&function(k,R,O){for(let Z=0;Z<O.length;Z++)vc(k,R,O[Z])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const k=E.transform.padding;Do(E,E.transform.height-(k.top||0),3,Os),Do(E,k.bottom||0,3,_a),Qa(E,k.left||0,3,Fs),Qa(E,E.transform.width-(k.right||0),3,yc);const R=E.transform.centerPoint;(function(O,Z,tt,Q){Ns(O,Z-1,tt-10,2,20,Q),Ns(O,Z-10,tt-1,20,2,Q)})(E,R.x,E.transform.height-R.y,uo)}(this),this.context.setDefault()}renderLayer(e,a,h,f){if(!h.isHidden(this.transform.zoom)&&(h.type==="background"||h.type==="custom"||(f||[]).length))switch(this.id=h.id,h.type){case"symbol":(function(y,T,P,E,k){if(y.renderPass!=="translucent")return;const R=nn.disabled,O=y.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Z,tt,Q,it,Y,ft,St){const st=tt.transform,gt=Y==="map",It=ft==="map";for(const Ct of Z){const kt=it.getTile(Ct),Gt=kt.getBucket(Q);if(!Gt||!Gt.text||!Gt.text.segments.get().length)continue;const Ot=c.ah(Gt.textSizeData,st.zoom),Xt=pt(kt,1,tt.transform.zoom),Se=Wt(Ct.posMatrix,It,gt,tt.transform,Xt),vi=Q.layout.get("icon-text-fit")!=="none"&&Gt.hasIconData();if(Ot){const se=Math.pow(2,st.zoom-kt.tileID.overscaledZ);Xa(Gt,gt,It,St,st,Se,Ct.posMatrix,se,Ot,vi,tt.style.map.terrain?(Ne,Ie)=>tt.style.map.terrain.getElevation(Ct,Ne,Ie):null)}}}(E,y,P,T,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),k),P.paint.get("icon-opacity").constantOr(1)!==0&&Ja(y,T,P,E,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),R,O),P.paint.get("text-opacity").constantOr(1)!==0&&Ja(y,T,P,E,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),R,O),T.map.showCollisionBoxes&&(Wa(y,T,P,E,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),!0),Wa(y,T,P,E,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),!1))})(e,a,h,f,this.style.placement.variableOffsets);break;case"circle":(function(y,T,P,E){if(y.renderPass!=="translucent")return;const k=P.paint.get("circle-opacity"),R=P.paint.get("circle-stroke-width"),O=P.paint.get("circle-stroke-opacity"),Z=!P.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(R.constantOr(1)===0||O.constantOr(1)===0))return;const tt=y.context,Q=tt.gl,it=y.depthModeForSublayer(0,ai.ReadOnly),Y=nn.disabled,ft=y.colorModeForRenderPass(),St=[];for(let st=0;st<E.length;st++){const gt=E[st],It=T.getTile(gt),Ct=It.getBucket(P);if(!Ct)continue;const kt=Ct.programConfigurations.get(P.id),Gt=y.useProgram("circle",kt),Ot=Ct.layoutVertexBuffer,Xt=Ct.indexBuffer,Se=y.style.map.terrain&&y.style.map.terrain.getTerrainData(gt),vi={programConfiguration:kt,program:Gt,layoutVertexBuffer:Ot,indexBuffer:Xt,uniformValues:vr(y,gt,It,P),terrainData:Se};if(Z){const se=Ct.segments.get();for(const Ne of se)St.push({segments:new c.S([Ne]),sortKey:Ne.sortKey,state:vi})}else St.push({segments:Ct.segments,sortKey:0,state:vi})}Z&&St.sort((st,gt)=>st.sortKey-gt.sortKey);for(const st of St){const{programConfiguration:gt,program:It,layoutVertexBuffer:Ct,indexBuffer:kt,uniformValues:Gt,terrainData:Ot}=st.state;It.draw(tt,Q.TRIANGLES,it,Y,ft,Ki.disabled,Gt,Ot,P.id,Ct,kt,st.segments,P.paint,y.transform.zoom,gt)}})(e,a,h,f);break;case"heatmap":(function(y,T,P,E){if(P.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const k=y.context,R=k.gl,O=nn.disabled,Z=new Ui([R.ONE,R.ONE],c.aT.transparent,[!0,!0,!0,!0]);(function(tt,Q,it){const Y=tt.gl;tt.activeTexture.set(Y.TEXTURE1),tt.viewport.set([0,0,Q.width/4,Q.height/4]);let ft=it.heatmapFbo;if(ft)Y.bindTexture(Y.TEXTURE_2D,ft.colorAttachment.get()),tt.bindFramebuffer.set(ft.framebuffer);else{const St=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,St),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),ft=it.heatmapFbo=tt.createFramebuffer(Q.width/4,Q.height/4,!1,!1),function(st,gt,It,Ct){var kt,Gt;const Ot=st.gl,Xt=(kt=st.HALF_FLOAT)!==null&&kt!==void 0?kt:Ot.UNSIGNED_BYTE,Se=(Gt=st.RGBA16F)!==null&&Gt!==void 0?Gt:Ot.RGBA;Ot.texImage2D(Ot.TEXTURE_2D,0,Se,gt.width/4,gt.height/4,0,Ot.RGBA,Xt,null),Ct.colorAttachment.set(It)}(tt,Q,St,ft)}})(k,y,P),k.clear({color:c.aT.transparent});for(let tt=0;tt<E.length;tt++){const Q=E[tt];if(T.hasRenderableParent(Q))continue;const it=T.getTile(Q),Y=it.getBucket(P);if(!Y)continue;const ft=Y.programConfigurations.get(P.id),St=y.useProgram("heatmap",ft),{zoom:st}=y.transform;St.draw(k,R.TRIANGLES,ai.disabled,O,Z,Ki.disabled,Pl(Q.posMatrix,it,st,P.paint.get("heatmap-intensity")),null,P.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,P.paint,y.transform.zoom,ft)}k.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(k,R){const O=k.context,Z=O.gl,tt=R.heatmapFbo;if(!tt)return;O.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,tt.colorAttachment.get()),O.activeTexture.set(Z.TEXTURE1);let Q=R.colorRampTexture;Q||(Q=R.colorRampTexture=new ce(O,R.colorRamp,Z.RGBA)),Q.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(O,Z.TRIANGLES,ai.disabled,nn.disabled,k.colorModeForRenderPass(),Ki.disabled,((it,Y,ft,St)=>{const st=c.Z();c.aS(st,0,it.width,it.height,0,0,1);const gt=it.context.gl;return{u_matrix:st,u_world:[gt.drawingBufferWidth,gt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Y.paint.get("heatmap-opacity")}})(k,R),null,R.id,k.viewportBuffer,k.quadTriangleIndexBuffer,k.viewportSegments,R.paint,k.transform.zoom)}(y,P))})(e,a,h,f);break;case"line":(function(y,T,P,E){if(y.renderPass!=="translucent")return;const k=P.paint.get("line-opacity"),R=P.paint.get("line-width");if(k.constantOr(1)===0||R.constantOr(1)===0)return;const O=y.depthModeForSublayer(0,ai.ReadOnly),Z=y.colorModeForRenderPass(),tt=P.paint.get("line-dasharray"),Q=P.paint.get("line-pattern"),it=Q.constantOr(1),Y=P.paint.get("line-gradient"),ft=P.getCrossfadeParameters(),St=it?"linePattern":tt?"lineSDF":Y?"lineGradient":"line",st=y.context,gt=st.gl;let It=!0;for(const Ct of E){const kt=T.getTile(Ct);if(it&&!kt.patternsLoaded())continue;const Gt=kt.getBucket(P);if(!Gt)continue;const Ot=Gt.programConfigurations.get(P.id),Xt=y.context.program.get(),Se=y.useProgram(St,Ot),vi=It||Se.program!==Xt,se=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ct),Ne=Q.constantOr(null);if(Ne&&kt.imageAtlas){const gi=kt.imageAtlas,oi=gi.patternPositions[Ne.to.toString()],xi=gi.patternPositions[Ne.from.toString()];oi&&xi&&Ot.setConstantPatternPositions(oi,xi)}const Ie=se?Ct:null,qi=it?Al(y,kt,P,ft,Ie):tt?ca(y,kt,P,tt,ft,Ie):Y?Fa(y,kt,P,Gt.lineClipsArray.length,Ie):ks(y,kt,P,Ie);if(it)st.activeTexture.set(gt.TEXTURE0),kt.imageAtlasTexture.bind(gt.LINEAR,gt.CLAMP_TO_EDGE),Ot.updatePaintBuffers(ft);else if(tt&&(vi||y.lineAtlas.dirty))st.activeTexture.set(gt.TEXTURE0),y.lineAtlas.bind(st);else if(Y){const gi=Gt.gradients[P.id];let oi=gi.texture;if(P.gradientVersion!==gi.version){let xi=256;if(P.stepInterpolant){const yn=T.getSource().maxzoom,rn=Ct.canonical.z===yn?Math.ceil(1<<y.transform.maxZoom-Ct.canonical.z):1;xi=c.ad(c.aY(Gt.maxLineLength/c.N*1024*rn),256,st.maxTextureSize)}gi.gradient=c.aZ({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:xi,image:gi.gradient||void 0,clips:Gt.lineClipsArray}),gi.texture?gi.texture.update(gi.gradient):gi.texture=new ce(st,gi.gradient,gt.RGBA),gi.version=P.gradientVersion,oi=gi.texture}st.activeTexture.set(gt.TEXTURE0),oi.bind(P.stepInterpolant?gt.NEAREST:gt.LINEAR,gt.CLAMP_TO_EDGE)}Se.draw(st,gt.TRIANGLES,O,y.stencilModeForClipping(Ct),Z,Ki.disabled,qi,se,P.id,Gt.layoutVertexBuffer,Gt.indexBuffer,Gt.segments,P.paint,y.transform.zoom,Ot,Gt.layoutVertexBuffer2),It=!1}})(e,a,h,f);break;case"fill":(function(y,T,P,E){const k=P.paint.get("fill-color"),R=P.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const O=y.colorModeForRenderPass(),Z=P.paint.get("fill-pattern"),tt=y.opaquePassEnabledForLayer()&&!Z.constantOr(1)&&k.constantOr(c.aT.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===tt){const Q=y.depthModeForSublayer(1,y.renderPass==="opaque"?ai.ReadWrite:ai.ReadOnly);ma(y,T,P,E,Q,O,!1)}if(y.renderPass==="translucent"&&P.paint.get("fill-antialias")){const Q=y.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,ai.ReadOnly);ma(y,T,P,E,Q,O,!0)}})(e,a,h,f);break;case"fill-extrusion":(function(y,T,P,E){const k=P.paint.get("fill-extrusion-opacity");if(k!==0&&y.renderPass==="translucent"){const R=new ai(y.context.gl.LEQUAL,ai.ReadWrite,y.depthRangeFor3D);if(k!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))ur(y,T,P,E,R,nn.disabled,Ui.disabled),ur(y,T,P,E,R,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const O=y.colorModeForRenderPass();ur(y,T,P,E,R,nn.disabled,O)}}})(e,a,h,f);break;case"hillshade":(function(y,T,P,E){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const k=y.context,R=y.depthModeForSublayer(0,ai.ReadOnly),O=y.colorModeForRenderPass(),[Z,tt]=y.renderPass==="translucent"?y.stencilConfigForOverlap(E):[{},E];for(const Q of tt){const it=T.getTile(Q);it.needsHillshadePrepare!==void 0&&it.needsHillshadePrepare&&y.renderPass==="offscreen"?Ro(y,it,P,R,nn.disabled,O):y.renderPass==="translucent"&&cu(y,Q,it,P,R,Z[Q.overscaledZ],O)}k.viewport.set([0,0,y.width,y.height])})(e,a,h,f);break;case"raster":(function(y,T,P,E){if(y.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!E.length)return;const k=y.context,R=k.gl,O=T.getSource(),Z=y.useProgram("raster"),tt=y.colorModeForRenderPass(),[Q,it]=O instanceof ti?[{},E]:y.stencilConfigForOverlap(E),Y=it[it.length-1].overscaledZ,ft=!y.options.moving;for(const St of it){const st=y.depthModeForSublayer(St.overscaledZ-Y,P.paint.get("raster-opacity")===1?ai.ReadWrite:ai.ReadOnly,R.LESS),gt=T.getTile(St);gt.registerFadeDuration(P.paint.get("raster-fade-duration"));const It=T.findLoadedParent(St,0),Ct=uu(gt,It,T,P,y.transform,y.style.map.terrain);let kt,Gt;const Ot=P.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;k.activeTexture.set(R.TEXTURE0),gt.texture.bind(Ot,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(R.TEXTURE1),It?(It.texture.bind(Ot,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),kt=Math.pow(2,It.tileID.overscaledZ-gt.tileID.overscaledZ),Gt=[gt.tileID.canonical.x*kt%1,gt.tileID.canonical.y*kt%1]):gt.texture.bind(Ot,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const Xt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(St),Se=Xt?St:null,vi=Se?Se.posMatrix:y.transform.calculatePosMatrix(St.toUnwrapped(),ft),se=fc(vi,Gt||[0,0],kt||1,Ct,P);O instanceof ti?Z.draw(k,R.TRIANGLES,st,nn.disabled,tt,Ki.disabled,se,Xt,P.id,O.boundsBuffer,y.quadTriangleIndexBuffer,O.boundsSegments):Z.draw(k,R.TRIANGLES,st,Q[St.overscaledZ],tt,Ki.disabled,se,Xt,P.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(e,a,h,f);break;case"background":(function(y,T,P,E){const k=P.paint.get("background-color"),R=P.paint.get("background-opacity");if(R===0)return;const O=y.context,Z=O.gl,tt=y.transform,Q=tt.tileSize,it=P.paint.get("background-pattern");if(y.isPatternMissing(it))return;const Y=!it&&k.a===1&&R===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==Y)return;const ft=nn.disabled,St=y.depthModeForSublayer(0,Y==="opaque"?ai.ReadWrite:ai.ReadOnly),st=y.colorModeForRenderPass(),gt=y.useProgram(it?"backgroundPattern":"background"),It=E||tt.coveringTiles({tileSize:Q,terrain:y.style.map.terrain});it&&(O.activeTexture.set(Z.TEXTURE0),y.imageManager.bind(y.context));const Ct=P.getCrossfadeParameters();for(const kt of It){const Gt=E?kt.posMatrix:y.transform.calculatePosMatrix(kt.toUnwrapped()),Ot=it?Qn(Gt,R,y,it,{tileID:kt,tileSize:Q},Ct):Rs(Gt,R,k),Xt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(kt);gt.draw(O,Z.TRIANGLES,St,ft,st,Ki.disabled,Ot,Xt,P.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(e,0,h,f);break;case"custom":(function(y,T,P){const E=y.context,k=P.implementation;if(y.renderPass==="offscreen"){const R=k.prerender;R&&(y.setCustomLayerDefaults(),E.setColorMode(y.colorModeForRenderPass()),R.call(k,E.gl,y.transform.customLayerMatrix()),E.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),E.setColorMode(y.colorModeForRenderPass()),E.setStencilMode(nn.disabled);const R=k.renderingMode==="3d"?new ai(y.context.gl.LEQUAL,ai.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,ai.ReadOnly);E.setDepthMode(R),k.render(E.gl,y.transform.customLayerMatrix()),E.setDirty(),y.setBaseState(),E.bindFramebuffer.set(null)}})(e,0,h)}}translatePosMatrix(e,a,h,f,y){if(!h[0]&&!h[1])return e;const T=y?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(T){const k=Math.sin(T),R=Math.cos(T);h=[h[0]*R-h[1]*k,h[0]*k+h[1]*R]}const P=[y?h[0]:pt(a,h[0],this.transform.zoom),y?h[1]:pt(a,h[1],this.transform.zoom),0],E=new Float32Array(16);return c.$(E,e,P),E}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),h=this.imageManager.getPattern(e.to.toString());return!a||!h}useProgram(e,a){this.cache=this.cache||{};const h=e+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new Ls(this.context,Vi[e],a,Ds[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ce(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}class bn{constructor(e,a){this.points=e,this.planes=a}static fromInvProjectionMatrix(e,a,h){const f=Math.pow(2,h),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const E=1/(P=c.ag([],P,e))[3]/a*f;return c.b3(P,P,[E,E,1/P[3],E])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const E=function(Z,tt){var Q=tt[0],it=tt[1],Y=tt[2],ft=Q*Q+it*it+Y*Y;return ft>0&&(ft=1/Math.sqrt(ft)),Z[0]=tt[0]*ft,Z[1]=tt[1]*ft,Z[2]=tt[2]*ft,Z}([],function(Z,tt,Q){var it=tt[0],Y=tt[1],ft=tt[2],St=Q[0],st=Q[1],gt=Q[2];return Z[0]=Y*gt-ft*st,Z[1]=ft*St-it*gt,Z[2]=it*st-Y*St,Z}([],te([],y[P[0]],y[P[1]]),te([],y[P[2]],y[P[1]]))),k=-((R=E)[0]*(O=y[P[1]])[0]+R[1]*O[1]+R[2]*O[2]);var R,O;return E.concat(k)});return new bn(y,T)}}class Us{constructor(e,a){this.min=e,this.max=a,this.center=function(h,f,y){return h[0]=.5*f[0],h[1]=.5*f[1],h[2]=.5*f[2],h}([],function(h,f,y){return h[0]=f[0]+y[0],h[1]=f[1]+y[1],h[2]=f[2]+y[2],h}([],this.min,this.max))}quadrant(e){const a=[e%2==0,e<2],h=Le(this.min),f=Le(this.max);for(let y=0;y<a.length;y++)h[y]=a[y]?this.min[y]:this.center[y],f[y]=a[y]?this.center[y]:this.max[y];return f[2]=this.max[2],new Us(h,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let f=0;f<e.planes.length;f++){const y=e.planes[f];let T=0;for(let P=0;P<a.length;P++)c.b4(y,a[P])>=0&&T++;if(T===0)return 0;T!==a.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let y=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let P=0;P<e.points.length;P++){const E=e.points[P][f]-this.min[f];y=Math.min(y,E),T=Math.max(T,E)}if(T<0||y>this.max[f]-this.min[f])return 0}return 1}}class hr{constructor(e=0,a=0,h=0,f=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=h,this.right=f}interpolate(e,a,h){return a.top!=null&&e.top!=null&&(this.top=c.B.number(e.top,a.top,h)),a.bottom!=null&&e.bottom!=null&&(this.bottom=c.B.number(e.bottom,a.bottom,h)),a.left!=null&&e.left!=null&&(this.left=c.B.number(e.left,a.left,h)),a.right!=null&&e.right!=null&&(this.right=c.B.number(e.right,a.right,h)),this}getCenter(e,a){const h=c.ad((this.left+e-this.right)/2,0,e),f=c.ad((this.top+a-this.bottom)/2,0,a);return new c.P(h,f)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new hr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ls{constructor(e,a,h,f,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=e||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=f??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new hr,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const e=new ls(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this._minEleveationForCurrentTile=e._minEleveationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const a=-c.b5(e,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var h=new c.A(4);return c.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}(),function(h,f,y){var T=f[0],P=f[1],E=f[2],k=f[3],R=Math.sin(y),O=Math.cos(y);h[0]=T*O+E*R,h[1]=P*O+k*R,h[2]=T*-R+E*O,h[3]=P*-R+k*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const a=c.ad(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const a=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,h){this._unmodified=!1,this._edgeInsets.interpolate(e,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const a=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(e){const a=[new c.b6(0,e)];if(this._renderWorldCopies){const h=this.pointCoordinate(new c.P(0,0)),f=this.pointCoordinate(new c.P(this.width,0)),y=this.pointCoordinate(new c.P(this.width,this.height)),T=this.pointCoordinate(new c.P(0,this.height)),P=Math.floor(Math.min(h.x,f.x,y.x,T.x)),E=Math.floor(Math.max(h.x,f.x,y.x,T.x)),k=1;for(let R=P-k;R<=E+k;R++)R!==0&&a.push(new c.b6(R,e))}return a}coveringTiles(e){var a,h;let f=this.coveringZoomLevel(e);const y=f;if(e.minzoom!==void 0&&f<e.minzoom)return[];e.maxzoom!==void 0&&f>e.maxzoom&&(f=e.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),P=c.U.fromLngLat(this.center),E=Math.pow(2,f),k=[E*T.x,E*T.y,0],R=[E*P.x,E*P.y,0],O=bn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let Z=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Z=f);const tt=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,Q=st=>({aabb:new Us([st*E,0,0],[(st+1)*E,E,0]),zoom:0,x:0,y:0,wrap:st,fullyVisible:!1}),it=[],Y=[],ft=f,St=e.reparseOverscaled?y:f;if(this._renderWorldCopies)for(let st=1;st<=3;st++)it.push(Q(-st)),it.push(Q(st));for(it.push(Q(0));it.length>0;){const st=it.pop(),gt=st.x,It=st.y;let Ct=st.fullyVisible;if(!Ct){const Se=st.aabb.intersects(O);if(Se===0)continue;Ct=Se===2}const kt=e.terrain?k:R,Gt=st.aabb.distanceX(kt),Ot=st.aabb.distanceY(kt),Xt=Math.max(Math.abs(Gt),Math.abs(Ot));if(st.zoom===ft||Xt>tt+(1<<ft-st.zoom)-2&&st.zoom>=Z){const Se=ft-st.zoom,vi=k[0]-.5-(gt<<Se),se=k[1]-.5-(It<<Se);Y.push({tileID:new c.O(st.zoom===ft?St:st.zoom,st.wrap,st.zoom,gt,It),distanceSq:Ce([R[0]-.5-gt,R[1]-.5-It]),tileDistanceToCamera:Math.sqrt(vi*vi+se*se)})}else for(let Se=0;Se<4;Se++){const vi=(gt<<1)+Se%2,se=(It<<1)+(Se>>1),Ne=st.zoom+1;let Ie=st.aabb.quadrant(Se);if(e.terrain){const qi=new c.O(Ne,st.wrap,Ne,vi,se),gi=e.terrain.getMinMaxElevation(qi),oi=(a=gi.minElevation)!==null&&a!==void 0?a:this.elevation,xi=(h=gi.maxElevation)!==null&&h!==void 0?h:this.elevation;Ie=new Us([Ie.min[0],Ie.min[1],oi],[Ie.max[0],Ie.max[1],xi])}it.push({aabb:Ie,zoom:Ne,x:vi,y:se,wrap:st.wrap,fullyVisible:Ct})}}return Y.sort((st,gt)=>st.distanceSq-gt.distanceSq).map(st=>st.tileID)}resize(e,a){this.width=e,this.height=a,this.pixelsToGLUnits=[2/e,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const a=c.ad(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new c.P(c.G(e.lng)*this.worldSize,c.H(a)*this.worldSize)}unproject(e){return new c.U(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const a=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(a,this.tileZoom);if(!(this.elevation-h))return;const f=this.getCameraPosition(),y=c.U.fromLngLat(f.lngLat,f.altitude),T=c.U.fromLngLat(a,h),P=y.x-T.x,E=y.y-T.y,k=y.z-T.z,R=Math.sqrt(P*P+E*E+k*k),O=this.scaleZoom(this.cameraToCenterDistance/R/this.tileSize);this._elevation=h,this._center=a,this.zoom=O}setLocationAtPoint(e,a){const h=this.pointCoordinate(a),f=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(e),T=new c.U(y.x-(h.x-f.x),y.y-(h.y-f.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,a){return a?this.coordinatePoint(this.locationCoordinate(e),a.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,a){return this.coordinateLocation(this.pointCoordinate(e,a))}locationCoordinate(e){return c.U.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,a){if(a){const Z=a.pointCoordinate(e);if(Z!=null)return Z}const h=[e.x,e.y,0,1],f=[e.x,e.y,1,1];c.ag(h,h,this.pixelMatrixInverse),c.ag(f,f,this.pixelMatrixInverse);const y=h[3],T=f[3],P=h[1]/y,E=f[1]/T,k=h[2]/y,R=f[2]/T,O=k===R?0:(0-k)/(R-k);return new c.U(c.B.number(h[0]/y,f[0]/T,O)/this.worldSize,c.B.number(P,E,O)/this.worldSize)}coordinatePoint(e,a=0,h=this.pixelMatrix){const f=[e.x*this.worldSize,e.y*this.worldSize,a,1];return c.ag(f,f,h),new c.P(f[0]/f[3],f[1]/f[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new je().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new je([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,a=!1){const h=e.key,f=a?this._alignedPosMatrixCache:this._posMatrixCache;if(f[h])return f[h];const y=e.canonical,T=this.worldSize/this.zoomScale(y.z),P=y.x+Math.pow(2,y.z)*e.wrap,E=c.ao(new Float64Array(16));return c.$(E,E,[P*T,y.y*T,0]),c.a0(E,E,[T/c.N,T/c.N,1]),c.a1(E,a?this.alignedProjMatrix:this.projMatrix,E),f[h]=new Float32Array(E),f[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,a,h,f,y=-90,T=90,P=-180,E=180;const k=this.size,R=this._unmodified;if(this.latRange){const tt=this.latRange;y=c.H(tt[1])*this.worldSize,T=c.H(tt[0])*this.worldSize,e=T-y<k.y?k.y/(T-y):0}if(this.lngRange){const tt=this.lngRange;P=c.b5(c.G(tt[0])*this.worldSize,0,this.worldSize),E=c.b5(c.G(tt[1])*this.worldSize,0,this.worldSize),E<P&&(E+=this.worldSize),a=E-P<k.x?k.x/(E-P):0}const O=this.point,Z=Math.max(a||0,e||0);if(Z)return this.center=this.unproject(new c.P(a?(E+P)/2:O.x,e?(T+y)/2:O.y)),this.zoom+=this.scaleZoom(Z),this._unmodified=R,void(this._constraining=!1);if(this.latRange){const tt=O.y,Q=k.y/2;tt-Q<y&&(f=y+Q),tt+Q>T&&(f=T-Q)}if(this.lngRange){const tt=(P+E)/2,Q=c.b5(O.x,tt-this.worldSize/2,tt+this.worldSize/2),it=k.x/2;Q-it<P&&(h=P+it),Q+it>E&&(h=E-it)}h===void 0&&f===void 0||(this.center=this.unproject(new c.P(h!==void 0?h:O.x,f!==void 0?f:O.y)).wrap()),this._unmodified=R,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,a=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b7(1,this.center.lat)*this.worldSize;let f=c.ao(new Float64Array(16));c.a0(f,f,[this.width/2,-this.height/2,1]),c.$(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=c.ao(new Float64Array(16)),c.a0(f,f,[1,-1,1]),c.$(f,f,[-1,-1,0]),c.a0(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this._minEleveationForCurrentTile),P=y-T*this._pixelPerMeter/Math.cos(this._pitch),E=T<0?P:y,k=Math.PI/2+this._pitch,R=this._fov*(.5+e.y/this.height),O=Math.sin(R)*E/Math.sin(c.ad(Math.PI-k-R,.01,Math.PI-.01)),Z=this.getHorizon(),tt=2*Math.atan(Z/this.cameraToCenterDistance)*(.5+e.y/(2*Z)),Q=Math.sin(tt)*E/Math.sin(c.ad(Math.PI-k-tt,.01,Math.PI-.01)),it=Math.min(O,Q),Y=1.01*(Math.cos(Math.PI/2-this._pitch)*it+E),ft=this.height/50;f=new Float64Array(16),c.b8(f,this._fov,this.width/this.height,ft,Y),f[8]=2*-e.x/this.width,f[9]=2*e.y/this.height,c.a0(f,f,[1,-1,1]),c.$(f,f,[0,0,-this.cameraToCenterDistance]),c.b9(f,f,this._pitch),c.ae(f,f,this.angle),c.$(f,f,[-a,-h,0]),this.mercatorMatrix=c.a0([],f,[this.worldSize,this.worldSize,this.worldSize]),c.a0(f,f,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.a1(new Float64Array(16),this.labelPlaneMatrix,f),c.$(f,f,[0,0,-this.elevation]),this.projMatrix=f,this.invProjMatrix=c.as([],f),this.pixelMatrix3D=c.a1(new Float64Array(16),this.labelPlaneMatrix,f);const St=this.width%2/2,st=this.height%2/2,gt=Math.cos(this.angle),It=Math.sin(this.angle),Ct=a-Math.round(a)+gt*St+It*st,kt=h-Math.round(h)+gt*st+It*St,Gt=new Float64Array(f);if(c.$(Gt,Gt,[Ct>.5?Ct-1:Ct,kt>.5?kt-1:kt,0]),this.alignedProjMatrix=Gt,f=c.as(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.ag(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const a=this.getCameraPoint();if(e.length===1)return[e[0],a];{let h=a.x,f=a.y,y=a.x,T=a.y;for(const P of e)h=Math.min(h,P.x),f=Math.min(f,P.y),y=Math.max(y,P.x),T=Math.max(T,P.y);return[new c.P(h,f),new c.P(y,f),new c.P(y,T),new c.P(h,T),new c.P(h,f)]}}}function Bo(_,e){let a,h=!1,f=null,y=null;const T=()=>{f=null,h&&(_.apply(y,a),f=setTimeout(T,e),h=!1)};return(...P)=>(h=!0,y=this,a=P,f||T(),f)}class cs{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(h=f)}),(h&&h[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}},this._updateHash=Bo(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const a=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,f=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,f),T=Math.round(a.lng*y)/y,P=Math.round(a.lat*y)/y,E=this._map.getBearing(),k=this._map.getPitch();let R="";if(R+=e?`/${T}/${P}/${h}`:`${h}/${P}/${T}`,(E||k)&&(R+="/"+Math.round(10*E)/10),k&&(R+=`/${Math.round(k)}`),this._hashName){const O=this._hashName;let Z=!1;const tt=window.location.hash.slice(1).split("&").map(Q=>{const it=Q.split("=")[0];return it===O?(Z=!0,`${it}=${R}`):Q}).filter(Q=>Q);return Z||tt.push(`${O}=${R}`),`#${tt.join("&")}`}return`#${R}`}}const ho={linearity:.3,easing:c.ba(0,0,.3,1)},tl=c.e({deceleration:2500,maxSpeed:1400},ho),ga=c.e({deceleration:20,maxSpeed:1400},ho),us=c.e({deceleration:1e3,maxSpeed:360},ho),ya=c.e({deceleration:1e3,maxSpeed:90},ho);class el{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.h.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=c.h.now();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const y=va(a.pan.mag(),h,c.e({},tl,e||{}));f.offset=a.pan.mult(y.amount/a.pan.mag()),f.center=this._map.transform.center,Br(f,y)}if(a.zoom){const y=va(a.zoom,h,ga);f.zoom=this._map.transform.zoom+y.amount,Br(f,y)}if(a.bearing){const y=va(a.bearing,h,us);f.bearing=this._map.transform.bearing+c.ad(y.amount,-179,179),Br(f,y)}if(a.pitch){const y=va(a.pitch,h,ya);f.pitch=this._map.transform.pitch+y.amount,Br(f,y)}if(f.zoom||f.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;f.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),c.e(f,{noMoveStart:!0})}}function Br(_,e){(!_.duration||_.duration<e.duration)&&(_.duration=e.duration,_.easing=e.easing)}function va(_,e,a){const{maxSpeed:h,linearity:f,deceleration:y}=a,T=c.ad(_*f/(e/1e3),-h,h),P=Math.abs(T)/(y*f);return{easing:a.easing,duration:1e3*P,amount:T*(P/2)}}class Vn extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,h,f={}){const y=D.mousePos(a.getCanvasContainer(),h),T=a.unproject(y);super(e,c.e({point:y,lngLat:T,originalEvent:h},f)),this._defaultPrevented=!1,this.target=a}}class xa extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,h){const f=e==="touchend"?h.changedTouches:h.touches,y=D.touchPos(a.getCanvasContainer(),f),T=y.map(E=>a.unproject(E)),P=y.reduce((E,k,R,O)=>E.add(k.div(O.length)),new c.P(0,0));super(e,{points:y,point:P,lngLats:T,lngLat:a.unproject(P),originalEvent:h}),this._defaultPrevented=!1}}class kl extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,h){super(e,{originalEvent:h}),this._defaultPrevented=!1}}class xc{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new kl(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new Vn(e.type,this._map,e))}mouseup(e){this._map.fire(new Vn(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Vn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Vn(e.type,this._map,e))}mouseover(e){this._map.fire(new Vn(e.type,this._map,e))}mouseout(e){this._map.fire(new Vn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new xa(e.type,this._map,e))}touchmove(e){this._map.fire(new xa(e.type,this._map,e))}touchend(e){this._map.fire(new xa(e.type,this._map,e))}touchcancel(e){this._map.fire(new xa(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zl{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Vn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Vn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class po{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class Or{constructor(e,a){this._map=e,this._tr=new po(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(D.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const h=a;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=h,this._box||(this._box=D.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const y=Math.min(f.x,h.x),T=Math.max(f.x,h.x),P=Math.min(f.y,h.y),E=Math.max(f.y,h.y);D.setTransform(this._box,`translate(${y}px,${P}px)`),this._box.style.width=T-y+"px",this._box.style.height=E-P+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const h=this._startPos,f=a;if(this.reset(),D.suppressClick(),h.x!==f.x||h.y!==f.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:y=>y.fitScreenCoordinates(h,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(D.remove(this._box),this._box=null),D.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new c.k(e,{originalEvent:a}))}}function jn(_,e){if(_.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${e.length}`);const a={};for(let h=0;h<_.length;h++)a[_[h].identifier]=e[h];return a}class fo{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),h.length===this.numTouches&&(this.centroid=function(f){const y=new c.P(0,0);for(const T of f)y._add(T);return y.div(f.length)}(a),this.touches=jn(h,a)))}touchmove(e,a,h){if(this.aborted||!this.centroid)return;const f=jn(h,a);for(const y in this.touches){const T=f[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(e,a,h){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class hs{constructor(e){this.singleTap=new fo(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,h){this.singleTap.touchstart(e,a,h)}touchmove(e,a,h){this.singleTap.touchmove(e,a,h)}touchend(e,a,h){const f=this.singleTap.touchend(e,a,h);if(f){const y=e.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(f)<30;if(y&&T||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class mo{constructor(e){this._tr=new po(e),this._zoomIn=new hs({numTouches:1,numTaps:2}),this._zoomOut=new hs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,h){this._zoomIn.touchstart(e,a,h),this._zoomOut.touchstart(e,a,h)}touchmove(e,a,h){this._zoomIn.touchmove(e,a,h),this._zoomOut.touchmove(e,a,h)}touchend(e,a,h){const f=this._zoomIn.touchend(e,a,h),y=this._zoomOut.touchend(e,a,h),T=this._tr;return f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(f)},{originalEvent:e})}):y?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(y)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const f=a.length?a[0]:a;return!this._moved&&f.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(h,f))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&D.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const hu={0:1,2:2};class ds{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=D.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(a,h){const f=hu[h];return a.buttons===void 0||(a.buttons&f)!==f}(e,this._eventButton)}isValidEndEvent(e){return D.mouseButton(e)===this._eventButton}}class bc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const _o=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=function(e){e.preventDefault()}},ps=({enable:_,clickTolerance:e,bearingDegreesPerPixelMoved:a=.8})=>{const h=new ds({checkCorrectEvent:f=>D.mouseButton(f)===0&&f.ctrlKey||D.mouseButton(f)===2});return new Jr({clickTolerance:e,move:(f,y)=>({bearingDelta:(y.x-f.x)*a}),moveStateManager:h,enable:_,assignEvents:_o})},Qr=({enable:_,clickTolerance:e,pitchDegreesPerPixelMoved:a=-.5})=>{const h=new ds({checkCorrectEvent:f=>D.mouseButton(f)===0&&f.ctrlKey||D.mouseButton(f)===2});return new Jr({clickTolerance:e,move:(f,y)=>({pitchDelta:(y.y-f.y)*a}),moveStateManager:h,enable:_,assignEvents:_o})};class _e{constructor(e,a){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(e,a,h){return this._calculateTransform(e,a,h)}touchmove(e,a,h){if(this._map._cooperativeGestures&&(this._minTouches===2&&h.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,h.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(h.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,a,h)}touchend(e,a,h){this._calculateTransform(e,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,h){h.length>0&&(this._active=!0);const f=jn(h,a),y=new c.P(0,0),T=new c.P(0,0);let P=0;for(const k in f){const R=f[k],O=this._touches[k];O&&(y._add(R),T._add(R.sub(O)),P++,f[k]=R)}if(this._touches=f,P<this._minTouches||!T.mag())return;const E=T.div(P);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(P),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class br{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,h){if(!this._firstTwoTouches)return;e.preventDefault();const[f,y]=this._firstTwoTouches,T=go(h,a,f),P=go(h,a,y);if(!T||!P)return;const E=this._aroundCenter?null:T.add(P).div(2);return this._move([T,P],E,e)}touchend(e,a,h){if(!this._firstTwoTouches)return;const[f,y]=this._firstTwoTouches,T=go(h,a,f),P=go(h,a,y);T&&P||(this._active&&D.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function go(_,e,a){for(let h=0;h<_.length;h++)if(_[h].identifier===a)return e[h]}function fs(_,e){return Math.log(_/e)/Math.LN2}class Vs extends br{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const h=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(fs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fs(this._distance,h),pinchAround:a}}}function le(_,e){return 180*_.angleWith(e)/Math.PI}class $s extends br{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:le(this._vector,h),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,h=le(e,this._startVector);return Math.abs(h)<a}}function ms(_){return Math.abs(_.y)>Math.abs(_.x)}class wc extends br{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,h){super.touchstart(e,a,h),this._currentTouchCount=h.length}_start(e){this._lastPoints=e,ms(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,h){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const f=e[0].sub(this._lastPoints[0]),y=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,y,h.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(f.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,h){if(this._valid!==void 0)return this._valid;const f=e.mag()>=2,y=a.mag()>=2;if(!f&&!y)return;if(!f||!y)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const T=e.y>0==a.y>0;return ms(e)&&ms(a)&&T}}const il={panStep:100,bearingStep:15,pitchStep:10};class Tc{constructor(e){this._tr=new po(e);const a=il;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,h=0,f=0,y=0,T=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?h=-1:(e.preventDefault(),y=-1);break;case 39:e.shiftKey?h=1:(e.preventDefault(),y=1);break;case 38:e.shiftKey?f=1:(e.preventDefault(),T=-1);break;case 40:e.shiftKey?f=-1:(e.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,f=0),{cameraAnimation:P=>{const E=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Rl,zoom:a?Math.round(E.zoom)+a*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+h*this._bearingStep,pitch:E.pitch+f*this._pitchStep,offset:[-y*this._panStep,-T*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rl(_){return _*(2-_)}const Dl=4.000244140625;class Sc{constructor(e,a){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=e,this._tr=new po(e),this._el=e.getCanvasContainer(),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!e[this._map._metaKey])return;e.preventDefault()}let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const h=c.h.now(),f=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%Dl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=D.mousePos(this._el,e),h=this._tr;this._around=c.L.convert(this._aroundCenter?h.center:h.unproject(a)),this._aroundPoint=h.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Dl?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&E!==0&&(E=1/E);const k=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(k*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,h=this._startZoom,f=this._easing;let y,T=!1;if(this._type==="wheel"&&h&&f){const P=Math.min((c.h.now()-this._lastWheelEventTime)/200,1),E=f(P);y=c.B.number(h,a,E),P<1?this._frameId||(this._frameId=!0):T=!0}else y=a,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:y-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=c.bb;if(this._prevEase){const h=this._prevEase,f=(c.h.now()-h.start)/h.duration,y=h.easing(f+.01)-h.easing(f),T=.27/Math.sqrt(y*y+1e-4)*.01,P=Math.sqrt(.0729-T*T);a=c.ba(T,P,.25,1)}return this._prevEase={start:c.h.now(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class nl{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rl{constructor(e){this._tr=new po(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bl{constructor(){this._tap=new hs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,h){if(!this._swipePoint)if(this._tapTime){const f=a[0],y=e.timeStamp-this._tapTime<500,T=this._tapPoint.dist(f)<30;y&&T?h.length>0&&(this._swipePoint=f,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(e,a,h)}touchmove(e,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const f=a[0],y=f.y-this._swipePoint.y;return this._swipePoint=f,e.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(e,a,h)}touchend(e,a,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const f=this._tap.touchend(e,a,h);f&&(this._tapTime=e.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ol{constructor(e,a,h){this._el=e,this._mousePan=a,this._touchPan=h}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gn{constructor(e,a,h){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Oo{constructor(e,a,h,f){this._el=e,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const s=_=>_.zoom||_.drag||_.pitch||_.rotate;class d extends c.k{}function b(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class C{constructor(e,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,y)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=f.type==="renderFrame"?void 0:f,P={needsRenderFrame:!1},E={},k={},R=f.touches,O=R?this._getMapTouches(R):void 0,Z=O?D.touchPos(this._el,O):D.mousePos(this._el,f);for(const{handlerName:it,handler:Y,allowed:ft}of this._handlers){if(!Y.isEnabled())continue;let St;this._blockedByActive(k,ft,it)?Y.reset():Y[y||f.type]&&(St=Y[y||f.type](f,Z,O),this.mergeHandlerResult(P,E,St,it,T),St&&St.needsRenderFrame&&this._triggerRenderFrame()),(St||Y.isActive())&&(k[it]=Y)}const tt={};for(const it in this._previousActiveHandlers)k[it]||(tt[it]=T);this._previousActiveHandlers=k,(Object.keys(tt).length||b(P))&&(this._changes.push([P,E,tt]),this._triggerRenderFrame()),(Object.keys(k).length||b(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=P;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new el(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,y,T]of this._listeners)D.addEventListener(f,y,f===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[e,a,h]of this._listeners)D.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(e){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new xc(a,e));const f=a.boxZoom=new Or(a,e);this._add("boxZoom",f),e.interactive&&e.boxZoom&&f.enable();const y=new mo(a),T=new rl(a);a.doubleClickZoom=new nl(T,y),this._add("tapZoom",y),this._add("clickZoom",T),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const P=new Bl;this._add("tapDragZoom",P);const E=a.touchPitch=new wc(a);this._add("touchPitch",E),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const k=ps(e),R=Qr(e);a.dragRotate=new Gn(e,k,R),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const O=(({enable:ft,clickTolerance:St})=>{const st=new ds({checkCorrectEvent:gt=>D.mouseButton(gt)===0&&!gt.ctrlKey});return new Jr({clickTolerance:St,move:(gt,It)=>({around:It,panDelta:It.sub(gt)}),activateOnStart:!0,moveStateManager:st,enable:ft,assignEvents:_o})})(e),Z=new _e(e,a);a.dragPan=new ol(h,O,Z),this._add("mousePan",O),this._add("touchPan",Z,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const tt=new $s,Q=new Vs;a.touchZoomRotate=new Oo(h,Q,tt,P),this._add("touchRotate",tt,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate);const it=a.scrollZoom=new Sc(a,()=>this._triggerRenderFrame());this._add("scrollZoom",it,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const Y=a.keyboard=new Tc(a);this._add("keyboard",Y),e.interactive&&e.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new zl(a))}_add(e,a,h){this._handlers.push({handlerName:e,handler:a,allowed:h}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!s(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,h){for(const f in e)if(f!==h&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const h of e)this._el.contains(h.target)&&a.push(h);return a}mergeHandlerResult(e,a,h,f,y){if(!h)return;c.e(e,h);const T={handlerName:f,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(a.zoom=T),h.panDelta!==void 0&&(a.drag=T),h.pitchDelta!==void 0&&(a.pitch=T),h.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const e={},a={},h={};for(const[f,y,T]of this._changes)f.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(f.panDelta)),f.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(e.around=f.around),f.pinchAround!==void 0&&(e.pinchAround=f.pinchAround),f.noInertia&&(e.noInertia=f.noInertia),c.e(a,y),c.e(h,T);this._updateMapTransform(e,a,h),this._changes=[]}_updateMapTransform(e,a,h){const f=this._map,y=f._getTransformForUpdate(),T=f.terrain;if(!(b(e)||T&&this._terrainMovement))return this._fireEvents(a,h,!0);let{panDelta:P,zoomDelta:E,bearingDelta:k,pitchDelta:R,around:O,pinchAround:Z}=e;Z!==void 0&&(O=Z),f._stop(!0),O=O||f.transform.centerPoint;const tt=y.pointLocation(P?O.sub(P):O);k&&(y.bearing+=k),R&&(y.pitch+=R),E&&(y.zoom+=E),T?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(P)):y.setLocationAtPoint(tt,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(tt,O),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(f.terrain)})):y.setLocationAtPoint(tt,O),f._applyUpdatedTransform(y),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,h,!0)}_fireEvents(e,a,h){const f=s(this._eventsInProgress),y=s(e),T={};for(const R in e){const{originalEvent:O}=e[R];this._eventsInProgress[R]||(T[`${R}start`]=O),this._eventsInProgress[R]=e[R]}!f&&y&&this._fireEvent("movestart",y.originalEvent);for(const R in T)this._fireEvent(R,T[R]);y&&this._fireEvent("move",y.originalEvent);for(const R in e){const{originalEvent:O}=e[R];this._fireEvent(R,O)}const P={};let E;for(const R in this._eventsInProgress){const{handlerName:O,originalEvent:Z}=this._eventsInProgress[R];this._handlersById[O].isActive()||(delete this._eventsInProgress[R],E=a[O]||Z,P[`${R}end`]=E)}for(const R in P)this._fireEvent(R,P[R]);const k=s(this._eventsInProgress);if(h&&(f||y)&&!k){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!R||!R.essential&&c.h.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:E})),O(this._map.getBearing())&&this._map.resetNorth()):(O(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new c.k(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new d("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class B extends c.E{constructor(e,a){super(),this._renderFrameCallback=()=>{const h=Math.min((c.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.L(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}panBy(e,a,h){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},a),h)}panTo(e,a,h){return this.easeTo(c.e({center:e},a),h)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,h){return this.easeTo(c.e({zoom:e},a),h)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,h){return this.easeTo(c.e({bearing:e},a),h)}resetNorth(e,a){return this.rotateTo(0,c.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}cameraForBounds(e,a){e=je.convert(e);const h=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),h,a)}_cameraForBoxAndBearing(e,a,h,f){const y={top:0,bottom:0,right:0,left:0};if(typeof(f=c.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const It=f.padding;f.padding={top:It,bottom:It,right:It,left:It}}f.padding=c.e(y,f.padding);const T=this.transform,P=T.padding,E=T.project(c.L.convert(e)),k=T.project(c.L.convert(a)),R=E.rotate(-h*Math.PI/180),O=k.rotate(-h*Math.PI/180),Z=new c.P(Math.max(R.x,O.x),Math.max(R.y,O.y)),tt=new c.P(Math.min(R.x,O.x),Math.min(R.y,O.y)),Q=Z.sub(tt),it=(T.width-(P.left+P.right+f.padding.left+f.padding.right))/Q.x,Y=(T.height-(P.top+P.bottom+f.padding.top+f.padding.bottom))/Q.y;if(Y<0||it<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ft=Math.min(T.scaleZoom(T.scale*Math.min(it,Y)),f.maxZoom),St=c.P.convert(f.offset),st=new c.P((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(h*Math.PI/180),gt=St.add(st).mult(T.scale/T.zoomScale(ft));return{center:T.unproject(E.add(k).div(2).sub(gt)),zoom:ft,bearing:h}}fitBounds(e,a,h){return this._fitInternal(this.cameraForBounds(e,a),a,h)}fitScreenCoordinates(e,a,h,f,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(a)),h,f),f,y)}_fitInternal(e,a,h){return e?(delete(a=c.e(e,a)).padding,a.linear?this.easeTo(a,h):this.flyTo(a,h)):this}jumpTo(e,a){this.stop();const h=this._getTransformForUpdate();let f=!1,y=!1,T=!1;return"zoom"in e&&h.zoom!==+e.zoom&&(f=!0,h.zoom=+e.zoom),e.center!==void 0&&(h.center=c.L.convert(e.center)),"bearing"in e&&h.bearing!==+e.bearing&&(y=!0,h.bearing=+e.bearing),"pitch"in e&&h.pitch!==+e.pitch&&(T=!0,h.pitch=+e.pitch),e.padding==null||h.isPaddingEqual(e.padding)||(h.padding=e.padding),this._applyUpdatedTransform(h),this.fire(new c.k("movestart",a)).fire(new c.k("move",a)),f&&this.fire(new c.k("zoomstart",a)).fire(new c.k("zoom",a)).fire(new c.k("zoomend",a)),y&&this.fire(new c.k("rotatestart",a)).fire(new c.k("rotate",a)).fire(new c.k("rotateend",a)),T&&this.fire(new c.k("pitchstart",a)).fire(new c.k("pitch",a)).fire(new c.k("pitchend",a)),this.fire(new c.k("moveend",a))}calculateCameraOptionsFromTo(e,a,h,f=0){const y=c.U.fromLngLat(e,a),T=c.U.fromLngLat(h,f),P=T.x-y.x,E=T.y-y.y,k=T.z-y.z,R=Math.hypot(P,E,k);if(R===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(P,E),Z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),tt=180*Math.atan2(P,-E)/Math.PI;let Q=180*Math.acos(O/R)/Math.PI;return Q=k<0?90-Q:90+Q,{center:T.toLngLat(),zoom:Z,pitch:Q,bearing:tt}}easeTo(e,a){this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.bb},e)).animate===!1||!e.essential&&c.h.prefersReducedMotion)&&(e.duration=0);const h=this._getTransformForUpdate(),f=this.getZoom(),y=this.getBearing(),T=this.getPitch(),P=this.getPadding(),E="zoom"in e?+e.zoom:f,k="bearing"in e?this._normalizeBearing(e.bearing,y):y,R="pitch"in e?+e.pitch:T,O="padding"in e?e.padding:h.padding,Z=c.P.convert(e.offset);let tt=h.centerPoint.add(Z);const Q=h.pointLocation(tt),it=c.L.convert(e.center||Q);this._normalizeCenter(it);const Y=h.project(Q),ft=h.project(it).sub(Y),St=h.zoomScale(E-f);let st,gt;e.around&&(st=c.L.convert(e.around),gt=h.locationPoint(st));const It={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==f,this._rotating=this._rotating||y!==k,this._pitching=this._pitching||R!==T,this._padding=!h.isPaddingEqual(O),this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,It),this.terrain&&this._prepareElevation(it),this._ease(Ct=>{if(this._zooming&&(h.zoom=c.B.number(f,E,Ct)),this._rotating&&(h.bearing=c.B.number(y,k,Ct)),this._pitching&&(h.pitch=c.B.number(T,R,Ct)),this._padding&&(h.interpolatePadding(P,O,Ct),tt=h.centerPoint.add(Z)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ct),st)h.setLocationAtPoint(st,gt);else{const kt=h.zoomScale(h.zoom-f),Gt=E>f?Math.min(2,St):Math.max(.5,St),Ot=Math.pow(Gt,1-Ct),Xt=h.unproject(Y.add(ft.mult(Ct*Ot)).mult(kt));h.setLocationAtPoint(h.renderWorldCopies?Xt.wrap():Xt,tt)}this._applyUpdatedTransform(h),this._fireMoveEvents(a)},Ct=>{this.terrain&&this._finalizeElevation(),this._afterEase(a,Ct)},e),this}_prepareEase(e,a,h={}){this._moving=!0,a||h.moving||this.fire(new c.k("movestart",e)),this._zooming&&!h.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!h.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!h.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(h-(a-(h*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.elevation=c.B.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;const a=e.clone(),{center:h,zoom:f,pitch:y,bearing:T,elevation:P}=this.transformCameraUpdate(a);h&&(a.center=h),f!==void 0&&(a.zoom=f),y!==void 0&&(a.pitch=y),T!==void 0&&(a.bearing=T),P!==void 0&&(a.elevation=P),this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const h=this._zooming,f=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new c.k("zoomend",e)),f&&this.fire(new c.k("rotateend",e)),y&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,a){if(!e.essential&&c.h.prefersReducedMotion){const Ie=c.F(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ie,a)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.bb},e);const h=this._getTransformForUpdate(),f=this.getZoom(),y=this.getBearing(),T=this.getPitch(),P=this.getPadding(),E="zoom"in e?c.ad(+e.zoom,h.minZoom,h.maxZoom):f,k="bearing"in e?this._normalizeBearing(e.bearing,y):y,R="pitch"in e?+e.pitch:T,O="padding"in e?e.padding:h.padding,Z=h.zoomScale(E-f),tt=c.P.convert(e.offset);let Q=h.centerPoint.add(tt);const it=h.pointLocation(Q),Y=c.L.convert(e.center||it);this._normalizeCenter(Y);const ft=h.project(it),St=h.project(Y).sub(ft);let st=e.curve;const gt=Math.max(h.width,h.height),It=gt/Z,Ct=St.mag();if("minZoom"in e){const Ie=c.ad(Math.min(e.minZoom,f,E),h.minZoom,h.maxZoom),qi=gt/h.zoomScale(Ie-f);st=Math.sqrt(qi/Ct*2)}const kt=st*st;function Gt(Ie){const qi=(It*It-gt*gt+(Ie?-1:1)*kt*kt*Ct*Ct)/(2*(Ie?It:gt)*kt*Ct);return Math.log(Math.sqrt(qi*qi+1)-qi)}function Ot(Ie){return(Math.exp(Ie)-Math.exp(-Ie))/2}function Xt(Ie){return(Math.exp(Ie)+Math.exp(-Ie))/2}const Se=Gt(!1);let vi=function(Ie){return Xt(Se)/Xt(Se+st*Ie)},se=function(Ie){return gt*((Xt(Se)*(Ot(qi=Se+st*Ie)/Xt(qi))-Ot(Se))/kt)/Ct;var qi},Ne=(Gt(!0)-Se)/st;if(Math.abs(Ct)<1e-6||!isFinite(Ne)){if(Math.abs(gt-It)<1e-6)return this.easeTo(e,a);const Ie=It<gt?-1:1;Ne=Math.abs(Math.log(It/gt))/st,se=function(){return 0},vi=function(qi){return Math.exp(Ie*st*qi)}}return e.duration="duration"in e?+e.duration:1e3*Ne/("screenSpeed"in e?+e.screenSpeed/st:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=y!==k,this._pitching=R!==T,this._padding=!h.isPaddingEqual(O),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(Y),this._ease(Ie=>{const qi=Ie*Ne,gi=1/vi(qi);h.zoom=Ie===1?E:f+h.scaleZoom(gi),this._rotating&&(h.bearing=c.B.number(y,k,Ie)),this._pitching&&(h.pitch=c.B.number(T,R,Ie)),this._padding&&(h.interpolatePadding(P,O,Ie),Q=h.centerPoint.add(tt)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ie);const oi=Ie===1?Y:h.unproject(ft.add(St.mult(se(qi))).mult(gi));h.setLocationAtPoint(h.renderWorldCopies?oi.wrap():oi,Q),this._applyUpdatedTransform(h),this._fireMoveEvents(a)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(a)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,a)}if(!e){const h=this.handlers;h&&h.stop(!1)}return this}_ease(e,a,h){h.animate===!1||h.duration===0?(e(1),a()):(this._easeStart=c.h.now(),this._easeOptions=h,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=c.b5(e,-180,180);const h=Math.abs(e-a);return Math.abs(e-360-a)<h&&(e-=360),Math.abs(e+360-a)<h&&(e+=360),e}_normalizeCenter(e){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const h=e.lng-a.center.lng;e.lng+=h>180?-360:h<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.L.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}class j{constructor(e={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=D.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=D.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=D.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){D.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const h=this._map._getUIString(`AttributionControl.${a}`);e.title=h,e.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.sourceCaches;for(const f in a){const y=a[f];if(y.used||y.usedForTerrain){const T=y.getSource();T.attribution&&e.indexOf(T.attribution)<0&&e.push(T.attribution)}}e=e.filter(f=>String(f).trim()),e.sort((f,y)=>f.length-y.length),e=e.filter((f,y)=>{for(let T=y+1;T<e.length;T++)if(e[T].indexOf(f)>=0)return!1;return!0});const h=e.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,e.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class at{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=D.create("div","maplibregl-ctrl");const a=D.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){D.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Tt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const f of h)if(f.id===e)return void(f.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Et={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var $t=c.Q([{name:"a_pos3d",type:"Int16",components:3}]);class ye extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];const h={};for(const f of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))h[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),c.aS(f.posMatrix,0,c.N,0,c.N,0,1),this._tiles[f.key]=new Nt(f,this.tileSize));for(const f in this._tiles)h[f]||delete this._tiles[f]}freeRtt(e){for(const a in this._tiles){const h=this._tiles[a];(!e||h.tileID.equals(e)||h.tileID.isChildOf(e)||e.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const a={};for(const h of this._renderableTilesKeys){const f=this._tiles[h].tileID;if(f.canonical.equals(e.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16),c.aS(y.posMatrix,0,c.N,0,c.N,0,1),a[h]=y}else if(f.canonical.isChildOf(e.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16);const T=f.canonical.z-e.canonical.z,P=f.canonical.x-(f.canonical.x>>T<<T),E=f.canonical.y-(f.canonical.y>>T<<T),k=c.N>>T;c.aS(y.posMatrix,0,k,0,k,0,1),c.$(y.posMatrix,y.posMatrix,[-P*k,-E*k,0]),a[h]=y}else if(e.canonical.isChildOf(f.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16);const T=e.canonical.z-f.canonical.z,P=e.canonical.x-(e.canonical.x>>T<<T),E=e.canonical.y-(e.canonical.y>>T<<T),k=c.N>>T;c.aS(y.posMatrix,0,c.N,0,c.N,0,1),c.$(y.posMatrix,y.posMatrix,[P*k,E*k,0]),c.a0(y.posMatrix,y.posMatrix,[1/2**T,1/2**T,0]),a[h]=y}}return a}getSourceTile(e,a){const h=this.sourceCache._source;let f=e.overscaledZ-this.deltaZoom;if(f>h.maxzoom&&(f=h.maxzoom),f<h.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(f).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!y||!y.dem)&&a)for(;f>=h.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(e.scaledTo(f--).key);return y}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=e)}}class He{constructor(e,a,h){this.painter=e,this.sourceCache=new ye(a),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,h,f=c.N){var y;if(!(a>=0&&a<f&&h>=0&&h<f))return 0;const T=this.getTerrainData(e),P=(y=T.tile)===null||y===void 0?void 0:y.dem;if(!P)return 0;const E=function(Q,it,Y){var ft=it[0],St=it[1];return Q[0]=Y[0]*ft+Y[4]*St+Y[12],Q[1]=Y[1]*ft+Y[5]*St+Y[13],Q}([],[a/f*c.N,h/f*c.N],T.u_terrain_matrix),k=[E[0]*P.dim,E[1]*P.dim],R=Math.floor(k[0]),O=Math.floor(k[1]),Z=k[0]-R,tt=k[1]-O;return P.get(R,O)*(1-Z)*(1-tt)+P.get(R+1,O)*Z*(1-tt)+P.get(R,O+1)*(1-Z)*tt+P.get(R+1,O+1)*Z*tt}getElevationForLngLatZoom(e,a){const{tileID:h,mercatorX:f,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(h,f%c.N,y%c.N,c.N)}getElevation(e,a,h,f=c.N){return this.getDEMElevation(e,a,h,f)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const f=this.painter.context,y=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ce(f,y,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ce(f,new c.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ao([])}const a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new ce(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const h=a&&a+a.tileID.key+e.key;if(h&&!this._demMatrixCache[h]){const f=this.sourceCache.sourceCache._source.maxzoom;let y=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=f?y=e.canonical.z-f:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=e.canonical.x-(e.canonical.x>>y<<y),P=e.canonical.y-(e.canonical.y>>y<<y),E=c.bc(new Float64Array(16),[1/(c.N<<y),1/(c.N<<y),0]);c.$(E,E,[T*c.N,P*c.N,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,h=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ce(a.context,{width:h,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ce(a.context,{width:h,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(h,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,h,f))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,T=0;y<this._coordsTextureSize;y++)for(let P=0;P<this._coordsTextureSize;P++,T+=4)a[T+0]=255&P,a[T+1]=255&y,a[T+2]=P>>8<<4|y>>8,a[T+3]=0;const h=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new ce(e,h,e.gl.RGBA,{premultiply:!1});return f.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(e){const a=new Uint8Array(4),h=this.painter.context,f=h.gl;h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),h.bindFramebuffer.set(null);const y=a[0]+(a[2]>>4<<8),T=a[1]+((15&a[2])<<8),P=this.coordsIndex[255-a[3]],E=P&&this.sourceCache.getTileByID(P);if(!E)return null;const k=this._coordsTextureSize,R=(1<<E.tileID.canonical.z)*k;return new c.U(this._allowMercatorOverflow(e,(E.tileID.canonical.x*k+y)/R),(E.tileID.canonical.y*k+T)/R,this.getElevation(E.tileID,y,T,k))}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,a=new c.bd,h=new c.b0,f=this.meshSize,y=c.N/f,T=f*f;for(let O=0;O<=f;O++)for(let Z=0;Z<=f;Z++)a.emplaceBack(Z*y,O*y,0);for(let O=0;O<T;O+=f+1)for(let Z=0;Z<f;Z++)h.emplaceBack(Z+O,f+Z+O+1,f+Z+O+2),h.emplaceBack(Z+O,f+Z+O+2,Z+O+1);const P=a.length,E=P+2*(f+1);for(const O of[0,1])for(let Z=0;Z<=f;Z++)for(const tt of[0,1])a.emplaceBack(Z*y,O*c.N,tt);for(let O=0;O<2*f;O+=2)h.emplaceBack(E+O,E+O+1,E+O+3),h.emplaceBack(E+O,E+O+3,E+O+2),h.emplaceBack(P+O,P+O+3,P+O+1),h.emplaceBack(P+O,P+O+2,P+O+3);const k=a.length,R=k+2*(f+1);for(const O of[0,1])for(let Z=0;Z<=f;Z++)for(const tt of[0,1])a.emplaceBack(O*c.N,Z*y,tt);for(let O=0;O<2*f;O+=2)h.emplaceBack(k+O,k+O+1,k+O+3),h.emplaceBack(k+O,k+O+3,k+O+2),h.emplaceBack(R+O,R+O+3,R+O+1),h.emplaceBack(R+O,R+O+2,R+O+3);return this._mesh={indexBuffer:e.createIndexBuffer(h),vertexBuffer:e.createVertexBuffer(a,$t.members),segments:c.S.simpleSegment(0,0,a.length,h.length)},this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,a){var h;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(h=this.getMinMaxElevation(f).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,h={minElevation:null,maxElevation:null};return a&&a.dem&&(h.minElevation=a.dem.min*this.exaggeration,h.maxElevation=a.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(e,a){const h=c.U.fromLngLat(e.wrap()),f=(1<<a)*c.N,y=h.x*f,T=h.y*f,P=Math.floor(y/c.N),E=Math.floor(T/c.N);return{tileID:new c.O(a,0,a,P,E),mercatorX:y,mercatorY:T}}_allowMercatorOverflow(e,a){const h=e.x<this.painter.width/2;let f=c.bf(a);const y=this.painter.transform.center.lng;return h&&Math.sign(f)>0&&Math.sign(y)<0||!h&&Math.sign(f)<0&&Math.sign(y)>0?(f=360*Math.sign(y)+f,c.G(f)):a}}class yi{constructor(e,a,h){this._context=e,this._size=a,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new ce(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(h.texture),{id:e,fbo:a,texture:h,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>e.id!==a),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const $i={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class mn{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new yi(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(h=>!e._layers[h].isHidden(a)),this._coordsDescendingInv={};for(const h in e.sourceCaches){this._coordsDescendingInv[h]={};const f=e.sourceCaches[h].getVisibleCoordinates();for(const y of f){const T=this.terrain.sourceCache.getTerrainCoords(y);for(const P in T)this._coordsDescendingInv[h][P]||(this._coordsDescendingInv[h][P]=[]),this._coordsDescendingInv[h][P].push(T[P])}}this._coordsDescendingInvStr={};for(const h of e._order){const f=e._layers[h],y=f.source;if($i[f.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const T in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][T]=this._coordsDescendingInv[y][T].map(P=>P.key).sort().join()}}for(const h of this._renderableTiles)for(const f in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[f][h.tileID.key];y&&y!==h.rttCoords[f]&&(h.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const a=e.type,h=this.painter,f=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if($i[a]&&(this._prevType&&$i[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(e.id),!f))return!0;if($i[this._prevType]||$i[a]&&f){this._prevType=a;const y=this._stacks.length-1,T=this._stacks[y]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(Ri(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[y]){const k=this.pool.getObjectForId(P.rtt[y].id);if(k.stamp===P.rtt[y].stamp){this.pool.useObject(k);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),P.rtt[y]={id:E.id,stamp:E.stamp},h.context.bindFramebuffer.set(E.fbo.framebuffer),h.context.clear({color:c.aT.transparent,stencil:0}),h.currentStencilSource=void 0;for(let k=0;k<T.length;k++){const R=h.style._layers[T[k]],O=R.source?this._coordsDescendingInv[R.source][P.tileID.key]:[P.tileID];h.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),h._renderTileClippingMasks(R,O),h.renderLayer(h,h.style.sourceCaches[R.source],R,O),R.source&&(P.rttCoords[R.source]=this._coordsDescendingInvStr[R.source][P.tileID.key])}}return Ri(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),$i[a]}return!1}}const me=F,xe={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},to=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},Ol={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fl{constructor(e,a,h=!1){this.mousedown=T=>{this.startMouse(c.e({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),D.mousePos(this.element,T)),D.addEventListener(window,"mousemove",this.mousemove),D.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,D.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=D.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),D.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=D.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const f=e.dragRotate._mouseRotate.getClickTolerance(),y=e.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=ps({clickTolerance:f,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:P,bearingDegreesPerPixelMoved:E=.8})=>{const k=new bc;return new Jr({clickTolerance:P,move:(R,O)=>({bearingDelta:(O.x-R.x)*E}),moveStateManager:k,enable:T,assignEvents:to})})({clickTolerance:f,enable:!0}),this.map=e,h&&(this.mousePitch=Qr({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:P,pitchDegreesPerPixelMoved:E=-.5})=>{const k=new bc;return new Jr({clickTolerance:P,move:(R,O)=>({pitchDelta:(O.y-R.y)*E}),moveStateManager:k,enable:T,assignEvents:to})})({clickTolerance:y,enable:!0})),D.addEventListener(a,"mousedown",this.mousedown),D.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),D.addEventListener(a,"touchcancel",this.reset)}startMouse(e,a){this.mouseRotate.dragStart(e,a),this.mousePitch&&this.mousePitch.dragStart(e,a),D.disableDrag()}startTouch(e,a){this.touchRotate.dragStart(e,a),this.touchPitch&&this.touchPitch.dragStart(e,a),D.disableDrag()}moveMouse(e,a){const h=this.map,{bearingDelta:f}=this.mouseRotate.dragMove(e,a)||{};if(f&&h.setBearing(h.getBearing()+f),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(e,a)||{};y&&h.setPitch(h.getPitch()+y)}}moveTouch(e,a){const h=this.map,{bearingDelta:f}=this.touchRotate.dragMove(e,a)||{};if(f&&h.setBearing(h.getBearing()+f),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(e,a)||{};y&&h.setPitch(h.getPitch()+y)}}off(){const e=this.element;D.removeEventListener(e,"mousedown",this.mousedown),D.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),D.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.removeEventListener(window,"touchend",this.touchend),D.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){D.enableDrag(),D.removeEventListener(window,"mousemove",this.mousemove),D.removeEventListener(window,"mouseup",this.mouseup),D.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.removeEventListener(window,"touchend",this.touchend)}}let _n;function sl(_,e,a){if(_=new c.L(_.lng,_.lat),e){const h=new c.L(_.lng-360,_.lat),f=new c.L(_.lng+360,_.lat),y=a.locationPoint(_).distSqr(e);a.locationPoint(h).distSqr(e)<y?_=h:a.locationPoint(f).distSqr(e)<y&&(_=f)}for(;Math.abs(_.lng-a.center.lng)>180;){const h=a.locationPoint(_);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;_.lng>a.center.lng?_.lng-=360:_.lng+=360}return _}const wr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Nl(_,e,a){const h=_.classList;for(const f in wr)h.remove(`maplibregl-${a}-anchor-${f}`);h.add(`maplibregl-${a}-anchor-${e}`)}class Xi extends c.E{constructor(e){if(super(),this._onKeyPress=a=>{const h=a.code,f=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const h=a.originalEvent.target,f=this._element;this._popup&&(h===f||f.contains(h))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!h)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=sl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),D.setTransform(this._element,`${wr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${f}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const T=this._map.unproject(this._pos),P=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=T.distanceTo(this._lngLat)>20*P?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=a=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=D.create("div"),this._element.setAttribute("aria-label","Map marker");const a=D.createNS("http://www.w3.org/2000/svg","svg"),h=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${h}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${h}`);const y=D.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=D.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const P=D.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ft of E){const St=D.createNS("http://www.w3.org/2000/svg","ellipse");St.setAttributeNS(null,"opacity","0.04"),St.setAttributeNS(null,"cx","10.5"),St.setAttributeNS(null,"cy","5.80029008"),St.setAttributeNS(null,"rx",ft.rx),St.setAttributeNS(null,"ry",ft.ry),P.appendChild(St)}const k=D.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const R=D.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(R);const O=D.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const Z=D.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(Z);const tt=D.createNS("http://www.w3.org/2000/svg","g");tt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),tt.setAttributeNS(null,"fill","#FFFFFF");const Q=D.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const it=D.createNS("http://www.w3.org/2000/svg","circle");it.setAttributeNS(null,"fill","#000000"),it.setAttributeNS(null,"opacity","0.25"),it.setAttributeNS(null,"cx","5.5"),it.setAttributeNS(null,"cy","5.5"),it.setAttributeNS(null,"r","5.4999962");const Y=D.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#FFFFFF"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962"),Q.appendChild(it),Q.appendChild(Y),T.appendChild(P),T.appendChild(k),T.appendChild(O),T.appendChild(tt),T.appendChild(Q),a.appendChild(T),a.setAttributeNS(null,"height",h*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Nl(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),D.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.L.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const f=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Yi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let on=0,Zs=!1;const ba={maxWidth:100,unit:"metric"};function _s(_,e,a){const h=a&&a.maxWidth||100,f=_._container.clientHeight/2,y=_.unproject([0,f]),T=_.unproject([h,f]),P=y.distanceTo(T);if(a&&a.unit==="imperial"){const E=3.2808*P;E>5280?Fo(e,h,E/5280,_._getUIString("ScaleControl.Miles")):Fo(e,h,E,_._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Fo(e,h,P/1852,_._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Fo(e,h,P/1e3,_._getUIString("ScaleControl.Kilometers")):Fo(e,h,P,_._getUIString("ScaleControl.Meters"))}function Fo(_,e,a,h){const f=function(y){const T=Math.pow(10,`${Math.floor(y)}`.length-1);let P=y/T;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(E){const k=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*k)/k}(P),T*P}(a);_.style.width=e*(f/a)+"px",_.innerHTML=`${f}&nbsp;${h}`}const Ul={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},du=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function al(_){if(_){if(typeof _=="number"){const e=Math.round(Math.abs(_)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,_),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-_),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(_,0),right:new c.P(-_,0)}}if(_ instanceof c.P||Array.isArray(_)){const e=c.P.convert(_);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(_.center||[0,0]),top:c.P.convert(_.top||[0,0]),"top-left":c.P.convert(_["top-left"]||[0,0]),"top-right":c.P.convert(_["top-right"]||[0,0]),bottom:c.P.convert(_.bottom||[0,0]),"bottom-left":c.P.convert(_["bottom-left"]||[0,0]),"bottom-right":c.P.convert(_["bottom-right"]||[0,0]),left:c.P.convert(_.left||[0,0]),right:c.P.convert(_.right||[0,0])}}return al(new c.P(0,0))}const pu={extend:(_,...e)=>c.e(_,...e),run(_){_()},logToElement(_,e=!1,a="log"){const h=window.document.getElementById(a);h&&(e&&(h.innerHTML=""),h.innerHTML+=`<br>${_}`)}},fu=F;class Di{static get version(){return fu}static get workerCount(){return Te.workerCount}static set workerCount(e){Te.workerCount=e}static get maxParallelImageRequests(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(e){c.c.MAX_PARALLEL_IMAGE_REQUESTS=e}static get workerUrl(){return c.c.WORKER_URL}static set workerUrl(e){c.c.WORKER_URL=e}static addProtocol(e,a){c.c.REGISTERED_PROTOCOLS[e]=a}static removeProtocol(e){delete c.c.REGISTERED_PROTOCOLS[e]}}return Di.Map=class extends B{constructor(_){if(c.bg.mark(c.bh.create),(_=c.e({},xe,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ls(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),{bearingSnap:_.bearingSnap}),this._cooperativeGesturesOnWheel=e=>{this._onCooperativeGesture(e,e[this._metaKey],1)},this._contextLost=e=>{e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.k("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._cooperativeGestures=_.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._renderTaskQueue=new Tt,this._controls=[],this._mapId=c.a2(),this._locale=c.e({},Et,_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this._imageQueueHandle=oe.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ut(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let e=!1;const a=Bo(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{e?a(h):e=!0}),this._resizeObserver.observe(this._container)}this.handlers=new C(this,_),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=_.hash&&new cs(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,c.e({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new j({customAttribution:_.customAttribution})),_.maplibreLogo&&this.addControl(new at,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update(e.dataType==="style"),this.fire(new c.k(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new c.k(`${e.dataType}dataloading`,e))}),this.on("dataabort",e=>{this.fire(new c.k("sourcedataabort",e))})}_getMapId(){return this._mapId}addControl(_,e){if(e===void 0&&(e=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=_.onAdd(this);this._controls.push(_);const h=this._controlPositions[e];return e.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(_);return e>-1&&this._controls.splice(e,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,e,a,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,e,a,h)}resize(_){var e;const a=this._containerDimensions(),h=a[0],f=a[1],y=this._getClampedPixelRatio(h,f);if(this._resizeCanvas(h,f,y),this.painter.resize(h,f,y),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const E=this._getClampedPixelRatio(h,f);this._resizeCanvas(h,f,E),this.painter.resize(h,f,E)}this.transform.resize(h,f),(e=this._requestedCameraState)===null||e===void 0||e.resize(h,f);const T=!this._moving;return T&&(this.stop(),this.fire(new c.k("movestart",_)).fire(new c.k("move",_))),this.fire(new c.k("resize",_)),T&&this.fire(new c.k("moveend",_)),this}_getClampedPixelRatio(_,e){const{0:a,1:h}=this._maxCanvasSize,f=this.getPixelRatio(),y=_*f,T=e*f;return Math.min(y>a?a/y:1,T>h?h/T:1)*f}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(je.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(_){return this._cooperativeGestures=_,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(_){return this.transform.locationPoint(c.L.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(c.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,e,a){if(_==="mouseenter"||_==="mouseover"){let h=!1;return{layer:e,listener:a,delegates:{mousemove:y=>{const T=this.getLayer(e)?this.queryRenderedFeatures(y.point,{layers:[e]}):[];T.length?h||(h=!0,a.call(this,new Vn(_,this,y.originalEvent,{features:T}))):h=!1},mouseout:()=>{h=!1}}}}if(_==="mouseleave"||_==="mouseout"){let h=!1;return{layer:e,listener:a,delegates:{mousemove:T=>{(this.getLayer(e)?this.queryRenderedFeatures(T.point,{layers:[e]}):[]).length?h=!0:h&&(h=!1,a.call(this,new Vn(_,this,T.originalEvent)))},mouseout:T=>{h&&(h=!1,a.call(this,new Vn(_,this,T.originalEvent)))}}}}{const h=f=>{const y=this.getLayer(e)?this.queryRenderedFeatures(f.point,{layers:[e]}):[];y.length&&(f.features=y,a.call(this,f),delete f.features)};return{layer:e,listener:a,delegates:{[_]:h}}}}on(_,e,a){if(a===void 0)return super.on(_,e);const h=this._createDelegatedListener(_,e,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(h);for(const f in h.delegates)this.on(f,h.delegates[f]);return this}once(_,e,a){if(a===void 0)return super.once(_,e);const h=this._createDelegatedListener(_,e,a);for(const f in h.delegates)this.once(f,h.delegates[f]);return this}off(_,e,a){return a===void 0?super.off(_,e):(this._delegatedListeners&&this._delegatedListeners[_]&&(h=>{const f=this._delegatedListeners[_];for(let y=0;y<f.length;y++){const T=f[y];if(T.layer===e&&T.listener===a){for(const P in T.delegates)this.off(P,T.delegates[P]);return f.splice(y,1),this}}})(),this)}queryRenderedFeatures(_,e){if(!this.style)return[];let a;const h=_ instanceof c.P||Array.isArray(_),f=h?_:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(h?{}:_)||{},f instanceof c.P||typeof f[0]=="number")a=[c.P.convert(f)];else{const y=c.P.convert(f[0]),T=c.P.convert(f[1]);a=[y,new c.P(T.x,y.y),T,new c.P(y.x,T.y),y]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(_,e){return this.style.querySourceFeatures(_,e)}setStyle(_,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(_,e))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const e=this._locale[_];if(e==null)throw new Error(`Missing UI string '${_}'`);return e}_updateStyle(_,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,e));const a=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new mi(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,e,a):this.style.loadJSON(_,e,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new mi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,e){if(typeof _=="string"){const a=this._requestManager.transformRequest(_,Jt.Style);c.f(a,(h,f)=>{h?this.fire(new c.j(h)):f&&this._updateDiff(f,e)})}else typeof _=="object"&&this._updateDiff(_,e)}_updateDiff(_,e){try{this.style.setState(_,e)&&this._update(!0)}catch(a){c.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(_,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(_,e){return this._lazyInitEmptyStyle(),this.style.addSource(_,e),this._update(!0)}isSourceLoaded(_){const e=this.style&&this.style.sourceCaches[_];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const e=this.style.sourceCaches[_.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);for(const a in this.style._layers){const h=this.style._layers[a];h.type==="hillshade"&&h.source===_.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new He(this.painter,e,_),this.painter.renderToTexture=new mn(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==_.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:_})),this}getTerrain(){var _,e;return(e=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const e in _){const a=_[e]._tiles;for(const h in a){const f=a[h];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}addSourceType(_,e,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(_,e,a)}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,e,a={}){const{pixelRatio:h=1,sdf:f=!1,stretchX:y,stretchY:T,content:P}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.a(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:k,data:R}=e,O=e;return this.style.addImage(_,{data:new c.R({width:E,height:k},new Uint8Array(R)),pixelRatio:h,stretchX:y,stretchY:T,content:P,sdf:f,version:0,userImage:O}),O.onAdd&&O.onAdd(this,_),this}}{const{width:E,height:k,data:R}=c.h.getImageData(e);this.style.addImage(_,{data:new c.R({width:E,height:k},R),pixelRatio:h,stretchX:y,stretchY:T,content:P,sdf:f,version:0})}}updateImage(_,e){const a=this.style.getImage(_);if(!a)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=e instanceof HTMLImageElement||c.a(e)?c.h.getImageData(e):e,{width:f,height:y,data:T}=h;if(f===void 0||y===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||y!==a.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(e instanceof HTMLImageElement||c.a(e));return a.data.replace(T,P),this.style.updateImage(_,a),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,e){oe.getImage(this._requestManager.transformRequest(_,Jt.Image),e)}listImages(){return this.style.listImages()}addLayer(_,e){return this._lazyInitEmptyStyle(),this.style.addLayer(_,e),this._update(!0)}moveLayer(_,e){return this.style.moveLayer(_,e),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,e,a){return this.style.setLayerZoomRange(_,e,a),this._update(!0)}setFilter(_,e,a={}){return this.style.setFilter(_,e,a),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,e,a,h={}){return this.style.setPaintProperty(_,e,a,h),this._update(!0)}getPaintProperty(_,e){return this.style.getPaintProperty(_,e)}setLayoutProperty(_,e,a,h={}){return this.style.setLayoutProperty(_,e,a,h),this._update(!0)}getLayoutProperty(_,e){return this.style.getLayoutProperty(_,e)}setGlyphs(_,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,e,a,h=>{h||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,e,a=>{a||this._update(!0)}),this}setLight(_,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(_,e){return this.style.setFeatureState(_,e),this._update()}removeFeatureState(_,e){return this.style.removeFeatureState(_,e),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,e=0;return this._container&&(_=this._container.clientWidth||400,e=this._container.clientHeight||300),[_,e]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const e=this._canvasContainer=D.create("div","maplibregl-canvas-container",_);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=D.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),h=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],h);const f=this._controlContainer=D.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{y[T]=D.create("div",`maplibregl-ctrl-${T} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=D.create("div","maplibregl-cooperative-gesture-screen",this._container);let _=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(_=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${_}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){D.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(_,e,a){this._canvas.width=Math.floor(a*_),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{e={requestedAttributes:_},h&&(e.statusMessage=h.statusMessage,e.type=h.type)},{once:!0});const a=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!a){const h="Failed to initialize WebGL";throw e?(e.message=h,new Error(JSON.stringify(e))):new Error(h)}this.painter=new as(a,this.transform),q.testSupport(a)}_onCooperativeGesture(_,e,a){return!e&&a<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,y=c.h.now();this.style.zoomHistory.update(f,y);const T=new c.a8(f,{now:y,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=T.crossFadingFactor();P===1&&P===this._crossFadingFactor||(a=!0,this._crossFadingFactor=P),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bg.mark(c.bh.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const h=this._sourcesDirty||this._styleDirty||this._placementDirty;return h||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,c.bg.mark(c.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),oe.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),D.remove(this._canvasContainer),D.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),c.bg.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=c.h.frame(_=>{c.bg.frame(_),this._frame=null,this._render(_)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return me}getCameraTargetElevation(){return this.transform.elevation}},Di.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),h=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,a)=>{const h=this._map._getUIString(`NavigationControl.${a}`);e.title=h,e.setAttribute("aria-label",h)},this.options=c.e({},Ol,_),this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),D.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),D.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=D.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){D.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,e){const a=D.create("button",_,this._container);return a.type="button",a.addEventListener("click",e),a}},Di.GeolocateControl=class extends c.E{constructor(_){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new c.L(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,f=this._map.getBearing(),y=c.e({bearing:f},this.options.fitBoundsOptions),T=je.fromLngLat(a,h);this._map.fitBounds(T,y,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new c.L(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Zs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=e=>{if(this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=D.create("button","maplibregl-ctrl-geolocate",this._container),D.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=D.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xi({element:this._dotElement}),this._circleElement=D.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")))})}},this.options=c.e({},Yi,_)}onAdd(_){return this._map=_,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(e,a=!1){_n===void 0||a?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{_n=h.state!=="denied",e(_n)}).catch(()=>{_n=!!window.navigator.geolocation,e(_n)}):(_n=!!window.navigator.geolocation,e(_n)):e(_n)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),D.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,on=0,Zs=!1}_isOutOfMapMaxBounds(_){const e=this._map.getMaxBounds(),a=_.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),e=_.getSouthEast(),a=_.getNorthEast(),h=e.distanceTo(a),f=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":on--,Zs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),on++,on>1?(_={maximumAge:6e5,timeout:0},Zs=!0):(_=this.options.positionOptions,Zs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Di.AttributionControl=j,Di.LogoControl=at,Di.ScaleControl=class{constructor(_){this._onMove=()=>{_s(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,_s(this._map,this._container,this.options)},this.options=c.e({},ba,_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){D.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Di.FullscreenControl=class extends c.E{constructor(_={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){D.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=D.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);D.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Di.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=_}onAdd(_){return this._map=_,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=D.create("button","maplibregl-ctrl-terrain",this._container),D.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){D.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Di.Popup=class extends c.E{constructor(_){super(),this.remove=()=>(this._content&&D.remove(this._content),this._container&&(D.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new c.k("close")),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=D.create("div","maplibregl-popup",this._map.getContainer()),this._tip=D.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sl(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!e)return;const a=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);let h=this.options.anchor;const f=al(this.options.offset);if(!h){const T=this._container.offsetWidth,P=this._container.offsetHeight;let E;E=a.y+f.bottom.y<P?["top"]:a.y>this._map.transform.height-P?["bottom"]:[],a.x<T/2?E.push("left"):a.x>this._map.transform.width-T/2&&E.push("right"),h=E.length===0?"bottom":E.join("-")}const y=a.add(f[h]).round();D.setTransform(this._container,`${wr[h]} translate(${y.x}px,${y.y}px)`),Nl(this._container,h,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ul),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=c.L.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const e=document.createDocumentFragment(),a=document.createElement("body");let h;for(a.innerHTML=_;h=a.firstChild,h;)e.appendChild(h);return this.setDOMContent(e)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=D.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){this._container&&this._container.classList.add(_)}removeClassName(_){this._container&&this._container.classList.remove(_)}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}_createCloseButton(){this.options.closeButton&&(this._closeButton=D.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(du);_&&_.focus()}},Di.Marker=Xi,Di.Style=mi,Di.LngLat=c.L,Di.LngLatBounds=je,Di.Point=c.P,Di.MercatorCoordinate=c.U,Di.Evented=c.E,Di.AJAXError=c.bi,Di.config=c.c,Di.CanvasSource=ei,Di.GeoJSONSource=be,Di.ImageSource=ti,Di.RasterDEMTileSource=pn,Di.RasterTileSource=Oe,Di.VectorTileSource=hi,Di.VideoSource=en,Di.setRTLTextPlugin=c.bj,Di.getRTLTextPluginStatus=c.bk,Di.prewarm=function(){ki().acquire(ie)},Di.clearPrewarmedResources=function(){const _=Xe;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(ie),Xe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},pu.extend(Di,{isSafari:c.ac,getPerformanceMetrics:c.bg.getPerformanceMetrics}),Di});var I=x;return I})})(rx);var TC=rx.exports;const wi=ym(TC),sx="3.7.7",SC=sx,iu=typeof Buffer=="function",by=typeof TextDecoder=="function"?new TextDecoder:void 0,wy=typeof TextEncoder=="function"?new TextEncoder:void 0,PC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Hu=Array.prototype.slice.call(PC),Gh=(i=>{let r={};return i.forEach((u,m)=>r[u]=m),r})(Hu),AC=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,yr=String.fromCharCode.bind(String),Ty=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),ax=i=>i.replace(/=/g,"").replace(/[+\/]/g,r=>r=="+"?"-":"_"),lx=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),cx=i=>{let r,u,m,x,S="";const I=i.length%3;for(let c=0;c<i.length;){if((u=i.charCodeAt(c++))>255||(m=i.charCodeAt(c++))>255||(x=i.charCodeAt(c++))>255)throw new TypeError("invalid character found");r=u<<16|m<<8|x,S+=Hu[r>>18&63]+Hu[r>>12&63]+Hu[r>>6&63]+Hu[r&63]}return I?S.slice(0,I-3)+"===".substring(I):S},vm=typeof btoa=="function"?i=>btoa(i):iu?i=>Buffer.from(i,"binary").toString("base64"):cx,zf=iu?i=>Buffer.from(i).toString("base64"):i=>{let u=[];for(let m=0,x=i.length;m<x;m+=4096)u.push(yr.apply(null,i.subarray(m,m+4096)));return vm(u.join(""))},sd=(i,r=!1)=>r?ax(zf(i)):zf(i),IC=i=>{if(i.length<2){var r=i.charCodeAt(0);return r<128?i:r<2048?yr(192|r>>>6)+yr(128|r&63):yr(224|r>>>12&15)+yr(128|r>>>6&63)+yr(128|r&63)}else{var r=65536+(i.charCodeAt(0)-55296)*1024+(i.charCodeAt(1)-56320);return yr(240|r>>>18&7)+yr(128|r>>>12&63)+yr(128|r>>>6&63)+yr(128|r&63)}},CC=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ux=i=>i.replace(CC,IC),Sy=iu?i=>Buffer.from(i,"utf8").toString("base64"):wy?i=>zf(wy.encode(i)):i=>vm(ux(i)),jc=(i,r=!1)=>r?ax(Sy(i)):Sy(i),Py=i=>jc(i,!0),EC=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,LC=i=>{switch(i.length){case 4:var r=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),u=r-65536;return yr((u>>>10)+55296)+yr((u&1023)+56320);case 3:return yr((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return yr((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},hx=i=>i.replace(EC,LC),dx=i=>{if(i=i.replace(/\s+/g,""),!AC.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let r,u="",m,x;for(let S=0;S<i.length;)r=Gh[i.charAt(S++)]<<18|Gh[i.charAt(S++)]<<12|(m=Gh[i.charAt(S++)])<<6|(x=Gh[i.charAt(S++)]),u+=m===64?yr(r>>16&255):x===64?yr(r>>16&255,r>>8&255):yr(r>>16&255,r>>8&255,r&255);return u},xm=typeof atob=="function"?i=>atob(lx(i)):iu?i=>Buffer.from(i,"base64").toString("binary"):dx,px=iu?i=>Ty(Buffer.from(i,"base64")):i=>Ty(xm(i).split("").map(r=>r.charCodeAt(0))),fx=i=>px(mx(i)),MC=iu?i=>Buffer.from(i,"base64").toString("utf8"):by?i=>by.decode(px(i)):i=>hx(xm(i)),mx=i=>lx(i.replace(/[-_]/g,r=>r=="-"?"+":"/")),Rf=i=>MC(mx(i)),kC=i=>{if(typeof i!="string")return!1;const r=i.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(r)||!/[^\s0-9a-zA-Z\-_]/.test(r)},_x=i=>({value:i,enumerable:!1,writable:!0,configurable:!0}),gx=function(){const i=(r,u)=>Object.defineProperty(String.prototype,r,_x(u));i("fromBase64",function(){return Rf(this)}),i("toBase64",function(r){return jc(this,r)}),i("toBase64URI",function(){return jc(this,!0)}),i("toBase64URL",function(){return jc(this,!0)}),i("toUint8Array",function(){return fx(this)})},yx=function(){const i=(r,u)=>Object.defineProperty(Uint8Array.prototype,r,_x(u));i("toBase64",function(r){return sd(this,r)}),i("toBase64URI",function(){return sd(this,!0)}),i("toBase64URL",function(){return sd(this,!0)})},zC=()=>{gx(),yx()},RC={version:sx,VERSION:SC,atob:xm,atobPolyfill:dx,btoa:vm,btoaPolyfill:cx,fromBase64:Rf,toBase64:jc,encode:jc,encodeURI:Py,encodeURL:Py,utob:ux,btou:hx,decode:Rf,isValid:kC,fromUint8Array:sd,toUint8Array:fx,extendString:gx,extendUint8Array:yx,extendBuiltins:zC};var bm={exports:{}},Gc=typeof Reflect=="object"?Reflect:null,Ay=Gc&&typeof Gc.apply=="function"?Gc.apply:function(r,u,m){return Function.prototype.apply.call(r,u,m)},ad;Gc&&typeof Gc.ownKeys=="function"?ad=Gc.ownKeys:Object.getOwnPropertySymbols?ad=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:ad=function(r){return Object.getOwnPropertyNames(r)};function DC(i){console&&console.warn&&console.warn(i)}var vx=Number.isNaN||function(r){return r!==r};function ln(){ln.init.call(this)}bm.exports=ln;bm.exports.once=NC;ln.EventEmitter=ln;ln.prototype._events=void 0;ln.prototype._eventsCount=0;ln.prototype._maxListeners=void 0;var Iy=10;function Vd(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(ln,"defaultMaxListeners",{enumerable:!0,get:function(){return Iy},set:function(i){if(typeof i!="number"||i<0||vx(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Iy=i}});ln.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ln.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||vx(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function xx(i){return i._maxListeners===void 0?ln.defaultMaxListeners:i._maxListeners}ln.prototype.getMaxListeners=function(){return xx(this)};ln.prototype.emit=function(r){for(var u=[],m=1;m<arguments.length;m++)u.push(arguments[m]);var x=r==="error",S=this._events;if(S!==void 0)x=x&&S.error===void 0;else if(!x)return!1;if(x){var I;if(u.length>0&&(I=u[0]),I instanceof Error)throw I;var c=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw c.context=I,c}var F=S[r];if(F===void 0)return!1;if(typeof F=="function")Ay(F,this,u);else for(var D=F.length,q=Px(F,D),m=0;m<D;++m)Ay(q[m],this,u);return!0};function bx(i,r,u,m){var x,S,I;if(Vd(u),S=i._events,S===void 0?(S=i._events=Object.create(null),i._eventsCount=0):(S.newListener!==void 0&&(i.emit("newListener",r,u.listener?u.listener:u),S=i._events),I=S[r]),I===void 0)I=S[r]=u,++i._eventsCount;else if(typeof I=="function"?I=S[r]=m?[u,I]:[I,u]:m?I.unshift(u):I.push(u),x=xx(i),x>0&&I.length>x&&!I.warned){I.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=i,c.type=r,c.count=I.length,DC(c)}return i}ln.prototype.addListener=function(r,u){return bx(this,r,u,!1)};ln.prototype.on=ln.prototype.addListener;ln.prototype.prependListener=function(r,u){return bx(this,r,u,!0)};function BC(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function wx(i,r,u){var m={fired:!1,wrapFn:void 0,target:i,type:r,listener:u},x=BC.bind(m);return x.listener=u,m.wrapFn=x,x}ln.prototype.once=function(r,u){return Vd(u),this.on(r,wx(this,r,u)),this};ln.prototype.prependOnceListener=function(r,u){return Vd(u),this.prependListener(r,wx(this,r,u)),this};ln.prototype.removeListener=function(r,u){var m,x,S,I,c;if(Vd(u),x=this._events,x===void 0)return this;if(m=x[r],m===void 0)return this;if(m===u||m.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete x[r],x.removeListener&&this.emit("removeListener",r,m.listener||u));else if(typeof m!="function"){for(S=-1,I=m.length-1;I>=0;I--)if(m[I]===u||m[I].listener===u){c=m[I].listener,S=I;break}if(S<0)return this;S===0?m.shift():OC(m,S),m.length===1&&(x[r]=m[0]),x.removeListener!==void 0&&this.emit("removeListener",r,c||u)}return this};ln.prototype.off=ln.prototype.removeListener;ln.prototype.removeAllListeners=function(r){var u,m,x;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete m[r]),this;if(arguments.length===0){var S=Object.keys(m),I;for(x=0;x<S.length;++x)I=S[x],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=m[r],typeof u=="function")this.removeListener(r,u);else if(u!==void 0)for(x=u.length-1;x>=0;x--)this.removeListener(r,u[x]);return this};function Tx(i,r,u){var m=i._events;if(m===void 0)return[];var x=m[r];return x===void 0?[]:typeof x=="function"?u?[x.listener||x]:[x]:u?FC(x):Px(x,x.length)}ln.prototype.listeners=function(r){return Tx(this,r,!0)};ln.prototype.rawListeners=function(r){return Tx(this,r,!1)};ln.listenerCount=function(i,r){return typeof i.listenerCount=="function"?i.listenerCount(r):Sx.call(i,r)};ln.prototype.listenerCount=Sx;function Sx(i){var r=this._events;if(r!==void 0){var u=r[i];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}ln.prototype.eventNames=function(){return this._eventsCount>0?ad(this._events):[]};function Px(i,r){for(var u=new Array(r),m=0;m<r;++m)u[m]=i[m];return u}function OC(i,r){for(;r+1<i.length;r++)i[r]=i[r+1];i.pop()}function FC(i){for(var r=new Array(i.length),u=0;u<r.length;++u)r[u]=i[u].listener||i[u];return r}function NC(i,r){return new Promise(function(u,m){function x(I){i.removeListener(r,S),m(I)}function S(){typeof i.removeListener=="function"&&i.removeListener("error",x),u([].slice.call(arguments))}Ax(i,r,S,{once:!0}),r!=="error"&&UC(i,x,{once:!0})})}function UC(i,r,u){typeof i.on=="function"&&Ax(i,"error",r,u)}function Ax(i,r,u,m){if(typeof i.on=="function")m.once?i.once(r,u):i.on(r,u);else if(typeof i.addEventListener=="function")i.addEventListener(r,function x(S){m.once&&i.removeEventListener(r,x),u(S)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var VC=bm.exports;const $C=ym(VC);function ZC(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class jC{constructor(){this._apiKey="",this._fetch=ZC(),this.tileCacheSize=200}set apiKey(r){this._apiKey=r}get apiKey(){return this._apiKey}set fetch(r){this._fetch=r}get fetch(){return this._fetch}}const qc=new jC,GC={AUTO:"auto",ALBANIAN:"sq",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HUNGARIAN:"hu",ICELANDIC:"is",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALTESE:"mt",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"};new Set(Object.values(GC));async function qC(i,r={}){if(qc.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(i).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return qc.fetch(i,r)}const Ix={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(Ix);class HC extends Error{constructor(r,u=""){super(`Call to enpoint ${r.url} failed with the status code ${r.status}. ${u}`),this.res=r}}const Cy={403:"Key is missing, invalid or restricted"};async function WC(i={}){const r=new URL("geolocation/ip.json",Ix.maptilerApiURL);r.searchParams.set("key",i.apiKey??qc.apiKey);const u=r.toString(),m=await qC(u);if(!m.ok)throw new HC(m,m.status in Cy?Cy[m.status]:"");return await m.json()}const Ey={info:WC};function Cx(i){const r=/^maptiler:\/\/(.*)/;let u;const m=i.trim();let x;return m.startsWith("http://")||m.startsWith("https://")?x=m:(u=r.exec(m))!==null?x=`https://api.maptiler.com/maps/${u[1]}/style.json`:x=`https://api.maptiler.com/maps/${m}/style.json`,x}class Ex{constructor(r,u,m,x,S,I){this.name=r,this.variantType=u,this.id=m,this.referenceStyle=x,this.description=S,this.imageURL=I}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(r){return this.referenceStyle.hasVariant(r)}getVariant(r){return this.referenceStyle.getVariant(r)}getVariants(){return this.referenceStyle.getVariants().filter(r=>r!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return Cx(this.getId())}}class Lx{constructor(r,u){this.name=r,this.id=u,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(r){this.variants[r.getType()]=r,this.orderedVariants.push(r)}hasVariant(r){return r in this.variants}getVariant(r){return r in this.variants?this.variants[r]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const Df=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function KC(i){return new Proxy(i,{get(r,u,m){return r.hasVariant(u)?r.getVariant(u):u.toString().toUpperCase()===u?i.getDefaultVariant():Reflect.get(r,u,m)}})}function XC(){const i={};for(let r=0;r<Df.length;r+=1){const u=Df[r],m=KC(new Lx(u.name,u.referenceStyleID));for(let x=0;x<u.variants.length;x+=1){const S=u.variants[x],I=new Ex(S.name,S.variantType,S.id,m,S.description,S.imageURL);m.addVariant(I)}i[u.referenceStyleID]=m}return i}const Bf=XC();let qh;const YC=new Uint8Array(16);function JC(){if(!qh&&(qh=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!qh))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return qh(YC)}const gr=[];for(let i=0;i<256;++i)gr.push((i+256).toString(16).slice(1));function QC(i,r=0){return gr[i[r+0]]+gr[i[r+1]]+gr[i[r+2]]+gr[i[r+3]]+"-"+gr[i[r+4]]+gr[i[r+5]]+"-"+gr[i[r+6]]+gr[i[r+7]]+"-"+gr[i[r+8]]+gr[i[r+9]]+"-"+gr[i[r+10]]+gr[i[r+11]]+gr[i[r+12]]+gr[i[r+13]]+gr[i[r+14]]+gr[i[r+15]]}const tE=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ly={randomUUID:tE};function eE(i,r,u){if(Ly.randomUUID&&!r&&!i)return Ly.randomUUID();i=i||{};const m=i.random||(i.rng||JC)();return m[6]=m[6]&15|64,m[8]=m[8]&63|128,QC(m)}const Bi={VISITOR:"visitor",VISITOR_ENGLISH:"visitor_en",STYLE:"style",AUTO:"auto",STYLE_LOCK:"style_lock",LATIN:"name:latin",NON_LATIN:"name:nonlatin",LOCAL:"name",INTERNATIONAL:"name_int",ALBANIAN:"name:sq",AMHARIC:"name:am",ARABIC:"name:ar",ARMENIAN:"name:hy",AZERBAIJANI:"name:az",BASQUE:"name:eu",BELORUSSIAN:"name:be",BENGALI:"name:bn",BOSNIAN:"name:bs",BRETON:"name:br",BULGARIAN:"name:bg",CATALAN:"name:ca",CHINESE:"name:zh",TRADITIONAL_CHINESE:"name:zh-Hant",SIMPLIFIED_CHINESE:"name:zh-Hans",CORSICAN:"name:co",CROATIAN:"name:hr",CZECH:"name:cs",DANISH:"name:da",DUTCH:"name:nl",ENGLISH:"name:en",ESPERANTO:"name:eo",ESTONIAN:"name:et",FINNISH:"name:fi",FRENCH:"name:fr",FRISIAN:"name:fy",GEORGIAN:"name:ka",GERMAN:"name:de",GREEK:"name:el",HEBREW:"name:he",HINDI:"name:hi",HUNGARIAN:"name:hu",ICELANDIC:"name:is",INDONESIAN:"name:id",IRISH:"name:ga",ITALIAN:"name:it",JAPANESE:"name:ja",JAPANESE_HIRAGANA:"name:ja-Hira",JAPANESE_KANA:"name:ja_kana",JAPANESE_LATIN:"name:ja_rm",JAPANESE_2018:"name:ja-Latn",KANNADA:"name:kn",KAZAKH:"name:kk",KOREAN:"name:ko",KOREAN_LATIN:"name:ko-Latn",KURDISH:"name:ku",ROMAN_LATIN:"name:la",LATVIAN:"name:lv",LITHUANIAN:"name:lt",LUXEMBOURGISH:"name:lb",MACEDONIAN:"name:mk",MALAYALAM:"name:ml",MALTESE:"name:mt",NORWEGIAN:"name:no",OCCITAN:"name:oc",PERSIAN:"name:fa",POLISH:"name:pl",PORTUGUESE:"name:pt",PUNJABI:"name:pa",WESTERN_PUNJABI:"name:pnb",ROMANIAN:"name:ro",ROMANSH:"name:rm",RUSSIAN:"name:ru",SCOTTISH_GAELIC:"name:gd",SERBIAN_CYRILLIC:"name:sr",SERBIAN_LATIN:"name:sr-Latn",SLOVAK:"name:sk",SLOVENE:"name:sl",SPANISH:"name:es",SWEDISH:"name:sv",TAMIL:"name:ta",TELUGU:"name:te",THAI:"name:th",TURKISH:"name:tr",UKRAINIAN:"name:uk",URDU:"name:ur",VIETNAMIAN_LATIN:"name:vi",WELSH:"name:cy"},iE=new Set(Object.values(Bi));function My(i){return iE.has(i)}const nE=new Set(Object.values(Bi));function ky(){if(typeof navigator>"u")return`name:${Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0]}`;const i=Array.from(new Set(navigator.languages.map(r=>`name:${r.split("-")[0]}`))).filter(r=>nE.has(r));return i.length?i[0]:Bi.LOCAL}const Ko={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Bi.STYLE,secondaryLanguage:Bi.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(Ko);var rE=Object.defineProperty,oE=(i,r,u)=>r in i?rE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,Fu=(i,r,u)=>(oE(i,typeof r!="symbol"?r+"":r,u),u);const Mx=eE();class sE extends $C{constructor(){super(),Fu(this,"primaryLanguage",Ko.primaryLanguage),Fu(this,"secondaryLanguage"),Fu(this,"session",!0),Fu(this,"_unit","metric"),Fu(this,"_apiKey","")}set unit(r){this._unit=r,this.emit("unit",r)}get unit(){return this._unit}set apiKey(r){this._apiKey=r,qc.apiKey=r,this.emit("apiKey",r)}get apiKey(){return this._apiKey}set fetch(r){qc.fetch=r}get fetch(){return qc.fetch}}const Ao=new sE;class aE extends wi.LogoControl{onAdd(r){return super.onAdd(r)}}var lE=Object.defineProperty,cE=(i,r,u)=>r in i?lE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,zy=(i,r,u)=>(cE(i,typeof r!="symbol"?r+"":r,u),u);class Ry extends aE{constructor(r={}){var u,m;super(r),zy(this,"logoURL",""),zy(this,"linkURL",""),this.logoURL=(u=r.logoURL)!=null?u:Ko.maptilerLogoURL,this.linkURL=(m=r.linkURL)!=null?m:Ko.maptilerURL}onAdd(r){var u;this._map=r,this._compact=(u=this.options.compact)!=null?u:!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const m=window.document.createElement("a");return m.style.backgroundRepeat="no-repeat",m.style.cursor="pointer",m.style.display="block",m.style.height="23px",m.style.margin="0 0 -4px -4px",m.style.overflow="hidden",m.style.width="88px",m.style.backgroundImage=`url(${this.logoURL})`,m.style.backgroundSize="100px 30px",m.style.width="100px",m.style.height="30px",m.target="_blank",m.rel="noopener",m.href=this.linkURL,m.setAttribute("aria-label","MapTiler logo"),m.setAttribute("rel","noopener"),this._container.appendChild(m),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var uE=Object.defineProperty,Dy=Object.getOwnPropertySymbols,hE=Object.prototype.hasOwnProperty,dE=Object.prototype.propertyIsEnumerable,By=(i,r,u)=>r in i?uE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,Oy=(i,r)=>{for(var u in r||(r={}))hE.call(r,u)&&By(i,u,r[u]);if(Dy)for(var u of Dy(r))dE.call(r,u)&&By(i,u,r[u]);return i};function pE(){wi.getRTLTextPluginStatus()==="unavailable"&&wi.setRTLTextPlugin(Ko.rtlPluginURL,i=>{i&&console.error(i)},!0)}function fE(i,r){i.forEach(u=>{typeof r[u]=="function"&&(r[u]=r[u].bind(r))})}function yl(i,r,u){const m=window.document.createElement(i);return r!==void 0&&(m.className=r),u&&u.appendChild(m),m}function kx(i){i.parentNode&&i.parentNode.removeChild(i)}function Fy(i,r){let u=null;try{u=new URL(i)}catch{return{url:i}}return u.host===Ko.maptilerApiHost&&(u.searchParams.has("key")||u.searchParams.append("key",Ao.apiKey),Ao.session&&u.searchParams.append("mtsid",Mx)),{url:u.href}}function Ny(i){return function(r,u){var m;if(i!==void 0){const x=i(r,u),S=Fy((m=x==null?void 0:x.url)!=null?m:"");return Oy(Oy({},x),S)}else return Fy(r)}}function zx(){return Math.random().toString(36).substring(2)}function $d(i){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(i)}function mE(i){try{return JSON.parse(i)}catch{}return null}function Uy(i){return i?typeof i=="string"||i instanceof String?!i.startsWith("http")&&i.toLowerCase().includes(".json")?i:Cx(i):i instanceof Ex?i.getExpandedStyleURL():i instanceof Lx?i.getDefaultVariant().getExpandedStyleURL():i:Bf[Df[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}var _E=Object.defineProperty,gE=(i,r,u)=>r in i?_E(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,Yp=(i,r,u)=>(gE(i,typeof r!="symbol"?r+"":r,u),u);class yE{constructor(){Yp(this,"_map"),Yp(this,"_container"),Yp(this,"_terrainButton"),fE(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(r){return this._map=r,this._container=yl("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=yl("button","maplibregl-ctrl-terrain",this._container),yl("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){kx(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}}class vE extends wi.NavigationControl{onAdd(r){return super.onAdd(r)}}var xE=Object.defineProperty,bE=(i,r,u)=>r in i?xE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,wE=(i,r,u)=>(bE(i,r+"",u),u);class TE extends vE{constructor(){super({showCompass:!0,showZoom:!0,visualizePitch:!0}),wE(this,"_rotateCompassArrow",()=>{const r=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5))}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r}),this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",r=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})})}_createButton(r,u){const m=super._createButton(r,u);return m.clickFunction=u,m}}class SE extends wi.GeolocateControl{onAdd(r){return super.onAdd(r)}}var PE=Object.defineProperty,AE=Object.defineProperties,IE=Object.getOwnPropertyDescriptors,Vy=Object.getOwnPropertySymbols,CE=Object.prototype.hasOwnProperty,EE=Object.prototype.propertyIsEnumerable,Of=(i,r,u)=>r in i?PE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,LE=(i,r)=>{for(var u in r||(r={}))CE.call(r,u)&&Of(i,u,r[u]);if(Vy)for(var u of Vy(r))EE.call(r,u)&&Of(i,u,r[u]);return i},ME=(i,r)=>AE(i,IE(r)),Hh=(i,r,u)=>(Of(i,typeof r!="symbol"?r+"":r,u),u);const $y=wi.Marker,Zy=wi.LngLat,kE=wi.LngLatBounds;class zE extends SE{constructor(){super(...arguments),Hh(this,"lastUpdatedCenter",new Zy(0,0)),Hh(this,"_updateCamera",r=>{var u,m,x;const S=new Zy(r.coords.longitude,r.coords.latitude),I=r.coords.accuracy,c=this._map.getBearing(),F=ME(LE({bearing:c},this.options.fitBoundsOptions),{linear:!0}),D=this._map.getZoom();D>((x=(m=(u=this.options)==null?void 0:u.fitBoundsOptions)==null?void 0:m.maxZoom)!=null?x:30)&&(F.zoom=D),this._map.fitBounds(kE.fromLngLat(S,I),F,{geolocateSource:!0});let q=!1;const W=()=>{q=!0};this._map.once("click",W),this._map.once("dblclick",W),this._map.once("dragstart",W),this._map.once("mousedown",W),this._map.once("touchstart",W),this._map.once("wheel",W),this._map.once("moveend",()=>{this._map.off("click",W),this._map.off("dblclick",W),this._map.off("dragstart",W),this._map.off("mousedown",W),this._map.off("touchstart",W),this._map.off("wheel",W),!q&&(this.lastUpdatedCenter=this._map.getCenter())})}),Hh(this,"_setupUI",r=>{if(this.lastUpdatedCenter=this._map.getCenter(),this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=yl("button","maplibregl-ctrl-geolocate",this._container),yl("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=yl("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new $y({element:this._dotElement}),this._circleElement=yl("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $y({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",u=>{const m=u.originalEvent&&u.originalEvent.type==="resize",x=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!u.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!m&&x>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}),Hh(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const r=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],u=this._map.project(r),m=this._map.unproject([u.x,u.y]),x=this._map.unproject([u.x+20,u.y]),S=m.distanceTo(x)/20,I=Math.ceil(2*this._accuracy/S);this._circleElement.style.width=`${I}px`,this._circleElement.style.height=`${I}px`}}class RE extends wi.AttributionControl{onAdd(r){return super.onAdd(r)}}class DE extends wi.ScaleControl{onAdd(r){return super.onAdd(r)}}class BE extends wi.FullscreenControl{onAdd(r){return super.onAdd(r)}}var OE=Object.defineProperty,FE=Object.defineProperties,NE=Object.getOwnPropertyDescriptors,jy=Object.getOwnPropertySymbols,UE=Object.prototype.hasOwnProperty,VE=Object.prototype.propertyIsEnumerable,Ff=(i,r,u)=>r in i?OE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,Hc=(i,r)=>{for(var u in r||(r={}))UE.call(r,u)&&Ff(i,u,r[u]);if(jy)for(var u of jy(r))VE.call(r,u)&&Ff(i,u,r[u]);return i},Gy=(i,r)=>FE(i,NE(r)),$E=(i,r,u)=>(Ff(i,r+"",u),u),wm=(i,r,u)=>{if(!r.has(i))throw TypeError("Cannot "+u)},Oi=(i,r,u)=>(wm(i,r,"read from private field"),u?u.call(i):r.get(i)),Ws=(i,r,u)=>{if(r.has(i))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(i):r.set(i,u)},Bc=(i,r,u,m)=>(wm(i,r,"write to private field"),r.set(i,u),u),wo=(i,r,u)=>(wm(i,r,"access private method"),u),To,ea,Wl,Rx,ec,qo,ld,Nf,Dx,So,Ho,Uf,Bx;class Jp{constructor(r,u){Ws(this,Nf),Ws(this,So),Ws(this,Uf),Ws(this,To,void 0),$E(this,"map"),Ws(this,ea,void 0),Ws(this,Wl,void 0),Ws(this,Rx,void 0),Ws(this,ec,void 0),Ws(this,qo,!1),Ws(this,ld,void 0);var m;r.style!==void 0&&Bc(this,qo,!0),Bc(this,To,Gy(Hc(Gy(Hc({zoomAdjust:-4,position:"top-right"},u),{forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1}),r),{containerStyle:Hc({border:"1px solid #000",width:"400px",height:"300px"},(m=r.containerStyle)!=null?m:{})})),r.lockZoom!==void 0&&(Oi(this,To).minZoom=r.lockZoom,Oi(this,To).maxZoom=r.lockZoom)}setStyle(r,u){Oi(this,qo)||this.map.setStyle(r,u),wo(this,So,Ho).call(this)}addLayer(r,u){return Oi(this,qo)||this.map.addLayer(r,u),wo(this,So,Ho).call(this),this.map}moveLayer(r,u){return Oi(this,qo)||this.map.moveLayer(r,u),wo(this,So,Ho).call(this),this.map}removeLayer(r){return Oi(this,qo)||this.map.removeLayer(r),wo(this,So,Ho).call(this),this}setLayerZoomRange(r,u,m){return Oi(this,qo)||this.map.setLayerZoomRange(r,u,m),wo(this,So,Ho).call(this),this}setFilter(r,u,m){return Oi(this,qo)||this.map.setFilter(r,u,m),wo(this,So,Ho).call(this),this}setPaintProperty(r,u,m,x){return Oi(this,qo)||this.map.setPaintProperty(r,u,m,x),wo(this,So,Ho).call(this),this}setLayoutProperty(r,u,m,x){return Oi(this,qo)||this.map.setLayoutProperty(r,u,m,x),wo(this,So,Ho).call(this),this}setGlyphs(r,u){return Oi(this,qo)||this.map.setGlyphs(r,u),wo(this,So,Ho).call(this),this}onAdd(r){Bc(this,ea,r),Bc(this,Wl,yl("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[u,m]of Object.entries(Oi(this,To).containerStyle))Oi(this,Wl).style.setProperty(u,m);return Oi(this,To).container=Oi(this,Wl),Oi(this,To).zoom=r.getZoom()+Oi(this,To).zoomAdjust,this.map=new Ox(Oi(this,To)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{wo(this,Nf,Dx).call(this,Oi(this,To).parentRect),Bc(this,ld,wo(this,Uf,Bx).call(this))}),Oi(this,Wl)}onRemove(){var r;(r=Oi(this,ld))==null||r.call(this),kx(Oi(this,Wl))}}To=new WeakMap;ea=new WeakMap;Wl=new WeakMap;Rx=new WeakMap;ec=new WeakMap;qo=new WeakMap;ld=new WeakMap;Nf=new WeakSet;Dx=function(i){i===void 0||i.linePaint===void 0&&i.fillPaint===void 0||(Bc(this,ec,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:Oi(this,ec)}),(i.lineLayout!==void 0||i.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:Hc({},i.lineLayout),paint:Hc({"line-color":"#FFF","line-width":1,"line-opacity":.85},i.linePaint)}),i.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:Hc({"fill-color":"#08F","fill-opacity":.135},i.fillPaint)}),wo(this,So,Ho).call(this))};So=new WeakSet;Ho=function(){if(Oi(this,ec)===void 0)return;const{devicePixelRatio:i}=window,r=Oi(this,ea).getCanvas(),u=r.width/i,m=r.height/i,x=Oi(this,ea).unproject.bind(Oi(this,ea)),S=x([0,0]),I=x([u,0]),c=x([0,m]),F=x([u,m]);Oi(this,ec).geometry.coordinates=[[c.toArray(),F.toArray(),I.toArray(),S.toArray(),c.toArray()]],this.map.getSource("parentRect").setData(Oi(this,ec))};Uf=new WeakSet;Bx=function(){const{pitchAdjust:i}=Oi(this,To),r=()=>{S("parent")},u=()=>{S("minimap")},m=()=>{Oi(this,ea).on("move",r),this.map.on("move",u)},x=()=>{Oi(this,ea).off("move",r),this.map.off("move",u)},S=I=>{var c;x();const F=I==="parent"?Oi(this,ea):this.map,D=I==="parent"?this.map:Oi(this,ea),q=F.getCenter(),W=F.getZoom()+((c=Oi(this,To).zoomAdjust)!=null?c:-4)*(I==="parent"?1:-1),K=F.getBearing(),bt=F.getPitch();D.jumpTo({center:q,zoom:W,bearing:K,pitch:i?bt:0}),wo(this,So,Ho).call(this),m()};return m(),()=>{x()}};var ZE=Object.defineProperty,jE=Object.defineProperties,GE=Object.getOwnPropertyDescriptors,qy=Object.getOwnPropertySymbols,qE=Object.prototype.hasOwnProperty,HE=Object.prototype.propertyIsEnumerable,Vf=(i,r,u)=>r in i?ZE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,WE=(i,r)=>{for(var u in r||(r={}))qE.call(r,u)&&Vf(i,u,r[u]);if(qy)for(var u of qy(r))HE.call(r,u)&&Vf(i,u,r[u]);return i},KE=(i,r)=>jE(i,GE(r)),Ma=(i,r,u)=>(Vf(i,typeof r!="symbol"?r+"":r,u),u),Ks=(i,r,u)=>new Promise((m,x)=>{var S=F=>{try{c(u.next(F))}catch(D){x(D)}},I=F=>{try{c(u.throw(F))}catch(D){x(D)}},c=F=>F.done?m(F.value):Promise.resolve(F.value).then(S,I);c((u=u.apply(i,r)).next())});const XE={POINT:"POINT",COUNTRY:"COUNTRY"};let Ox=class extends wi.Map{constructor(r){var u,m,x;r.apiKey&&(Ao.apiKey=r.apiKey);const S=Uy(r.style),I=location.hash;Ao.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!"),super(KE(WE({},r),{style:S,maplibreLogo:!1,transformRequest:Ny(r.transformRequest)})),Ma(this,"isTerrainEnabled",!1),Ma(this,"terrainExaggeration",1),Ma(this,"primaryLanguage"),Ma(this,"terrainGrowing",!1),Ma(this,"terrainFlattening",!1),Ma(this,"minimap"),Ma(this,"forceLanguageUpdate"),Ma(this,"languageAlwaysBeenStyle"),Ma(this,"isReady",!1),this.primaryLanguage=(u=r.language)!=null?u:Ao.primaryLanguage,this.forceLanguageUpdate=!(this.primaryLanguage===Bi.STYLE||this.primaryLanguage===Bi.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Bi.STYLE,this.terrainExaggeration=(m=r.terrainExaggeration)!=null?m:this.terrainExaggeration,this.once("styledata",()=>Ks(this,null,function*(){if(!r.geolocate||r.center||r.hash&&I)return;try{if(r.geolocate===XE.COUNTRY){yield this.fitToIpBounds();return}}catch(bt){console.warn(bt.message)}let W;try{yield this.centerOnIpPoint(r.zoom),W=this.getCameraHash()}catch(bt){console.warn(bt.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(bt=>{W===this.getCameraHash()&&(this.terrain?this.easeTo({center:[bt.coords.longitude,bt.coords.latitude],zoom:r.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[bt.coords.longitude,bt.coords.latitude],zoom:r.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>Ks(this,null,function*(){pE()})),this.once("load",()=>Ks(this,null,function*(){let W={logo:null};try{const K=Object.keys(this.style.sourceCaches).map(Pt=>this.getSource(Pt)).filter(Pt=>Pt&&"url"in Pt&&typeof Pt.url=="string"&&(Pt==null?void 0:Pt.url.includes("tiles.json"))),bt=new URL(K[0].url);bt.searchParams.has("key")||bt.searchParams.append("key",Ao.apiKey),W=yield(yield fetch(bt.href)).json()}catch{}if(r.forceNoAttributionControl!==!0)if("logo"in W&&W.logo){const K=W.logo;this.addControl(new Ry({logoURL:K}),r.logoPosition),r.attributionControl===!1&&this.addControl(new RE({customAttribution:r.customAttribution}))}else r.maptilerLogo&&this.addControl(new Ry,r.logoPosition);if(r.scaleControl){const K=r.scaleControl===!0||r.scaleControl===void 0?"bottom-right":r.scaleControl,bt=new DE({unit:Ao.unit});this.addControl(bt,K),Ao.on("unit",zt=>{bt.setUnit(zt)})}if(r.navigationControl!==!1){const K=r.navigationControl===!0||r.navigationControl===void 0?"top-right":r.navigationControl;this.addControl(new TE,K)}if(r.geolocateControl!==!1){const K=r.geolocateControl===!0||r.geolocateControl===void 0?"top-right":r.geolocateControl;this.addControl(new zE({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),K)}if(r.terrainControl){const K=r.terrainControl===!0||r.terrainControl===void 0?"top-right":r.terrainControl;this.addControl(new yE,K)}if(r.fullscreenControl){const K=r.fullscreenControl===!0||r.fullscreenControl===void 0?"top-right":r.fullscreenControl;this.addControl(new BE({}),K)}this.isReady=!0,this.fire("ready",{target:this})}));let c=!1,F=!1,D;this.once("ready",()=>{c=!0,F&&this.fire("loadWithTerrain",D)}),this.once("style.load",()=>{var W;const{minimap:K}=r;if(typeof K=="object"){const{zoom:bt,center:zt,style:Pt,language:oe,apiKey:Jt,maptilerLogo:Ut,antialias:Zt,refreshExpiredTiles:Le,maxBounds:de,scrollZoom:te,minZoom:Ce,maxZoom:pe,boxZoom:Fe,locale:ce,fadeDuration:Qt,crossSourceCollisions:fe,clickTolerance:ke,bounds:Ae,fitBoundsOptions:Ke,pixelRatio:we,validateStyle:Me}=r;this.minimap=new Jp(K,{zoom:bt,center:zt,style:Pt,language:oe,apiKey:Jt,container:"null",maptilerLogo:Ut,antialias:Zt,refreshExpiredTiles:Le,maxBounds:de,scrollZoom:te,minZoom:Ce,maxZoom:pe,boxZoom:Fe,locale:ce,fadeDuration:Qt,crossSourceCollisions:fe,clickTolerance:ke,bounds:Ae,fitBoundsOptions:Ke,pixelRatio:we,validateStyle:Me}),this.addControl(this.minimap,(W=K.position)!=null?W:"bottom-left")}else K===!0?(this.minimap=new Jp({},r),this.addControl(this.minimap,"bottom-left")):K!==void 0&&K!==!1&&(this.minimap=new Jp({},r),this.addControl(this.minimap,K))});const q=W=>{W.terrain&&(F=!0,D={type:"loadWithTerrain",target:this,terrain:W.terrain},this.off("terrain",q),c&&this.fire("loadWithTerrain",D))};this.on("terrain",q),r.terrain&&this.enableTerrain((x=r.terrainExaggeration)!=null?x:this.terrainExaggeration)}onLoadAsync(){return Ks(this,null,function*(){return new Promise(r=>{if(this.loaded())return r(this);this.once("load",()=>{r(this)})})})}onReadyAsync(){return Ks(this,null,function*(){return new Promise(r=>{if(this.isReady)return r(this);this.once("ready",()=>{r(this)})})})}onLoadWithTerrainAsync(){return Ks(this,null,function*(){return new Promise(r=>{if(this.isReady&&this.terrain)return r(this);this.once("loadWithTerrain",()=>{r(this)})})})}setStyle(r,u){var m;return(m=this.minimap)==null||m.setStyle(r),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1}),super.setStyle(Uy(r),u)}addLayer(r,u){var m;return(m=this.minimap)==null||m.addLayer(r,u),super.addLayer(r,u)}moveLayer(r,u){var m;return(m=this.minimap)==null||m.moveLayer(r,u),super.moveLayer(r,u)}removeLayer(r){var u;return(u=this.minimap)==null||u.removeLayer(r),super.removeLayer(r)}setLayerZoomRange(r,u,m){var x;return(x=this.minimap)==null||x.setLayerZoomRange(r,u,m),super.setLayerZoomRange(r,u,m)}setFilter(r,u,m){var x;return(x=this.minimap)==null||x.setFilter(r,u,m),super.setFilter(r,u,m)}setPaintProperty(r,u,m,x){var S;return(S=this.minimap)==null||S.setPaintProperty(r,u,m,x),super.setPaintProperty(r,u,m,x)}setLayoutProperty(r,u,m,x){var S;return(S=this.minimap)==null||S.setLayoutProperty(r,u,m,x),super.setLayoutProperty(r,u,m,x)}setGlyphs(r,u){var m;return(m=this.minimap)==null||m.setGlyphs(r,u),super.setGlyphs(r,u)}getStyleLanguage(){return!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?this.style.stylesheet.metadata["maptiler:language"]:null}setLanguage(r){var u,m;(m=(u=this.minimap)==null?void 0:u.map)==null||m.setLanguage(r),this.onStyleReady(()=>{this.setPrimaryLanguage(r)})}setPrimaryLanguage(r){const u=this.getStyleLanguage();if(!(r===Bi.STYLE&&(u===Bi.AUTO||u===Bi.VISITOR))&&(r!==Bi.STYLE&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===r&&!this.forceLanguageUpdate))return;if(!My(r)){console.warn(`The language "${r}" is not supported.`);return}if(this.primaryLanguage===Bi.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=r;let m=r;if(r===Bi.STYLE){if(!u){console.warn("The style has no default languages.");return}if(!My(u)){console.warn("The language defined in the style is not valid.");return}m=u}let x=Bi.LOCAL,S=`{${x}}`;m==Bi.VISITOR?(x=ky(),S=["case",["all",["has",x],["has",Bi.LOCAL]],["case",["==",["get",x],["get",Bi.LOCAL]],["get",Bi.LOCAL],["format",["get",x],{"font-scale":.8},`
`,["get",Bi.LOCAL],{"font-scale":1.1}]],["get",Bi.LOCAL]]):m==Bi.VISITOR_ENGLISH?(x=Bi.ENGLISH,S=["case",["all",["has",x],["has",Bi.LOCAL]],["case",["==",["get",x],["get",Bi.LOCAL]],["get",Bi.LOCAL],["format",["get",x],{"font-scale":.8},`
`,["get",Bi.LOCAL],{"font-scale":1.1}]],["get",Bi.LOCAL]]):m===Bi.AUTO?(x=ky(),S=["case",["has",x],["get",x],["get",Bi.LOCAL]]):m===Bi.LOCAL?(x=Bi.LOCAL,S=`{${x}}`):(x=m,S=["case",["has",x],["get",x],["get",Bi.LOCAL]]);const{layers:I}=this.getStyle();for(const{id:c,layout:F}of I){if(!F||!("text-field"in F))continue;const D=this.getLayoutProperty(c,"text-field");typeof D=="string"&&(D.toLowerCase().includes("ref")||D.toLowerCase().includes("housenumber"))||this.setLayoutProperty(c,"text-field",S)}}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(r,u=1e3){if(!this.terrain)return;const m=performance.now(),x=this.terrain.exaggeration,S=r-x,I=()=>{if(!this.terrain||this.terrainFlattening)return;const c=(performance.now()-m)/u;if(c<.99){const F=1-Math.pow(1-c,4),D=x+F*S;this.terrain.exaggeration=D,requestAnimationFrame(I)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=r;this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(I)}enableTerrain(r=this.terrainExaggeration){if(r<0){console.warn("Terrain exaggeration cannot be negative.");return}const u=x=>Ks(this,null,function*(){!this.terrain||x.type!=="data"||x.dataType!=="source"||!("source"in x)||x.sourceId!=="maptiler-terrain"||x.source.type!=="raster-dem"||x.isSourceLoaded&&(this.off("data",u),this.growTerrain(r))}),m=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=r,this.on("data",u),this.addSource(Ko.terrainSourceId,{type:"raster-dem",url:Ko.terrainSourceURL}),this.setTerrain({source:Ko.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(r);return}this.loaded()||this.isTerrainEnabled?m():this.once("load",()=>{this.getTerrain()&&this.getSource(Ko.terrainSourceId)||m()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const r=1*1e3,u=performance.now(),m=this.terrain.exaggeration,x=()=>{if(!this.terrain||this.terrainGrowing)return;const S=(performance.now()-u)/r;if(S<.99){const I=Math.pow(1-S,4),c=m*I;this.terrain.exaggeration=c,requestAnimationFrame(x)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(Ko.terrainSourceId)&&this.removeSource(Ko.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(x)}setTerrainExaggeration(r,u=!0){!u&&this.terrain?(this.terrainExaggeration=r,this.terrain.exaggeration=r,this.triggerRepaint()):this.enableTerrain(r)}onStyleReady(r){this.isStyleLoaded()?r():this.once("styledata",()=>{r()})}fitToIpBounds(){return Ks(this,null,function*(){const r=yield Ey.info();this.fitBounds(r.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(r){return Ks(this,null,function*(){var u,m;const x=yield Ey.info();this.jumpTo({center:[(u=x==null?void 0:x.longitude)!=null?u:0,(m=x==null?void 0:x.latitude)!=null?m:0],zoom:r||11})})}getCameraHash(){const r=new Float32Array(5),u=this.getCenter();return r[0]=u.lng,r[1]=u.lat,r[2]=this.getZoom(),r[3]=this.getPitch(),r[4]=this.getBearing(),RC.fromUint8Array(new Uint8Array(r.buffer))}getSdkConfig(){return Ao}getMaptilerSessionId(){return Mx}setTransformRequest(r){return super.setTransformRequest(Ny(r)),this}loadImageAsync(r){return Ks(this,null,function*(){return new Promise((u,m)=>{this.loadImage(r,(x,S)=>{if(x){m(x);return}u(S)})})})}};class OL extends wi.Marker{addTo(r){return super.addTo(r)}}class FL extends wi.Popup{addTo(r){return super.addTo(r)}}class NL extends wi.Style{constructor(r,u={}){super(r,u)}}class UL extends wi.CanvasSource{onAdd(r){super.onAdd(r)}}class VL extends wi.GeoJSONSource{onAdd(r){super.onAdd(r)}}class $L extends wi.ImageSource{onAdd(r){super.onAdd(r)}}class ZL extends wi.RasterTileSource{onAdd(r){super.onAdd(r)}}class jL extends wi.RasterDEMTileSource{onAdd(r){super.onAdd(r)}}class GL extends wi.VectorTileSource{onAdd(r){super.onAdd(r)}}class qL extends wi.VideoSource{onAdd(r){super.onAdd(r)}}class HL extends wi.TerrainControl{onAdd(r){return super.onAdd(r)}}var YE=Object.defineProperty,Hy=Object.getOwnPropertySymbols,JE=Object.prototype.hasOwnProperty,QE=Object.prototype.propertyIsEnumerable,Wy=(i,r,u)=>r in i?YE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,hc=(i,r)=>{for(var u in r||(r={}))JE.call(r,u)&&Wy(i,u,r[u]);if(Hy)for(var u of Hy(r))QE.call(r,u)&&Wy(i,u,r[u]);return i};function Tm(i){if(typeof DOMParser<"u"){const r=new DOMParser().parseFromString(i,"application/xml");if(r.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return r}else throw new Error("No XML parser found")}function Fx(i,r){if(!i.hasChildNodes())return!1;for(const u of Array.from(i.childNodes)){const m=u.nodeName;if(typeof m=="string"&&m.trim().toLowerCase()===r.toLowerCase())return!0}return!1}function Ky(i){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(i);throw new Error("No XML serializer found")}function Nx(i){if(typeof i=="string"&&(i=Tm(i)),!Fx(i,"gpx"))throw new Error("The XML document is not valid GPX");const r=ar(i,"trk"),u=ar(i,"rte"),m=ar(i,"wpt"),x={type:"FeatureCollection",features:[]};for(const S of Array.from(r)){const I=nL(S);I&&x.features.push(I)}for(const S of Array.from(u)){const I=rL(S);I&&x.features.push(I)}for(const S of Array.from(m))x.features.push(oL(S));return x}function Ux(i,r){var u;if(typeof i=="string"&&(i=Tm(i)),!Fx(i,"kml"))throw new Error("The XML document is not valid KML");const m={type:"FeatureCollection",features:[]},x={},S={},I={},c=ar(i,"Placemark"),F=ar(i,"Style"),D=ar(i,"StyleMap");for(const q of Array.from(F)){const W=Yy(Ky(q)).toString(16);x["#"+ic(q,"id")]=W,S[W]=q}for(const q of Array.from(D)){x["#"+ic(q,"id")]=Yy(Ky(q)).toString(16);const W=ar(q,"Pair"),K={};for(const bt of Array.from(W))K[(u=Ji(ci(bt,"key")))!=null?u:""]=Ji(ci(bt,"styleUrl"));I["#"+ic(q,"id")]=K}for(const q of Array.from(c))m.features=m.features.concat(iL(q,x,S,I));return m}function Xy(i){if(i===null)return["#000000",1];let r="",u=1;return i.substring(0,1)==="#"&&(i=i.substring(1)),(i.length===6||i.length===3)&&(r=i),i.length===8&&(u=parseInt(i.substring(0,2),16)/255,r="#"+i.substring(6,8)+i.substring(4,6)+i.substring(2,4)),[r??"#000000",u??1]}function tL(i){return Zx(i.split(" "))}function eL(i){var r;let u=ar(i,"coord");const m=[],x=[];u.length===0&&(u=ar(i,"gx:coord"));for(const I of Array.from(u))m.push(tL((r=Ji(I))!=null?r:""));const S=ar(i,"when");for(const I of Array.from(S))x.push(Ji(I));return{coords:m,times:x}}function cd(i){var r,u,m;const x=["Polygon","LineString","Point","Track","gx:Track"];let S,I,c,F,D;const q=[],W=[];if(ci(i,"MultiGeometry")!==null)return cd(ci(i,"MultiGeometry"));if(ci(i,"MultiTrack")!==null)return cd(ci(i,"MultiTrack"));if(ci(i,"gx:MultiTrack")!==null)return cd(ci(i,"gx:MultiTrack"));for(c=0;c<x.length;c++)if(I=ar(i,x[c]),I){for(F=0;F<I.length;F++)if(S=I[F],x[c]==="Point")q.push({type:"Point",coordinates:jx((r=Ji(ci(S,"coordinates")))!=null?r:"")});else if(x[c]==="LineString")q.push({type:"LineString",coordinates:Qy((u=Ji(ci(S,"coordinates")))!=null?u:"")});else if(x[c]==="Polygon"){const K=ar(S,"LinearRing"),bt=[];for(D=0;D<K.length;D++)bt.push(Qy((m=Ji(ci(K[D],"coordinates")))!=null?m:""));q.push({type:"Polygon",coordinates:bt})}else if(x[c]==="Track"||x[c]==="gx:Track"){const K=eL(S);q.push({type:"LineString",coordinates:K.coords}),K.times.length&&W.push(K.times)}}return{geoms:q,coordTimes:W}}function iL(i,r,u,m){var x,S,I,c,F,D,q,W,K,bt;const zt=cd(i),Pt={},oe=Ji(ci(i,"name")),Jt=Ji(ci(i,"address")),Ut=Ji(ci(i,"description")),Zt=ci(i,"TimeSpan"),Le=ci(i,"TimeStamp"),de=ci(i,"ExtendedData"),te=ci(i,"visibility");let Ce,pe=Ji(ci(i,"styleUrl")),Fe=ci(i,"LineStyle"),ce=ci(i,"PolyStyle");if(!zt.geoms.length)return[];if(oe&&(Pt.name=oe),Jt&&(Pt.address=Jt),pe){pe[0]!=="#"&&(pe="#"+pe),Pt.styleUrl=pe,r[pe]&&(Pt.styleHash=r[pe]),m[pe]&&(Pt.styleMapHash=m[pe],Pt.styleHash=r[(x=m[pe].normal)!=null?x:""]);const fe=u[(S=Pt.styleHash)!=null?S:""];if(fe){Fe||(Fe=ci(fe,"LineStyle")),ce||(ce=ci(fe,"PolyStyle"));const ke=ci(fe,"IconStyle");if(ke){const Ae=ci(ke,"Icon");if(Ae){const Ke=Ji(ci(Ae,"href"));Ke&&(Pt.icon=Ke)}}}}if(Ut&&(Pt.description=Ut),Zt){const fe=Ji(ci(Zt,"begin")),ke=Ji(ci(Zt,"end"));fe&&ke&&(Pt.timespan={begin:fe,end:ke})}if(Le!==null&&(Pt.timestamp=(I=Ji(ci(Le,"when")))!=null?I:new Date().toISOString()),Fe!==null){const fe=Xy(Ji(ci(Fe,"color"))),ke=fe[0],Ae=fe[1],Ke=parseFloat((c=Ji(ci(Fe,"width")))!=null?c:"");ke&&(Pt.stroke=ke),isNaN(Ae)||(Pt["stroke-opacity"]=Ae),isNaN(Ke)||(Pt["stroke-width"]=Ke)}if(ce){const fe=Xy(Ji(ci(ce,"color"))),ke=fe[0],Ae=fe[1],Ke=Ji(ci(ce,"fill")),we=Ji(ci(ce,"outline"));ke&&(Pt.fill=ke),isNaN(Ae)||(Pt["fill-opacity"]=Ae),Ke&&(Pt["fill-opacity"]=Ke==="1"?Pt["fill-opacity"]||1:0),we&&(Pt["stroke-opacity"]=we==="1"?Pt["stroke-opacity"]||1:0)}if(de){const fe=ar(de,"Data"),ke=ar(de,"SimpleData");for(Ce=0;Ce<fe.length;Ce++)Pt[(F=fe[Ce].getAttribute("name"))!=null?F:""]=(D=Ji(ci(fe[Ce],"value")))!=null?D:"";for(Ce=0;Ce<ke.length;Ce++)Pt[(q=ke[Ce].getAttribute("name"))!=null?q:""]=(W=Ji(ke[Ce]))!=null?W:""}te!==null&&(Pt.visibility=(K=Ji(te))!=null?K:""),zt.coordTimes.length!==0&&(Pt.coordTimes=zt.coordTimes.length===1?zt.coordTimes[0]:zt.coordTimes);const Qt={type:"Feature",geometry:zt.geoms.length===1?zt.geoms[0]:{type:"GeometryCollection",geometries:zt.geoms},properties:Pt};return ic(i,"id")&&(Qt.id=(bt=ic(i,"id"))!=null?bt:void 0),[Qt]}function Vx(i,r){const u=ar(i,r),m=[],x=[];let S=[];const I=u.length;if(!(I<2)){for(let c=0;c<I;c++){const F=Gx(u[c]);m.push(F.coordinates),F.time&&x.push(F.time),(F.heartRate||S.length)&&(S.length===0&&(S=new Array(c).fill(null)),S.push(F.heartRate))}return{line:m,times:x,heartRates:S}}}function nL(i){const r=ar(i,"trkseg"),u=[],m=[],x=[];let S;for(let c=0;c<r.length;c++)if(S=Vx(r[c],"trkpt"),S!==void 0&&(S.line&&u.push(S.line),S.times&&S.times.length&&m.push(S.times),x.length||S.heartRates&&S.heartRates.length)){if(!x.length)for(let F=0;F<c;F++)x.push(new Array(u[F].length).fill(null));S.heartRates&&S.heartRates.length?x.push(S.heartRates):x.push(new Array(S.line.length).fill(null))}if(u.length===0)return;const I=hc(hc({},Sm(i)),$x(ci(i,"extensions")));return m.length!==0&&(I.coordTimes=u.length===1?m[0]:m),x.length!==0&&(I.heartRates=u.length===1?x[0]:x),u.length===1?{type:"Feature",properties:I,geometry:{type:"LineString",coordinates:u[0]}}:{type:"Feature",properties:I,geometry:{type:"MultiLineString",coordinates:u}}}function rL(i){const r=Vx(i,"rtept");return r===void 0?void 0:{type:"Feature",properties:hc(hc({},Sm(i)),$x(ci(i,"extensions"))),geometry:{type:"LineString",coordinates:r.line}}}function oL(i){return{type:"Feature",properties:hc(hc({},Sm(i)),$f(i,["sym"])),geometry:{type:"Point",coordinates:Gx(i).coordinates}}}function $x(i){var r,u;const m={};if(i){const x=ci(i,"line");if(x){const S=Ji(ci(x,"color")),I=parseFloat((r=Ji(ci(x,"opacity")))!=null?r:"0"),c=parseFloat((u=Ji(ci(x,"width")))!=null?u:"0");S&&(m.stroke=S),isNaN(I)||(m["stroke-opacity"]=I),isNaN(c)||(m["stroke-width"]=c*96/25.4)}}return m}function Sm(i){const r=$f(i,["name","cmt","desc","type","time","keywords"]),u=ar(i,"link");if(u.length!==0){r.links=[];for(const m of Array.from(u)){const x=hc({href:ic(m,"href")},$f(m,["text","type"]));r.links.push(x)}}return r}function Yy(i){let r=0;if(!i||!i.length)return r;for(let u=0;u<i.length;u++)r=(r<<5)-r+i.charCodeAt(u)|0;return r}function ar(i,r){return i.getElementsByTagName(r)}function ic(i,r){return i.getAttribute(r)}function Jy(i,r){var u;return parseFloat((u=ic(i,r))!=null?u:"0")}function ci(i,r){const u=ar(i,r);return u.length?u[0]:null}function sL(i){return i.normalize&&i.normalize(),i}function Zx(i){return i.map(parseFloat).map(r=>isNaN(r)?null:r)}function Ji(i){return i&&sL(i),i&&i.textContent}function $f(i,r){var u;const m={};let x,S;for(S=0;S<r.length;S++)x=ci(i,r[S]),x&&(m[r[S]]=(u=Ji(x))!=null?u:"");return m}function jx(i){return Zx(i.replace(/\s*/g,"").split(","))}function Qy(i){const r=i.replace(/^\s*|\s*$/g,"").split(/\s+/),u=[];for(const m of r)u.push(jx(m));return u}function Gx(i){var r,u;const m=[Jy(i,"lon"),Jy(i,"lat")],x=ci(i,"ele"),S=ci(i,"gpxtpx:hr")||ci(i,"hr"),I=ci(i,"time");let c;return x&&(c=parseFloat((r=Ji(x))!=null?r:"0"),isNaN(c)||m.push(c)),{coordinates:m,time:I?Ji(I):null,heartRate:S!==null?parseFloat((u=Ji(S))!=null?u:"0"):null}}function aL(i){try{typeof i=="string"&&(i=Tm(i))}catch{return null}try{return Nx(i)}catch{}try{return Ux(i)}catch{}return null}var lL=Object.defineProperty,cL=(i,r,u)=>r in i?lL(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,tv=(i,r,u)=>(cL(i,typeof r!="symbol"?r+"":r,u),u);function Wh(i){const r=i.toString(16);return r.length==1?"0"+r:r}function uL(i){return"#"+Wh(i[0])+Wh(i[1])+Wh(i[2])+(i.length===4?Wh(i[3]):"")}class Ze extends Array{constructor(r={}){super(),tv(this,"min",0),tv(this,"max",1),"min"in r&&(this.min=r.min),"max"in r&&(this.max=r.max),"stops"in r&&this.setStops(r.stops,{clone:!1})}static fromArrayDefinition(r){return new Ze({stops:r.map(u=>({value:u[0],color:u[1]}))})}setStops(r,u={clone:!0}){const m=u.clone?this.clone():this;m.length=0;let x=1/0,S=-1/0;for(let I=0;I<r.length;I+=1)x=Math.min(x,r[I].value),S=Math.max(S,r[I].value),m.push({value:r[I].value,color:r[I].color.slice()});return m.sort((I,c)=>I.value<c.value?-1:1),this.min=x,this.max=S,m}scale(r,u,m={clone:!0}){const x=m.clone,S=this[0].value,c=this.at(-1).value-S,F=u-r,D=[];for(let q=0;q<this.length;q+=1){const bt=(this[q].value-S)/c*F+r;x?D.push({value:bt,color:this[q].color.slice()}):this[q].value=bt}return x?new Ze({stops:D}):this}at(r){return r<0?this[this.length+r]:this[r]}clone(){return new Ze({stops:this.getRawColorStops()})}getRawColorStops(){const r=[];for(let u=0;u<this.length;u+=1)r.push({value:this[u].value,color:this[u].color});return r}reverse(r={clone:!0}){const u=r.clone?this.clone():this;for(let m=0;m<~~(u.length/2);m+=1){const x=u[m].color;u[m].color=u.at(-(m+1)).color,u.at(-(m+1)).color=x}return u}getBounds(){return{min:this.min,max:this.max}}getColor(r,u={smooth:!0}){if(r<=this[0].value)return this[0].color;if(r>=this.at(-1).value)return this.at(-1).color;for(let m=0;m<this.length-1;m+=1){if(r>this[m+1].value)continue;const x=this[m].color;if(!u.smooth)return x.slice();const S=this[m].value,I=this[m+1].value,c=this[m+1].color,F=(I-r)/(I-S);return x.map((D,q)=>Math.round(D*F+c[q]*(1-F)))}return[0,0,0]}getColorHex(r,u={smooth:!0,withAlpha:!1}){return uL(this.getColor(r,u))}getColorRelative(r,u={smooth:!0}){const m=this.getBounds();return this.getColor(m.min+r*(m.max-m.min),u)}getCanvasStrip(r={horizontal:!0,size:512,smooth:!0}){const u=document.createElement("canvas");u.width=r.horizontal?r.size:1,u.height=r.horizontal?1:r.size;const m=u.getContext("2d");if(!m)throw new Error("Canvs context is missing");const x=m.getImageData(0,0,u.width,u.height),S=x.data,I=r.size,c=this[0].value,q=(this.at(-1).value-c)/I;for(let W=0;W<I;W+=1){const K=this.getColor(c+W*q,{smooth:r.smooth});S[W*4]=K[0],S[W*4+1]=K[1],S[W*4+2]=K[2],S[W*4+3]=K.length>3?K[3]:255}return m.putImageData(x,0,0),u}resample(r,u=15){const m=this.getBounds(),x=this.scale(0,1),S=1/(u-1);let I;if(r==="ease-in-square")I=Array.from({length:u},(D,q)=>{const W=q*S,K=Math.pow(W,2),bt=x.getColor(K);return{value:W,color:bt}});else if(r==="ease-out-square")I=Array.from({length:u},(D,q)=>{const W=q*S,K=1-Math.pow(1-W,2),bt=x.getColor(K);return{value:W,color:bt}});else if(r==="ease-out-sqrt")I=Array.from({length:u},(D,q)=>{const W=q*S,K=Math.pow(W,.5),bt=x.getColor(K);return{value:W,color:bt}});else if(r==="ease-in-sqrt")I=Array.from({length:u},(D,q)=>{const W=q*S,K=1-Math.pow(1-W,.5),bt=x.getColor(K);return{value:W,color:bt}});else if(r==="ease-out-exp")I=Array.from({length:u},(D,q)=>{const W=q*S,K=1-Math.pow(2,-10*W),bt=x.getColor(K);return{value:W,color:bt}});else if(r==="ease-in-exp")I=Array.from({length:u},(D,q)=>{const W=q*S,K=Math.pow(2,10*W-10),bt=x.getColor(K);return{value:W,color:bt}});else throw new Error("Invalid ressampling method.");return new Ze({stops:I}).scale(m.min,m.max)}transparentStart(){const r=this.getRawColorStops();return r.unshift({value:r[0].value,color:r[0].color.slice()}),r[1].value+=.001,r.forEach(u=>{u.color.length===3&&u.color.push(255)}),r[0].color[3]=0,new Ze({stops:r})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}const qx={NULL:new Ze({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new Ze({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new Ze({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new Ze({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new Ze({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new Ze({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new Ze({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new Ze({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new Ze({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new Ze({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new Ze({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new Ze({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new Ze({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new Ze({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new Ze({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new Ze({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new Ze({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new Ze({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new Ze({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new Ze({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new Ze({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new Ze({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new Ze({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new Ze({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new Ze({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new Ze({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new Ze({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new Ze({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new Ze({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new Ze({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new Ze({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new Ze({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new Ze({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new Ze({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new Ze({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new Ze({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new Ze({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new Ze({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new Ze({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new Ze({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new Ze({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new Ze({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new Ze({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new Ze({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new Ze({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new Ze({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new Ze({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new Ze({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new Ze({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})},ev=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function Pm(){return ev[~~(Math.random()*ev.length)][~~(Math.random()*4)]}function Zd(){return`maptiler_source_${zx()}`}function jd(){return`maptiler_layer_${zx()}`}function iv(i,r){if(r<=i[0].zoom)return i[0].value;if(r>=i[i.length-1].zoom)return i[i.length-1].value;for(let u=0;u<i.length-1;u+=1)if(r>=i[u].zoom&&r<i[u+1].zoom){const m=i[u+1].zoom-i[u].zoom,x=(r-i[u].zoom)/m;return x*i[u+1].value+(1-x)*i[u].value}return 0}function nc(i){return["interpolate",["linear"],["zoom"],...i.map(r=>[r.zoom,r.value]).flat()]}function Qi(i){return["interpolate",["linear"],["zoom"],...i.map(r=>[r.zoom,r.value]).flat()]}function hL(i,r){if(typeof r=="number"&&typeof i=="number")return 2*r+i;if(typeof r=="number"&&Array.isArray(i))return["interpolate",["linear"],["zoom"],...i.map(u=>[u.zoom,2*r+u.value]).flat()];if(typeof i=="number"&&Array.isArray(r))return["interpolate",["linear"],["zoom"],...r.map(u=>[u.zoom,2*u.value+i]).flat()];if(Array.isArray(i)&&Array.isArray(r)){const u=Array.from(new Set([...i.map(m=>m.zoom),...r.map(m=>m.zoom)])).sort((m,x)=>m<x?-1:1);return["interpolate",["linear"],["zoom"],...u.map(m=>[m,2*iv(r,m)+iv(i,m)]).flat()]}return 0}function dL(i,r){return["interpolate",["linear"],["get",r],...i.map(u=>[u.propertyValue,u.value]).flat()]}function Hx(i){const r=i.trimStart(),u=`${r}${" ".repeat(i.length-r.length)}`,m=Array.from(u);if(!m.every(c=>c===" "||c==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(m.some(c=>c==="_")&&m.some(c=>c===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const I=[1];for(let c=1;c<m.length;c+=1){const F=m[c-1],D=m[c];F===D?I[I.length-1]+=1:I.push(1)}return I}function nv(i,r){return["interpolate",["linear"],["get",r],...i.map(u=>[u.value,u.color]).flat()]}function rv(i,r,u=!0){return u?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",r],...i.map(m=>[m.value,m.pointRadius*.025]).flat()],2,["interpolate",["linear"],["get",r],...i.map(m=>[m.value,m.pointRadius*.05]).flat()],4,["interpolate",["linear"],["get",r],...i.map(m=>[m.value,m.pointRadius*.1]).flat()],8,["interpolate",["linear"],["get",r],...i.map(m=>[m.value,m.pointRadius*.25]).flat()],16,["interpolate",["linear"],["get",r],...i.map(m=>[m.value,m.pointRadius]).flat()]]:["interpolate",["linear"],["get",r],...i.map(m=>[m.value,m.pointRadius]).flat()]}function pL(i,r,u=!0){return u?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",r],...i.map(m=>[m.propertyValue,m.value*.025]).flat()],2,["interpolate",["linear"],["get",r],...i.map(m=>[m.propertyValue,m.value*.05]).flat()],4,["interpolate",["linear"],["get",r],...i.map(m=>[m.propertyValue,m.value*.1]).flat()],8,["interpolate",["linear"],["get",r],...i.map(m=>[m.propertyValue,m.value*.25]).flat()],16,["interpolate",["linear"],["get",r],...i.map(m=>[m.propertyValue,m.value]).flat()]]:["interpolate",["linear"],["get",r],...i.map(m=>[m.propertyValue,m.value]).flat()]}function ov(i,r){return i.every(u=>u.color[3]===i[0].color[3])?i[0].color[3]?i[0].color[3]/255:1:["interpolate",["linear"],["get",r],...i.getRawColorStops().map(u=>{const m=u.value,x=u.color;return[m,x.length===4?x[3]/255:1]}).flat()]}function fL(i,r=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:r+1},(u,m)=>{const x=m/r;return[x,i.getColorHex(x)]}).flat()]}var mL=Object.defineProperty,_L=Object.defineProperties,gL=Object.getOwnPropertyDescriptors,sv=Object.getOwnPropertySymbols,yL=Object.prototype.hasOwnProperty,vL=Object.prototype.propertyIsEnumerable,av=(i,r,u)=>r in i?mL(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,rc=(i,r)=>{for(var u in r||(r={}))yL.call(r,u)&&av(i,u,r[u]);if(sv)for(var u of sv(r))vL.call(r,u)&&av(i,u,r[u]);return i},xL=(i,r)=>_L(i,gL(r)),bL=(i,r,u)=>new Promise((m,x)=>{var S=F=>{try{c(u.next(F))}catch(D){x(D)}},I=F=>{try{c(u.throw(F))}catch(D){x(D)}},c=F=>F.done?m(F.value):Promise.resolve(F.value).then(S,I);c((u=u.apply(i,r)).next())});function wL(i,r){return bL(this,arguments,function*(u,m,x={}){var S,I,c;if(!m.sourceId&&!m.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let F=m.data;if(typeof F=="string"){if($d(F))F=`https://api.maptiler.com/data/${m.data}/features.json?key=${Ao.apiKey}`;else if(((S=F.split(".").pop())==null?void 0:S.toLowerCase().trim())==="gpx"){const q=yield(yield fetch(F,x)).text();F=Nx(q)}else if(((I=F.split(".").pop())==null?void 0:I.toLowerCase().trim())==="kml"){const q=yield(yield fetch(F,x)).text();F=Ux(q)}else{const D=(c=mE(F))!=null?c:aL(F);D&&(F=D)}if(!F)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return TL(u,xL(rc({},m),{data:F}))})}function TL(i,r){var u,m,x,S,I,c,F,D,q,W,K,bt,zt,Pt,oe,Jt,Ut,Zt,Le,de;if(r.layerId&&i.getLayer(r.layerId))throw new Error(`A layer already exists with the layer id: ${r.layerId}`);const te=(u=r.sourceId)!=null?u:Zd(),Ce=(m=r.layerId)!=null?m:jd(),pe={polylineLayerId:Ce,polylineOutlineLayerId:"",polylineSourceId:te};r.data&&!i.getSource(te)&&i.addSource(te,{type:"geojson",data:r.data});const Fe=(x=r.lineWidth)!=null?x:3,ce=(S=r.lineColor)!=null?S:Pm(),Qt=(I=r.lineOpacity)!=null?I:1,fe=(c=r.lineBlur)!=null?c:0,ke=(F=r.lineGapWidth)!=null?F:0;let Ae=(D=r.lineDashArray)!=null?D:null;const Ke=(q=r.outlineWidth)!=null?q:1,we=(W=r.outlineColor)!=null?W:"#FFFFFF",Me=(K=r.outlineOpacity)!=null?K:1,Ht=(bt=r.outlineBlur)!=null?bt:0;if(typeof Ae=="string"&&(Ae=Hx(Ae)),r.outline===!0){const fi=`${Ce}_outline`;pe.polylineOutlineLayerId=fi,i.addLayer({id:fi,type:"line",source:te,layout:{"line-join":(zt=r.lineJoin)!=null?zt:"round","line-cap":(Pt=r.lineCap)!=null?Pt:"round"},minzoom:(oe=r.minzoom)!=null?oe:0,maxzoom:(Jt=r.maxzoom)!=null?Jt:23,paint:{"line-opacity":typeof Me=="number"?Me:Qi(Me),"line-color":typeof we=="string"?we:nc(we),"line-width":hL(Fe,Ke),"line-blur":typeof Ht=="number"?Ht:Qi(Ht)}},r.beforeId)}return i.addLayer({id:Ce,type:"line",source:te,layout:{"line-join":(Ut=r.lineJoin)!=null?Ut:"round","line-cap":(Zt=r.lineCap)!=null?Zt:"round"},minzoom:(Le=r.minzoom)!=null?Le:0,maxzoom:(de=r.maxzoom)!=null?de:23,paint:rc({"line-opacity":typeof Qt=="number"?Qt:Qi(Qt),"line-color":typeof ce=="string"?ce:nc(ce),"line-width":typeof Fe=="number"?Fe:Qi(Fe),"line-blur":typeof fe=="number"?fe:Qi(fe),"line-gap-width":typeof ke=="number"?ke:Qi(ke)},Ae&&{"line-dasharray":Ae})},r.beforeId),pe}function SL(i,r){var u,m,x,S,I,c,F,D,q,W,K;if(r.layerId&&i.getLayer(r.layerId))throw new Error(`A layer already exists with the layer id: ${r.layerId}`);const bt=(u=r.sourceId)!=null?u:Zd(),zt=(m=r.layerId)!=null?m:jd(),Pt={polygonLayerId:zt,polygonOutlineLayerId:r.outline?`${zt}_outline`:"",polygonSourceId:bt};if(r.data&&!i.getSource(bt)){let ce=r.data;typeof ce=="string"&&$d(ce)&&(ce=`https://api.maptiler.com/data/${ce}/features.json?key=${Ao.apiKey}`),i.addSource(bt,{type:"geojson",data:ce})}let oe=(x=r.outlineDashArray)!=null?x:null;const Jt=(S=r.outlineWidth)!=null?S:1,Ut=(I=r.outlineColor)!=null?I:"#FFFFFF",Zt=(c=r.outlineOpacity)!=null?c:1,Le=(F=r.outlineBlur)!=null?F:0,de=(D=r.fillColor)!=null?D:Pm(),te=(q=r.fillOpacity)!=null?q:1,Ce=(W=r.outlinePosition)!=null?W:"center",pe=(K=r.pattern)!=null?K:null;typeof oe=="string"&&(oe=Hx(oe));const Fe=(ce=null)=>{var Qt,fe,ke,Ae,Ke,we;if(i.addLayer({id:zt,type:"fill",source:bt,minzoom:(Qt=r.minzoom)!=null?Qt:0,maxzoom:(fe=r.maxzoom)!=null?fe:23,paint:rc({"fill-color":typeof de=="string"?de:nc(de),"fill-opacity":typeof te=="number"?te:Qi(te)},ce&&{"fill-pattern":ce})},r.beforeId),r.outline===!0){let Me;Ce==="inside"?typeof Jt=="number"?Me=.5*Jt:Me=Qi(Jt.map(({zoom:Ht,value:fi})=>({zoom:Ht,value:.5*fi}))):Ce==="outside"?typeof Jt=="number"?Me=-.5*Jt:Me=Qi(Jt.map(Ht=>({zoom:Ht.zoom,value:-.5*Ht.value}))):Me=0,i.addLayer({id:Pt.polygonOutlineLayerId,type:"line",source:bt,layout:{"line-join":(ke=r.outlineJoin)!=null?ke:"round","line-cap":(Ae=r.outlineCap)!=null?Ae:"butt"},minzoom:(Ke=r.minzoom)!=null?Ke:0,maxzoom:(we=r.maxzoom)!=null?we:23,paint:rc({"line-opacity":typeof Zt=="number"?Zt:Qi(Zt),"line-color":typeof Ut=="string"?Ut:nc(Ut),"line-width":typeof Jt=="number"?Jt:Qi(Jt),"line-blur":typeof Le=="number"?Le:Qi(Le),"line-offset":Me},oe&&{"line-dasharray":oe})},r.beforeId)}};return pe?i.hasImage(pe)?Fe(pe):i.loadImage(pe,(ce,Qt)=>{if(ce)return console.error("Could not load the pattern image.",ce.message),Fe();if(!Qt)return console.error(`An image cannot be created from the pattern URL ${pe}.`),Fe();i.addImage(pe,Qt),Fe(pe)}):Fe(),Pt}function PL(i,r){var u,m,x,S,I,c,F,D,q,W,K,bt,zt,Pt,oe,Jt;if(r.layerId&&i.getLayer(r.layerId))throw new Error(`A layer already exists with the layer id: ${r.layerId}`);const Ut=(u=r.minPointRadius)!=null?u:10,Zt=(m=r.maxPointRadius)!=null?m:50,Le=(x=r.cluster)!=null?x:!1,de=20,te=Array.isArray(r.pointColor)?r.pointColor:qx.TURBO.scale(10,r.cluster?1e4:1e3).resample("ease-out-square"),Ce=te.getBounds(),pe=(S=r.sourceId)!=null?S:Zd(),Fe=(I=r.layerId)!=null?I:jd(),ce=(c=r.showLabel)!=null?c:Le,Qt=(F=r.alignOnViewport)!=null?F:!0,fe=(D=r.outline)!=null?D:!1,ke=(q=r.outlineOpacity)!=null?q:1,Ae=(W=r.outlineWidth)!=null?W:1,Ke=(K=r.outlineColor)!=null?K:"#FFFFFF";let we;const Me=(bt=r.zoomCompensation)!=null?bt:!0,Ht=(zt=r.minzoom)!=null?zt:0,fi=(Pt=r.maxzoom)!=null?Pt:23;typeof r.pointOpacity=="number"?we=r.pointOpacity:Array.isArray(r.pointOpacity)?we=Qi(r.pointOpacity):r.cluster?we=ov(te,"point_count"):r.property?we=ov(te,r.property):we=Qi([{zoom:Ht,value:0},{zoom:Ht+.25,value:1},{zoom:fi-.25,value:1},{zoom:fi,value:0}]);const ze={pointLayerId:Fe,clusterLayerId:"",labelLayerId:"",pointSourceId:pe};if(r.data&&!i.getSource(pe)){let Ue=r.data;typeof Ue=="string"&&$d(Ue)&&(Ue=`https://api.maptiler.com/data/${Ue}/features.json?key=${Ao.apiKey}`),i.addSource(pe,{type:"geojson",data:Ue,cluster:Le})}if(Le){ze.clusterLayerId=`${Fe}_cluster`;const Ue=Array.from({length:de},(si,je)=>{const ui=Ce.min+je*(Ce.max-Ce.min)/(de-1);return{value:ui,pointRadius:Ut+(Zt-Ut)*Math.pow(je/(de-1),.5),color:te.getColorHex(ui)}});i.addLayer({id:ze.clusterLayerId,type:"circle",source:pe,filter:["has","point_count"],paint:rc({"circle-color":typeof r.pointColor=="string"?r.pointColor:nv(Ue,"point_count"),"circle-radius":typeof r.pointRadius=="number"?r.pointRadius:Array.isArray(r.pointRadius)?Qi(r.pointRadius):rv(Ue,"point_count",!1),"circle-pitch-alignment":Qt?"viewport":"map","circle-pitch-scale":"map","circle-opacity":we},fe&&{"circle-stroke-opacity":typeof ke=="number"?ke:Qi(ke),"circle-stroke-width":typeof Ae=="number"?Ae:Qi(Ae),"circle-stroke-color":typeof Ke=="string"?Ke:nc(Ke)}),minzoom:Ht,maxzoom:fi},r.beforeId),i.addLayer({id:ze.pointLayerId,type:"circle",source:pe,filter:["!",["has","point_count"]],paint:rc({"circle-pitch-alignment":Qt?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof r.pointColor=="string"?r.pointColor:te.getColorHex(te.getBounds().min),"circle-radius":typeof r.pointRadius=="number"?r.pointRadius:Array.isArray(r.pointRadius)?Qi(r.pointRadius):Ue[0].pointRadius*.75,"circle-opacity":we},fe&&{"circle-stroke-opacity":typeof ke=="number"?ke:Qi(ke),"circle-stroke-width":typeof Ae=="number"?Ae:Qi(Ae),"circle-stroke-color":typeof Ke=="string"?Ke:nc(Ke)}),minzoom:Ht,maxzoom:fi},r.beforeId)}else{let Ue=typeof r.pointColor=="string"?r.pointColor:Array.isArray(r.pointColor)?r.pointColor.getColorHex(r.pointColor.getBounds().min):Pm(),si=typeof r.pointRadius=="number"?Me?Qi([{zoom:0,value:r.pointRadius*.025},{zoom:2,value:r.pointRadius*.05},{zoom:4,value:r.pointRadius*.1},{zoom:8,value:r.pointRadius*.25},{zoom:16,value:r.pointRadius*1}]):r.pointRadius:Array.isArray(r.pointRadius)?Qi(r.pointRadius):Me?Qi([{zoom:0,value:Ut*.05},{zoom:2,value:Ut*.1},{zoom:4,value:Ut*.2},{zoom:8,value:Ut*.5},{zoom:16,value:Ut*1}]):Ut;if(r.property&&Array.isArray(r.pointColor)){const je=Array.from({length:de},(ui,hi)=>{const Oe=Ce.min+hi*(Ce.max-Ce.min)/(de-1);return{value:Oe,pointRadius:typeof r.pointRadius=="number"?r.pointRadius:Ut+(Zt-Ut)*Math.pow(hi/(de-1),.5),color:typeof r.pointColor=="string"?r.pointColor:te.getColorHex(Oe)}});Ue=nv(je,r.property),si=rv(je,r.property,Me)}i.addLayer({id:ze.pointLayerId,type:"circle",source:pe,layout:{"circle-sort-key":r.property?["/",1,["get",r.property]]:0},paint:rc({"circle-pitch-alignment":Qt?"viewport":"map","circle-pitch-scale":"map","circle-color":Ue,"circle-opacity":we,"circle-radius":si},fe&&{"circle-stroke-opacity":typeof ke=="number"?ke:Qi(ke),"circle-stroke-width":typeof Ae=="number"?Ae:Qi(Ae),"circle-stroke-color":typeof Ke=="string"?Ke:nc(Ke)}),minzoom:Ht,maxzoom:fi},r.beforeId)}if(ce!==!1&&(r.cluster||r.property)){ze.labelLayerId=`${Fe}_label`;const Ue=(oe=r.labelColor)!=null?oe:"#fff",si=(Jt=r.labelSize)!=null?Jt:12;i.addLayer({id:ze.labelLayerId,type:"symbol",source:pe,filter:["has",r.cluster?"point_count":r.property],layout:{"text-field":r.cluster?"{point_count_abbreviated}":`{${r.property}}`,"text-font":["Noto Sans Regular"],"text-size":si,"text-pitch-alignment":Qt?"viewport":"map","symbol-sort-key":["/",1,["get",r.cluster?"point_count":r.property]]},paint:{"text-color":Ue,"text-opacity":we},minzoom:Ht,maxzoom:fi},r.beforeId)}return ze}function AL(i,r){var u,m,x,S,I,c,F,D,q,W;if(r.layerId&&i.getLayer(r.layerId))throw new Error(`A layer already exists with the layer id: ${r.layerId}`);const K=(u=r.sourceId)!=null?u:Zd(),bt=(m=r.layerId)!=null?m:jd(),zt=(x=r.minzoom)!=null?x:0,Pt=(S=r.maxzoom)!=null?S:23,oe=(I=r.zoomCompensation)!=null?I:!0,Jt=(c=r.opacity)!=null?c:[{zoom:zt,value:0},{zoom:zt+.25,value:1},{zoom:Pt-.25,value:1},{zoom:Pt,value:0}];let Ut=Array.isArray(r.colorRamp)?r.colorRamp:qx.TURBO.transparentStart();const Zt=Ut.getBounds();(Zt.min!==0||Zt.max!==1)&&(Ut=Ut.scale(0,1)),Ut.hasTransparentStart()||(Ut=Ut.transparentStart());const Le=(F=r.intensity)!=null?F:[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],de=(D=r.property)!=null?D:null,te=(q=r.weight)!=null?q:1;let Ce=1;de?typeof te=="number"?(Ce=te,typeof r.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(te)?Ce=dL(te,de):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof te=="number"?Ce=te:Array.isArray(te)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const pe=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],Fe=(W=r.radius)!=null?W:oe?pe:10;let ce=1;typeof Fe=="number"?ce=Fe:Array.isArray(Fe)&&"zoom"in Fe[0]?ce=Qi(Fe):de&&Array.isArray(Fe)&&"propertyValue"in Fe[0]?ce=pL(Fe,de,oe):!de&&Array.isArray(Fe)&&"propertyValue"in Fe[0]?(ce=Qi(pe),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):ce=Qi(pe);const Qt={heatmapLayerId:bt,heatmapSourceId:K};if(r.data&&!i.getSource(K)){let fe=r.data;typeof fe=="string"&&$d(fe)&&(fe=`https://api.maptiler.com/data/${fe}/features.json?key=${Ao.apiKey}`),i.addSource(K,{type:"geojson",data:fe})}return i.addLayer({id:bt,type:"heatmap",source:K,minzoom:zt,maxzoom:Pt,paint:{"heatmap-weight":Ce,"heatmap-intensity":typeof Le=="number"?Le:Qi(Le),"heatmap-color":fL(Ut),"heatmap-radius":ce,"heatmap-opacity":typeof Jt=="number"?Jt:Qi(Jt)}}),Qt}const lv={addPolyline:wL,addPolygon:SL,addPoint:PL,addHeatmap:AL},{setRTLTextPlugin:WL,getRTLTextPluginStatus:KL,LngLat:IL,LngLatBounds:XL,MercatorCoordinate:YL,Evented:JL,AJAXError:QL,prewarm:tM,clearPrewarmedResources:eM,version:iM,workerCount:nM,maxParallelImageRequests:rM,workerUrl:oM,addProtocol:sM,removeProtocol:aM}=wi;wi.Map;wi.Marker;wi.Popup;wi.Style;wi.CanvasSource;wi.GeoJSONSource;wi.ImageSource;wi.RasterTileSource;wi.RasterDEMTileSource;wi.VectorTileSource;wi.VideoSource;wi.NavigationControl;wi.GeolocateControl;wi.AttributionControl;wi.LogoControl;wi.ScaleControl;wi.FullscreenControl;wi.TerrainControl;function CL(){li.MaptilerLayer=li.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(i){li.setOptions(this,i),this._throttledUpdate=li.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(i){this._container||this._initContainer();const r=document.createElement("a");r.href="https://www.maptiler.com",r.style="position:absolute; left:10px; bottom:2px; z-index:999;";const u=document.createElement("img");u.src="https://api.maptiler.com/resources/logo.svg",u.alt="MapTiler logo",u.width="100",u.height="30",r.appendChild(u),i.getContainer().appendChild(r);const m=this.getPaneName();i.getPane(m).appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),i.options.zoomAnimation&&li.DomEvent.on(i._proxy,li.DomUtil.TRANSITION_END,this._transitionEnd,this),i.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(i){this._map._proxy&&this._map.options.zoomAnimation&&li.DomEvent.off(this._map._proxy,li.DomUtil.TRANSITION_END,this._transitionEnd,this);const r=this.getPaneName();i.getPane(r).removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const i=this.getSize().multiplyBy(.5),r=this._map.latLngToContainerPoint(this._map.getCenter());return li.latLngBounds(this._map.containerPointToLatLng(r.subtract(i)),this._map.containerPointToLatLng(r.add(i)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(i){this._maptilerMap.setStyle(i)},setLanguage:function(i){this._maptilerMap.setLanguage(i)},_roundPoint:function(i){return{x:Math.round(i.x),y:Math.round(i.y)}},_initContainer:function(){const i=this._container=li.DomUtil.create("div","leaflet-gl-layer"),r=this.getSize(),u=this._map.getSize().multiplyBy(this.options.padding);i.style.width=r.x+"px",i.style.height=r.y+"px";const m=this._map.containerPointToLayerPoint([0,0]).subtract(u);li.DomUtil.setPosition(i,this._roundPoint(m))},_initMaptilerSDK:function(){const i=this._map.getCenter();let r=this.options.style,u=this.options.apiKey;if((typeof this.options.style=="string"||this.options.style instanceof String)&&this.options.style.startsWith("https://api.maptiler.com/maps/"))try{const S=new URL(this.options.style),I=S.searchParams.get("key");I&&(u=I,S.searchParams.delete("key"),r=S.href)}catch(S){console.error(S)}const m={...this.options,style:r,apiKey:u,container:this._container,center:[i.lng,i.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(delete m.center,delete m.zoom),this._maptilerMap=new Ox(m),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._maptilerMap.transform.latRange=null,this._maptilerMap.transform.maxValidLatitude=1/0,this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const x=this._maptilerMap._actualCanvas;li.DomUtil.addClass(x,"leaflet-image-layer"),li.DomUtil.addClass(x,"leaflet-zoom-animated"),this.options.interactive&&li.DomUtil.addClass(x,"leaflet-interactive"),this.options.className&&li.DomUtil.addClass(x,this.options.className),Object.keys(lv).forEach(S=>{this[S]=I=>lv[S].apply(null,[this._maptilerMap,I])})},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const i=this.getSize(),r=this._map.getSize().multiplyBy(this.options.padding),u=this._map.containerPointToLayerPoint([0,0]).subtract(r);li.DomUtil.setPosition(this._container,this._roundPoint(u)),this._transformGL(),this._maptilerMap.transform.width!==i.x||this._maptilerMap.transform.height!==i.y?(this._container.style.width=i.x+"px",this._container.style.height=i.y+"px",this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){const i=this._map.getCenter(),r=this._maptilerMap.transform;r.center=IL.convert([i.lng,i.lat]),r.zoom=this._map.getZoom()-1},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(i){const r=this._map.getZoomScale(i.zoom),u=this._map.getSize().multiplyBy(this.options.padding*r),m=this.getSize()._divideBy(2),x=this._map.project(i.center,i.zoom)._subtract(m)._add(this._map._getMapPanePos().add(u))._round(),S=this._map.project(this._map.getBounds().getNorthWest(),i.zoom)._subtract(x);li.DomUtil.setTransform(this._maptilerMap._actualCanvas,S.subtract(this._offset),r)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const i=this._map.getZoomScale(this._map.getZoom());li.DomUtil.setTransform(this._maptilerMap._actualCanvas,null,i),this._zooming=!1,this._update()},_transitionEnd:function(){li.Util.requestAnimFrame(function(){const i=this._map.getZoom(),r=this._map.getCenter(),u=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());li.DomUtil.setTransform(this._maptilerMap._actualCanvas,u,1),this._maptilerMap.once("moveend",li.Util.bind(function(){this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:r,zoom:i-1})},this)},_resize:function(i){this._transitionEnd(i)}}),li.MaptilerLayer,li.maptilerLayer=function(i){return new li.MaptilerLayer(i)},li.maptilerLayer,li.MaptilerStyle={},Object.keys(Bf).forEach(i=>{li.MaptilerStyle[i]=Bf[i]}),li.MaptilerStyle,li.MaptilerStyle,li.maptilerStyle=li.MaptilerStyle,li.MaptilerLanguage={},Object.keys(Bi).forEach(i=>{li.MaptilerLanguage[i]=Bi[i]}),li.MaptilerLanguage,li.MaptilerLanguage,li.maptilerLanguage=li.MaptilerLanguage}(()=>{try{CL()}catch(i){console.error(i)}})();const cv=14,EL=lh({__name:"Map",props:{state:Number},setup(i){const r=i,u=Er();let m=Er(!1),x,S=Er(2020),I=Er(!0),c=Er(!1),F=Er(),D=Er(),q=Er(),W=Er(),K=Er(),bt=Er(),zt=Mf(),Pt,oe,Jt,Ut,Zt,Le,de,te,Ce=Er(),pe=Er(),Fe,ce=Er(!1);const Qt=window.innerWidth,fe=window.innerHeight,ke=Qt<1024?280:199,Ae=`height:${fe-ke}px`;Jh(()=>r.state,be=>{be===2.5&&(u.value={PROGNOSERA:"Zentrum",ANGEBOTSMIETEN:16.17},Zr("#Zentrum").attr("opacity",1),Ue(u.value,[Qt/2,fe/2])),be!==2.5&&Zr("#Zentrum").attr("opacity",0),be===2.6&&(u.value={PROGNOSERA:"Marzahn",ANGEBOTSMIETEN:7.21},Zr("#Marzahn").attr("opacity",1),Ue(u.value,[Qt/2+60,fe/2-400])),be!==2.6&&Zr("#Marzahn").attr("opacity",0),be!==2.5&&be!==2.6&&Ke(),be&&be<3&&(S.value=2020,I.value=!0,c.value=!1,Oe(oe)),be===3&&(S.value=2020,I.value=!0,c.value=!0,Oe(oe)),be===4&&(S.value=2009,c.value=!0,I.value=!0,Oe(Pt)),be===5&&(S.value=2009,c.value=!0,I.value=!1,Oe(Pt))});function Ke(){const be=Zr("#tooltip");be.classed("opacity-0",!0),be.classed("opacity-90",!1)}function we(be){be&&(be==="initial"?(Zt.setView([52.5,13.4],Fe),Ut.setView([52.5,13.4],Fe)):be==="in"?(Ut.zoomIn(),Zt.zoomIn()):(Ut.zoomOut(),Zt.zoomOut())),setTimeout(()=>{Ce.value=Ut.getZoom()},250)}const Me=td(()=>"bg-gray-400 text-white border-none rounded pointer-events-none "),Ht=td(()=>"bg-gray-50 text-gray-800 border-gray-50");function fi(be){be===2009?(S.value=2009,c.value=!0,Oe(Pt)):be===2020&&(S.value=2020,I.value=!0,Oe(oe))}function ze(be){be===2009?c.value=!c.value:I.value=!I.value,m.value=!m.value,Oe(S.value===2020?oe:Pt)}function Ue(be,Ge){let ti,en;const ei=Zr("#tooltip");Zr("#rent-indicator").classed("hidden",!1),ei.classed("opacity-0",!1),ei.classed("opacity-90",!0),Qt>668&&(Ge[0]>Qt-250?ti=Ge[0]-200:ti=Ge[0]+50,Ge[1]<250?en=Ge[1]+100:en=Ge[1]-150,ei.style("left",ti+"px").style("top",en+"px")),u.value=be}const si=td(()=>`background: linear-gradient(90deg,${zt(F.value)}, ${zt(q.value)}, ${zt(D.value)} )`);function je(){var en;const be=(en=u.value)==null?void 0:en.ANGEBOTSMIETEN,Ge=be&&(be-F.value)/(D.value-F.value)*99;Zr("#rent-indicator").style("left",`${Ge==null?void 0:Ge.toFixed(2)}%`)}function ui(){Jt=Pt.concat(oe),Jt.forEach(be=>{be.Angebotsmieten=+be.Angebotsmieten}),W.value=Og(Jt,be=>be.Angebotsmieten),K.value=Bg(Jt,be=>be.Angebotsmieten),bt.value=Number(Fg(Jt,be=>be.Angebotsmieten).toFixed(2))}function hi(){const be=Le.selectAll("path").data(vy(x,x.objects.progs).features).enter().append("path").attr("d",ti=>te(ti)).style("transition","opacity 0.15s").attr("stroke","rgb(0,0,0,0.7)").attr("stroke-width",3).attr("opacity",0).attr("fill","transparent").attr("id",ti=>ti.properties.PROGNOSERA).on("mouseenter",(ti,en)=>{!ce.value&&Zr(ti.currentTarget).attr("opacity",1);const[ei,ut]=DP(ti,Zr("#main-map").node());Ue(en.properties,[ei,ut]),je()}).on("mouseleave",ti=>{Zr(ti.currentTarget).attr("opacity",0),Ke(),Zr("#rent-indicator").classed("hidden",!0)}),Ge=()=>{be.attr("d",te)};Ge(),Zt.on("moveend zoomend",Ge)}function Oe(be){let Ge={};be.forEach(ei=>{Ge[ei.Prognoseraum]=+ei.Angebotsmieten}),x.features=vy(x,x.objects.progs).features.map(ei=>(ei.properties.ANGEBOTSMIETEN=Ge[ei.properties.PROGNOSERA],ei)),c.value&&I.value?(D.value=K.value,F.value=W.value,q.value=bt.value):(D.value=Bg(x.features,ei=>ei.properties.ANGEBOTSMIETEN),F.value=Og(x.features,ei=>ei.properties.ANGEBOTSMIETEN),q.value=Number(Fg(x.features,ei=>ei.properties.ANGEBOTSMIETEN).toFixed(2))),zt=Mf().domain([F.value,q.value,D.value]).range(["#1E6E6B","#EDE9D6","#B24424"]).interpolate(rh.gamma(-.1));const ti=de.selectAll("path").data(x.features).enter().append("path").attr("d",ei=>te(ei)).attr("stroke","white").attr("stroke-width",.2).attr("fill","transparent");de.selectAll("path").transition().attr("fill",ei=>Number.isNaN(ei.properties.ANGEBOTSMIETEN)?"white":zt(ei.properties.ANGEBOTSMIETEN));const en=()=>{ti.attr("d",te);const ei=Ut.getCenter();Zt.setView(new li.LatLng(ei.lat,ei.lng),Ut.getZoom(),{animate:!0})};en(),Ut.on("moveend zoomend",en)}function pn(){var Bt;Qt<450&&(Fe=9.25),Qt>=450&&Qt<1280&&(Fe=10),Qt>=1280&&(Fe=11.25),pe.value=Fe;const be={minZoom:pe.value,maxZoom:cv,scrollWheelZoom:!1,zoomControl:!1,zoomSnap:.75,zoomDelta:.75,dragging:!(Qt<1280),tap:!(Qt<1280),maxBoundsViscosity:.8,touchZoom:Qt<1280};Ut=li.map("main-map",be).setView([52.5,13.4],Fe),Zt=li.map("border-map",be).setView([52.5,13.4],Fe),Ce.value=Ut.getZoom();const Ge=li.latLngBounds([52.71,14.13],[52.3,12.7]);Ut.setMaxBounds(Ge),Zt.setMaxBounds(Ge),new li.MaptilerLayer({apiKey:"hsl5L4grOcWPCDYacsGF",style:"https://api.maptiler.com/maps/f9fd35b5-3026-423b-ac7e-4dc7537efabb/style.json?key=hsl5L4grOcWPCDYacsGF",attributionControl:!1}).addTo(Ut),li.control.scale({imperial:!1,maxWidth:150}).addTo(Ut),li.svg().addTo(Ut),li.svg().addTo(Zt);const ti=Zr(Ut.getPanes().overlayPane),en=Zr(Ut.getPanes().tilePane);de=ti.select("svg").append("g"),en.style("z-index",5),en.style("pointer-events","none"),Ut.getPanes().overlayPane.style.zIndex=4,Ut.getPanes().mapPane.style.zIndex=1,Le=Zr(Zt.getPanes().overlayPane).select("svg").attr("pointer-events","auto").append("g");const Vt=oC({point:function(Nt,re){const dt=Ut.latLngToLayerPoint(new li.LatLng(re,Nt));this.stream.point(dt.x,dt.y)}});te=rC().projection(Vt),(Bt=document.getElementById("border-map"))==null||Bt.addEventListener("mousedown",function(Nt){var re;Nt.stopImmediatePropagation(),(re=document.getElementById("main-map"))==null||re.dispatchEvent(new MouseEvent("mousedown",Nt))},!0),Zt.on("zoomstart",()=>{Ut.dragging.disable(),ce.value=!0}),Ut.on("zoomstart",()=>{Ut.dragging.disable(),ce.value=!0}),Zt.on("zoomend",()=>{Ut.dragging.enable(),ce.value=!1,Ce.value=Ut.getZoom()}),Ut.on("zoom",()=>{ce.value=!0,Ut.dragging.disable()}),Ut.on("move",()=>{ce.value=!0,Ut.doubleClickZoom.disable()}),Ut.on("movestart",()=>{ce.value=!0,Ut.doubleClickZoom.disable()}),Zt.on("movestart",()=>{ce.value=!0,Ut.doubleClickZoom.disable()}),Zt.on("moveend",()=>{ce.value=!1,Ut.doubleClickZoom.enable(),Ut.dragging.enable()}),Oe(oe),hi()}return nm(()=>{Promise.all([iy("mieten_berlin_2009.csv"),iy("mieten_berlin_2020.csv"),MI("simplified.topo.json")]).then(be=>{Pt=be[0],oe=be[1],x=be[2],ui(),pn()})}),(be,Ge)=>(Jo(),ia("div",{class:"px-2 lg:px-8 transition-all duration-500",style:eu(i.state===1&&"filter: saturate(0%)")},[Qo($T,{selectedYear:Gr(S),selected:u.value,mapHeightCalculated:Ae,mapIsMoving:Gr(ce),state:i.state},null,8,["selectedYear","selected","mapIsMoving","state"]),Qo(DT,{state:i.state,zoomLevel:Gr(Ce),minZoom:Gr(pe),maxZoom:cv,initZoomLevel:Gr(Fe),selectedYear:Gr(S),colorScale2009:Gr(c),colorScale2020:Gr(I),minRent:Gr(F),maxRent:Gr(D),meanRent:Gr(q),selectedButton:Me.value,unselectedButton:Ht.value,legendScale:si.value,onZoomIn:Ge[0]||(Ge[0]=ti=>we("in")),onZoomOut:Ge[1]||(Ge[1]=ti=>we("out")),onZoomInitial:Ge[2]||(Ge[2]=ti=>we("initial")),onToggleYear2020:Ge[3]||(Ge[3]=ti=>fi(2020)),onToggleYear2009:Ge[4]||(Ge[4]=ti=>fi(2009)),onToggleColorScales2020:Ge[5]||(Ge[5]=ti=>ze(2020)),onToggleColorScales2009:Ge[6]||(Ge[6]=ti=>ze(2009))},null,8,["state","zoomLevel","minZoom","initZoomLevel","selectedYear","colorScale2009","colorScale2020","minRent","maxRent","meanRent","selectedButton","unselectedButton","legendScale"])],4))}}),LL="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%235f6368'%3e%3cpath%20d='M480-344%20240-584l56-56%20184%20184%20184-184%2056%2056-240%20240Z'/%3e%3c/svg%3e",ML={class:"bg-white flex-col w-full p-4 opacity-90 flex justify-center items-center lg:text-xl max-w-screen-lg mx-auto"},kL=["innerHTML"],zL={key:0,src:LL,alt:"scroll-down",width:"80",height:"80"},RL=lh({__name:"FlyingTextBlock",props:{text:{},marginBottom:{},first:{}},setup(i){return(r,u)=>(Jo(),ia("div",ML,[bi("div",{style:{"line-height":"1.5"},innerHTML:r.text},null,8,kL),r.first?(Jo(),ia("img",zL)):d0("",!0)]))}}),DL=lh({__name:"App",setup(i){const r=window.innerHeight,u=`gap:${r}px`,m=`margin-bottom:${r+100}px`,x=`padding-top:${r/8}px`,S=u+";"+m+";"+x;let I=Er(1),c=Er(),F,D,q,W,K,bt,zt,Pt;function oe(){F=document.getElementById("one"),D=document.getElementById("two"),q=document.getElementById("two-a"),W=document.getElementById("two-b"),K=document.getElementById("three"),bt=document.getElementById("four"),zt=document.getElementById("five"),Pt=document.getElementById("six")}function Jt(){F&&D&&F.getBoundingClientRect().top>0&&D.getBoundingClientRect().top>r&&(I.value=1),F&&F.getBoundingClientRect().top<0&&(I.value=2),D&&D.getBoundingClientRect().bottom<r&&(I.value=2),q&&q.getBoundingClientRect().bottom<r&&(I.value=2.5),W&&W.getBoundingClientRect().bottom<r&&(I.value=2.6),K&&K.getBoundingClientRect().bottom<r&&(I.value=3),bt&&bt.getBoundingClientRect().bottom<r&&(I.value=4),zt&&zt.getBoundingClientRect().bottom<r&&(I.value=5),Pt&&Pt.getBoundingClientRect().bottom<r&&(I.value=6)}async function Ut(){try{const Le=await fetch("/blockTexts.json");if(!Le.ok)throw new Error("Network response was not ok");return await Le.json()}catch(Le){console.error("Error fetching blockTexts:",Le)}}function Zt(){window.scrollTo(0,0)}return nm(async()=>{c.value=await Ut(),setTimeout(()=>{oe()},1e3),window.addEventListener("beforeunload",Zt)}),Gv(()=>{window.removeEventListener("beforeunload",Zt)}),(Le,de)=>(Jo(),ia("div",{class:"w-full",onWheel:de[0]||(de[0]=te=>Jt()),onTouchmove:de[1]||(de[1]=te=>Jt())},[Qo(EL,{state:Gr(I),class:"fixed z-0 w-full left-0 top-0"},null,8,["state"]),Gr(c)?(Jo(),ia("div",{key:0,class:"relative z-1 w-full flex flex-col px-10",style:S},[(Jo(!0),ia(Wo,null,of(Gr(c),(te,Ce)=>(Jo(),u0(RL,{key:Ce,id:Ce,text:te,"margin-bottom":m,first:Ce==="one"},{default:Vv(()=>[dd(Ra(Ce),1)]),_:2},1032,["id","text","first"]))),128))])):d0("",!0)],32))}});sT(DL).mount("#app");
